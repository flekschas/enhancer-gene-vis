{"version":3,"sources":["AppInitializing.js","AppError.js","ChromInfoProvider.js","use-debounce.js","CheckboxList.js","Logo.js","FileInput.js","utils.js","local-bed-data-server.js","use-query-string.js","constants.js","state.js","VariantsSettings.js","Welcome.js","ModalProvider.js","AppSidebar.js","SearchField.js","use-previous.js","AppTopbar.js","EnhancerRegionsInfo.js","EnhancerRegionsHelp.js","EnhancerRegionsSettings.js","TitleBar.js","view-config.js","EnhancerRegions.js","EnhancerGenesInfo.js","EnhancerGenesHelp.js","EnhancerGenesSettings.js","TooltipProvider.js","EnhancerGenesPlot.js","EnhancerGenes.js","DnaAccessibilityInfo.js","DnaAccessibilityHelp.js","DnaAccessibilitySettings.js","DnaAccessibility.js","AppMain.js","with-either.js","App.js","serviceWorker.js","annotation-overlay-meta-track.js","ridge-plot-track.js","stratified-bed-track.js","snp-track.js","stacked-bar-track.js","tss-track.js","local-bed-data-fetcher.js","index.js"],"names":["useStyles","makeStyles","theme","backdrop","zIndex","drawer","color","backgroundColor","AppInitializing","classes","className","Backdrop","open","CircularProgress","ChromInfoContext","createContext","ChromInfoProvider","children","chromInfo","Provider","value","useChromInfo","context","React","useContext","undefined","Error","useDebounce","delay","useState","debouncedValue","setDebouncedValue","useEffect","handler","setTimeout","clearTimeout","root","position","filterBar","top","content","right","left","bottom","background","checkbox","marginTop","marginBottom","checkboxLabel","fontSize","marginLeft","nestedCheckbox","visible","transition","transform","height","invisible","Option","memo","filterState","name","stateWithName","group","stateWithGroup","colorCheckbox","colorText","filter","useRecoilValue","useRecoilState","state","setState","groupState","setGroupState","nameLowerCase","useMemo","toLowerCase","changeHandler","useCallback","event","currState","checked","target","currGroupState","newGroupState","n","N","length","includes","FormControlLabel","key","control","Checkbox","style","icon","checkedIcon","onChange","label","Typography","noWrap","OptionGroup","NestedCheckboxList","optionWithName","optionGroupWithGroup","filterLabel","groupedOptions","optionToGroup","groupColors","groupColorsDark","globalFilter","setGlobalFilter","setFilter","filterDb","filterChangeHandler","filterBarBg","FormControl","variant","margin","fullWidth","InputLabel","htmlFor","Grid","container","direction","alignItems","OutlinedInput","id","FormGroup","map","i","Fragment","options","option","logo","padding","lineHeight","fontWeight","logoAbc","letterSpacing","paddingRight","logoEnhancer","Logo","props","styles","item","defaultProps","FileInput","forwardRef","ref","clearHandler","onClear","accept","Icon","InsertDriveFileIcon","otherProps","file","setFile","localChangeHandler","fileList","files","clearFile","ButtonGroup","Button","component","disableElevation","startIcon","type","hidden","disabled","onClick","contains","a","b","createColorTexture","PIXI","colors","colorTexRes","Math","max","ceil","sqrt","rgba","Float32Array","forEach","Texture","fromBuffer","dashedXLineTo","graphics","xStart","xEnd","y","dashSize","diff","sign","width","abs","stepSize","numSteps","moveTo","lineTo","getQueryStringValue","decoder","identity","queryString","parse","window","location","search","setQueryStringValue","encoder","values","newQsValue","stringify","strict","url","origin","pathname","history","pushState","path","toAbsPosition","absPosition","indexOf","split","chrom","pos","chrPositions","toFixed","number","decimals","forced","string","substring","scaleBand","domain","fixedBandwidth","bandwidth","range","rangeSize","paddingInner","paddingInnerZeroBased","totalWidth","sum","getBandwidth","update","totalPaddingInner","reduce","scale","v","idx","slice","newDomain","newRange","newFixedBandwidth","newPaddingInner","newPaddingInnerZeroBased","booleanQueryStringDecoder","header","columnImportance","tree","IntervalTree","text","lines","fields","chromOffset","startAbs","endAbs","insert","chrOffset","importance","uid","createLocalBedDataServer","tilesetInfo","whenIndex","loadFile","subscriptionTile","globalPubSub","subscribe","fileId","z","x","requestId","then","index","tileWidth","max_width","start","end","results","publish","subscriptionTilesetInfo","destroy","unsubscribe","useRecoilQueryString","atom","setValue","onSetValue","newValue","EPS","DEFAULT_COLOR_MAP","DEFAULT_COLOR_MAP_DARK","DEFAULT_COLOR_MAP_LIGHT","GENE_SEARCH_URL","VARIANT_SEARCH_URL","DEFAULT_STRATIFICATION","categoryField","axisShowGroupSeparator","axisNoGroupColor","groups","categories","GROUPED_SAMPLE_OPTIONS","SAMPLE_TO_GROUP","sampleToGroup","SAMPLES","flatMap","SAMPLE_IDX","idxs","sample","DEFAULT_VARIANT_TRACK_DEF","axisPositionHorizontal","markColor","markColorFocus","markSize","markOpacity","markOpacityFocus","valueColumn","labelPosition","labelColor","labelOpacity","showMousePosition","showGlobalMousePosition","mousePositionColor","toolTip","field","numDecimals","other","LOCAL_BED_TILESET_INFO_HG19","zoom_step","max_length","assembly","chrom_names","chrom_sizes","tile_size","max_zoom","min_pos","max_pos","version","coordSystem","DEFAULT_VIEW_CONFIG_ENHANCER","editable","trackSourceServers","views","genomePositionSearchBox","autocompleteServer","autocompleteId","chromInfoServer","chromInfoId","chromInfoPath","tracks","contents","stroke","fontIsLeftAligned","tilesetUid","server","fromViewUid","projectionFillColor","projectionStrokeColor","projectionFillOpacity","projectionStrokeOpacity","strokeWidth","plusStrandColor","minusStrandColor","geneAnnotationHeight","geneLabelPosition","geneStrandSpacing","focusRegion","strokeColor","strokeOpacity","arcStyle","startField","endField","set","binSize","axisAlign","offsetField","importanceField","importanceDomain","stratification","legendAlign","markColorHighlight","markColorDehighlight","markMinWidth","markHeight","rowHeight","indicatorStyle","geneField","overlays","extent","minWidth","fill","fillOpacity","outline","outlineOpacity","outlineWidth","outlinePos","metaTracks","overlaysTrack","annotationTracks","layout","w","h","initialXDomain","initialYDomain","DEFAULT_DNA_ACCESSIBILITY_ROW_SELECTION","DEFAULT_DNA_ACCESSIBILITY_ROW_CATEGORIES","row","category","axisLabelColor","axisLabelBackground","DEFAULT_VIEW_CONFIG_DNA_ACCESSIBILITY","zoomFixed","labelShowResolution","labelShowAssembly","markArea","markResolution","valueScaling","colorRange","rowPadding","rowNormalization","rowSelections","rowIdToCategory","fn","args","rowCategories","showRowLabels","rowLabelSize","getDefault","initialValue","chrPosUrlEncoder","chrPos","replace","chrPosUrlDecoder","sampleFilterState","default","sampleSelectionState","selector","get","sampleWithName","selectedSamplesState","memoize","sampleGroupWithGroup","sampleGroupSelectionSizesState","sizes","variantTracksState","deepClone","columnPvalue","columnPosteriorProbability","showVariantsSettingsState","showWelcomeState","dnaAccessLabelStyleState","dnaAccessLabelShowInfoState","focusGeneState","focusGeneOptionState","focusVariantState","focusVariantOptionState","variantYScaleState","enhancerRegionsHideUnfocusedState","enhancerRegionsColorEncodingState","enhancerRegionsShowInfoState","enhancerGenesShowInfoState","enhancerGenesPaddingState","enhancerGenesCellEncodingState","enhancerGenesSvgState","higlassEnhancerRegionsState","higlassDnaAccessState","xDomainStartWithAssembly","totalLength","absToChr","join","xDomainEndWithAssembly","xDomainStartAbsWithAssembly","xDomainStart","xDomainEndAbsWithAssembly","xDomainEnd","focusGeneStartWithAssembly","focusGeneOption","chr","txStart","focusGeneEndWithAssembly","txEnd","focusVariantPositionWithAssembly","focusVariantOption","focusVariantRelPositionState","focusVariantStrPositionState","useFocusGene","useFocusVariant","useDnaAccessShowInfos","useXDomainStartWithAssembly","useXDomainEndWithAssembly","useEnhancerRegionsShowInfos","useEnhancerGenesShowInfos","note","palette","grey","title","buttonNormal","buttonActive","boxShadow","trackList","useStylesTrackConfig","grow","flex","separator","marginRight","propInput","useStylesTooltipVisible","arrow","tooltip","useStylesTooltipHidden","display","TrackConfig","config","propertyChangeHandler","property","isRemote","Boolean","isLocal","whatever","classesTooltipVisible","classesTooltipHidden","Tooltip","placement","TextField","size","min","step","VariantsSettings","closeHandler","setFocusVariant","variantTracks","setVariantTracks","tmpVariantTracks","setTmpVariantTracks","changed","setChanged","variantTrackServers","useRef","currVariantTracks","current","changeTmpVariantTracks","newTrackConfig","currTmpVariantTracks","newTmpVariantTracks","saveHandler","newVariantTracks","servers","trackConfig","push","some","align","href","rel","variantTrackConfig","justifyContent","spacing","showTutorial","startExploring","Welcome","tutorial","setTutorial","ModalContext","paper","borderRadius","shadows","maxWidth","maxHeight","overflow","ModalProvider","Component","setComponent","customCloseHandler","setCustomCloseHandler","showModal","newComponent","newCustomCloseHandler","Modal","aria-labelledby","aria-describedby","onClose","closeAfterTransition","BackdropComponent","BackdropProps","timeout","Fade","in","h1","flexShrink","drawerGrid","drawerPaper","settings","flexGrow","globalSettingsTitle","settingsContent","toolbar","mixins","titleBar","titleBarText","titleBarContainer","titleBarTitle","titleBarIcon","titleBarIconActive","globalSettingsFirstBox","extractCoreFromHiGlassSvg","svg","fifthLn","nthIndexOf","lastLn","lastIndexOf","core","AppSidebar","useShowModal","setXDomainStart","setXDomainEnd","showWelcome","setShowWelcome","showVariantsSettings","setShowVariantsSettings","higlassEnhancerRegions","higlassDnaAccess","enhancerGenesSvg","userChangedDomain","setUserChangedDomain","numericalXDomainStart","isString","chrToAbs","numericalXDomainEnd","xDomainStartChangeHandler","xDomainEndChangeHandler","curr","closeWelcome","openWelcome","closeVariantsSettings","openVariantsSettings","mergeSvgs","enhancerSvg","dnaAccessSvg","enhancerGeneSvg","enhancerSvgCore","enhancerWidth","enhancerHeight","dnaAccessSvgCore","dnaAccessWidth","dnaAccessHeight","firstSvgClosingBracket","lastSvgOpeningBracket","extractCoreFromStringifiedSvg","enhancerGeneSvgCore","enhancerGeneHeight","actualEnhancerHeight","track","actualDnaAccessHeight","mergedSvg","Drawer","anchor","ButtonBase","Divider","Box","m","xDomain","getViewConfig","Number","isNaN","zoomTo","CheckboxList","exportAsSvg","XMLSerializer","serializeToString","filename","stringOrBlob","blob","Blob","navigator","msSaveOrOpenBlob","msSaveBlob","elem","document","createElement","URL","createObjectURL","download","body","appendChild","click","removeChild","revokeObjectURL","console","warn","inputRoot","borderTopLeftRadius","borderTopRightRadius","borderBottomWidth","focused","input","textFieldRoot","fetchJsonFromUrl","query","fetch","response","json","result","GeneIcon","SvgIcon","viewBox","d","GeneOption","geneName","VariantOption","SearchField","setOpen","setOptions","inputValue","searchQuery","setSearchQuery","debouncedSearchQuery","loading","autocompleteClasses","customSearch","searchUrl","active","whenResults","Array","isArray","Promise","all","flat","multiple","autocompleteOptions","Autocomplete","larger","onInputChange","newInputValue","onOpen","getOptionSelected","_value","getOptionLabel","renderInput","params","InputProps","endAdornment","renderOption","renderTags","getTagProps","Chip","usePrevious","appBar","common","black","white","toolbarExtra","paddingLeft","locationSearch","match","score","AppTopbar","focusGene","setFocusGene","focusVariant","setFocusGeneOption","setFocusVariantOption","prevFocusGeneOption","prevFocusVariantOption","focusGeneVariantOptions","_focusGeneVariant","clearFocusGene","clearFocusVariant","AppBar","Toolbar","newValues","newFocusElements","gene","gray","pink","EnhancerRegionsInfo","showInfo","iconRadioLegend","variantYScale","setVariantYScale","hideUnfocused","setHideUnfocused","colorEncoding","setColorEncoding","hideUnfocusedChangeHandler","changeVariantYScale","changeColorEncoding","Switch","FormLabel","RadioGroup","aria-label","iconRadio","IconButton","iconRadioActive","bar","iconActive","popeover","paddingTop","info","borderBottom","TitleBar","Info","Help","Settings","useShowInfo","popoverDirection","setShowInfo","helpAnchorEl","setHelpAnchorEl","settingsAnchorEl","setSettingsAnchorEl","infoToggleHandler","show","helpOpenHandler","currentTarget","helpCloseHandler","settingsOpenHandler","settingsCloseHandler","helpId","settingsId","anchorOriginVertical","transformOriginVertical","helpOpen","settingsOpen","iconInfoClass","iconHelpClass","iconSettingsClass","wrap","Popover","anchorEl","anchorOrigin","vertical","horizontal","transformOrigin","getFocusGeneRegion","viewConfig","getFocusVariantRegion","updateViewConfigVariantTracks","variantTrackConfigs","variantTrack","data","updateViewConfigFocusVariant","trackIdxs","trackIdx","childTrack","setFocusRegion","updateViewConfigVariantYScale","yScale","updateViewConfigXDomain","newXDomainStart","newXDomainEnd","force","_force","isFunction","focusGeneRegion","focusVariantRegion","fullWidthHeight","higlassContainer","minHeight","panZoomTip","textAlign","opacity","animation","userSelect","panZoomTipNormal","panZoomTipNormalHover","panZoomTipActive","panZoomTipActiveHover","EnhancerRegion","useSetRecoilState","setHiglass","focusVariantPosition","xDomainStartAbs","xDomainEndAbs","focusGeneStart","focusGeneEnd","sampleGroupSelectionSizes","selectedSamples","higlassMouseOver","setHiglassMouseOver","higlassFocus","setHiglassFocus","higlassContainerRef","higlassEnhancerClickSelection","higlassMouseDown","higlassNumMouseOver","higlassNumFocus","higlassNumFocusMouseOut","shouldSkipUpdatingXDomain","numSamples","Object","pipe","focusStyle","updateViewConfigFocusStyle","coloring","opacityEncoding","updateViewConfigFilter","matrixTrack","updateViewConfigMatrixHeight","viewConfigHeight","higlassBlockClasses","higlassClickHandler","payload","log","higlassLocationChangeHandlerDb","debounce","absPos","windowMouseDownClearHandler","e","isParentOf","addEventListener","higlassMouseDownHandler","higlassInitHandler","higlassInstance","api","on","getComponent","element","EnhancerRegionsHelp","EnhancerRegionsSettings","onMouseEnter","onMouseLeave","onMouseDown","onFocus","onBlur","tabIndex","sizeMode","globalMousePosition","verticalAlign","placeholder","fontStyle","small","medium","large","cellEncoding","justify","EnhancerGenesSettings","setCellEncoding","setPadding","changeCellEncoding","changePadding","TooltipContext","pointerEvents","TooltipProvider","localState","setLocalState","showTooltip","plot","plotSvg","useTooltipStyles","uuid","fetchTile","tileId","samples","j","dodge","radius","radius2","circles","sort","head","tail","intersects","next","Infinity","EnhancerGenesPlot","useShowTooltip","sampleSelection","geneCellEncoding","relPosition","strPosition","genePadding","plotEl","setPlotEl","tile","setTile","isLoadingTile","setIsLoadingTile","setTilesetInfo","setWidth","prevWidth","prevGeneCellEncoding","getTileWidth","tileXPos","floor","_tile","entry","filterByPosition","plotElRef","node","isInit","maxScore","minAbsDistance","maxAbsDistance","genes","categoryAggregation","entries","numEnhancers","distComparator","absDistance","genesUpstreamByDist","TinyQueue","genesDownstreamByDist","relGenePos","distance","isDownstream","samplesByCategory","sampleCategory","genesDownstreamByDistArr","pop","genesUpstreamByDistArr","prevGene","relDistance","useLayoutEffect","measure","requestAnimationFrame","currWidth","getBoundingClientRect","removeEventListener","tooltipClasses","select","paddingBottom","circleRadius","circlePadding","geneLabelPadding","beeswarmPadding","distanceBarWidth","distPaddingRange","attr","maxCatgorySize","cat","categorySizeScale","scaleLog","clamp","percentScale","scaleLinear","circleYScalePre","circleYScalePost","circleYScale","geneContainerWidth","maxGenes","genesUpstream","reverse","genesDownstream","minMax","minRelDistance","maxRelDistance","paddingScale","genesUpstreamPadding","round","genesUpstreamScale","genesDownstreamPadding","genesDownstreamScale","genesUpstreamLeftPad","minVisibleAbsDist","minDist","maxVisibleAbsDist","maxDist","distanceHeightScale","plotBeeswarm","selection","isRightAligned","selectAll","getArrayNumCols","maxSize","plotArray","numCols","instanceCache","tooltipTitleGetter","cellSize","indexToX","indexToY","bBox","arrayTooltipTitleGetter","geneArrayInstances","upstream","downstream","geneArrayInstanceMouseEnterHandler","dHovering","geneArrayInstanceMouseLeaveHandler","plotBox","valueScale","valueGetter","cellWidth","fillColor","textColor","showText","showZero","showTooltipOnMouseEnter","bg","boxTooltipTitleGetter","enhancerG","enhancerGCellG","genesUpstreamG","geneLabelX","geneLabelY","genesUpstreamGCellG","remove","genesDownstreamG","genesDownstreamGCellG","distRange","distStep","tickValues","call","axisRight","tickSize","tickFormat","s","this","parentNode","nextSibling","g","plotEnhancerGeneConnections","EnhancerGenes","EnhancerGenesInfo","EnhancerGenesHelp","DnaAccessibilityInfo","dnaAccessibilityRegionSize","DnaAccessibilityHelp","DnaAccessibilitySettings","dnaAccessLabelStyle","setDnaAccessLabelStyle","changeDnaAccessLabelStyle","getDnaAccessXDomain","enhancerViewRange","enhancerViewCenter","midPos","DnaAccessibility","setHiglassDnaAccess","labelStyle","xDomainStartAbsDb","xDomainEndAbsDb","labels","updateViewConfigDnaAccessXDomain","rowId","pixelPreciseMarginPadding","containerPaddingX","containerPaddingY","viewMarginTop","viewMarginBottom","viewMarginLeft","viewMarginRight","viewPaddingTop","viewPaddingBottom","viewPaddingLeft","viewPaddingRight","enhancerWrapper","enhancer","overflowY","enhancerRegions","enhancerGenes","dnaAccessibility","AppMain","focusGeneChangeHandler","focusVariantChangeHandler","r","CssBaseline","withEither","ifEitherFn","EitherComponent","createMuiTheme","primary","main","secondary","App","setChromInfo","ChromosomeInfo","_chromInfo","catch","Main","AppError","ThemeProvider","hostname","createAnnotationOverlayMetaTrack","HGC","pubSub","services","AnnotationOverlayMetaTrack","definition","getTrackObject","animate","onNewTilesLoaded","annotationTrackIds","Set","add","annotationDrawnHandlerBound","annotationDrawnHandler","bind","tilesDrawnEndHandlerBound","tilesDrawnEndHandler","drawnAnnotations","Map","tracksDrawingTiles","pubSubs","xStartAbs","xEndAbs","has","updateOverlays","from","draw","clear","availableOptions","defaultOptions","FLOAT_BYTES","BYTES_PER_ELEMENT","VS","FS","COLORMAP_GRAYS","getMax","fetchedTiles","maxValue","tileData","maxNonZero","getNumRows","coarseShape","getRowMaxs","maxVector","maxValueByRow","scaleGraphics","xScale","drawnAtScale","tileK","posOffset","getNumPointsPerRow","numRows","positions","createRidgePlotTrack","libraries","format","d3Format","d3Scale","tileProxy","RidgePlotTrack","updateOptions","pLoading","Graphics","pMasked","addChild","loadIndicator","Text","labelSize","coarsifyTileValues","bins_per_dimension","zoomLevel","tilePos","binsPerTileIn","binsPerTile","resolutions","chosenResolution","tileHeight","tileX","tileY","xTilePos","yTilePos","minX","minY","reverseYAxis","selectRowsAggregationMode","selectRowsAggregationFn","maxNan","minNan","sumNan","meanNan","markAreaColor","utils","colorToHex","markColorRgbNorm","colorToRgba","markColorTex","markColorTexRes","markNumColors","oldMarkResolution","TILE_SIZE","oldRowHeight","oldRowPadding","oldRowNormalization","oldRowSelections","oldShowRowLabels","updateTiles","updateRowLabels","drawLabel","updateScales","rowLabelAlign","pAxis","removeChildAt","rowLabels","rowLabel","row_infos","rowIndex","removeRowLabels","indicator","Sprite","WHITE","tint","dimensions","yStart","xLabelOffset","getRowHeight","rowStepHeight","rowStepYCenter","newOptions","updateExistingGraphics","getTilePosAndDimensions","shape","binSizePx","binSizeBp","binSizeBpHalf","binXPos","valuesByRow","meanValue","dense","subarray","rowIdx","actualTrackHeight","getTrackHeight","globalMax","colorIndexScale","rowMaxs","rowValueScales","rowColorIndexScales","valueScaleByRow","colorIndexScaleByRow","rowScale","tiles","maxRows","positionsByRow","colorIndicesByRow","offsetSignsByRow","_xScale","size2d","size1d","unshift","numPointsPerRow","verticesPerLine","verticesPerPoint","indices","Uint32Array","k","p1a","p1b","p1c","p1d","p2a","p2b","p2c","p2d","indexOffset","visibleTrackHeight","tilesToData","colorIndices","offsetSigns","toLineIndices","uniforms","UniformGroup","uLineColor","uNaNColor","uAreaColorTex","uAreaColorTexRes","uWidth","uMiter","shader","Shader","geometry","Geometry","numVerticesPoint","addAttribute","TYPES","FLOAT","addIndex","mesh","Mesh","newGraphics","pMain","lineGraphics","updateLoadIndicator","hasFetchedTiles","renderLines","fetching","newPosition","newXScale","newYScale","refreshTiles","trackX","trackY","calculateZoomLevel","calculateTileWidth","invert","posInTileX","rowSelection","tileToLocalId","fetchedTile","selectRowsAggregationMethod","rowI","rowInfo","getVisibleData","svgns","base","setAttribute","output","stride","createLine","line","posPerRow","posToPoints","arr","numColors","defs","createElementNS","linearGradient","stop","insertBefore","firstChild","l","y0","firstComma","firstX","firstY","lastComma","lastX","lastY","HorizontalLine1DPixiTrack","datatype","orientation","pointToPosition","pt","cX","widthHalf","pointToIndex","pointToOpacity","pointToHighlight","highlight","getItemDistance","getMaxDistance","maxDistItem","scaleScalableGraphics","getRegionId","createStratifiedBedTrack","MAX_CLICK_DELAY","configs","opacityLogScale","StratifiedBedTrack","pLegend","legendMin","legendMax","interactive","interactiveChildren","alpha","mousedownTime","performance","now","mousedown","mouseup","clickHandler","intervals","regionId","isLeftToRight","intervalTree","createIntervalTree","categoryToGroup","groupToColor","numGroups","numCategories","groupLabels","getCategory","categoryToY","yToCategory","groupSizes","valueFilter","filteredGroups","groupSize","groupLabelsPixiText","markColorHighlightRgbNorm","markColorDehighlightRgbNorm","filterSet","include","filterField","itemFilter","getImportance","opacityScale","opacityLinearScale","getRegion","getGene","minImportance","updateStratificationOption","heightScale","categoryHeightScale","valueScaleInverted","isHighlighting","__focus","__item","focusFilterFn","addFn","filteredItems","reducerVar","accumulator","itemToIndicatorCategory","i1","isItemInFocus","dataToPoint","itemToIndicatorReducer","points","getPoints","Uint16Array","opacities","highlights","uColor","uColorHighlight","uHighlighting","indicatorPointGraphics","yEnd","xTickOffset","xTickEnd","numAxisLabels","lineStyle","labelPixiText","beginFill","drawRect","endFill","legendMinText","legendMaxText","minValue","minTextWidth","getBounds","maxTextWidth","offset","rectHeight","drawRoundedRect","renderIndicatorCategoryAxis","renderIndicatorLegend","renderIndicatorPoints","updateIndicators","relX","relY","foundItem","xAbsLo","xAbsHi","queryInterval","interval","getElementAtPosition","colorHex","toString","bgHex","offsetX","offsetY","global","gAxis","createRect","f","o","strokeDasharray","x1","y1","x2","y2","createDashedLine","pixiText","t","_style","_fill","_align","_font","textContent","createText","colorHighlight","renderIndicatorCategoryAxisAsSvg","thumbnail","DOMParser","parseFromString","documentElement","flip1D","trackBorderWidth","trackBorderColor","optionsInfo","inlineOptions","circle","ellipse","createSnpTrack","d3Array","SnpTrack","colorEncodingRange","minVisibleValueInTiles","maxVisibleValueInTiles","makeValueScale","calculateMedianVisibleValue","xStartPos","xEndPos","rectY","doubleRadius","drawnPoly","anchorRadius","rectGraphics","drawCircle","finalDotYPos","rows","startY","endY","initialize","circleDraws","circleFocusDraws","td","geneInfo","yMiddle","drawnRects","circleDraw","drawPoly","buttonMode","hoveringSnp","relTilePos","dist","itemY","MAX_RADIUS","otherStr","substr","visibleAndFetchedTiles","plusStrandRows","renderRows","focusedCircles","c","axis","axisPositionVertical","gDrawnAxis","exportAxisLeftSVG","exportAxisRightSVG","BedLikeTrack","getIs2d","get1dStart","get2dStart","get1dEnd","get2dEnd","getHistMax","histMax","histogramMax","segmentToPosition","segment","segmentToColorIdx","colorIdx","segmentToFocused","createStackedBarTrack","toRgbNorm","StackedBarTrack","is2d","getStart","getEnd","updateTileFocusMap","numBins","histogram1d","histogram2d","histogram2dNumPred","Uint8Array","categoryBinHash","maxBinId","binStart","binEnd","bin","histIdx","binHash","updateTileHistogram","focusMap","numFilteredGroups","colorMap","colorMapRgbNorm","colorMapTex","colorMapTexRes","colorMapFocus","colorMapFocusRgbNorm","colorMapFocusTex","colorMapFocusTexRes","markColorFocusRgbNorm","markSizeFocus","getOffset","chromOffsets","updateFocusMap","updateHistograms","chroms","chromSizes","offsets","cumSum","brgs","computeChromOffets","oldNumBins","segments","cumHeight","histToSegments","colorIdxs","uColorMapTex","uColorMapTexRes","uColorMapFocus","uColorMapFocusTexRes","State","DRAW_MODES","TRIANGLES","drawAxis","renderStackedBars","renderTrack","relPos","rowCumSum","rowNumPred","totalPred","numPred","relYPos","findIndex","createTssTrack","TssTrack","createPubSub","xStartScreen","xEndScreen","LocalCsvDataFetcher","createRandomId","random","LocalBedDataFetcherClass","dataConfig","callback","tilesetInfoLoading","tilesetInfoData","resolve","reject","timeoutId","loadHandler","tileIds","register","dataFetcher","createLocalBedDataFetcher","pluginType","isMetaTrack","ReactDOM","render","getElementById","serviceWorker","ready","registration","unregister","error","message"],"mappings":"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,MAAO,UACPoN,WAAY,CACV,oBACA,gBACA,uCACA,gBACA,iBACA,kBACA,eACA,+BACA,0CAGJ,CACEpN,MAAO,UACPoN,WAAY,CACV,mCACA,kBACA,8BACA,oCACA,4CACA,uBACA,wCACA,kBAGJ,CACEpN,MAAO,6BACPoN,WAAY,CACV,gBACA,eACA,6CACA,0BACA,kCACA,gDACA,iCACA,kBAGJ,CACEpN,MAAO,cACPoN,WAAY,CACV,8BACA,+BACA,2BACA,mBACA,+BAGJ,CACEpN,MAAO,aACPoN,WAAY,CACV,gCACA,qCACA,gBACA,eACA,6BACA,KACA,uBACA,gBACA,mBACA,kCACA,kBACA,OACA,4DACA,cACA,kBACA,uBACA,OACA,aACA,iCACA,gCACA,eACA,uBACA,qCACA,0BACA,qDACA,gBACA,0BACA,wBACA,aACA,0BACA,qDACA,2BACA,uCACA,QACA,4CACA,gBACA,uBACA,mCACA,kCACA,gDACA,iBACA,kCAGJ,CACEpN,MAAO,QACPoN,WAAY,CACV,wBACA,kBACA,oBACA,yBACA,2BACA,yBACA,gBACA,8BACA,gCACA,yBACA,mBACA,eACA,cACA,yBACA,6BACA,oBACA,wDACA,6CACA,QACA,2DACA,uBACA,iEACA,sEAMKC,GAAyBN,GAAuBI,OAAOpL,KAClE,SAACjE,GAAD,MAAY,CACVF,KAAME,EAAMkC,MACZkC,QAASpE,EAAMsP,eAINE,GAAkBD,GAAuBhE,QACpD,SAACkE,EAAezP,GAId,OAHAA,EAAMoE,QAAQoD,SAAQ,SAACnD,GACrBoL,EAAcpL,GAAUrE,EAAMF,QAEzB2P,IAET,IAGWC,GAAUH,GAAuBI,SAAQ,SAAC3P,GAAD,OAAWA,EAAMoE,WAE1DwL,GAAaF,GAAQnE,QAAO,SAACsE,EAAMC,EAAQpE,GAEtD,OADAmE,EAAKC,GAAUpE,EACRmE,IACN,IAgBUE,GAA4B,CACvCxJ,KAAM,mBACN9G,OAAQ,GACR2E,QAAS,CACP4L,uBAAwB,QACxBC,UAAW,QACXC,eAAgB,UAChBC,SAAU,EACVC,YAAa,IACbC,iBAAkB,IAClBC,YAAa,E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eAAgB,CA1ZgB,WACF,eA8ZvBC,GAA0C,CACrD,IACA,GACA,GACA,GACA,GACA,GACA,IACA,GACA,GACA,GACA,GACA,GACA,EACA,GACA,GACA,IACA,GACA,GACA,GACA,GACA,GACA,GACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,GACA,GACA,GACA,GACA,GACA,IACA,GACA,GACA,GACA,GACA,GACA,GACA,IACA,GACA,GACA,GACA,GACA,GACA,IACA,IACA,GACA,IACA,GACA,IACA,GACA,IACA,GACA,EACA,IACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,IACA,GACA,IACA,GACA,GACA,GACA,GACA,GACA,GACA,EACA,IACA,GACA,GACA,GACA,GACA,EACA,IACA,IACA,GACA,GACA,GACA,GACA,GACA,GACA,EACA,GACA,IACA,GACA,GACA,IACA,GACA,GACA,GACA,IACA,GACA,GACA,IACA,EACA,IACA,IACA,GACA,EACA,GACA,GACA,IACA,GACA,IACA,GACA,EACA,IACA,GACA,IACA,GACA,EACA,IACA,GACA,IACA,GACA,EACA,GACA,GACA,GACA,GACA,IAGWC,GAA2C9G,GAAuBI,OAAO9D,QACpF,SAACyK,EAAKhW,EAAO4N,GACX,IAAMqI,EAAW,CACf/T,MAAOlC,EAAMkC,MACb1F,MAAOwD,EAAMkW,eACbpX,WAAYkB,EAAMmW,oBAClBvI,SAKF,OAHA5N,EAAMsP,WAAW9H,SAAQ,SAACsI,GACxBkG,EAAIlG,GAAUmG,KAETD,IAET,IAGWI,GAAwC,CACnDC,WAAW,EACXvE,UAAU,EACVC,mBAAoB,CAAC,uBACrBC,MAAO,CACL,CACEjF,IAAK,UACLuF,cAAe,oDACfC,OAAQ,CACN9T,IAAK,CACH,CACEsO,IAAK,SACLxG,KAAM,+BACNqM,OAAQ,2BACRD,WAAY,yBACZlT,OAAQ,GACR2E,QAAS,CAEP5H,MAAO,UACPiW,OAAQ,QACRtT,SAAU,GACVuT,mBAAmB,EACnBhC,mBAAmB,EACnBE,mBAAoB,YAGxB,CACE7D,IAAK,Q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","file":"static/js/main.6d390b81.chunk.js","sourcesContent":["import React from 'react';\nimport Backdrop from '@material-ui/core/Backdrop';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { makeStyles } from '@material-ui/core/styles';\n\nconst useStyles = makeStyles((theme) => ({\n  backdrop: {\n    zIndex: theme.zIndex.drawer + 1,\n    color: '#bbb',\n    backgroundColor: '#fff',\n  },\n}));\n\nconst AppInitializing = () => {\n  const classes = useStyles();\n\n  return (\n    <div className=\"full-wh\">\n      <Backdrop className={classes.backdrop} open={true}>\n        <CircularProgress color=\"inherit\" />\n      </Backdrop>\n    </div>\n  );\n};\n\nexport default AppInitializing;\n","import React from 'react';\nimport './AppError.css';\n\nconst AppInitializing = () => (\n  <div className=\"full-wh app-error\">\n    <span>Failed to initialize!</span>\n  </div>\n);\n\nexport default AppInitializing;\n","import React, { createContext } from 'react';\n\nconst ChromInfoContext = createContext();\n\nexport default function ChromInfoProvider({ children, chromInfo }) {\n  return (\n    <ChromInfoContext.Provider value={chromInfo}>\n      {children}\n    </ChromInfoContext.Provider>\n  );\n}\n\nfunction useChromInfo() {\n  const context = React.useContext(ChromInfoContext);\n  if (context === undefined) {\n    throw new Error('useChromInfo must be used within a ChromInfoContext');\n  }\n  return context;\n}\n\nexport { useChromInfo };\n","import { useState, useEffect } from 'react';\n\nexport default function useDebounce(value, delay) {\n  const [debouncedValue, setDebouncedValue] = useState(value);\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      setDebouncedValue(value);\n    }, delay);\n\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [value, delay]);\n\n  return debouncedValue;\n}\n","import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useRecoilState, useRecoilValue } from 'recoil';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport CheckBoxIcon from '@material-ui/icons/CheckBox';\nimport CheckBoxOutlineBlankIcon from '@material-ui/icons/CheckBoxOutlineBlank';\nimport IndeterminateCheckBoxIcon from '@material-ui/icons/IndeterminateCheckBox';\nimport FilterListIcon from '@material-ui/icons/FilterList';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport FormGroup from '@material-ui/core/FormGroup';\nimport Grid from '@material-ui/core/Grid';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport OutlinedInput from '@material-ui/core/OutlinedInput';\nimport Typography from '@material-ui/core/Typography';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport useDebounce from './use-debounce';\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    position: 'relative',\n  },\n  filterBar: {\n    position: 'sticky',\n    zIndex: 1,\n    top: '8px',\n    '&:before': {\n      content: '\"\"',\n      position: 'absolute',\n      zIndex: 0,\n      top: '-9px',\n      right: '-8px',\n      left: '-8px',\n      bottom: 0,\n      background: 'white',\n    },\n  },\n  checkbox: {\n    marginTop: -6,\n    marginBottom: -6,\n  },\n  checkboxLabel: {\n    fontSize: '0.8rem',\n    marginLeft: -6,\n  },\n  nestedCheckbox: {\n    marginLeft: 4,\n  },\n  visible: {\n    transition: '.3s ease transform, .3s ease height',\n    transform: 'scale(1, 1)',\n    height: '1.625rem',\n  },\n  invisible: {\n    transition: '.3s ease transform, .3s ease height',\n    transform: 'scale(1, 0)',\n    height: '0rem',\n  },\n}));\n\nconst Option = React.memo(function Option({\n  filterState,\n  name,\n  stateWithName,\n  group,\n  stateWithGroup,\n  colorCheckbox,\n  colorText,\n}) {\n  const filter = useRecoilValue(filterState);\n  const [state, setState] = useRecoilState(stateWithName(name));\n  const [groupState, setGroupState] = useRecoilState(stateWithGroup(group));\n  const nameLowerCase = useMemo(() => name.toLowerCase(), [name]);\n\n  const changeHandler = useCallback(\n    (event) => {\n      setState((currState) => ({\n        ...currState,\n        checked: event.target.checked,\n      }));\n      setGroupState((currGroupState) => {\n        const newGroupState = {\n          ...currGroupState,\n          n: currGroupState.n + (event.target.checked ? 1 : -1),\n        };\n        switch (newGroupState.n) {\n          case currGroupState.N:\n            newGroupState.checked = true;\n            break;\n          case 0:\n            newGroupState.checked = false;\n            break;\n          default:\n            newGroupState.checked = undefined;\n            break;\n        }\n        return newGroupState;\n      });\n    },\n    [setState, setGroupState]\n  );\n\n  useEffect(() => {\n    if (groupState.checked === true) {\n      setState((currState) => ({\n        ...currState,\n        checked: true,\n      }));\n    } else if (groupState.checked === false) {\n      setState((currState) => ({\n        ...currState,\n        checked: false,\n      }));\n    }\n  }, [groupState, setState]);\n\n  useEffect(() => {\n    setState((currState) => ({\n      ...currState,\n      visible: !filter.length || nameLowerCase.includes(filter),\n    }));\n  }, [filter, nameLowerCase, setState]);\n\n  const classes = useStyles();\n\n  return (\n    <div className={state.visible ? classes.visible : classes.invisible}>\n      <FormControlLabel\n        key={name}\n        className={`${classes.checkbox} ${classes.nestedCheckbox}`}\n        control={\n          <Checkbox\n            style={{\n              color: colorCheckbox,\n            }}\n            icon={<CheckBoxOutlineBlankIcon fontSize=\"small\" />}\n            checkedIcon={<CheckBoxIcon fontSize=\"small\" />}\n            checked={state.checked}\n            onChange={changeHandler}\n            name={name}\n          />\n        }\n        label={\n          <Typography\n            className={classes.checkboxLabel}\n            noWrap\n            style={{\n              color: colorText,\n            }}\n          >\n            {name}\n          </Typography>\n        }\n      />\n    </div>\n  );\n});\n\nconst OptionGroup = React.memo(function OptionGroup({\n  group,\n  stateWithGroup,\n  colorCheckbox,\n  colorText,\n}) {\n  const [state, setState] = useRecoilState(stateWithGroup(group));\n\n  const changeHandler = useCallback(\n    (event) => {\n      setState((currState) => ({\n        ...currState,\n        checked: event.target.checked,\n        n: event.target.checked ? currState.N : 0,\n      }));\n    },\n    [setState]\n  );\n\n  const classes = useStyles();\n\n  return (\n    <FormControlLabel\n      className={classes.checkbox}\n      control={\n        <Checkbox\n          style={{ color: colorCheckbox }}\n          icon={\n            state.checked === false ? (\n              <CheckBoxOutlineBlankIcon fontSize=\"small\" />\n            ) : (\n              <IndeterminateCheckBoxIcon fontSize=\"small\" />\n            )\n          }\n          checkedIcon={<CheckBoxIcon fontSize=\"small\" />}\n          checked={state.checked === true}\n          onChange={changeHandler}\n          name={group.name}\n        />\n      }\n      label={\n        <Typography\n          className={classes.checkboxLabel}\n          noWrap\n          style={{ color: colorText }}\n        >\n          <strong>{group.name}</strong>{' '}\n          <span>\n            ({state.n}/{state.N})\n          </span>\n        </Typography>\n      }\n    />\n  );\n});\n\nconst NestedCheckboxList = React.memo(function NestedCheckboxList({\n  filterState,\n  optionWithName,\n  optionGroupWithGroup,\n  filterLabel = 'Filter',\n  groupedOptions = [],\n  optionToGroup = {},\n  groupColors = [],\n  groupColorsDark = [],\n}) {\n  const [globalFilter, setGlobalFilter] = useRecoilState(filterState);\n  const [filter, setFilter] = useState(globalFilter);\n  const filterDb = useDebounce(filter, 350);\n\n  const filterChangeHandler = useCallback(\n    (event) => {\n      setFilter(event.target.value.toLowerCase());\n    },\n    [setFilter]\n  );\n\n  useEffect(() => {\n    setGlobalFilter(filterDb);\n  }, [filterDb, setGlobalFilter]);\n\n  const classes = useStyles();\n\n  return (\n    <div className={classes.root}>\n      <div className={classes.filterBarBg} />\n      <FormControl\n        className={classes.filterBar}\n        variant=\"outlined\"\n        margin=\"dense\"\n        fullWidth\n      >\n        <InputLabel htmlFor=\"filter\">\n          <Grid container direction=\"row\" alignItems=\"center\">\n            <FilterListIcon fontSize=\"small\" />\n            <span style={{ marginLeft: 3 }}>{filterLabel}</span>\n          </Grid>\n        </InputLabel>\n        <OutlinedInput\n          id=\"filter\"\n          label={\n            <Grid container direction=\"row\" alignItems=\"center\">\n              <FilterListIcon fontSize=\"small\" />\n              <span style={{ marginLeft: 3 }}>{filterLabel}</span>\n            </Grid>\n          }\n          onChange={filterChangeHandler}\n          value={filter}\n        />\n      </FormControl>\n      <FormGroup>\n        {groupedOptions.map((group, i) => (\n          <React.Fragment key={group.name}>\n            <OptionGroup\n              key={group.name}\n              group={group}\n              stateWithGroup={optionGroupWithGroup}\n              colorCheckbox={groupColors[i % groupColors.length] || 'inherit'}\n              colorText={\n                groupColorsDark[i % groupColorsDark.length] || 'inherit'\n              }\n            />\n            {group.options.map((option) => (\n              <Option\n                filterState={filterState}\n                key={option}\n                name={option}\n                stateWithName={optionWithName}\n                group={group}\n                stateWithGroup={optionGroupWithGroup}\n                colorCheckbox={groupColors[i % groupColors.length] || 'inherit'}\n                colorText={\n                  groupColorsDark[i % groupColorsDark.length] || 'inherit'\n                }\n              />\n            ))}\n          </React.Fragment>\n        ))}\n      </FormGroup>\n    </div>\n  );\n});\n\nexport default NestedCheckboxList;\n","import PropTypes from 'prop-types';\nimport React from 'react';\n\nimport Grid from '@material-ui/core/Grid';\nimport { makeStyles } from '@material-ui/core/styles';\n\nconst useStyles = makeStyles((theme) => ({\n  logo: {\n    height: '100%',\n    padding: '0.1em',\n    alignItems: 'center',\n    fontSize: '1em',\n    lineHeight: '1em',\n    fontWeight: 'bold',\n  },\n  logoAbc: {\n    fontSize: '2.75em',\n    letterSpacing: '-0.075rem',\n    paddingRight: '0.125em',\n    fontWeight: 900,\n  },\n  logoEnhancer: {\n    alignItems: 'flex-start',\n  },\n}));\n\nconst Logo = (props) => {\n  const classes = useStyles();\n\n  return (\n    <Grid container className={classes.logo} style={props.styles}>\n      <Grid item className={classes.logoAbc}>\n        ABC\n      </Grid>\n      <Grid item>\n        <Grid container direction=\"column\" className={classes.logoEnhancer}>\n          <Grid item>Enhancer-Gene</Grid>\n          <Grid item>Connections</Grid>\n        </Grid>\n      </Grid>\n    </Grid>\n  );\n};\n\nLogo.defaultProps = {\n  styles: {},\n};\n\nLogo.propTypes = {\n  styles: PropTypes.object,\n};\n\nexport default Logo;\n","import React, { useCallback, useState } from 'react';\nimport Button from '@material-ui/core/Button';\nimport ButtonGroup from '@material-ui/core/ButtonGroup';\nimport ClearIcon from '@material-ui/icons/Clear';\nimport InsertDriveFileIcon from '@material-ui/icons/InsertDriveFile';\n\nconst FileInput = React.memo(\n  React.forwardRef(function FileInput(props, ref) {\n    const {\n      onChange: changeHandler,\n      onClear: clearHandler,\n      className = '',\n      label = 'Select',\n      accept = '*',\n      color = 'default',\n      Icon = InsertDriveFileIcon,\n    } = props;\n\n    // We will spread any other props onto the root component. However, some\n    // props can mess things up so we will remove them in the following lines\n    const otherProps = { ...props };\n    delete otherProps.onChange;\n    delete otherProps.onClear;\n    delete otherProps.className;\n    delete otherProps.file;\n    delete otherProps.label;\n    delete otherProps.accept;\n    delete otherProps.color;\n    delete otherProps.Icon;\n\n    const [file, setFile] = useState(props.file || null);\n\n    const localChangeHandler = useCallback(\n      (event) => {\n        const fileList = event.target.files;\n        setFile(fileList[0]);\n        if (changeHandler) changeHandler(fileList[0], event);\n      },\n      [changeHandler]\n    );\n\n    const clearFile = useCallback(() => {\n      setFile(null);\n      if (clearHandler) clearHandler();\n    }, [clearHandler]);\n\n    return (\n      <ButtonGroup {...otherProps} className=\"r\" ref={ref}>\n        <Button\n          variant={file ? 'outlined' : 'contained'}\n          component=\"label\"\n          className={className}\n          color={color}\n          disableElevation\n          startIcon={<Icon />}\n        >\n          <input\n            accept={accept}\n            type=\"file\"\n            onChange={localChangeHandler}\n            hidden\n          />\n          {file ? file.name : label}\n        </Button>\n        <Button\n          variant=\"contained\"\n          disabled={!file}\n          onClick={clearFile}\n          disableElevation\n        >\n          <ClearIcon fontSize=\"inherit\" />\n        </Button>\n      </ButtonGroup>\n    );\n  })\n);\n\nexport default FileInput;\n","import { identity } from '@flekschas/utils';\nimport queryString from 'query-string';\n\nexport const contains = (a, b) => a[0] <= b[0] && a[1] >= b[1];\n\nexport const createColorTexture = (PIXI, colors) => {\n  const colorTexRes = Math.max(2, Math.ceil(Math.sqrt(colors.length)));\n  const rgba = new Float32Array(colorTexRes ** 2 * 4);\n  colors.forEach((color, i) => {\n    // eslint-disable-next-line prefer-destructuring\n    rgba[i * 4] = color[0]; // r\n    // eslint-disable-next-line prefer-destructuring\n    rgba[i * 4 + 1] = color[1]; // g\n    // eslint-disable-next-line prefer-destructuring\n    rgba[i * 4 + 2] = color[2]; // b\n    // eslint-disable-next-line prefer-destructuring\n    rgba[i * 4 + 3] = color[3]; // a\n  });\n\n  return [PIXI.Texture.fromBuffer(rgba, colorTexRes, colorTexRes), colorTexRes];\n};\n\nexport const dashedXLineTo = (graphics, xStart, xEnd, y, dashSize) => {\n  const diff = xEnd - xStart;\n  const direction = Math.sign(diff);\n  const width = Math.abs(diff);\n  const stepSize = dashSize * 2;\n  const numSteps = Math.ceil(width / stepSize);\n  for (let i = 0; i < numSteps; i++) {\n    graphics.moveTo(xStart + i * stepSize * direction, y);\n    graphics.lineTo(xStart + (i * stepSize + dashSize) * direction, y);\n  }\n};\n\nexport const download = (filename, stringOrBlob) => {\n  const blob =\n    typeof stringOrBlob === 'string'\n      ? new Blob([stringOrBlob], { type: 'application/octet-stream' })\n      : stringOrBlob;\n  if (window.navigator.msSaveOrOpenBlob) {\n    window.navigator.msSaveBlob(blob, filename);\n  } else {\n    const elem = window.document.createElement('a');\n    elem.href = window.URL.createObjectURL(blob);\n    elem.download = filename;\n    document.body.appendChild(elem);\n    elem.click();\n    document.body.removeChild(elem);\n    URL.revokeObjectURL(elem.href);\n  }\n};\n\nexport const getQueryStringValue = (key, decoder = identity) =>\n  decoder(queryString.parse(window.location.search)[key]);\n\nexport const setQueryStringValue = (key, value, encoder = identity) => {\n  const values = queryString.parse(window.location.search);\n  const newQsValue = queryString.stringify(\n    {\n      ...values,\n      [key]: encoder(value),\n    },\n    { strict: false }\n  );\n  const url = `${window.location.origin}${window.location.pathname}?${newQsValue}`;\n  window.history.pushState({ path: url }, '', url);\n};\n\nexport const toAbsPosition = (position, chromInfo) => {\n  let absPosition;\n  if (position.indexOf && position.indexOf(':') >= 0) {\n    const [chrom, pos] = position.split(':');\n    absPosition = chromInfo.chrPositions[chrom].pos + +pos;\n  } else {\n    absPosition = +position;\n  }\n  return absPosition;\n};\n\nexport const toFixed = (number, decimals, forced) => {\n  let string = number.toFixed(decimals);\n  if (!forced) {\n    while (string[string.length - 1] === '0') {\n      string = string.substring(0, string.length - 1);\n    }\n    if (string[string.length - 1] === '.') {\n      string = string.substring(0, string.length - 1);\n    }\n  }\n  return string;\n};\n\nexport const scaleBand = () => {\n  let domain = [];\n  let fixedBandwidth = null;\n  let bandwidth = 1;\n  let range = [0, 1];\n  let rangeSize = range[1] - range[0];\n  let paddingInner = [];\n  // If `true` the padding will begin before the first bar!\n  let paddingInnerZeroBased = false;\n  let totalWidth = 0;\n\n  const sum = (a, b) => a + b;\n  const getBandwidth = () => fixedBandwidth || bandwidth;\n\n  const update = () => {\n    rangeSize = range[1] - range[0];\n\n    const totalPaddingInner = paddingInner.reduce(sum, 0);\n    bandwidth = (rangeSize - totalPaddingInner) / domain.length;\n    totalWidth = totalPaddingInner + domain.length * getBandwidth();\n  };\n\n  const scale = (v) => {\n    const idx = domain.indexOf(v);\n\n    if (idx === -1) return undefined;\n\n    return (\n      idx * getBandwidth() +\n      paddingInner.slice(0, idx + paddingInnerZeroBased).reduce(sum, 0)\n    );\n  };\n\n  scale.domain = (newDomain) => {\n    if (newDomain) {\n      domain = [...newDomain];\n      update();\n      return scale;\n    }\n\n    return domain;\n  };\n\n  scale.range = (newRange) => {\n    if (newRange) {\n      range = [...newRange];\n      update();\n      return scale;\n    }\n\n    return range;\n  };\n\n  scale.bandwidth = () => getBandwidth();\n\n  scale.fixedBandwidth = (newFixedBandwidth) => {\n    if (newFixedBandwidth) {\n      fixedBandwidth = newFixedBandwidth;\n      update();\n      return scale;\n    }\n\n    return newFixedBandwidth;\n  };\n\n  scale.totalWidth = () => totalWidth;\n\n  scale.rangeSize = () => rangeSize;\n\n  scale.paddingInner = (newPaddingInner) => {\n    if (newPaddingInner) {\n      paddingInner = newPaddingInner;\n      update();\n      return scale;\n    }\n\n    return paddingInner;\n  };\n\n  scale.paddingInnerZeroBased = (newPaddingInnerZeroBased) => {\n    if (newPaddingInnerZeroBased) {\n      paddingInnerZeroBased = newPaddingInnerZeroBased;\n      update();\n      return scale;\n    }\n\n    return paddingInnerZeroBased;\n  };\n\n  return scale;\n};\n\nexport const stringifySvg = (svg) =>\n  new window.XMLSerializer().serializeToString(svg);\n\nexport const booleanQueryStringDecoder = (v) =>\n  v === undefined ? undefined : v === 'true';\n","import { globalPubSub } from 'pub-sub-es';\nimport IntervalTree from '@flatten-js/interval-tree';\n\nimport { toAbsPosition } from './utils';\n\nasync function loadFile(\n  file,\n  chromInfo,\n  { header = true, columnImportance = 7 } = {}\n) {\n  const tree = new IntervalTree();\n  const text = await file.text();\n  const lines = text.split(/\\r\\n|\\n/);\n  for (let i = +header; i < lines.length; i++) {\n    const fields = lines[i].split('\\t');\n    const chromOffset = toAbsPosition(`${fields[0]}:0`, chromInfo);\n    const startAbs = toAbsPosition(`${fields[0]}:${fields[1]}`, chromInfo);\n    const endAbs = toAbsPosition(`${fields[0]}:${fields[2]}`, chromInfo);\n    tree.insert([startAbs, endAbs], {\n      chrOffset: chromOffset,\n      xStart: startAbs,\n      xEnd: endAbs,\n      importance: +fields[columnImportance],\n      uid: `${file.name}-${i}`,\n      name: fields[3],\n      fields,\n    });\n  }\n  return tree;\n}\n\nconst createLocalBedDataServer = (\n  file,\n  id,\n  chromInfo,\n  tilesetInfo,\n  options\n) => {\n  const whenIndex = loadFile(file, chromInfo, options);\n\n  const requestTileHandler = ({ fileId, z, x, requestId }) => {\n    if (fileId !== id) return;\n    whenIndex.then((index) => {\n      const tileWidth = tilesetInfo.max_width / 2 ** z;\n      const start = tileWidth * x;\n      const end = start + tileWidth;\n      const results = index.search([start, end]);\n      globalPubSub.publish(`localBed:tile:${requestId}`, results);\n    });\n  };\n\n  const requestTilesetInfoHandler = ({ fileId, requestId }) => {\n    if (fileId !== id) return;\n    globalPubSub.publish(`localBed:tilesetInfo:${requestId}`, tilesetInfo);\n  };\n\n  const subscriptionTile = globalPubSub.subscribe(\n    'localBed:requestTile',\n    requestTileHandler\n  );\n\n  const subscriptionTilesetInfo = globalPubSub.subscribe(\n    'localBed:requestTilesetInfo',\n    requestTilesetInfoHandler\n  );\n\n  const destroy = () => {\n    globalPubSub.unsubscribe(subscriptionTile);\n    globalPubSub.unsubscribe(subscriptionTilesetInfo);\n  };\n\n  return {\n    destroy,\n  };\n};\n\nexport default createLocalBedDataServer;\n","import { useState, useCallback } from 'react';\nimport { useRecoilState } from 'recoil';\n\nimport { getQueryStringValue, setQueryStringValue } from './utils';\n\nexport default function useQueryStringWithReactState(\n  key,\n  initialValue,\n  { encoder, decoder } = {}\n) {\n  const _initialValue =\n    getQueryStringValue(key, decoder) === undefined\n      ? initialValue\n      : getQueryStringValue(key, decoder);\n\n  const [value, setValue] = useState(_initialValue);\n\n  const onSetValue = useCallback(\n    (newValue) => {\n      setValue(newValue);\n      setQueryStringValue(key, newValue, encoder);\n    },\n    [key, encoder]\n  );\n\n  // Set initial value\n  setQueryStringValue(key, value, encoder);\n\n  return [value, onSetValue];\n}\n\nexport function useRecoilQueryString(key, atom, { encoder, decoder } = {}) {\n  const [value, setValue] = useRecoilState(atom);\n\n  const onSetValue = useCallback(\n    (newValue) => {\n      setValue(newValue);\n      setQueryStringValue(key, newValue, encoder);\n    },\n    [key, encoder, setValue]\n  );\n\n  // Set initial value\n  setQueryStringValue(key, value, encoder);\n\n  return [value, onSetValue];\n}\n","export const DRAWER_WIDTH = 240;\n\nexport const EPS = 1e-6;\n\nexport const SVG_SKELETON = `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg\n    xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n    xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\" width=\"_WIDTH_px\" height=\"_HEIGHT_px\">\n    <g id=\"enhancer-plot\">\n    _ENHANCER_\n    </g>\n    <g id=\"enhancer-gene-plot\" transform=\"translate(0, _ENHANCER_GENE_Y_)\">\n    _ENHANCER_GENE_\n    </g>\n    <g id=\"dna-accessibility-plot\" transform=\"translate(_DNA_ACCESS_X_, 0)\">\n    _DNA_ACCESS_\n    </g>\n</svg>`;\n\nexport const DEFAULT_COLOR_MAP = [\n  // '#c17da5', // pink\n  '#c76526', // red\n  '#6fb2e4', // light blue\n  '#eee462', // yellow\n  '#469b76', // green\n  '#3170ad', // dark blue\n  '#dca237', // orange\n  '#000000', // black\n  '#999999', // gray\n];\n\nexport const DEFAULT_COLOR_MAP_DARK = [\n  // '#a1688a', // pink\n  '#a65420', // red\n  '#4a7798', // light blue\n  '#999026', // yellow\n  '#3a8162', // green\n  '#295d90', // dark blue\n  '#b7872e', // orange\n  '#000000', // black\n  '#666666', // gray\n];\n\nexport const DEFAULT_COLOR_MAP_LIGHT = [\n  // '#f5e9f0', // pink\n  '#f6e5db', // red\n  '#e7f2fb', // light blue\n  '#f2eda9', // yellow\n  '#e0eee8', // green\n  '#dde7f1', // dark blue\n  '#f5e4c4', // orange\n  '#d5d5d5', // black\n  '#ffffff', // gray\n];\n\nexport const GENE_SEARCH_URL =\n  'https://higlass.io/api/v1/suggest/?d=OHJakQICQD6gTD7skx4EWA';\n\nexport const VARIANT_SEARCH_URL =\n  'https://resgen.io/api/v1/suggest/?d=VF5-RDXWTxidGMJU7FeaxA';\n\nexport const DEFAULT_STRATIFICATION = {\n  categoryField: 10,\n  axisShowGroupSeparator: true,\n  axisNoGroupColor: false,\n  groups: [\n    {\n      label: 'Mononuclear Phagocytes',\n      categories: [\n        'THP1_LPS_4hr-Engreitz',\n        'THP_pmaLPS_ATAC_6h',\n        'CD14-positive_monocyte_treated_with_LPS_4h-Novakovic2016',\n        'CD14-positive_monocyte_treated_with_BG_1h-Novakovic2016',\n        'CD14-positive_monocyte_treated_with_RPMI_d6-Novakovic2016',\n        'THP1-Engreitz',\n        'THP_pmaLPS_ATAC_96h',\n        'CD14-positive_monocyte_treated_with_BG_d1-Novakovic2016',\n        'THP_pmaLPS_ATAC_72h',\n        'THP-1_monocyte-VanBortle2017',\n        'CD14-positive_monocyte_treated_with_LPS_d1-Novakovic2016',\n        'CD14-positive_monocyte-ENCODE',\n        'THP_pmaLPS_ATAC_2h',\n        'dendritic_cell_treated_with_Lipopolysaccharide_0_ng-mL_for_0_hour-Garber2017',\n        'CD14-positive_monocyte_treated_with_RPMI_1h-Novakovic2016',\n        'U937_LPS_4hr-Engreitz',\n        'CD14-positive_monocyte-Novakovic2016',\n        'dendritic_cell_treated_with_Lipopolysaccharide_100_ng-mL_for_6_hour-Garber2017',\n        'CD14-positive_monocyte_treated_with_BG_4h-Novakovic2016',\n        'THP_pmaLPS_ATAC_0h',\n        'HAP1',\n        'THP-1_macrophage-VanBortle2017',\n        'dendritic_cell_treated_with_Lipopolysaccharide_100_ng-mL_for_1_hour-Garber2017',\n        'U937-Engreitz',\n        'CD14-positive_monocyte_treated_with_RPMI_d1-Novakovic2016',\n        'CD14-positive_monocyte_treated_with_RPMI_4h-Novakovic2016',\n        'CD14-positive_monocyte_treated_with_LPS_d6-Novakovic2016',\n        'CD14-positive_monocyte_treated_with_LPS_1h-Novakovic2016',\n        'THP_pmaLPS_ATAC_24h',\n        'THP_pmaLPS_ATAC_1h',\n        'dendritic_cell_treated_with_Lipopolysaccharide_100_ng-mL_for_2_hour-Garber2017',\n        'CD14-positive_monocyte_treated_with_BG_d6-Novakovic2016',\n        'dendritic_cell_treated_with_Lipopolysaccharide_100_ng-mL_for_30_minute-Garber2017',\n        'THP_pmaLPS_ATAC_120h',\n        'dendritic_cell_treated_with_Lipopolysaccharide_100_ng-mL_for_4_hour-Garber2017',\n        'THP_pmaLPS_ATAC_48h',\n        'CD14-positive_monocytes-Roadmap',\n        'THP_pmaLPS_ATAC_12h', // monoctye\n      ],\n    },\n    {\n      label: 'B Cells',\n      categories: [\n        'Karpas-422-ENCODE', // b-cell cell line\n        'BJAB-Engreitz',\n        'BJAB_anti-IgM_anti-CD40_4hr-Engreitz',\n        'B_cell-ENCODE',\n        'OCI-LY7-ENCODE',\n        'GM12878-Roadmap',\n        'MM.1S-ENCODE',\n        'CD19-positive_B_cell-Roadmap',\n        'CD8-positive_alpha-beta_T_cell-ENCODE',\n      ],\n    },\n    {\n      label: 'T Cells',\n      categories: [\n        'Jurkat_anti-CD3_PMA_4hr-Engreitz', // t-cell\n        'Jurkat-Engreitz',\n        'CD3-positive_T_cell-Roadmap',\n        'CD4-positive_helper_T_cell-ENCODE',\n        'CD8-positive_alpha-beta_T_cell-Corces2016',\n        'thymus_fetal-Roadmap',\n        'CD4-positive_helper_T_cell-Corces2016',\n        'T-cell-ENCODE',\n      ],\n    },\n    {\n      label: 'Other haematopoietic cells',\n      categories: [\n        'spleen-ENCODE',\n        'K562-Roadmap',\n        'CD56-positive_natural_killer_cells-Roadmap',\n        'erythroblast-Corces2016',\n        'CD34-positive_mobilized-Roadmap',\n        'megakaryocyte-erythroid_progenitor-Corces2016',\n        'natural_killer_cell-Corces2016',\n        'IMR90-Roadmap',\n      ],\n    },\n    {\n      label: 'Fibroblasts',\n      categories: [\n        'foreskin_fibroblast-Roadmap',\n        'fibroblast_of_dermis-Roadmap',\n        'fibroblast_of_arm-ENCODE',\n        'astrocyte-ENCODE',\n        'fibroblast_of_lung-Roadmap',\n      ],\n    },\n    {\n      label: 'Epithelial',\n      categories: [\n        'small_intestine_fetal-Roadmap',\n        'epithelial_cell_of_prostate-ENCODE',\n        'HCT116-ENCODE',\n        'MCF-7-ENCODE',\n        'adrenal_gland_fetal-ENCODE',\n        'H7',\n        'keratinocyte-Roadmap',\n        'MCF10A-Ji2017',\n        'pancreas-Roadmap',\n        'mammary_epithelial_cell-Roadmap',\n        'stomach-Roadmap',\n        'LoVo',\n        'A549_treated_with_ethanol_0.02_percent_for_1_hour-Roadmap',\n        'PC-9-ENCODE',\n        'H1-hESC-Roadmap',\n        'thyroid_gland-ENCODE',\n        'HT29',\n        'MDA-MB-231',\n        'iPS_DF_19.11_Cell_Line-Roadmap',\n        'large_intestine_fetal-Roadmap',\n        'Panc1-ENCODE',\n        'adrenal_gland-ENCODE',\n        'MCF10A_treated_with_TAM24hr-Ji2017',\n        'trophoblast_cell-ENCODE',\n        'H1_BMP4_Derived_Trophoblast_Cultured_Cells-Roadmap',\n        'uterus-ENCODE',\n        'body_of_pancreas-ENCODE',\n        'stomach_fetal-Roadmap',\n        'H9-Roadmap',\n        'transverse_colon-ENCODE',\n        'H1_BMP4_Derived_Mesendoderm_Cultured_Cells-Roadmap',\n        'breast_epithelium-ENCODE',\n        'induced_pluripotent_stem_cell-ENCODE',\n        'LNCAP',\n        'H1_Derived_Mesenchymal_Stem_Cells-Roadmap',\n        'ovary-Roadmap',\n        'sigmoid_colon-ENCODE',\n        'skeletal_muscle_myoblast-Roadmap',\n        'bipolar_neuron_from_iPSC-ENCODE',\n        'coronary_artery_smooth_muscle_cell-Miller2016',\n        'SK-N-SH-ENCODE',\n        'muscle_of_trunk_fetal-Roadmap',\n      ],\n    },\n    {\n      label: 'Other',\n      categories: [\n        'adipose_tissue-ENCODE',\n        'HeLa-S3-Roadmap',\n        'hepatocyte-ENCODE',\n        'heart_ventricle-ENCODE',\n        'spinal_cord_fetal-ENCODE',\n        'coronary_artery-ENCODE',\n        'HepG2-Roadmap',\n        'muscle_of_leg_fetal-Roadmap',\n        'gastrocnemius_medialis-ENCODE',\n        'brite_adipose-Loft2014',\n        'placenta-Roadmap',\n        'liver-ENCODE',\n        'A673-ENCODE',\n        'white_adipose-Loft2014',\n        'cardiac_muscle_cell-ENCODE',\n        'osteoblast-ENCODE',\n        'H1_Derived_Neuronal_Progenitor_Cultured_Cells-Roadmap',\n        'endothelial_cell_of_umbilical_vein-Roadmap',\n        'NCCIT',\n        'myotube_originated_from_skeletal_muscle_myoblast-Roadmap',\n        'psoas_muscle-Roadmap',\n        'endothelial_cell_of_umbilical_vein_vegf_stim_4_hours-zhang2013',\n        'endothelial_cell_of_umbilical_vein_vegf_stim_12_hours-zhang2013',\n      ],\n    },\n  ],\n};\n\nexport const GROUPED_SAMPLE_OPTIONS = DEFAULT_STRATIFICATION.groups.map(\n  (group) => ({\n    name: group.label,\n    options: group.categories,\n  })\n);\n\nexport const SAMPLE_TO_GROUP = GROUPED_SAMPLE_OPTIONS.reduce(\n  (sampleToGroup, group) => {\n    group.options.forEach((option) => {\n      sampleToGroup[option] = group.name;\n    });\n    return sampleToGroup;\n  },\n  {}\n);\n\nexport const SAMPLES = GROUPED_SAMPLE_OPTIONS.flatMap((group) => group.options);\n\nexport const SAMPLE_IDX = SAMPLES.reduce((idxs, sample, idx) => {\n  idxs[sample] = idx;\n  return idxs;\n}, {});\n\nexport const DEFAULT_X_DOMAIN_START = 1761366260;\nexport const DEFAULT_X_DOMAIN_END = 1761603836;\n\nexport const DEFAULT_VARIANT_TRACKS = [\n  {\n    server: 'https://resgen.io/api/v1',\n    tilesetUid: 'VF5-RDXWTxidGMJU7FeaxA',\n    columnPvalue: 7,\n    columnPosteriorProbability: 8,\n    markColor: 'black',\n    label: 'IBD Variants',\n  },\n];\n\nexport const DEFAULT_VARIANT_TRACK_DEF = {\n  type: 'point-annotation',\n  height: 32,\n  options: {\n    axisPositionHorizontal: 'right',\n    markColor: 'black',\n    markColorFocus: '#cc0078',\n    markSize: 2,\n    markOpacity: 0.33,\n    markOpacityFocus: 0.66,\n    valueColumn: 7,\n    name: 'Variants',\n    labelPosition: 'topLeft',\n    labelColor: 'black',\n    labelOpacity: 0.33,\n    showMousePosition: true,\n    showGlobalMousePosition: true,\n    mousePositionColor: 'black',\n    toolTip: {\n      name: {\n        field: 3,\n      },\n      value: {\n        field: 6,\n        numDecimals: 2,\n      },\n      other: [\n        {\n          label: 'Post. Prob.',\n          field: 7,\n          numDecimals: 2,\n        },\n      ],\n    },\n  },\n};\n\nexport const LOCAL_BED_TILESET_INFO_HG19 = {\n  zoom_step: 1,\n  max_length: 3137161265,\n  assembly: 'hg19',\n  chrom_names:\n    'chr1\\tchr2\\tchr3\\tchr4\\tchr5\\tchr6\\tchr7\\tchr8\\tchr9\\tchr10\\tchr11\\tchr12\\tchr13\\tchr14\\tchr15\\tchr16\\tchr17\\tchr18\\tchr19\\tchr20\\tchr21\\tchr22\\tchrX\\tchrY\\tchrM\\tchr6_ssto_hap7\\tchr6_mcf_hap5\\tchr6_cox_hap2\\tchr6_mann_hap4\\tchr6_apd_hap1\\tchr6_qbl_hap6\\tchr6_dbb_hap3\\tchr17_ctg5_hap1\\tchr4_ctg9_hap1\\tchr1_gl000192_random\\tchrUn_gl000225\\tchr4_gl000194_random\\tchr4_gl000193_random\\tchr9_gl000200_random\\tchrUn_gl000222\\tchrUn_gl000212\\tchr7_gl000195_random\\tchrUn_gl000223\\tchrUn_gl000224\\tchrUn_gl000219\\tchr17_gl000205_random\\tchrUn_gl000215\\tchrUn_gl000216\\tchrUn_gl000217\\tchr9_gl000199_random\\tchrUn_gl000211\\tchrUn_gl000213\\tchrUn_gl000220\\tchrUn_gl000218\\tchr19_gl000209_random\\tchrUn_gl000221\\tchrUn_gl000214\\tchrUn_gl000228\\tchrUn_gl000227\\tchr1_gl000191_random\\tchr19_gl000208_random\\tchr9_gl000198_random\\tchr17_gl000204_random\\tchrUn_gl000233\\tchrUn_gl000237\\tchrUn_gl000230\\tchrUn_gl000242\\tchrUn_gl000243\\tchrUn_gl000241\\tchrUn_gl000236\\tchrUn_gl000240\\tchr17_gl000206_random\\tchrUn_gl000232\\tchrUn_gl000234\\tchr11_gl000202_random\\tchrUn_gl000238\\tchrUn_gl000244\\tchrUn_gl000248\\tchr8_gl000196_random\\tchrUn_gl000249\\tchrUn_gl000246\\tchr17_gl000203_random\\tchr8_gl000197_random\\tchrUn_gl000245\\tchrUn_gl000247\\tchr9_gl000201_random\\tchrUn_gl000235\\tchrUn_gl000239\\tchr21_gl000210_random\\tchrUn_gl000231\\tchrUn_gl000229\\tchrUn_gl000226\\tchr18_gl000207_random',\n  chrom_sizes:\n    '249250621\\t243199373\\t198022430\\t191154276\\t180915260\\t171115067\\t159138663\\t146364022\\t141213431\\t135534747\\t135006516\\t133851895\\t115169878\\t107349540\\t102531392\\t90354753\\t81195210\\t78077248\\t59128983\\t63025520\\t48129895\\t51304566\\t155270560\\t59373566\\t16571\\t4928567\\t4833398\\t4795371\\t4683263\\t4622290\\t4611984\\t4610396\\t1680828\\t590426\\t547496\\t211173\\t191469\\t189789\\t187035\\t186861\\t186858\\t182896\\t180455\\t179693\\t179198\\t174588\\t172545\\t172294\\t172149\\t169874\\t166566\\t164239\\t161802\\t161147\\t159169\\t155397\\t137718\\t129120\\t128374\\t106433\\t92689\\t90085\\t81310\\t45941\\t45867\\t43691\\t43523\\t43341\\t42152\\t41934\\t41933\\t41001\\t40652\\t40531\\t40103\\t39939\\t39929\\t39786\\t38914\\t38502\\t38154\\t37498\\t37175\\t36651\\t36422\\t36148\\t34474\\t33824\\t27682\\t27386\\t19913\\t15008\\t4262',\n  tile_size: 1024.0,\n  max_zoom: 22,\n  max_width: 4294967296.0,\n  min_pos: [1],\n  max_pos: [3137161265],\n  header:\n    'chrom1\\tstart1\\tend1\\tchrom2\\tstart2\\tend2\\ttargetGene\\tscore\\tstrand1\\tstrand2\\tcellType',\n  version: 2,\n  coordSystem: '',\n};\n\nexport const DEFAULT_VIEW_CONFIG_ENHANCER = {\n  editable: false,\n  trackSourceServers: ['//higlass.io/api/v1'],\n  views: [\n    {\n      uid: 'context',\n      genomePositionSearchBox: {\n        autocompleteServer: '//higlass.io/api/v1',\n        autocompleteId: 'OHJakQICQD6gTD7skx4EWA',\n        chromInfoServer: '//higlass.io/api/v1',\n        chromInfoId: 'hg19',\n        visible: true,\n      },\n      chromInfoPath: '//s3.amazonaws.com/pkerp/data/hg19/chromSizes.tsv',\n      tracks: {\n        top: [\n          {\n            type: 'combined',\n            uid: 'chroms-viewport',\n            height: 12,\n            contents: [\n              {\n                type: 'horizontal-chromosome-labels',\n                options: {\n                  // tickPositions: 'ends',\n                  color: '#999999',\n                  stroke: 'white',\n                  fontSize: 10,\n                  fontIsLeftAligned: true,\n                  showMousePosition: false,\n                  mousePositionColor: '#000000',\n                },\n                tilesetUid: 'ADfY_RtsQR6oKOMyrq6qhw',\n                height: 12,\n                server: 'https://resgen.io/api/v1',\n                uid: 'chroms',\n              },\n              {\n                uid: 'viewport-details-chroms',\n                type: 'viewport-projection-horizontal',\n                fromViewUid: 'details',\n                height: 12,\n                options: {\n                  projectionFillColor: '#cc0078',\n                  projectionStrokeColor: '#cc0078',\n                  projectionFillOpacity: 0.3,\n                  projectionStrokeOpacity: 0.3,\n                  strokeWidth: 1,\n                },\n              },\n            ],\n          },\n          {\n            type: 'combined',\n            uid: 'genes-tss-viewport',\n            height: 48,\n            contents: [\n              {\n                type: 'horizontal-gene-annotations',\n                uid: 'genes',\n                height: 48,\n                server: 'https://resgen.io/api/v1',\n                tilesetUid: 'NCifnbrKQu6j-ohVWJLoJw',\n                options: {\n                  fontSize: 9,\n                  plusStrandColor: 'black',\n                  minusStrandColor: 'black',\n                  geneAnnotationHeight: 10,\n                  geneLabelPosition: 'outside',\n                  geneStrandSpacing: 0.5,\n                  showMousePosition: true,\n                  showGlobalMousePosition: true,\n                  mousePositionColor: 'black',\n                },\n              },\n              {\n                type: 'tss',\n                uid: 'tss',\n                height: 48,\n                // server: 'http://localhost:9876/api/v1',\n                // tilesetUid: 'RefSeqCurated170308bedCollapsedGeneBoundsTSS500bp',\n                server: 'https://resgen.io/api/v1',\n                tilesetUid: 'VMZDLKrtQDmJMSjg7Ds4yA',\n                options: {\n                  fontSize: 9,\n                  plusStrandColor: 'black',\n                  minusStrandColor: 'black',\n                  geneAnnotationHeight: 12,\n                  geneLabelPosition: 'outside',\n                  geneStrandSpacing: 2,\n                },\n              },\n              {\n                uid: 'viewport-details-genes',\n                type: 'viewport-projection-horizontal',\n                fromViewUid: 'details',\n                height: 48,\n                options: {\n                  projectionFillColor: '#cc0078',\n                  projectionStrokeColor: '#cc0078',\n                  projectionFillOpacity: 0.3,\n                  projectionStrokeOpacity: 0.3,\n                  strokeWidth: 1,\n                },\n              },\n            ],\n          },\n          {\n            type: 'combined',\n            uid: 'variants',\n            height: 32,\n            contents: [\n              {\n                type: 'point-annotation',\n                uid: 'ibd-snps',\n                // server: 'http://localhost:9876/api/v1',\n                // tilesetUid: 'IBDCombinedset1-2variantonly-pval',\n                server: 'https://resgen.io/api/v1',\n                tilesetUid: 'VF5-RDXWTxidGMJU7FeaxA',\n                height: 32,\n                options: {\n                  axisPositionHorizontal: 'right',\n                  markColor: 'black',\n                  markColorFocus: '#cc0078',\n                  markSize: 2,\n                  markOpacity: 0.33,\n                  markOpacityFocus: 0.66,\n                  // axisPositionHorizontal: 'right',\n                  valueColumn: 7,\n                  focusRegion: [\n                    1680373143 + 81046453 - 25,\n                    1680373143 + 81046453 + 25,\n                  ],\n                  name: 'IBD Variants',\n                  labelPosition: 'topLeft',\n                  labelColor: '#757575',\n                  showMousePosition: true,\n                  showGlobalMousePosition: true,\n                  mousePositionColor: 'black',\n                  toolTip: {\n                    name: {\n                      field: 3,\n                    },\n                    value: {\n                      field: 6,\n                      numDecimals: 2,\n                    },\n                    other: [\n                      {\n                        label: 'Post. Prob.',\n                        field: 7,\n                        numDecimals: 2,\n                      },\n                    ],\n                  },\n                },\n              },\n            ],\n          },\n          {\n            type: 'combined',\n            uid: 'arcs-stacked-bars',\n            height: 72,\n            contents: [\n              {\n                type: '1d-arcs',\n                uid: 'arcs',\n                server: 'https://resgen.io/api/v1',\n                tilesetUid: 'GOxTKzoLSsuw0BaG6eBrXw',\n                height: 72,\n                options: {\n                  labelPosition: 'hidden',\n                  strokeColor: '#808080',\n                  strokeWidth: 1,\n                  strokeOpacity: 0.05,\n                  arcStyle: 'circle',\n                  startField: 1,\n                  endField: 4,\n                  filter: {\n                    set: SAMPLES,\n                    field: 10,\n                  },\n                },\n              },\n              {\n                type: 'stacked-bar',\n                // server: 'http://localhost:9876/api/v1',\n                // tilesetUid: 'AllPredictionsAvgHiCABC0015minus150ForABCPaperV2hg19beddb',\n                server: 'https://resgen.io/api/v1',\n                // tilesetUid: 'P0Ng5fhvQWeO7dlpx0FknA', // all chroms\n                // tilesetUid: 'PGXLE50tQyOayNXKUnX4fQ', // just chr10\n                // tilesetUid: 'AaJojHeORzKyiag1pSlAag', // bed\n                tilesetUid: 'GOxTKzoLSsuw0BaG6eBrXw', // improved bed\n                height: 72,\n                uid: 'stacked-bars',\n                options: {\n                  binSize: 4,\n                  axisAlign: 'right',\n                  axisPositionHorizontal: 'right',\n                  labelPosition: 'topLeft',\n                  markColor: 'black',\n                  markColorFocus: '#cc0078',\n                  markSize: 4,\n                  markOpacity: 0.33,\n                  labelColor: 'black',\n                  offsetField: 3,\n                  startField: 4,\n                  endField: 5,\n                  importanceField: 7,\n                  importanceDomain: [0, 1],\n                  focusRegion: [\n                    1680373143 + 81046453 - 25,\n                    1680373143 + 81046453 + 25,\n                  ],\n                  name: 'Enhancer regions',\n                  stratification: DEFAULT_STRATIFICATION,\n                  showMousePosition: true,\n                  showGlobalMousePosition: true,\n                  mousePositionColor: 'black',\n                },\n              },\n            ],\n          },\n          {\n            type: 'stratified-bed',\n            // server: 'http://localhost:9876/api/v1',\n            // tilesetUid: 'AllPredictionsAvgHiCABC0015minus150ForABCPaperV2hg19beddb',\n            server: 'https://resgen.io/api/v1',\n            // tilesetUid: 'P0Ng5fhvQWeO7dlpx0FknA', // all chroms\n            // tilesetUid: 'PGXLE50tQyOayNXKUnX4fQ', // just chr10\n            // tilesetUid: 'AaJojHeORzKyiag1pSlAag', // bed\n            tilesetUid: 'GOxTKzoLSsuw0BaG6eBrXw', // improved bed\n            height: 413,\n            uid: 'indicatorByCellTypes',\n            options: {\n              axisAlign: 'right',\n              legendAlign: 'left',\n              labelPosition: 'hidden',\n              markColor: 'black',\n              markColorHighlight: '#bf0071',\n              markColorDehighlight: '#bbbbbb',\n              markSize: 4,\n              markMinWidth: 4,\n              markHeight: 3,\n              rowHeight: 3,\n              markOpacity: 0.33,\n              arcStyle: 'indicator',\n              indicatorStyle: 'category-rect',\n              labelColor: 'black',\n              geneField: 6,\n              importanceField: 7,\n              importanceDomain: [0, 1],\n              // focusRegion: [\n              //   1680373143 + 81046453 - 25,\n              //   1680373143 + 81046453 + 25,\n              // ],\n              name: 'By Celltype',\n              axisPositionHorizontal: 'right',\n              stratification: DEFAULT_STRATIFICATION,\n              showMousePosition: true,\n              showGlobalMousePosition: true,\n              mousePositionColor: 'black',\n            },\n          },\n        ],\n      },\n      overlays: [\n        {\n          uid: 'region-focus',\n          includes: [\n            'chroms-viewport',\n            'genes-tss-viewport',\n            'variants',\n            'arcs-stacked-bars',\n            'indicatorByCellTypes',\n          ],\n          options: {\n            extent: [[1680373143 + 81046453, 1680373143 + 81046454]],\n            minWidth: 3,\n            fill: '#cc0078',\n            fillOpacity: 0.05,\n            strokeWidth: 0,\n            outline: '#cc0078',\n            outlineOpacity: 0.33,\n            outlineWidth: 1,\n            outlinePos: ['left', 'right'],\n          },\n        },\n        {\n          uid: 'gene-focus',\n          includes: ['genes-tss-viewport'],\n          options: {\n            extent: [],\n            minWidth: 3,\n            fill: '#cc0078',\n            fillOpacity: 0.25,\n            stroke: '#cc0078',\n            strokeWidth: 0,\n            outlineWidth: 0,\n          },\n        },\n        {\n          uid: 'tss-overlays',\n          includes: [\n            'chroms',\n            'genes-tss-viewport',\n            'variants',\n            'arcs-stacked-bars',\n            'indicatorByCellTypes',\n          ],\n          options: {\n            extent: [],\n            minWidth: 1,\n            fill: 'black',\n            fillOpacity: 0.05,\n            strokeWidth: 0,\n            outline: 'black',\n            outlineOpacity: 0.1,\n            outlineWidth: 1,\n            outlinePos: ['left'],\n          },\n        },\n      ],\n      metaTracks: [\n        {\n          uid: 'tss-overlays-meta',\n          type: 'annotation-overlay',\n          overlaysTrack: 'tss-overlays',\n          options: {\n            annotationTracks: ['tss'],\n          },\n        },\n      ],\n      layout: {\n        w: 12,\n        h: 12,\n        x: 0,\n        y: 0,\n      },\n      initialXDomain: [DEFAULT_X_DOMAIN_START, DEFAULT_X_DOMAIN_END],\n      initialYDomain: [DEFAULT_X_DOMAIN_START, DEFAULT_X_DOMAIN_END],\n    },\n  ],\n};\n\nexport const DEFAULT_DNA_ACCESSIBILITY_ROW_SELECTION = [\n  120,\n  36,\n  54,\n  20,\n  80,\n  35,\n  101,\n  49,\n  44,\n  23,\n  30,\n  66,\n  5,\n  26,\n  15,\n  105,\n  57,\n  56,\n  74,\n  84,\n  79,\n  93,\n  106,\n  107,\n  34,\n  28,\n  25,\n  55,\n  121,\n  94,\n  58,\n  69,\n  67,\n  63,\n  126,\n  71,\n  72,\n  47,\n  11,\n  46,\n  39,\n  113,\n  29,\n  60,\n  45,\n  76,\n  21,\n  103,\n  129,\n  13,\n  128,\n  90,\n  104,\n  32,\n  109,\n  27,\n  9,\n  130,\n  95,\n  86,\n  53,\n  73,\n  50,\n  48,\n  78,\n  14,\n  92,\n  124,\n  31,\n  114,\n  64,\n  88,\n  12,\n  10,\n  38,\n  68,\n  3,\n  111,\n  70,\n  22,\n  61,\n  98,\n  6,\n  123,\n  118,\n  43,\n  37,\n  65,\n  81,\n  62,\n  33,\n  1,\n  24,\n  122,\n  83,\n  75,\n  112,\n  40,\n  97,\n  16,\n  117,\n  87,\n  19,\n  125,\n  7,\n  102,\n  116,\n  77,\n  8,\n  17,\n  82,\n  115,\n  89,\n  119,\n  18,\n  4,\n  108,\n  59,\n  127,\n  91,\n  0,\n  100,\n  85,\n  110,\n  99,\n  2,\n  96,\n  51,\n  41,\n  52,\n  42,\n];\n\nexport const DEFAULT_DNA_ACCESSIBILITY_ROW_CATEGORIES = DEFAULT_STRATIFICATION.groups.reduce(\n  (row, group, index) => {\n    const category = {\n      label: group.label,\n      color: group.axisLabelColor,\n      background: group.axisLabelBackground,\n      index,\n    };\n    group.categories.forEach((sample) => {\n      row[sample] = category;\n    });\n    return row;\n  },\n  {}\n);\n\nexport const DEFAULT_VIEW_CONFIG_DNA_ACCESSIBILITY = {\n  zoomFixed: false,\n  editable: false,\n  trackSourceServers: ['//higlass.io/api/v1'],\n  views: [\n    {\n      uid: 'details',\n      chromInfoPath: '//s3.amazonaws.com/pkerp/data/hg19/chromSizes.tsv',\n      tracks: {\n        top: [\n          {\n            uid: 'chroms',\n            type: 'horizontal-chromosome-labels',\n            server: 'https://resgen.io/api/v1',\n            tilesetUid: 'ADfY_RtsQR6oKOMyrq6qhw',\n            height: 17,\n            options: {\n              // tickPositions: 'ends',\n              color: '#999999',\n              stroke: 'white',\n              fontSize: 10,\n              fontIsLeftAligned: true,\n              showMousePosition: false,\n              mousePositionColor: '#000000',\n            },\n          },\n          {\n            uid: 'genes',\n            type: 'horizontal-gene-annotations',\n            server: 'https://resgen.io/api/v1',\n            tilesetUid: 'NCifnbrKQu6j-ohVWJLoJw',\n            height: 48,\n            options: {\n              fontSize: 9,\n              plusStrandColor: 'black',\n              minusStrandColor: 'black',\n              geneAnnotationHeight: 10,\n              geneLabelPosition: 'outside',\n              geneStrandSpacing: 0.5,\n              showMousePosition: true,\n              showGlobalMousePosition: true,\n              mousePositionColor: 'black',\n            },\n          },\n          {\n            type: 'combined',\n            uid: 'variants',\n            height: 32,\n            contents: [\n              {\n                type: 'point-annotation',\n                uid: 'ibd-snps',\n                // server: 'http://localhost:9876/api/v1',\n                // tilesetUid: 'IBDCombinedset1-2variantonly-pval',\n                server: 'https://resgen.io/api/v1',\n                tilesetUid: 'VF5-RDXWTxidGMJU7FeaxA',\n                height: 32,\n                options: {\n                  axisPositionHorizontal: 'right',\n                  markColor: 'black',\n                  markColorFocus: '#cc0078',\n                  markSize: 2,\n                  markOpacity: 0.33,\n                  markOpacityFocus: 0.66,\n                  // axisPositionHorizontal: 'right',\n                  valueColumn: 7,\n                  focusRegion: [\n                    1680373143 + 81046453 - 25,\n                    1680373143 + 81046453 + 25,\n                  ],\n                  name: 'IBD Variants',\n                  labelPosition: 'topLeft',\n                  labelColor: '#757575',\n                  showMousePosition: true,\n                  showGlobalMousePosition: true,\n                  mousePositionColor: 'black',\n                  toolTip: {\n                    name: {\n                      field: 3,\n                    },\n                    value: {\n                      field: 6,\n                      numDecimals: 2,\n                    },\n                    other: [\n                      {\n                        label: 'Post. Prob.',\n                        field: 7,\n                        numDecimals: 2,\n                      },\n                    ],\n                  },\n                },\n              },\n            ],\n          },\n          {\n            uid: 'dna-accessibility',\n            type: 'ridge-plot',\n            // server: 'http://localhost:9876/api/v1',\n            // tilesetUid: 'test',\n            server: 'https://resgen.io/api/v1',\n            tilesetUid: 'Uz1_tEABQf-uzktblvBKSQ',\n            // height: 403,\n            height: 131 * (24 - 6) + 6,\n            options: {\n              name: 'DNA Accessibility',\n              labelPosition: 'outerBottom',\n              labelShowResolution: false,\n              labelShowAssembly: false,\n              markArea: true,\n              markColor: '#444444',\n              markResolution: 256,\n              valueScaling: 'exponential',\n              colorRange: ['#ffffff', '#000000'],\n              rowHeight: 24,\n              rowPadding: -6,\n              rowNormalization: true,\n              rowSelections: DEFAULT_DNA_ACCESSIBILITY_ROW_SELECTION,\n              rowIdToCategory: {\n                fn: 'replace',\n                args: ['.accessibility', ''],\n              },\n              rowCategories: DEFAULT_DNA_ACCESSIBILITY_ROW_CATEGORIES,\n              showRowLabels: true,\n              rowLabelSize: 10,\n              showMousePosition: true,\n              showGlobalMousePosition: true,\n              mousePositionColor: 'black',\n            },\n          },\n        ],\n      },\n      overlays: [\n        {\n          uid: 'region-focus',\n          includes: ['chroms', 'genes', 'variants', 'dna-accessibility'],\n          options: {\n            extent: [],\n            minWidth: 3,\n            fill: '#cc0078',\n            fillOpacity: 0.05,\n            strokeWidth: 0,\n            outline: '#cc0078',\n            outlineOpacity: 0.33,\n            outlineWidth: 1,\n            outlinePos: ['left', 'right'],\n          },\n        },\n      ],\n      layout: {\n        w: 12,\n        h: 12,\n        x: 0,\n        y: 0,\n      },\n      initialXDomain: [\n        1680373143 + 81046453 - 500,\n        1680373143 + 81046454 + 500,\n      ],\n      initialYDomain: [\n        1680373143 + 81046453 - 500,\n        1680373143 + 81046454 + 500,\n      ],\n    },\n  ],\n};\n","import { atom, selector } from 'recoil';\nimport { memoize } from 'lodash-es';\nimport { deepClone } from '@flekschas/utils';\n\nimport { useRecoilQueryString } from './use-query-string';\n\nimport {\n  booleanQueryStringDecoder,\n  getQueryStringValue,\n  toAbsPosition,\n} from './utils';\n\nimport {\n  DEFAULT_X_DOMAIN_START,\n  DEFAULT_X_DOMAIN_END,\n  DEFAULT_VARIANT_TRACKS,\n  GROUPED_SAMPLE_OPTIONS,\n  SAMPLES,\n} from './constants';\n\nconst getDefault = (key, initialValue, decoder) =>\n  getQueryStringValue(key, decoder) === undefined\n    ? initialValue\n    : getQueryStringValue(key, decoder);\n\nconst chrPosUrlEncoder = (chrPos) =>\n  chrPos ? chrPos.replace(':', '.') : chrPos;\n\nconst chrPosUrlDecoder = (chrPos) =>\n  chrPos ? chrPos.replace('.', ':') : chrPos;\n\n// Atoms\nexport const sampleFilterState = atom({\n  key: 'sampleFilterState',\n  default: '',\n});\n\nexport const sampleSelectionState = selector({\n  key: 'sampleSelection',\n  get: ({ get }) => SAMPLES.map((name) => get(sampleWithName(name)).checked),\n});\n\nexport const selectedSamplesState = selector({\n  key: 'selectedSamples',\n  get: ({ get }) => SAMPLES.filter((name) => get(sampleWithName(name)).checked),\n});\n\nexport const sampleWithName = memoize((name) =>\n  atom({\n    key: `sample-${name}`,\n    default: {\n      checked: true,\n      visible: true,\n    },\n  })\n);\n\nexport const sampleGroupWithGroup = memoize(\n  (group) =>\n    atom({\n      key: `sampleGroup-${group.name}`,\n      default: {\n        checked: true,\n        visible: true,\n        n: group.options.length,\n        N: group.options.length,\n      },\n    }),\n  (group) => group.name\n);\n\nexport const sampleGroupSelectionSizesState = selector({\n  key: 'sampleGroupSelectionSizes',\n  get: ({ get }) =>\n    GROUPED_SAMPLE_OPTIONS.reduce((sizes, group) => {\n      sizes[group.name] = get(sampleGroupWithGroup(group)).n;\n      return sizes;\n    }, {}),\n});\n\nexport const variantTracksState = atom({\n  key: 'variantTracks',\n  default: deepClone(DEFAULT_VARIANT_TRACKS),\n});\n\nexport const showVariantsSettingsState = atom({\n  key: 'showVariantsSettings',\n  default: false,\n});\n\nexport const showWelcomeState = atom({\n  key: 'showWelcome',\n  default: getDefault('w', true, booleanQueryStringDecoder),\n});\n\nexport const dnaAccessLabelStyleState = atom({\n  key: 'dnaAccessLabelStyle',\n  default: getDefault('dal', 'indicator'),\n});\n\nexport const dnaAccessLabelShowInfoState = atom({\n  key: 'dnaAccessLabelShowInfos',\n  default: getDefault('dai', true, booleanQueryStringDecoder),\n});\n\nexport const focusGeneState = atom({\n  key: 'focusGene',\n  default: getDefault('g', ''),\n});\n\nexport const focusGeneOptionState = atom({\n  key: 'focusGeneOption',\n  default: null,\n});\n\nexport const focusVariantState = atom({\n  key: 'focusVariant',\n  default: getDefault('v', 'rs1250566'),\n});\n\nexport const focusVariantOptionState = atom({\n  key: 'focusVariantOption',\n  default: null,\n});\n\nexport const focusRegionOptionState = atom({\n  key: 'focusRegionOption',\n  default: null,\n});\n\nexport const variantYScaleState = atom({\n  key: 'variantYScale',\n  default: getDefault('vy', 'pValue'),\n});\n\nexport const enhancerRegionsHideUnfocusedState = atom({\n  key: 'enhancerRegionsHideUnfocused',\n  default: getDefault('erhu', false, booleanQueryStringDecoder),\n});\n\nexport const enhancerRegionsColorEncodingState = atom({\n  key: 'enhancerRegionsColorEncoding',\n  default: getDefault('erc', 'solid'),\n});\n\nexport const enhancerRegionsShowInfoState = atom({\n  key: 'enhancerRegionsShowInfos',\n  default: getDefault('eri', true, booleanQueryStringDecoder),\n});\n\nexport const enhancerGenesShowInfoState = atom({\n  key: 'enhancerGenesShowInfos',\n  default: getDefault('egi', true, booleanQueryStringDecoder),\n});\n\nexport const enhancerGenesPaddingState = atom({\n  key: 'enhancerGenesPadding',\n  default: getDefault('egp', false, booleanQueryStringDecoder),\n});\n\nexport const enhancerGenesCellEncodingState = atom({\n  key: 'enhancerGenesCellEncoding',\n  default: getDefault('egce', 'number'),\n});\n\nexport const enhancerGenesSvgState = atom({\n  key: 'enhancerGenesSvg',\n  default: null,\n});\nexport const higlassEnhancerRegionsState = atom({\n  key: 'higlassEnhancerRegions',\n  default: null,\n});\n\nexport const higlassDnaAccessState = atom({\n  key: 'higlassDnaAccess',\n  default: null,\n});\n\n// Dynamic state\nexport const xDomainStartWithAssembly = memoize(\n  (chromInfo) =>\n    atom({\n      key: `xDomainStart-${chromInfo.totalLength}`,\n      default: getDefault(\n        'xs',\n        chromInfo.absToChr(DEFAULT_X_DOMAIN_START).slice(0, 2).join(':'),\n        chrPosUrlDecoder\n      ),\n    }),\n  (chromInfo) => chromInfo.totalLength\n);\n\nexport const xDomainEndWithAssembly = memoize(\n  (chromInfo) =>\n    atom({\n      key: `xDomainEnd-${chromInfo.totalLength}`,\n      default: getDefault(\n        'xe',\n        chromInfo.absToChr(DEFAULT_X_DOMAIN_END).slice(0, 2).join(':'),\n        chrPosUrlDecoder\n      ),\n    }),\n  (chromInfo) => chromInfo.totalLength\n);\n\n// Derived state\nexport const xDomainStartAbsWithAssembly = memoize(\n  (chromInfo) =>\n    selector({\n      key: `xDomainStartAbs-${chromInfo.totalLength}`,\n      get: ({ get }) => {\n        const xDomainStart = get(xDomainStartWithAssembly(chromInfo));\n        return toAbsPosition(xDomainStart, chromInfo);\n      },\n    }),\n  (chromInfo) => chromInfo.totalLength\n);\n\nexport const xDomainEndAbsWithAssembly = memoize(\n  (chromInfo) =>\n    selector({\n      key: `xDomainEndAbs-${chromInfo.totalLength}`,\n      get: ({ get }) => {\n        const xDomainEnd = get(xDomainEndWithAssembly(chromInfo));\n        return toAbsPosition(xDomainEnd, chromInfo);\n      },\n    }),\n  (chromInfo) => chromInfo.totalLength\n);\n\nexport const focusGeneStartWithAssembly = memoize(\n  (chromInfo) =>\n    selector({\n      key: `focusGeneStart-${chromInfo.totalLength}`,\n      get: ({ get }) => {\n        const focusGeneOption = get(focusGeneOptionState);\n        return focusGeneOption\n          ? toAbsPosition(\n              `${focusGeneOption.chr}:${focusGeneOption.txStart}`,\n              chromInfo\n            )\n          : null;\n      },\n    }),\n  (chromInfo) => chromInfo.totalLength\n);\n\nexport const focusGeneEndWithAssembly = memoize(\n  (chromInfo) =>\n    selector({\n      key: `focusGeneEnd-${chromInfo.totalLength}`,\n      get: ({ get }) => {\n        const focusGeneOption = get(focusGeneOptionState);\n        return focusGeneOption\n          ? toAbsPosition(\n              `${focusGeneOption.chr}:${focusGeneOption.txEnd}`,\n              chromInfo\n            )\n          : null;\n      },\n    }),\n  (chromInfo) => chromInfo.totalLength\n);\n\nexport const focusVariantPositionWithAssembly = memoize((chromInfo) =>\n  selector({\n    key: `focusVariantPosition-${chromInfo.totalLength}`,\n    get: ({ get }) => {\n      const focusVariantOption = get(focusVariantOptionState);\n      return focusVariantOption\n        ? toAbsPosition(\n            `${focusVariantOption.chr}:${focusVariantOption.txStart}`,\n            chromInfo\n          )\n        : null;\n    },\n  })\n);\n\nexport const focusVariantRelPositionState = selector({\n  key: 'focusVariantRelPosition',\n  get: ({ get }) => {\n    const focusVariantOption = get(focusVariantOptionState);\n    return focusVariantOption ? +focusVariantOption.txStart : null;\n  },\n});\n\nexport const focusVariantStrPositionState = selector({\n  key: 'focusVariantStrPosition',\n  get: ({ get }) => {\n    const focusVariantOption = get(focusVariantOptionState);\n    return focusVariantOption\n      ? `${focusVariantOption.chr}:${focusVariantOption.txStart}`\n      : null;\n  },\n});\n\n// Predefined hooks\nexport const useShowWelcome = () =>\n  useRecoilQueryString('w', showWelcomeState, {\n    decoder: booleanQueryStringDecoder,\n  });\n\nexport const useFocusGene = () => useRecoilQueryString('g', focusGeneState);\n\nexport const useFocusVariant = () =>\n  useRecoilQueryString('v', focusVariantState);\n\nexport const useDnaAccessLabelStyle = () =>\n  useRecoilQueryString('dal', dnaAccessLabelStyleState);\n\nexport const useDnaAccessShowInfos = () =>\n  useRecoilQueryString('dai', dnaAccessLabelShowInfoState, {\n    decoder: booleanQueryStringDecoder,\n  });\n\nexport const useXDomainStartWithAssembly = (chromInfo) =>\n  useRecoilQueryString('s', xDomainStartWithAssembly(chromInfo), {\n    encoder: chrPosUrlEncoder,\n  });\n\nexport const useXDomainEndWithAssembly = (chromInfo) =>\n  useRecoilQueryString('e', xDomainEndWithAssembly(chromInfo), {\n    encoder: chrPosUrlEncoder,\n  });\n\nexport const useEnhancerRegionsShowInfos = () =>\n  useRecoilQueryString('eri', enhancerRegionsShowInfoState, {\n    decoder: booleanQueryStringDecoder,\n  });\n\nexport const useEnhancerRegionsHideUnfocused = () =>\n  useRecoilQueryString('eri', enhancerRegionsHideUnfocusedState, {\n    decoder: booleanQueryStringDecoder,\n  });\n\nexport const useEnhancerRegionsColorEncoding = () =>\n  useRecoilQueryString('eri', enhancerRegionsColorEncodingState);\n\nexport const useEnhancerGenesShowInfos = () =>\n  useRecoilQueryString('egi', enhancerGenesShowInfoState, {\n    decoder: booleanQueryStringDecoder,\n  });\n\nexport const useEnhancerGenesPadding = () =>\n  useRecoilQueryString('egp', enhancerGenesPaddingState, {\n    decoder: booleanQueryStringDecoder,\n  });\n\nexport const useEnhancerGenesCellEncoding = () =>\n  useRecoilQueryString('egce', enhancerGenesCellEncodingState);\n\nexport const useVariantYScale = () =>\n  useRecoilQueryString('vs', variantYScaleState);\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { useRecoilState } from 'recoil';\nimport { deepClone } from '@flekschas/utils';\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport TextField from '@material-ui/core/TextField';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Typography from '@material-ui/core/Typography';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport FileInput from './FileInput';\nimport { useChromInfo } from './ChromInfoProvider';\nimport createLocalBedDataServer from './local-bed-data-server';\n\nimport { variantTracksState, useFocusVariant } from './state';\n\nimport { LOCAL_BED_TILESET_INFO_HG19 } from './constants';\n\nconst useStyles = makeStyles((theme) => ({\n  note: {\n    color: theme.palette.grey['400'],\n    marginTop: '1em',\n  },\n  title: {\n    fontSize: '1.5rem',\n    fontWeight: 700,\n    margin: '0.5rem 0 0 0',\n  },\n  buttonNormal: {\n    minWidth: '10.5rem',\n    margin: '0 0.5rem',\n  },\n  buttonActive: {\n    minWidth: '10.5rem',\n    marginLeft: '0.5rem',\n    color: 'white',\n    background: '#cc0078 linear-gradient(45deg, #cc0078 30%, #cc0066 90%)',\n    boxShadow: '0 1px 6px 1px rgba(255, 76, 151, .3)',\n    '&:hover': {\n      boxShadow: '0 1px 6px 1px rgba(255, 76, 151, .5)',\n      background: '#d90080 linear-gradient(45deg, #d90080 30%, #d9006c 90%)',\n    },\n    '&:focus': {\n      boxShadow: '0 1px 6px 1px rgba(255, 76, 151, .5)',\n    },\n  },\n  trackList: {\n    margin: '16px 0',\n  },\n}));\n\nconst useStylesTrackConfig = makeStyles((theme) => ({\n  icon: {\n    color: theme.palette.grey['400'],\n    '&:hover': {\n      color: 'black',\n    },\n  },\n  grow: {\n    flex: 1,\n  },\n  separator: {\n    padding: '0 8px',\n  },\n  server: {\n    flex: 1,\n    marginRight: '2px',\n  },\n  tilesetUid: {\n    flex: 1,\n    marginLeft: '2px',\n  },\n  propInput: {\n    flex: 1,\n    marginLeft: '2px',\n    marginRight: '2px',\n    '&:first-child': {\n      marginLeft: 0,\n    },\n    '&:last-child': {\n      marginRight: 0,\n    },\n  },\n}));\n\nconst useStylesTooltipVisible = makeStyles((theme) => ({\n  arrow: {\n    color: 'black',\n  },\n  tooltip: {\n    backgroundColor: 'black',\n  },\n}));\n\nconst useStylesTooltipHidden = makeStyles((theme) => ({\n  tooltip: {\n    display: 'none',\n  },\n}));\n\nconst TrackConfig = React.memo(function TrackConfig({ config, onChange }) {\n  const [state, setState] = useState(config);\n\n  const propertyChangeHandler = (property) => (event) => {\n    // eslint-disable-next-line prefer-destructuring\n    const value = event.target.value;\n    setState((currState) => ({\n      ...currState,\n      [property]: value,\n    }));\n  };\n\n  const serverChangeHandler = (event) => {\n    const server = event.target.value;\n    setState((currState) => ({\n      ...currState,\n      server,\n      file: undefined,\n    }));\n  };\n\n  const tilesetUidChangeHandler = (event) => {\n    const tilesetUid = event.target.value;\n    setState((currState) => ({\n      ...currState,\n      tilesetUid,\n      file: undefined,\n    }));\n  };\n\n  const fileChangeHandler = (file) => {\n    setState((currState) => ({\n      ...currState,\n      file,\n      server: undefined,\n      tilesetUid: undefined,\n    }));\n  };\n\n  const fileClearHandler = () => {\n    setState((currState) => ({\n      ...currState,\n      file: undefined,\n    }));\n  };\n\n  useEffect(() => {\n    if (state !== config) onChange(state);\n  }, [onChange, state, config]);\n\n  const isRemote = Boolean(state.server || state.tilesetUid);\n  const isLocal = Boolean(state.whatever);\n\n  const classes = useStylesTrackConfig();\n  const classesTooltipVisible = useStylesTooltipVisible();\n  const classesTooltipHidden = useStylesTooltipHidden();\n\n  return (\n    <React.Fragment>\n      <Grid alignItems=\"center\" container>\n        <Grid className={classes.grow} item>\n          <Grid alignItems=\"center\" container>\n            <Tooltip\n              classes={isLocal ? classesTooltipVisible : classesTooltipHidden}\n              title=\"Setting a server will clear the file!\"\n              placement=\"top\"\n              arrow\n            >\n              <TextField\n                label=\"Server URL\"\n                variant=\"outlined\"\n                size=\"small\"\n                value={state.server || ''}\n                onChange={serverChangeHandler}\n                className={classes.server}\n              />\n            </Tooltip>\n            <Tooltip\n              classes={isLocal ? classesTooltipVisible : classesTooltipHidden}\n              title=\"Setting a tileset ID will clear the file!\"\n              placement=\"top\"\n              arrow\n            >\n              <TextField\n                label=\"Tileset ID\"\n                variant=\"outlined\"\n                size=\"small\"\n                value={state.tilesetUid || ''}\n                onChange={tilesetUidChangeHandler}\n                className={classes.tilesetUid}\n              />\n            </Tooltip>\n          </Grid>\n        </Grid>\n        <Grid item>\n          <Typography className={classes.separator}>or</Typography>\n        </Grid>\n        <Grid item>\n          <Tooltip\n            classes={isRemote ? classesTooltipVisible : classesTooltipHidden}\n            title=\"Selecting a file will clear the server and tileset ID!\"\n            placement=\"top\"\n            arrow\n          >\n            <FileInput\n              file={state.file}\n              onChange={fileChangeHandler}\n              onClear={fileClearHandler}\n            />\n          </Tooltip>\n        </Grid>\n      </Grid>\n      <Grid alignItems=\"center\" container>\n        <TextField\n          label=\"Name\"\n          variant=\"outlined\"\n          margin=\"normal\"\n          size=\"small\"\n          value={state.label || ''}\n          onChange={propertyChangeHandler('label')}\n          className={classes.propInput}\n        />\n        <TextField\n          label=\"Column P-Value\"\n          variant=\"outlined\"\n          margin=\"normal\"\n          size=\"small\"\n          type=\"number\"\n          min=\"1\"\n          step=\"1\"\n          value={state.columnPvalue || 7}\n          onChange={propertyChangeHandler('columnPvalue')}\n          className={classes.propInput}\n        />\n        <TextField\n          label=\"Column Post. Prob\"\n          variant=\"outlined\"\n          margin=\"normal\"\n          size=\"small\"\n          type=\"number\"\n          min=\"1\"\n          step=\"1\"\n          value={state.columnPosteriorProbability || 8}\n          onChange={propertyChangeHandler('columnPosteriorProbability')}\n          className={classes.propInput}\n        />\n      </Grid>\n    </React.Fragment>\n  );\n});\n\nconst VariantsSettings = React.memo(function VariantsSettings({\n  closeHandler,\n}) {\n  const chromInfo = useChromInfo();\n\n  const setFocusVariant = useFocusVariant()[1];\n  const [variantTracks, setVariantTracks] = useRecoilState(variantTracksState);\n  const [tmpVariantTracks, setTmpVariantTracks] = useState(() =>\n    deepClone(variantTracks)\n  );\n  const [changed, setChanged] = useState(false);\n  const variantTrackServers = useRef([]);\n  const currVariantTracks = useRef(variantTracks);\n\n  useEffect(() => {\n    currVariantTracks.current = variantTracks;\n  }, [variantTracks]);\n\n  const changeTmpVariantTracks = useCallback(\n    (i) => (newTrackConfig) => {\n      setTmpVariantTracks((currTmpVariantTracks) => {\n        const newTmpVariantTracks = [...currTmpVariantTracks];\n        newTmpVariantTracks[i] = newTrackConfig;\n        return newTmpVariantTracks;\n      });\n      setChanged(true);\n    },\n    []\n  );\n\n  const saveHandler = useCallback(() => {\n    const newVariantTracks = deepClone(tmpVariantTracks);\n\n    // Destroy old servers\n    variantTrackServers.current.forEach((server) => {\n      server.destroy();\n    });\n\n    // Create new servers\n    variantTrackServers.current = newVariantTracks.reduce(\n      (servers, trackConfig) => {\n        if (trackConfig.file) {\n          const tilesetInfo = {\n            ...LOCAL_BED_TILESET_INFO_HG19,\n            name: trackConfig.file,\n          };\n          servers.push(\n            createLocalBedDataServer(\n              trackConfig.file,\n              trackConfig.file.name,\n              chromInfo,\n              tilesetInfo,\n              {\n                header: true,\n                columnImportance: 7,\n              }\n            )\n          );\n        }\n        return servers;\n      },\n      []\n    );\n    setVariantTracks(newVariantTracks);\n    if (\n      newVariantTracks.some(\n        (newTrackConfig, i) =>\n          newTrackConfig.server !== currVariantTracks.current[i].server\n      ) ||\n      newVariantTracks.some(\n        (newTrackConfig, i) =>\n          newTrackConfig.tilesetUid !== currVariantTracks.current[i].tilesetUid\n      ) ||\n      newVariantTracks.some(\n        (newTrackConfig, i) =>\n          newTrackConfig.file !== currVariantTracks.current[i].file\n      )\n    ) {\n      setFocusVariant(null);\n    }\n    closeHandler();\n  }, [\n    chromInfo,\n    tmpVariantTracks,\n    closeHandler,\n    setVariantTracks,\n    setFocusVariant,\n  ]);\n\n  const classes = useStyles();\n\n  return (\n    <React.Fragment>\n      <Typography\n        id=\"title\"\n        align=\"center\"\n        variant=\"h5\"\n        component=\"h2\"\n        noWrap\n        className={classes.title}\n      >\n        Variant Track\n      </Typography>\n      <p id=\"description\">\n        Variants can be loaded from a remote{' '}\n        <code>\n          <a\n            href=\"https://docs.higlass.io/data_preparation.html#bed-files\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            .beddb\n          </a>\n        </code>{' '}\n        or a local <code>.bed</code> file. To access a remote file, please enter\n        the URL of the{' '}\n        <a\n          href=\"https://docs.higlass.io/higlass_server.html\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          HiGlass server\n        </a>{' '}\n        and the track ID. To access a local file please select it with via the\n        file selection.\n      </p>\n      <div className={classes.trackList}>\n        {tmpVariantTracks.map((variantTrackConfig, i) => (\n          <TrackConfig\n            key={i}\n            config={variantTrackConfig}\n            onChange={changeTmpVariantTracks(i)}\n          />\n        ))}\n      </div>\n      <Typography align=\"center\">\n        <Button\n          className={classes.buttonNormal}\n          onClick={closeHandler}\n          variant=\"contained\"\n          disableElevation\n        >\n          Cancel\n        </Button>\n        <Button\n          className={changed ? classes.buttonActive : classes.buttonNormal}\n          onClick={changed ? saveHandler : closeHandler}\n          variant=\"contained\"\n          disableElevation\n        >\n          {changed ? 'Save' : 'Okay'}\n        </Button>\n      </Typography>\n    </React.Fragment>\n  );\n});\n\nexport default VariantsSettings;\n","import Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\nimport React, { useState } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport Logo from './Logo';\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    '&>p': {\n      fontSize: '1.125em',\n    },\n  },\n  title: {\n    display: 'flex',\n    justifyContent: 'center',\n    margin: theme.spacing(2, 0, 3),\n  },\n  note: {\n    color: theme.palette.grey['400'],\n    marginTop: '1em',\n  },\n  showTutorial: {\n    minWidth: '10.5rem',\n    marginRight: '0.5rem',\n  },\n  startExploring: {\n    minWidth: '10.5rem',\n    marginLeft: '0.5rem',\n    color: 'white',\n    background: '#cc0078 linear-gradient(45deg, #cc0078 30%, #cc0066 90%)',\n    boxShadow: '0 1px 6px 1px rgba(255, 76, 151, .3)',\n    '&:hover': {\n      boxShadow: '0 1px 6px 1px rgba(255, 76, 151, .5)',\n      background: '#d90080 linear-gradient(45deg, #d90080 30%, #d9006c 90%)',\n    },\n    '&:focus': {\n      boxShadow: '0 1px 6px 1px rgba(255, 76, 151, .5)',\n    },\n  },\n}));\n\nconst Welcome = React.memo(function Welcome({ closeHandler }) {\n  const [tutorial, setTutorial] = useState(false);\n\n  const classes = useStyles();\n\n  if (tutorial)\n    return (\n      <div className={classes.root}>\n        <p>\n          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do\n          eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad\n          minim veniam, quis nostrud exercitation ullamco laboris nisi ut\n          aliquip ex ea commodo consequat. Duis aute irure dolor in\n          reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla\n          pariatur. Excepteur sint occaecat cupidatat non proident, sunt in\n          culpa qui officia deserunt mollit anim id est laborum.\n        </p>\n        <p>\n          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do\n          eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad\n          minim veniam, quis nostrud exercitation ullamco laboris nisi ut\n          aliquip ex ea commodo consequat. Duis aute irure dolor in\n          reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla\n          pariatur. Excepteur sint occaecat cupidatat non proident, sunt in\n          culpa qui officia deserunt mollit anim id est laborum.\n        </p>\n        <p>\n          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do\n          eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad\n          minim veniam, quis nostrud exercitation ullamco laboris nisi ut\n          aliquip ex ea commodo consequat. Duis aute irure dolor in\n          reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla\n          pariatur. Excepteur sint occaecat cupidatat non proident, sunt in\n          culpa qui officia deserunt mollit anim id est laborum.\n        </p>\n        <p>\n          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do\n          eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad\n          minim veniam, quis nostrud exercitation ullamco laboris nisi ut\n          aliquip ex ea commodo consequat. Duis aute irure dolor in\n          reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla\n          pariatur. Excepteur sint occaecat cupidatat non proident, sunt in\n          culpa qui officia deserunt mollit anim id est laborum.\n        </p>\n        <p>\n          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do\n          eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad\n          minim veniam, quis nostrud exercitation ullamco laboris nisi ut\n          aliquip ex ea commodo consequat. Duis aute irure dolor in\n          reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla\n          pariatur. Excepteur sint occaecat cupidatat non proident, sunt in\n          culpa qui officia deserunt mollit anim id est laborum.\n        </p>\n        <p>\n          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do\n          eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad\n          minim veniam, quis nostrud exercitation ullamco laboris nisi ut\n          aliquip ex ea commodo consequat. Duis aute irure dolor in\n          reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla\n          pariatur. Excepteur sint occaecat cupidatat non proident, sunt in\n          culpa qui officia deserunt mollit anim id est laborum.\n        </p>\n        <p>\n          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do\n          eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad\n          minim veniam, quis nostrud exercitation ullamco laboris nisi ut\n          aliquip ex ea commodo consequat. Duis aute irure dolor in\n          reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla\n          pariatur. Excepteur sint occaecat cupidatat non proident, sunt in\n          culpa qui officia deserunt mollit anim id est laborum.\n        </p>\n        <p>\n          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do\n          eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad\n          minim veniam, quis nostrud exercitation ullamco laboris nisi ut\n          aliquip ex ea commodo consequat. Duis aute irure dolor in\n          reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla\n          pariatur. Excepteur sint occaecat cupidatat non proident, sunt in\n          culpa qui officia deserunt mollit anim id est laborum.\n        </p>\n        <p>\n          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do\n          eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad\n          minim veniam, quis nostrud exercitation ullamco laboris nisi ut\n          aliquip ex ea commodo consequat. Duis aute irure dolor in\n          reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla\n          pariatur. Excepteur sint occaecat cupidatat non proident, sunt in\n          culpa qui officia deserunt mollit anim id est laborum.\n        </p>\n        <Typography align=\"center\">\n          <Button\n            className={classes.startExploring}\n            onClick={closeHandler}\n            variant=\"contained\"\n            disableElevation\n          >\n            Start Exploring!\n          </Button>\n        </Typography>\n        <Typography align=\"center\" className={classes.note}>\n          <em>\n            You can reopen this tutorial by clicking on \"ABC Enhancer-Gene\n            Connections\" in the upper left corner!\n          </em>\n        </Typography>\n      </div>\n    );\n\n  return (\n    <div className={classes.root}>\n      <Typography\n        id=\"title\"\n        align=\"center\"\n        variant=\"h5\"\n        component=\"h2\"\n        noWrap\n        className={classes.title}\n      >\n        <Logo\n          styles={{\n            width: 'auto',\n          }}\n        />\n      </Typography>\n      <p id=\"description\">\n        This web application visualizes genome-wide enhancer-gene interactions\n        that were predicted with the <em>Activity-By-Contact</em> (ABC) model.\n        You can interactively browse the entire human genome and filter\n        enhancers by gene and containing variant.\n      </p>\n      <p>\n        For information regarding the ABC model please refer to our initial\n        publication:{' '}\n        <a\n          href=\"https://www.nature.com/articles/s41588-019-0538-0\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          Fulco et al., Activity-by-contact model of enhancerpromoter\n          regulation from thousands of CRISPR perturbations,{' '}\n          <em>Nature Genetics</em> (2019)\n        </a>\n        .\n      </p>\n      <Typography align=\"center\">\n        <Button\n          className={classes.showTutorial}\n          onClick={() => setTutorial(true)}\n          variant=\"contained\"\n          disableElevation\n        >\n          Show Tutorial\n        </Button>\n        <Button\n          className={classes.startExploring}\n          onClick={closeHandler}\n          variant=\"contained\"\n          disableElevation\n        >\n          Start Exploring!\n        </Button>\n      </Typography>\n    </div>\n  );\n});\n\nexport default Welcome;\n","import React, { createContext, useCallback, useState } from 'react';\nimport Backdrop from '@material-ui/core/Backdrop';\nimport Fade from '@material-ui/core/Fade';\nimport Modal from '@material-ui/core/Modal';\nimport { makeStyles } from '@material-ui/core/styles';\n\nconst ModalContext = createContext();\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    padding: '4rem',\n  },\n  paper: {\n    backgroundColor: theme.palette.background.paper,\n    borderRadius: '0.25rem',\n    boxShadow: theme.shadows[4],\n    maxWidth: '60rem',\n    maxHeight: 'calc(100vh - 8rem)',\n    overflow: 'auto',\n    padding: theme.spacing(2, 4),\n    outline: 0,\n  },\n}));\n\nexport default function ModalProvider({ children }) {\n  const [Component, setComponent] = useState(null);\n  const [customCloseHandler, setCustomCloseHandler] = useState(null);\n\n  const showModal = useCallback(\n    (newComponent = null, newCustomCloseHandler = null) => {\n      setComponent(newComponent);\n      setCustomCloseHandler(() => newCustomCloseHandler);\n    },\n    []\n  );\n\n  const closeHandler = useCallback(() => {\n    setComponent(null);\n    setCustomCloseHandler(null);\n  }, []);\n\n  const classes = useStyles();\n\n  const open = Boolean(Component);\n\n  return (\n    <ModalContext.Provider value={showModal}>\n      {children}\n      <Modal\n        aria-labelledby=\"modal-title\"\n        aria-describedby=\"modal-description\"\n        className={classes.root}\n        open={open}\n        onClose={customCloseHandler || closeHandler}\n        closeAfterTransition\n        BackdropComponent={Backdrop}\n        BackdropProps={{\n          timeout: 250,\n        }}\n      >\n        <Fade in={open}>\n          <div className={classes.paper}>\n            {open && (\n              <Component closeHandler={customCloseHandler || closeHandler} />\n            )}\n          </div>\n        </Fade>\n      </Modal>\n    </ModalContext.Provider>\n  );\n}\n\nfunction useShowModal() {\n  const context = React.useContext(ModalContext);\n  if (context === undefined) {\n    throw new Error('useShowModal must be used within a ModalContext');\n  }\n  return context;\n}\n\nexport { useShowModal };\n","import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useRecoilState, useRecoilValue } from 'recoil';\nimport { isString, nthIndexOf } from '@flekschas/utils';\n\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport Divider from '@material-ui/core/Divider';\nimport Drawer from '@material-ui/core/Drawer';\nimport FormControl from '@material-ui/core/FormControl';\nimport Grid from '@material-ui/core/Grid';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport OutlinedInput from '@material-ui/core/OutlinedInput';\nimport ButtonBase from '@material-ui/core/ButtonBase';\nimport { makeStyles } from '@material-ui/core/styles';\nimport SettingsIcon from '@material-ui/icons/Settings';\n\nimport CheckboxList from './CheckboxList';\nimport Logo from './Logo';\nimport VariantsSettings from './VariantsSettings';\nimport Welcome from './Welcome';\nimport { useChromInfo } from './ChromInfoProvider';\nimport { useShowModal } from './ModalProvider';\n\nimport {\n  enhancerGenesSvgState,\n  higlassEnhancerRegionsState,\n  higlassDnaAccessState,\n  sampleFilterState,\n  sampleWithName,\n  sampleGroupWithGroup,\n  showVariantsSettingsState,\n  useXDomainStartWithAssembly,\n  useXDomainEndWithAssembly,\n  useShowWelcome,\n} from './state';\n\nimport { download, stringifySvg } from './utils';\n\nimport {\n  DEFAULT_COLOR_MAP_DARK,\n  DEFAULT_COLOR_MAP,\n  DEFAULT_VIEW_CONFIG_ENHANCER,\n  DEFAULT_VIEW_CONFIG_DNA_ACCESSIBILITY,\n  SVG_SKELETON,\n  DRAWER_WIDTH,\n  GROUPED_SAMPLE_OPTIONS,\n  SAMPLE_TO_GROUP,\n} from './constants';\n\nconst useStyles = makeStyles((theme) => ({\n  h1: {\n    height: '100%',\n    margin: '0',\n    padding: '0',\n    fontSize: '1rem',\n    lineHeight: '1rem',\n    fontWeight: 'bold',\n  },\n  drawer: {\n    width: DRAWER_WIDTH,\n    flexShrink: 0,\n  },\n  drawerGrid: {\n    height: '100%',\n  },\n  drawerPaper: {\n    width: DRAWER_WIDTH,\n  },\n  settings: {\n    position: 'relative',\n    flexGrow: 1,\n  },\n  globalSettingsTitle: {\n    padding: '3px 8px 4px 8px',\n    margin: 0,\n    '& h6': {\n      fontSize: '0.8rem',\n      fontWeight: 'bold',\n    },\n  },\n  settingsContent: {\n    position: 'absolute',\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0,\n    overflow: 'hidden auto',\n  },\n  toolbar: theme.mixins.toolbar,\n  grow: {\n    flexGrow: 1,\n  },\n  titleBar: {\n    position: 'relative',\n    padding: '2px',\n    fontSize: '0.8rem',\n    background: theme.palette.grey['100'],\n  },\n  titleBarText: {\n    fontSize: '0.8rem',\n  },\n  titleBarContainer: {\n    width: 'auto',\n  },\n  titleBarTitle: {\n    padding: '0 2px',\n    fontWeight: 900,\n  },\n  titleBarIcon: {\n    color: theme.palette.grey['400'],\n    '&:hover': {\n      color: 'black',\n    },\n  },\n  titleBarIconActive: {\n    color: 'black',\n    '&:hover': {\n      color: 'black',\n    },\n  },\n  globalSettingsFirstBox: {\n    margin: theme.spacing(0, 1, 1, 1),\n  },\n}));\n\nconst extractCoreFromHiGlassSvg = (svg) => {\n  const fifthLn = nthIndexOf(svg, '\\n', 4);\n  const lastLn = svg.lastIndexOf('\\n');\n  const width = +svg.substring(\n    svg.indexOf('width=\"') + 7,\n    svg.indexOf('px', svg.indexOf('width=\"') + 7)\n  );\n  const height = +svg.substring(\n    svg.indexOf('height=\"') + 8,\n    svg.indexOf('px', svg.indexOf('height=\"') + 8)\n  );\n  return {\n    core: svg.substring(fifthLn + 1, lastLn),\n    width,\n    height,\n  };\n};\n\nconst extractCoreFromStringifiedSvg = (svg) => {\n  const firstSvgClosingBracket = svg.indexOf('>');\n  const lastSvgOpeningBracket = svg.lastIndexOf('</svg>');\n  const [width, height] = svg\n    .substring(\n      svg.indexOf('viewbox=\"') + 9,\n      svg.indexOf('\"', svg.indexOf('viewbox=\"') + 9)\n    )\n    .split(' ')\n    .slice(2);\n  return {\n    core: svg.substring(firstSvgClosingBracket + 1, lastSvgOpeningBracket),\n    width: +width,\n    height: +height,\n  };\n};\n\nconst AppSidebar = React.memo(function AppSidebar() {\n  const chromInfo = useChromInfo();\n  const showModal = useShowModal();\n\n  const [xDomainStart, setXDomainStart] = useXDomainStartWithAssembly(\n    chromInfo\n  );\n  const [xDomainEnd, setXDomainEnd] = useXDomainEndWithAssembly(chromInfo);\n  const [showWelcome, setShowWelcome] = useShowWelcome();\n  const [showVariantsSettings, setShowVariantsSettings] = useRecoilState(\n    showVariantsSettingsState\n  );\n\n  const higlassEnhancerRegions = useRecoilValue(higlassEnhancerRegionsState);\n  const higlassDnaAccess = useRecoilValue(higlassDnaAccessState);\n  const enhancerGenesSvg = useRecoilValue(enhancerGenesSvgState);\n\n  const [userChangedDomain, setUserChangedDomain] = useState(0);\n\n  const numericalXDomainStart = useMemo(\n    () =>\n      isString(xDomainStart) && xDomainStart.indexOf(':') >= 0\n        ? chromInfo.chrToAbs([\n            xDomainStart.split(':')[0],\n            +xDomainStart.split(':')[1],\n          ])\n        : +xDomainStart,\n    [xDomainStart, chromInfo]\n  );\n\n  const numericalXDomainEnd = useMemo(\n    () =>\n      isString(xDomainEnd) && xDomainEnd.indexOf(':') >= 0\n        ? chromInfo.chrToAbs([\n            xDomainEnd.split(':')[0],\n            +xDomainEnd.split(':')[1],\n          ])\n        : +xDomainEnd,\n    [xDomainEnd, chromInfo]\n  );\n\n  const xDomainStartChangeHandler = useCallback(\n    (event) => {\n      setXDomainStart(event.target.value);\n      setUserChangedDomain(2);\n    },\n    [setXDomainStart]\n  );\n\n  const xDomainEndChangeHandler = useCallback(\n    (event) => {\n      setXDomainEnd(event.target.value);\n      setUserChangedDomain(2);\n    },\n    [setXDomainEnd]\n  );\n\n  useEffect(() => {\n    setUserChangedDomain((curr) => Math.max(0, curr - 1));\n  }, [xDomainStart, xDomainEnd]);\n\n  const higlassEnhancerZoomToXDomain = (event) => {\n    if (!higlassEnhancerRegions) return;\n\n    const xDomain = [\n      ...higlassEnhancerRegions.getViewConfig().views[0].initialXDomain,\n    ];\n\n    if (!Number.isNaN(+numericalXDomainStart)) {\n      xDomain[0] = numericalXDomainStart;\n    }\n    if (!Number.isNaN(+numericalXDomainEnd)) {\n      xDomain[1] = numericalXDomainEnd;\n    }\n\n    higlassEnhancerRegions.zoomTo(\n      'context',\n      xDomain[0],\n      xDomain[1],\n      xDomain[0],\n      xDomain[1],\n      2000\n    );\n  };\n\n  const closeWelcome = useCallback(() => {\n    setShowWelcome(false);\n  }, [setShowWelcome]);\n\n  const openWelcome = useCallback(() => {\n    setShowWelcome(true);\n  }, [setShowWelcome]);\n\n  useEffect(() => {\n    if (showWelcome) showModal(Welcome, closeWelcome);\n    else showModal();\n  }, [showWelcome, showModal, closeWelcome]);\n\n  const closeVariantsSettings = useCallback(() => {\n    setShowVariantsSettings(false);\n  }, [setShowVariantsSettings]);\n\n  const openVariantsSettings = useCallback(() => {\n    setShowVariantsSettings(true);\n  }, [setShowVariantsSettings]);\n\n  useEffect(() => {\n    if (showVariantsSettings) {\n      showModal(VariantsSettings, closeVariantsSettings);\n    } else if (!showWelcome) {\n      showModal();\n    }\n  }, [showWelcome, showVariantsSettings, showModal, closeVariantsSettings]);\n\n  const mergeSvgs = (enhancerSvg, dnaAccessSvg, enhancerGeneSvg) => {\n    const {\n      core: enhancerSvgCore,\n      width: enhancerWidth,\n      height: enhancerHeight,\n    } = extractCoreFromHiGlassSvg(enhancerSvg);\n    const {\n      core: dnaAccessSvgCore,\n      width: dnaAccessWidth,\n      height: dnaAccessHeight,\n    } = extractCoreFromHiGlassSvg(dnaAccessSvg);\n    const {\n      core: enhancerGeneSvgCore = null,\n      height: enhancerGeneHeight = 0,\n    } = enhancerGeneSvg ? extractCoreFromStringifiedSvg(enhancerGeneSvg) : {};\n\n    const actualEnhancerHeight = DEFAULT_VIEW_CONFIG_ENHANCER.views[0].tracks.top.reduce(\n      (height, track) => height + track.height,\n      0\n    );\n    const actualDnaAccessHeight = DEFAULT_VIEW_CONFIG_DNA_ACCESSIBILITY.views[0].tracks.top.reduce(\n      (height, track) => height + track.height,\n      0\n    );\n    const padding = 24;\n\n    let mergedSvg = SVG_SKELETON;\n    mergedSvg = mergedSvg.replace(\n      '_WIDTH_',\n      enhancerWidth + dnaAccessWidth + padding\n    );\n    mergedSvg = mergedSvg.replace(\n      '_HEIGHT_',\n      Math.max(\n        enhancerHeight + enhancerGeneHeight + padding,\n        dnaAccessHeight,\n        actualEnhancerHeight + enhancerGeneHeight + padding,\n        actualDnaAccessHeight\n      )\n    );\n    mergedSvg = mergedSvg.replace('_ENHANCER_', enhancerSvgCore);\n    mergedSvg = mergedSvg.replace(\n      '_ENHANCER_GENE_Y_',\n      enhancerHeight + padding\n    );\n    mergedSvg = mergedSvg.replace('_ENHANCER_GENE_', enhancerGeneSvgCore);\n    mergedSvg = mergedSvg.replace('_DNA_ACCESS_X_', enhancerWidth + padding);\n    mergedSvg = mergedSvg.replace('_DNA_ACCESS_', dnaAccessSvgCore);\n\n    if (enhancerGeneSvgCore === null) {\n      mergedSvg = mergedSvg.replace('_ENHANCER_GENE_', '');\n    } else {\n      mergedSvg = mergedSvg.replace('_ENHANCER_GENE_', enhancerGeneSvgCore);\n    }\n\n    return mergedSvg;\n  };\n\n  const higlassExportAsSvg = () => {\n    if (!higlassEnhancerRegions || !higlassDnaAccess) {\n      console.warn('One of the HiGlass instances is not available');\n      return;\n    }\n\n    const mergedSvg = mergeSvgs(\n      higlassEnhancerRegions.exportAsSvg(),\n      higlassDnaAccess.exportAsSvg(),\n      enhancerGenesSvg ? stringifySvg(enhancerGenesSvg) : null\n    );\n\n    download(\n      'abc-enhancers.svg',\n      new Blob([mergedSvg], { type: 'image/svg+xml' })\n    );\n  };\n\n  // Run on every render\n  const classes = useStyles();\n\n  return (\n    <Drawer\n      className={classes.drawer}\n      variant=\"permanent\"\n      classes={{\n        paper: classes.drawerPaper,\n      }}\n      anchor=\"left\"\n    >\n      <Grid container direction=\"column\" className={classes.drawerGrid}>\n        <Grid item>\n          <ButtonBase\n            className={classes.toolbar}\n            style={{ width: '100%' }}\n            onClick={openWelcome}\n          >\n            <h1 className={classes.h1}>\n              <Logo />\n            </h1>\n          </ButtonBase>\n          <Divider />\n        </Grid>\n        <Grid container item className={classes.grow} direction=\"column\">\n          <Grid item>\n            <Box m={1}>\n              <Box m={0}>\n                <FormControl variant=\"outlined\" margin=\"dense\" fullWidth>\n                  <InputLabel htmlFor=\"x-domain-start\">Region Start</InputLabel>\n                  <OutlinedInput\n                    id=\"x-domain-start\"\n                    label=\"Region Start\"\n                    onChange={xDomainStartChangeHandler}\n                    value={xDomainStart}\n                  />\n                </FormControl>\n              </Box>\n              <Box m={0}>\n                <FormControl variant=\"outlined\" margin=\"dense\" fullWidth>\n                  <InputLabel htmlFor=\"x-domain-end\">Region End</InputLabel>\n                  <OutlinedInput\n                    id=\"x-domain-end\"\n                    label=\"Region End\"\n                    onChange={xDomainEndChangeHandler}\n                    value={xDomainEnd}\n                  />\n                </FormControl>\n              </Box>\n              {userChangedDomain > 0 && (\n                <Box m={0}>\n                  <Button\n                    variant=\"contained\"\n                    margin=\"dense\"\n                    onClick={higlassEnhancerZoomToXDomain}\n                    fullWidth\n                    disableElevation\n                    size=\"small\"\n                  >\n                    Go\n                  </Button>\n                </Box>\n              )}\n            </Box>\n            <Divider />\n            <Box m={1}>\n              <Button\n                variant=\"contained\"\n                margin=\"dense\"\n                fullWidth\n                disableElevation\n                size=\"small\"\n                startIcon={<SettingsIcon />}\n                onClick={openVariantsSettings}\n              >\n                Edit Variants\n              </Button>\n            </Box>\n            <Divider />\n          </Grid>\n          <Grid item className={classes.settings}>\n            <Box m={0} className={classes.settingsContent}>\n              <Box className={classes.globalSettingsFirstBox}>\n                <CheckboxList\n                  filterState={sampleFilterState}\n                  filterLabel=\"Filter Samples\"\n                  optionWithName={sampleWithName}\n                  optionGroupWithGroup={sampleGroupWithGroup}\n                  groupedOptions={GROUPED_SAMPLE_OPTIONS}\n                  optionToGroup={SAMPLE_TO_GROUP}\n                  groupColors={DEFAULT_COLOR_MAP}\n                  groupColorsDark={DEFAULT_COLOR_MAP_DARK}\n                />\n              </Box>\n            </Box>\n          </Grid>\n          <Grid item>\n            <Divider />\n            <Box m={1}>\n              <Button\n                variant=\"contained\"\n                margin=\"dense\"\n                onClick={higlassExportAsSvg}\n                fullWidth\n                disableElevation\n                size=\"small\"\n              >\n                Export as SVG\n              </Button>\n            </Box>\n          </Grid>\n        </Grid>\n      </Grid>\n    </Drawer>\n  );\n});\n\nexport default AppSidebar;\n","import PropTypes from 'prop-types';\nimport React, { useEffect, useState } from 'react';\nimport TextField from '@material-ui/core/TextField';\nimport Autocomplete from '@material-ui/lab/Autocomplete';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Grid from '@material-ui/core/Grid';\nimport Chip from '@material-ui/core/Chip';\nimport SvgIcon from '@material-ui/core/SvgIcon';\nimport FlashOnIcon from '@material-ui/icons/FlashOn';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { identity } from '@flekschas/utils';\n\nimport useDebounce from './use-debounce';\n\nconst useStyles = makeStyles((theme) => ({\n  inputRoot: {\n    background: 'white !important',\n    borderTopLeftRadius: 0,\n    borderTopRightRadius: 0,\n    '&::before': {\n      borderBottomWidth: 0,\n      boxShadow: '0 1px 0 0 rgba(0, 0, 0, 0)',\n      transition: 'boxShadow 0.2s ease',\n    },\n    '&:hover::before': {\n      borderBottomWidth: 0,\n      boxShadow: '0 1px 0 0 rgba(0, 0, 0, 1)',\n    },\n  },\n  focused: {\n    boxShadow: '0 1px 0 0 rgba(0, 0, 0, 1)',\n  },\n  input: {\n    height: 35,\n    padding: '6px 0 6px',\n  },\n  textFieldRoot: {\n    '& .MuiFormLabel-root': {\n      color: 'black',\n      fontWeight: 'bold',\n      transform: 'translate(12px, 21px) scale(1.25)',\n    },\n    '& .MuiInputLabel-shrink': {\n      fontWeight: 'normal',\n    },\n  },\n}));\n\nconst fetchJsonFromUrl = async (url, query) => {\n  if (typeof url === 'string') {\n    const response = await fetch(`${url}&ac=${query || ''}`);\n    return response.json();\n  }\n  const response = await fetch(`${url.url}&ac=${query || ''}`);\n  const results = await response.json();\n  return results.map((result) => {\n    result.type = url.type;\n    return result;\n  });\n};\n\nfunction GeneIcon(props) {\n  return (\n    <SvgIcon viewBox=\"0 0 16 16\" {...props}>\n      <path d=\"M5.03 14.378A7.33 7.33 0 003.423 16h2.42a7.762 7.762 0 011.281-.774 13.241 13.241 0 01-1.863-1.016c-.078.054-.156.11-.233.168zM5.766 0l.219.174a8.754 8.754 0 001.636.92l.024.008c.797.24 1.507.627 2.023.933.325.18.674.4 1.024.66 1.825 1.363 2.79 3.22 2.79 5.367 0 2.062-.962 3.89-2.782 5.286-.061.048-.125.094-.186.139a10.45 10.45 0 00-1.895-.955 8.17 8.17 0 001.69-1.162h-3.92a6.191 6.191 0 01-1.199-1.15h6.093a4.054 4.054 0 00.603-1.747H3.839c.072.656.307 1.239.636 1.747h.011c.282.438.628.822.991 1.15H5.47l.74.584c.831.588 1.573.893 1.636.92a9.358 9.358 0 012.847 1.504A7.38 7.38 0 0112.3 16H9.879l-.759-.5a7.876 7.876 0 00-1.256-.594 11.833 11.833 0 01-2.07-1.04l.017-.009c-1.567-.999-3.571-2.851-3.571-5.794 0-2.149.964-4.005 2.79-5.367.076-.058.154-.113.231-.167.495.32 1.143.698 1.863 1.015a7.677 7.677 0 00-1.296.786c-.043.032-.083.066-.125.098h3.318c.535.336.999.727 1.364 1.149H4.598a4.215 4.215 0 00-.721 1.748h7.97l-.038-.195a3.527 3.527 0 00-.306-.904 4.417 4.417 0 00-.378-.65l-.01-.007a5.793 5.793 0 00-1.081-1.13l-.14-.109a7.236 7.236 0 00-.722-.48l-.031-.02a7.942 7.942 0 00-1.276-.607 10.278 10.278 0 01-1.257-.57C5.728 2.218 4.31 1.364 3.281 0h2.486zm6.267 0a7.808 7.808 0 01-1.743 1.707A10.443 10.443 0 008.396.752 8.592 8.592 0 009.592 0h2.442z\" />\n    </SvgIcon>\n  );\n}\n\nfunction GeneOption(props) {\n  return (\n    <Grid\n      key={props.option.geneName}\n      container\n      direction=\"row\"\n      alignItems=\"center\"\n    >\n      <GeneIcon fontSize=\"small\" />\n      <span>{props.option.geneName}</span>\n    </Grid>\n  );\n}\n\nfunction VariantOption(props) {\n  return (\n    <Grid\n      key={props.option.geneName}\n      container\n      direction=\"row\"\n      alignItems=\"center\"\n    >\n      <FlashOnIcon fontSize=\"small\" />\n      <span>{props.option.geneName}</span>\n    </Grid>\n  );\n}\n\nfunction Option(props) {\n  if (props.option.type === 'gene') return <GeneOption option={props.option} />;\n  if (props.option.type === 'variant')\n    return <VariantOption option={props.option} />;\n  return <div>{props.option.geneName}</div>;\n}\n\nexport default function SearchField(props) {\n  const [open, setOpen] = useState(false);\n  const [options, setOptions] = useState([]);\n  const [searchQuery, setSearchQuery] = useState(props.inputValue);\n  const debouncedSearchQuery = useDebounce(searchQuery, 250);\n  const loading = open && options.length === 0;\n  const classes = useStyles();\n  const autocompleteClasses = { ...classes };\n  delete autocompleteClasses.textFieldRoot;\n\n  const { customSearch, searchUrl } = props;\n\n  useEffect(() => {\n    let active = true;\n\n    if (!open) return undefined;\n\n    setOptions([]);\n\n    const whenResults = Array.isArray(searchUrl)\n      ? searchUrl.map((url) => fetchJsonFromUrl(url, debouncedSearchQuery))\n      : [fetchJsonFromUrl(searchUrl, debouncedSearchQuery)];\n\n    if (customSearch) whenResults.push(customSearch(debouncedSearchQuery));\n\n    Promise.all(whenResults).then((results) => {\n      if (active) setOptions(results.flat().filter(identity));\n    });\n\n    return () => {\n      active = false;\n    };\n  }, [searchUrl, customSearch, open, debouncedSearchQuery]);\n\n  useEffect(() => {\n    if (!open) {\n      setOptions([]);\n    }\n  }, [open]);\n\n  const value =\n    props.multiple && !Array.isArray(props.value) ? [props.value] : props.value;\n\n  let autocompleteOptions = value && options.length === 0 ? value : options;\n  autocompleteOptions = Array.isArray(autocompleteOptions)\n    ? autocompleteOptions\n    : [autocompleteOptions];\n\n  return (\n    <Autocomplete\n      classes={props.larger ? autocompleteClasses : {}}\n      multiple={props.multiple}\n      onChange={(event, newValue) => {\n        props.onChange(newValue);\n      }}\n      value={value}\n      onInputChange={(event, newInputValue) => {\n        if (event) setSearchQuery(newInputValue);\n      }}\n      fullWidth={props.fullWidth}\n      style={{ width: props.fullWidth ? 'auto' : props.width }}\n      open={open}\n      onOpen={() => {\n        setOpen(true);\n      }}\n      onClose={() => {\n        setOpen(false);\n      }}\n      getOptionSelected={(option, _value) =>\n        option.geneName === _value.geneName\n      }\n      getOptionLabel={(option) => (option ? option.geneName : '')}\n      options={autocompleteOptions}\n      loading={loading}\n      renderInput={(params) => (\n        <TextField\n          {...params}\n          className={props.larger ? classes.textFieldRoot : ''}\n          id={props.id}\n          label={props.label}\n          variant={props.variant}\n          size={props.size}\n          InputProps={{\n            ...params.InputProps,\n            endAdornment: (\n              <React.Fragment>\n                {loading ? (\n                  <CircularProgress color=\"inherit\" size={20} />\n                ) : null}\n                {params.InputProps.endAdornment}\n              </React.Fragment>\n            ),\n          }}\n        />\n      )}\n      renderOption={(option) => <Option option={option} />}\n      renderTags={(v, getTagProps) =>\n        v.map((option, index) => (\n          <Chip\n            icon={option.type === 'gene' ? <GeneIcon /> : <FlashOnIcon />}\n            key={option.geneName}\n            label={option.geneName}\n            {...getTagProps({ index })}\n          />\n        ))\n      }\n    />\n  );\n}\n\nSearchField.defaultProps = {\n  fullWidth: true,\n  id: '',\n  label: '',\n  multiple: false,\n  onChange: identity,\n  size: 'small',\n  value: null,\n  variant: 'outlined',\n  width: '10rem',\n};\n\nSearchField.propTypes = {\n  customSearch: PropTypes.func,\n  fullWidth: PropTypes.bool,\n  id: PropTypes.string,\n  label: PropTypes.oneOfType([PropTypes.string, PropTypes.node]),\n  multiple: PropTypes.bool,\n  onChange: PropTypes.func,\n  searchUrl: PropTypes.oneOfType([\n    PropTypes.arrayOf(\n      PropTypes.oneOfType([\n        PropTypes.shape({\n          url: PropTypes.string,\n          type: PropTypes.string,\n        }),\n        PropTypes.string,\n      ])\n    ),\n    PropTypes.string,\n  ]).isRequired,\n  size: PropTypes.string,\n  value: PropTypes.oneOfType([PropTypes.array, PropTypes.object]),\n  variant: PropTypes.string,\n  width: PropTypes.string,\n};\n","import { useRef, useEffect } from 'react';\n\nexport default function usePrevious(value) {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current;\n}\n","import React, { useMemo } from 'react';\nimport { useRecoilState } from 'recoil';\n\nimport AppBar from '@material-ui/core/AppBar';\nimport FormControl from '@material-ui/core/FormControl';\nimport Grid from '@material-ui/core/Grid';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport { makeStyles } from '@material-ui/core/styles';\nimport SearchIcon from '@material-ui/icons/Search';\n\nimport SearchField from './SearchField';\n\nimport usePrevious from './use-previous';\n\nimport {\n  focusGeneOptionState,\n  focusVariantOptionState,\n  useFocusGene,\n  useFocusVariant,\n} from './state';\n\nimport { DRAWER_WIDTH, GENE_SEARCH_URL, VARIANT_SEARCH_URL } from './constants';\n\nconst useStyles = makeStyles((theme) => ({\n  appBar: {\n    width: `calc(100% - ${DRAWER_WIDTH}px)`,\n    marginLeft: DRAWER_WIDTH,\n    color: theme.palette.common.black,\n    backgroundColor: theme.palette.common.white,\n    boxShadow: `0 1px 0 0 ${theme.palette.grey['300']}`,\n  },\n  toolbarExtra: {\n    paddingLeft: 0,\n    paddingRight: 0,\n    alignItems: 'flex-end',\n  },\n}));\n\nconst locationSearch = async (query) => {\n  if (!query) return undefined;\n\n  const match = query.match(/^chr(\\d+):(\\d)+$/);\n  if (\n    match &&\n    ((+match[1] > 0 && +match[1] < 23) ||\n      +match[1].toLowerCase() === 'x' ||\n      +match[1].toLowerCase() === 'y')\n  ) {\n    return [\n      {\n        chr: `chr${match[1]}`,\n        txStart: +match[2],\n        txEnd: +match[2] + 1,\n        score: 0,\n        geneName: query,\n        type: 'nucleotide',\n      },\n    ];\n  }\n\n  return undefined;\n};\n\nconst AppTopbar = React.memo(function AppTopbar() {\n  const [focusGene, setFocusGene] = useFocusGene();\n  const [focusVariant, setFocusVariant] = useFocusVariant();\n  const [focusGeneOption, setFocusGeneOption] = useRecoilState(\n    focusGeneOptionState\n  );\n  const [focusVariantOption, setFocusVariantOption] = useRecoilState(\n    focusVariantOptionState\n  );\n\n  const prevFocusGeneOption = usePrevious(focusGeneOption);\n  const prevFocusVariantOption = usePrevious(focusVariantOption);\n\n  // Derived State\n  const focusGeneVariantOptions = useMemo(\n    () => {\n      const _focusGeneVariant = [];\n      // Add the focus element that has not changed first!\n      if (focusGeneOption && focusGeneOption === prevFocusGeneOption)\n        _focusGeneVariant.push(focusGeneOption);\n      if (focusVariantOption && focusVariantOption === prevFocusVariantOption)\n        _focusGeneVariant.push(focusVariantOption);\n      // Now add the focused element that has changed!\n      if (focusGeneOption && focusGeneOption !== prevFocusGeneOption)\n        _focusGeneVariant.push(focusGeneOption);\n      if (focusVariantOption && focusVariantOption !== prevFocusVariantOption)\n        _focusGeneVariant.push(focusVariantOption);\n      return _focusGeneVariant;\n    },\n    // `prevFocusGeneOption` and `prevFocusVariantOption` are ommitted\n    // on purpose to avoid circular updates.\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [focusGeneOption, focusVariantOption]\n  );\n\n  const clearFocusGene = () => {\n    setFocusGene('');\n    setFocusGeneOption(null);\n  };\n\n  const clearFocusVariant = () => {\n    setFocusVariant('');\n    setFocusVariantOption(null);\n  };\n\n  const focusGeneVariantChangeHandler = (newValues) => {\n    if (newValues.length) {\n      const newFocusElements = {};\n      // We only allow exactly two selections\n      newValues.slice(newValues.length - 2).forEach((newValue) => {\n        switch (newValue.type) {\n          case 'gene':\n            newFocusElements.gene = newValue;\n            if (focusGene !== newValue.geneName) {\n              setFocusGene(newValue.geneName);\n              setFocusGeneOption(newValue);\n            }\n            break;\n\n          case 'variant':\n            newFocusElements.variant = newValue;\n            if (focusVariant !== newValue.geneName) {\n              setFocusVariant(newValue.geneName);\n              setFocusVariantOption(newValue);\n            }\n            break;\n\n          default:\n            // eslint-disable-next-line no-console\n            console.warn('Unknown focus element', newValue);\n            break;\n        }\n      });\n      // Unset focus elements\n      if (focusGene && !newFocusElements.gene) clearFocusGene();\n      if (focusVariant && !newFocusElements.variant) clearFocusVariant();\n    } else {\n      clearFocusGene();\n      clearFocusVariant();\n    }\n  };\n\n  const classes = useStyles();\n\n  return (\n    <AppBar position=\"fixed\" className={classes.appBar}>\n      <Toolbar\n        classes={{\n          root: classes.toolbarExtra,\n        }}\n      >\n        <FormControl fullWidth>\n          <SearchField\n            label={\n              <Grid container direction=\"row\" alignItems=\"center\">\n                <SearchIcon fontSize=\"small\" />\n                <span style={{ marginLeft: 3 }}>Gene or Variant</span>\n              </Grid>\n            }\n            customSearch={locationSearch}\n            searchUrl={[\n              { url: GENE_SEARCH_URL, type: 'gene' },\n              { url: VARIANT_SEARCH_URL, type: 'variant' },\n            ]}\n            onChange={focusGeneVariantChangeHandler}\n            value={focusGeneVariantOptions}\n            variant=\"filled\"\n            larger\n            fullWidth\n            multiple\n          />\n        </FormControl>\n      </Toolbar>\n    </AppBar>\n  );\n});\n\nexport default AppTopbar;\n","import React from 'react';\nimport { useRecoilValue } from 'recoil';\nimport Typography from '@material-ui/core/Typography';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport {\n  enhancerRegionsShowInfoState,\n  focusVariantState,\n  focusGeneState,\n} from './state';\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    display: 'flex',\n    justifyContent: 'space-between',\n  },\n  text: {\n    fontSize: '0.8rem',\n  },\n  black: {\n    color: 'black',\n  },\n  gray: {\n    color: theme.palette.grey['400'],\n  },\n  pink: {\n    color: '#cc0078',\n  },\n}));\n\nconst EnhancerRegionsInfo = React.memo(function EnhancerRegionsInfo() {\n  const showInfo = useRecoilValue(enhancerRegionsShowInfoState);\n  const focusGene = useRecoilValue(focusGeneState);\n  const focusVariant = useRecoilValue(focusVariantState);\n\n  const classes = useStyles();\n\n  if (!showInfo) return '';\n\n  return (\n    <React.Fragment>\n      {focusGene && focusVariant && (\n        <Typography className={classes.text} noWrap>\n          <span className={classes.pink}></span> Enhancers containing{' '}\n          <em>{focusVariant}</em> and predicted to regulate <em>{focusGene}</em>\n        </Typography>\n      )}\n      {focusGene && !focusVariant && (\n        <Typography className={classes.text} noWrap>\n          <span className={classes.pink}></span> Enhancers predicted to\n          regulate <em>{focusGene}</em>\n        </Typography>\n      )}\n      {!focusGene && focusVariant && (\n        <Typography className={classes.text} noWrap>\n          <span className={classes.pink}></span> Enhancers containing{' '}\n          <em>{focusVariant}</em>\n        </Typography>\n      )}\n      {focusGene || focusVariant ? (\n        <Typography className={classes.text} noWrap>\n          <span className={classes.gray}></span> All other predicted enhancers\n        </Typography>\n      ) : (\n        <Typography className={classes.text} noWrap>\n          <span className={classes.black}></span> All predicted enhancers\n        </Typography>\n      )}\n    </React.Fragment>\n  );\n});\n\nexport default EnhancerRegionsInfo;\n","import React from 'react';\nimport Typography from '@material-ui/core/Typography';\n\nconst EnhancerRegionsInfo = React.memo(function EnhancerRegionsInfo() {\n  return (\n    <React.Fragment>\n      <Typography>\n        This panel visualizes the predicted enhancers by sample type as a\n        matrix-like track. Each rectangle representes an enhancer. Promoter\n        regions are indicated by translucent light gray overlays.\n      </Typography>\n      <Typography>\n        {' '}\n        You can filter enhancers via their target gene or by variant (the dot\n        plot below the gene annotations). Click on a variant or gene to select\n        it. Selections are shown in pink/red.\n      </Typography>\n    </React.Fragment>\n  );\n});\n\nexport default EnhancerRegionsInfo;\n","import React, { useCallback } from 'react';\nimport Box from '@material-ui/core/Box';\nimport IconButton from '@material-ui/core/IconButton';\nimport RadioButtonCheckedIcon from '@material-ui/icons/RadioButtonChecked';\nimport RadioButtonUncheckedIcon from '@material-ui/icons/RadioButtonUnchecked';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport FormLabel from '@material-ui/core/FormLabel';\nimport RadioGroup from '@material-ui/core/RadioGroup';\nimport Switch from '@material-ui/core/Switch';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport {\n  useEnhancerRegionsHideUnfocused,\n  useEnhancerRegionsColorEncoding,\n  useVariantYScale,\n} from './state';\n\nconst useStyles = makeStyles((theme) => ({\n  iconRadioLegend: {\n    margin: theme.spacing(2, 0, 0.25, 0),\n  },\n}));\n\nconst EnhancerRegionsInfo = React.memo(function EnhancerRegionsInfo() {\n  const [variantYScale, setVariantYScale] = useVariantYScale();\n  const [hideUnfocused, setHideUnfocused] = useEnhancerRegionsHideUnfocused();\n  const [colorEncoding, setColorEncoding] = useEnhancerRegionsColorEncoding();\n\n  const hideUnfocusedChangeHandler = useCallback(\n    (event) => {\n      setHideUnfocused(event.target.checked);\n    },\n    [setHideUnfocused]\n  );\n\n  const changeVariantYScale = useCallback(\n    (value) => () => {\n      setVariantYScale(value);\n    },\n    [setVariantYScale]\n  );\n\n  const changeColorEncoding = useCallback(\n    (value) => () => {\n      setColorEncoding(value);\n    },\n    [setColorEncoding]\n  );\n\n  const classes = useStyles();\n\n  return (\n    <React.Fragment>\n      <Box m={1}>\n        <FormControlLabel\n          control={\n            <Switch\n              checked={hideUnfocused}\n              onChange={hideUnfocusedChangeHandler}\n              name=\"hideUnfocused\"\n            />\n          }\n          label=\"Hide unfocused enhancer regions\"\n        />\n      </Box>\n      <Box m={1}>\n        <FormControl component=\"fieldset\">\n          <FormLabel component=\"legend\" className={classes.iconRadioLegend}>\n            Variant y-scale\n          </FormLabel>\n          <RadioGroup\n            aria-label=\"variantYScale\"\n            name=\"variantYScale\"\n            value={variantYScale}\n          >\n            <FormControlLabel\n              label=\"p-value\"\n              value=\"pValue\"\n              className={classes.iconRadio}\n              control={\n                <IconButton\n                  size=\"small\"\n                  onClick={changeVariantYScale('pValue')}\n                >\n                  {variantYScale === 'pValue' ? (\n                    <RadioButtonCheckedIcon\n                      className={classes.iconRadioActive}\n                      fontSize=\"inherit\"\n                    />\n                  ) : (\n                    <RadioButtonUncheckedIcon fontSize=\"inherit\" />\n                  )}\n                </IconButton>\n              }\n            />\n            <FormControlLabel\n              label=\"Posterior probability\"\n              value=\"posteriorProbability\"\n              className={classes.iconRadio}\n              control={\n                <IconButton\n                  size=\"small\"\n                  onClick={changeVariantYScale('posteriorProbability')}\n                >\n                  {variantYScale === 'posteriorProbability' ? (\n                    <RadioButtonCheckedIcon\n                      className={classes.iconRadioActive}\n                      fontSize=\"inherit\"\n                    />\n                  ) : (\n                    <RadioButtonUncheckedIcon fontSize=\"inherit\" />\n                  )}\n                </IconButton>\n              }\n            />\n          </RadioGroup>\n        </FormControl>\n      </Box>\n      <Box m={1}>\n        <FormControl component=\"fieldset\">\n          <FormLabel component=\"legend\" className={classes.iconRadioLegend}>\n            Matrix colorEncoding\n          </FormLabel>\n          <RadioGroup\n            aria-label=\"colorEncoding\"\n            name=\"colorEncoding\"\n            value={colorEncoding}\n          >\n            <FormControlLabel\n              label=\"Solid\"\n              value=\"solid\"\n              className={classes.iconRadio}\n              control={\n                <IconButton size=\"small\" onClick={changeColorEncoding('solid')}>\n                  {colorEncoding === 'solid' ? (\n                    <RadioButtonCheckedIcon\n                      className={classes.iconRadioActive}\n                      fontSize=\"inherit\"\n                    />\n                  ) : (\n                    <RadioButtonUncheckedIcon fontSize=\"inherit\" />\n                  )}\n                </IconButton>\n              }\n            />\n            <FormControlLabel\n              label=\"Number of predictions\"\n              value=\"frequency\"\n              className={classes.iconRadio}\n              control={\n                <IconButton\n                  size=\"small\"\n                  onClick={changeColorEncoding('frequency')}\n                >\n                  {colorEncoding === 'frequency' ? (\n                    <RadioButtonCheckedIcon\n                      className={classes.iconRadioActive}\n                      fontSize=\"inherit\"\n                    />\n                  ) : (\n                    <RadioButtonUncheckedIcon fontSize=\"inherit\" />\n                  )}\n                </IconButton>\n              }\n            />\n            <FormControlLabel\n              label=\"Highest prediction score\"\n              value=\"highestImportance\"\n              className={classes.iconRadio}\n              control={\n                <IconButton\n                  size=\"small\"\n                  onClick={changeColorEncoding('highestImportance')}\n                >\n                  {colorEncoding === 'highestImportance' ? (\n                    <RadioButtonCheckedIcon\n                      className={classes.iconRadioActive}\n                      fontSize=\"inherit\"\n                    />\n                  ) : (\n                    <RadioButtonUncheckedIcon fontSize=\"inherit\" />\n                  )}\n                </IconButton>\n              }\n            />\n            <FormControlLabel\n              label=\"Prediction score of the closest connection\"\n              value=\"closestImportance\"\n              className={classes.iconRadio}\n              control={\n                <IconButton\n                  size=\"small\"\n                  onClick={changeColorEncoding('closestImportance')}\n                >\n                  {colorEncoding === 'closestImportance' ? (\n                    <RadioButtonCheckedIcon\n                      className={classes.iconRadioActive}\n                      fontSize=\"inherit\"\n                    />\n                  ) : (\n                    <RadioButtonUncheckedIcon fontSize=\"inherit\" />\n                  )}\n                </IconButton>\n              }\n            />\n          </RadioGroup>\n        </FormControl>\n      </Box>\n    </React.Fragment>\n  );\n});\n\nexport default EnhancerRegionsInfo;\n","import React, { useCallback, useMemo, useState } from 'react';\nimport Grid from '@material-ui/core/Grid';\nimport IconButton from '@material-ui/core/IconButton';\nimport HelpIcon from '@material-ui/icons/Help';\nimport InfoIcon from '@material-ui/icons/Info';\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport Popover from '@material-ui/core/Popover';\nimport Typography from '@material-ui/core/Typography';\nimport { makeStyles } from '@material-ui/core/styles';\n\nconst useStyles = makeStyles((theme) => ({\n  grow: {\n    flexGrow: 1,\n  },\n  bar: {\n    position: 'relative',\n    padding: '2px',\n    fontSize: '0.8rem',\n    background: theme.palette.grey['100'],\n  },\n  title: {\n    fontSize: '0.8rem',\n    padding: '0 2px',\n    fontWeight: 900,\n  },\n  icon: {\n    color: theme.palette.grey['400'],\n    '&:hover': {\n      color: 'black',\n    },\n  },\n  iconActive: {\n    color: theme.palette.grey['600'],\n    '&:hover': {\n      color: 'black',\n    },\n  },\n  popeover: {\n    '& > *': {\n      maxWidth: '20rem',\n      padding: '0.5rem',\n      fontSize: '0.8rem',\n      '&+p': {\n        paddingTop: 0,\n      },\n    },\n  },\n  info: {\n    '&> *': {\n      padding: '0 2px',\n    },\n    '&> *:last-child': {\n      borderBottom: `1px solid ${theme.palette.grey['100']}`,\n    },\n  },\n}));\n\nconst TitleBar = React.memo(function TitleBar({\n  id,\n  title,\n  Info,\n  Help,\n  Settings,\n  useShowInfo,\n  popoverDirection = 'bottom',\n}) {\n  const [showInfo, setShowInfo] = useShowInfo();\n  const [helpAnchorEl, setHelpAnchorEl] = useState();\n  const [settingsAnchorEl, setSettingsAnchorEl] = useState();\n\n  const infoToggleHandler = useCallback(() => {\n    setShowInfo((show) => !(show === true || show === 'true'));\n  }, [setShowInfo]);\n\n  const helpOpenHandler = useCallback((event) => {\n    setHelpAnchorEl(event.currentTarget);\n  }, []);\n\n  const helpCloseHandler = useCallback(() => {\n    setHelpAnchorEl(null);\n  }, []);\n\n  const settingsOpenHandler = useCallback((event) => {\n    setSettingsAnchorEl(event.currentTarget);\n  }, []);\n\n  const settingsCloseHandler = useCallback(() => {\n    setSettingsAnchorEl(null);\n  }, []);\n\n  const helpId = useMemo(() => `${id}-help`, [id]);\n  const settingsId = useMemo(() => `${id}-settings`, [id]);\n\n  const anchorOriginVertical = useMemo(\n    () => (popoverDirection === 'bottom' ? 'bottom' : 'top'),\n    [popoverDirection]\n  );\n  const transformOriginVertical = useMemo(\n    () => (popoverDirection === 'bottom' ? 'top' : 'bottom'),\n    [popoverDirection]\n  );\n\n  // On every render\n  const classes = useStyles();\n\n  const helpOpen = Boolean(helpAnchorEl);\n  const settingsOpen = Boolean(settingsAnchorEl);\n\n  const iconInfoClass = showInfo ? classes.iconActive : classes.icon;\n  const iconHelpClass = helpOpen ? classes.iconActive : classes.icon;\n  const iconSettingsClass = settingsOpen ? classes.iconActive : classes.icon;\n\n  return (\n    <Grid item className={classes.root}>\n      <Grid\n        item\n        className={classes.bar}\n        container\n        alignItems=\"center\"\n        wrap=\"nowrap\"\n      >\n        <Grid\n          item\n          container\n          alignItems=\"center\"\n          wrap=\"nowrap\"\n          className={classes.grow}\n        >\n          <Typography component=\"h3\" className={classes.title} noWrap>\n            {title}:\n          </Typography>\n        </Grid>\n        <Grid item>\n          <Grid container alignItems=\"center\" wrap=\"nowrap\">\n            <IconButton\n              aria-label=\"details\"\n              className={iconInfoClass}\n              size=\"small\"\n              onClick={infoToggleHandler}\n            >\n              <InfoIcon fontSize=\"inherit\" />\n            </IconButton>\n            <IconButton\n              aria-label=\"help\"\n              aria-describedby={helpId}\n              className={iconHelpClass}\n              size=\"small\"\n              onClick={helpOpenHandler}\n            >\n              <HelpIcon fontSize=\"inherit\" />\n            </IconButton>\n            <Popover\n              id={helpId}\n              open={helpOpen}\n              anchorEl={helpAnchorEl}\n              onClose={helpCloseHandler}\n              anchorOrigin={{\n                vertical: anchorOriginVertical,\n                horizontal: 'right',\n              }}\n              transformOrigin={{\n                vertical: transformOriginVertical,\n                horizontal: 'right',\n              }}\n            >\n              <div className={classes.popeover}>\n                <Help />\n              </div>\n            </Popover>\n            <IconButton\n              aria-label=\"settings\"\n              aria-describedby={settingsId}\n              className={iconSettingsClass}\n              size=\"small\"\n              onClick={settingsOpenHandler}\n            >\n              <SettingsIcon fontSize=\"inherit\" />\n            </IconButton>\n            <Popover\n              id={helpId}\n              open={settingsOpen}\n              anchorEl={settingsAnchorEl}\n              onClose={settingsCloseHandler}\n              anchorOrigin={{\n                vertical: anchorOriginVertical,\n                horizontal: 'right',\n              }}\n              transformOrigin={{\n                vertical: transformOriginVertical,\n                horizontal: 'right',\n              }}\n            >\n              <div className={classes.popeover}>\n                <Settings />\n              </div>\n            </Popover>\n          </Grid>\n        </Grid>\n      </Grid>\n      <Grid item className={classes.info}>\n        {showInfo && <Info />}\n      </Grid>\n    </Grid>\n  );\n});\n\nexport default TitleBar;\n","import { deepClone, isFunction } from '@flekschas/utils';\n\nimport { DEFAULT_VARIANT_TRACK_DEF } from './constants';\n\nconst getFocusGeneRegion = (viewConfig) => {\n  return viewConfig.views[0].overlays[1] &&\n    viewConfig.views[0].overlays[1].options.extent &&\n    viewConfig.views[0].overlays[1].options.extent.length\n    ? [...viewConfig.views[0].overlays[1].options.extent[0]]\n    : null;\n};\n\nconst getFocusVariantRegion = (viewConfig) => {\n  const track = viewConfig.views[0].tracks.top[2];\n  let focusRegion = null;\n\n  if (track.type === 'combined') {\n    if (!track.contents[0]) return focusRegion;\n    focusRegion = track.contents[0].options.focusRegion;\n  } else {\n    focusRegion = track.options.focusRegion;\n  }\n\n  return focusRegion ? [...focusRegion] : focusRegion;\n};\n\nexport const updateViewConfigVariantTracks = (variantTrackConfigs) => (\n  viewConfig\n) => {\n  const track = viewConfig.views[0].tracks.top[2];\n\n  if (track.type === 'combined') {\n    track.contents = variantTrackConfigs.reduce((tracks, trackConfig) => {\n      const variantTrack = deepClone(DEFAULT_VARIANT_TRACK_DEF);\n      if (trackConfig.server && trackConfig.tilesetUid) {\n        variantTrack.server = trackConfig.server;\n        variantTrack.tilesetUid = trackConfig.tilesetUid;\n        variantTrack.uid = `variants-${trackConfig.tilesetUid}`;\n        variantTrack.options.name = trackConfig.label || 'Variants';\n        tracks.push(variantTrack);\n      } else if (trackConfig.file) {\n        variantTrack.data = { type: 'localBed', id: trackConfig.file.name };\n        variantTrack.uid = `variants-${trackConfig.file.name}`;\n        variantTrack.options.name = trackConfig.label || 'Variants';\n        tracks.push(variantTrack);\n      }\n      return tracks;\n    }, []);\n\n    track.height = (track.contents.length > 0) * 32;\n  }\n\n  return viewConfig;\n};\n\nexport const updateViewConfigFocusVariant = (position, trackIdxs = []) => (\n  viewConfig\n) => {\n  const delFocusRegion = (track, focusRegion) => {\n    if (track.type === 'combined') {\n      track.contents.forEach((childTrack) => {\n        delete childTrack.options.focusRegion;\n      });\n    } else {\n      delete track.options.focusRegion;\n    }\n  };\n\n  const setFocusRegion = (track, focusRegion) => {\n    if (track.type === 'combined') {\n      track.contents.forEach((childTrack) => {\n        childTrack.options.focusRegion = focusRegion;\n      });\n    } else {\n      track.options.focusRegion = focusRegion;\n    }\n  };\n\n  if (Number.isNaN(+position) || position === null) {\n    trackIdxs.forEach((trackIdx) => {\n      delFocusRegion(viewConfig.views[0].tracks.top[trackIdx]);\n    });\n    viewConfig.views[0].overlays[0].options.extent = [];\n  } else {\n    const focusRegion = [position - 0.5, position + 0.5];\n    trackIdxs.forEach((trackIdx) => {\n      setFocusRegion(viewConfig.views[0].tracks.top[trackIdx], focusRegion);\n    });\n\n    viewConfig.views[0].overlays[0].options.extent = [focusRegion];\n  }\n\n  return viewConfig;\n};\n\nexport const updateViewConfigVariantYScale = (yScale) => (viewConfig) => {\n  const track = viewConfig.views[0].tracks.top[2];\n\n  if (track.type === 'combined') {\n    track.contents.forEach((childTrack) => {\n      childTrack.options.valueColumn = yScale === 'pValue' ? 7 : 8;\n    });\n  } else {\n    track.options.valueColumn = yScale === 'pValue' ? 7 : 8;\n  }\n\n  return viewConfig;\n};\n\nexport const updateViewConfigXDomain = (\n  newXDomainStart,\n  newXDomainEnd,\n  { force = false } = {}\n) => (viewConfig) => {\n  const _force = force === true || (isFunction(force) && force());\n\n  const xDomain = [...viewConfig.views[0].initialXDomain];\n  const focusGeneRegion = getFocusGeneRegion(viewConfig);\n  const focusVariantRegion = getFocusVariantRegion(viewConfig);\n\n  if (!Number.isNaN(+newXDomainStart)) {\n    xDomain[0] = newXDomainStart;\n  }\n  if (!Number.isNaN(+newXDomainEnd)) {\n    xDomain[1] = newXDomainEnd;\n  }\n\n  if (focusGeneRegion && !_force) {\n    xDomain[0] = focusGeneRegion[0] - 100000;\n    xDomain[1] = focusGeneRegion[1] + 100000;\n  }\n\n  if (focusVariantRegion && !_force) {\n    xDomain[0] = Math.min(xDomain[0], focusVariantRegion[0] - 100000);\n    xDomain[1] = Math.max(xDomain[1], focusVariantRegion[1] + 100000);\n  }\n\n  viewConfig.views[0].initialXDomain = xDomain;\n\n  return viewConfig;\n};\n\nexport const updateViewConfigFocusGene = (gene, start, end) => (viewConfig) => {\n  const n = viewConfig.views[0].tracks.top.length;\n\n  if (gene) {\n    viewConfig.views[0].tracks.top[n - 1].options.focusGene = gene;\n    viewConfig.views[0].overlays[1].options.extent = [[start, end]];\n  } else {\n    delete viewConfig.views[0].tracks.top[n - 1].options.focusGene;\n    delete viewConfig.views[0].overlays[1].options.extent;\n  }\n\n  return viewConfig;\n};\n","import React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { useRecoilValue, useSetRecoilState, useRecoilState } from 'recoil';\nimport { HiGlassComponent } from 'higlass';\nimport { debounce, deepClone, isParentOf, pipe, sum } from '@flekschas/utils';\n\nimport Typography from '@material-ui/core/Typography';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport { useChromInfo } from './ChromInfoProvider';\nimport EnhancerRegionsInfo from './EnhancerRegionsInfo';\nimport EnhancerRegionsHelp from './EnhancerRegionsHelp';\nimport EnhancerRegionsSettings from './EnhancerRegionsSettings';\nimport TitleBar from './TitleBar';\n\nimport {\n  enhancerRegionsColorEncodingState,\n  enhancerRegionsHideUnfocusedState,\n  focusGeneEndWithAssembly,\n  focusGeneOptionState,\n  focusGeneStartWithAssembly,\n  focusVariantOptionState,\n  focusVariantPositionWithAssembly,\n  higlassEnhancerRegionsState,\n  sampleGroupSelectionSizesState,\n  selectedSamplesState,\n  useEnhancerRegionsShowInfos,\n  useFocusGene,\n  useFocusVariant,\n  useXDomainEndWithAssembly,\n  useXDomainStartWithAssembly,\n  variantTracksState,\n  variantYScaleState,\n  xDomainEndAbsWithAssembly,\n  xDomainStartAbsWithAssembly,\n} from './state';\n\nimport {\n  updateViewConfigFocusGene,\n  updateViewConfigFocusVariant,\n  updateViewConfigVariantYScale,\n  updateViewConfigXDomain,\n  updateViewConfigVariantTracks,\n} from './view-config';\n\nimport { DEFAULT_VIEW_CONFIG_ENHANCER } from './constants';\n\nimport 'higlass/dist/hglib.css';\n\nimport './EnhancerRegions.css';\n\nconst useStyles = makeStyles((theme) => ({\n  grow: {\n    flexGrow: 1,\n  },\n  fullWidthHeight: {\n    position: 'absolute',\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0,\n  },\n  higlassContainer: {\n    position: 'relative',\n    minHeight: '100%',\n    overflow: 'hidden',\n  },\n  panZoomTip: {\n    position: 'absolute',\n    zIndex: 11,\n    top: 0,\n    left: 0,\n    right: 0,\n    padding: '0 2px',\n    fontSize: '0.8rem',\n    lineHeight: '1.5rem',\n    background: theme.palette.grey['100'],\n    textAlign: 'center',\n    boxShadow: '0 1px 3px 0 rgba(0, 0, 0, 0.1)',\n    opacity: 1,\n    animation: '0.75s ease 3s 1 running forwards fadeout',\n    '-webkit-touch-callout': 'none',\n    '-webkit-user-select': 'none',\n    '-khtml-user-select': 'none',\n    '-moz-user-select': 'none',\n    '-ms-user-select': 'none',\n    userSelect: 'none',\n    transition: '0.25s ease opacity, 0.25s ease transform',\n    '&:hover': {\n      opacity: 0,\n    },\n  },\n  panZoomTipNormal: {\n    color: theme.palette.grey['600'],\n  },\n  panZoomTipNormalHover: {\n    fontWeight: 'bold',\n    color: 'black',\n    background: '#aaa',\n    animation: '0.75s ease 5s 1 running forwards fadeout',\n  },\n  panZoomTipActive: {\n    color: 'white',\n    background: '#dd55a5',\n    animation: '0.75s ease 5s 1 running forwards fadeout',\n  },\n  panZoomTipActiveHover: {\n    fontWeight: 'bold',\n    color: 'white',\n    background: '#cc0078',\n    animation: '0.75s ease 5s 1 running forwards fadeout',\n  },\n}));\n\nconst updateViewConfigFocusStyle = (hideUnfocused) => (viewConfig) => {\n  viewConfig.views[0].tracks.top[4].options.focusStyle = hideUnfocused\n    ? 'filtering'\n    : 'highlighting';\n  viewConfig.views[0].tracks.top[4].options.stratification.axisNoGroupColor = !hideUnfocused;\n\n  return viewConfig;\n};\n\nconst updateViewConfigColorEncoding = (coloring) => (viewConfig) => {\n  viewConfig.views[0].tracks.top[4].options.opacityEncoding = coloring;\n  return viewConfig;\n};\n\nconst updateViewConfigFilter = (selectedSamples) => (viewConfig) => {\n  viewConfig.views[0].tracks.top[3].contents[0].options.filter = {\n    set: selectedSamples,\n    field: 10,\n  };\n  viewConfig.views[0].tracks.top[3].contents[1].options.filter = {\n    set: selectedSamples,\n    field: 10,\n  };\n  viewConfig.views[0].tracks.top[4].options.filter = {\n    set: selectedSamples,\n    field: 10,\n  };\n  return viewConfig;\n};\n\nconst updateViewConfigMatrixHeight = (numSamples) => (viewConfig) => {\n  const matrixTrack = viewConfig.views[0].tracks.top[4];\n  matrixTrack.height = numSamples * matrixTrack.options.markHeight + 14;\n  return viewConfig;\n};\n\nconst EnhancerRegion = React.memo((props) => {\n  const chromInfo = useChromInfo();\n\n  const [focusGeneOption, setFocusGeneOption] = useRecoilState(\n    focusGeneOptionState\n  );\n\n  const setFocusGene = useFocusGene()[1];\n  const setFocusVariant = useFocusVariant()[1];\n  const setXDomainStart = useXDomainStartWithAssembly(chromInfo)[1];\n  const setXDomainEnd = useXDomainEndWithAssembly(chromInfo)[1];\n  const setFocusVariantOption = useSetRecoilState(focusVariantOptionState);\n  const setHiglass = useSetRecoilState(higlassEnhancerRegionsState);\n\n  const variantTracks = useRecoilValue(variantTracksState);\n  const hideUnfocused = useRecoilValue(enhancerRegionsHideUnfocusedState);\n  const variantYScale = useRecoilValue(variantYScaleState);\n  const colorEncoding = useRecoilValue(enhancerRegionsColorEncodingState);\n  const focusVariantPosition = useRecoilValue(\n    focusVariantPositionWithAssembly(chromInfo)\n  );\n  const xDomainStartAbs = useRecoilValue(\n    xDomainStartAbsWithAssembly(chromInfo)\n  );\n  const xDomainEndAbs = useRecoilValue(xDomainEndAbsWithAssembly(chromInfo));\n  const focusGeneStart = useRecoilValue(focusGeneStartWithAssembly(chromInfo));\n  const focusGeneEnd = useRecoilValue(focusGeneEndWithAssembly(chromInfo));\n  const sampleGroupSelectionSizes = useRecoilValue(\n    sampleGroupSelectionSizesState\n  );\n  const selectedSamples = useRecoilValue(selectedSamplesState);\n\n  const [higlassMouseOver, setHiglassMouseOver] = useState(false);\n  const [higlassFocus, setHiglassFocus] = useState(false);\n  const higlassContainerRef = useRef(null);\n  const higlassEnhancerClickSelection = useRef(null);\n  const higlassMouseDown = useRef(false);\n  const higlassNumMouseOver = useRef(0);\n  const higlassNumFocus = useRef(0);\n  const higlassNumFocusMouseOut = useRef(0);\n\n  const shouldSkipUpdatingXDomain = () => {\n    if (higlassEnhancerClickSelection.current) {\n      higlassEnhancerClickSelection.current = false;\n      return true;\n    }\n    return false;\n  };\n\n  const numSamples = useMemo(\n    () => sum(Object.values(sampleGroupSelectionSizes)),\n    [sampleGroupSelectionSizes]\n  );\n\n  useEffect(() => {\n    higlassNumMouseOver.current += higlassMouseOver;\n  }, [higlassMouseOver]);\n\n  useEffect(() => {\n    higlassNumFocus.current += higlassFocus;\n  }, [higlassFocus]);\n\n  useEffect(() => {\n    if (higlassFocus) higlassNumFocusMouseOut.current += !higlassMouseOver;\n    else higlassNumFocusMouseOut.current = 0;\n  }, [higlassFocus, higlassMouseOver]);\n\n  const viewConfig = useMemo(\n    () =>\n      pipe(\n        updateViewConfigVariantTracks(variantTracks),\n        updateViewConfigFocusGene(\n          focusGeneOption ? focusGeneOption.geneName : null,\n          focusGeneStart,\n          focusGeneEnd\n        ),\n        updateViewConfigFocusVariant(focusVariantPosition, [2, 4]),\n        updateViewConfigFocusStyle(hideUnfocused),\n        updateViewConfigColorEncoding(colorEncoding),\n        updateViewConfigVariantYScale(variantYScale),\n        updateViewConfigXDomain(xDomainStartAbs, xDomainEndAbs, {\n          force: shouldSkipUpdatingXDomain,\n        }),\n        updateViewConfigFilter(selectedSamples),\n        updateViewConfigMatrixHeight(numSamples)\n      )(deepClone(DEFAULT_VIEW_CONFIG_ENHANCER)),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [\n      // `xDomainStartAbs` and `xDomainEndAbs` are ommitted on purpose to avoid\n      // updating the view-config on every pan or zoom event.\n      variantTracks,\n      focusGeneOption,\n      focusGeneStart,\n      focusGeneEnd,\n      focusVariantPosition,\n      hideUnfocused,\n      colorEncoding,\n      variantYScale,\n      selectedSamples,\n      numSamples,\n    ]\n  );\n\n  const viewConfigHeight = useMemo(\n    () =>\n      viewConfig.views[0].tracks.top.reduce(\n        (height, track) => height + track.height,\n        0\n      ),\n    [viewConfig]\n  );\n\n  const higlassBlockClasses = useMemo(\n    () => (higlassFocus ? 'higlass-block focus' : 'higlass-block'),\n    [higlassFocus]\n  );\n\n  // HiGlass Functions\n  const higlassClickHandler = (event) => {\n    if (event.type === 'gene-annotation') {\n      setFocusGene(event.payload.name);\n      higlassEnhancerClickSelection.current = true;\n      setFocusGeneOption({\n        chr: event.payload.fields[0],\n        txStart: event.payload.fields[1],\n        txEnd: event.payload.fields[2],\n        geneName: event.payload.name,\n        type: 'gene',\n      });\n    } else if (event.type === 'snp') {\n      setFocusVariant(event.payload.name);\n      higlassEnhancerClickSelection.current = true;\n      setFocusVariantOption({\n        chr: event.payload.fields[0],\n        txStart: event.payload.fields[1],\n        txEnd: event.payload.fields[2],\n        geneName: event.payload.name,\n        score: event.payload.importance,\n        type: 'variant',\n      });\n    } else if (event.type === 'annotation') {\n      console.log('clicked on annotation', event.payload);\n    }\n  };\n\n  const higlassLocationChangeHandler = (event) => {\n    const [newXDomainStart, newXDomainEnd] = event.xDomain.map((absPos) =>\n      chromInfo.absToChr(absPos).slice(0, 2).join(':')\n    );\n    setXDomainStart(newXDomainStart);\n    setXDomainEnd(newXDomainEnd);\n  };\n  const higlassLocationChangeHandlerDb = debounce(\n    higlassLocationChangeHandler,\n    250\n  );\n\n  const windowMouseDownClearHandler = useCallback((e) => {\n    if (!isParentOf(e.target, higlassContainerRef.current)) {\n      setHiglassFocus(false);\n    }\n    higlassMouseDown.current = false;\n  }, []);\n\n  useEffect(\n    () => {\n      window.addEventListener('mouseup', windowMouseDownClearHandler);\n      window.addEventListener('blur', windowMouseDownClearHandler);\n    },\n    // Execute only once on initialization\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    []\n  );\n\n  const higlassMouseDownHandler = useCallback(() => {\n    higlassMouseDown.current = true;\n  }, []);\n\n  const higlassInitHandler = useCallback(\n    (higlassInstance) => {\n      if (higlassInstance !== null) {\n        setHiglass(higlassInstance.api);\n        higlassInstance.api.on('click', higlassClickHandler);\n        higlassInstance.api.on(\n          'location',\n          higlassLocationChangeHandlerDb,\n          'context'\n        );\n        higlassInstance.api\n          .getComponent()\n          .element.addEventListener('mousedown', higlassMouseDownHandler);\n      }\n    },\n    // Execute only once on initialization\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    []\n  );\n\n  const higlassFocusHandler = () => {\n    setHiglassFocus(true);\n  };\n\n  const higlassBlurHandler = () => {\n    if (!higlassMouseDown.current) {\n      setHiglassFocus(false);\n    }\n  };\n\n  const higlassContainerMouseEnterHandler = () => {\n    setHiglassMouseOver(true);\n  };\n\n  const higlassContainerMouseLeaveHandler = () => {\n    setHiglassMouseOver(false);\n  };\n\n  // Run on every render\n  const classes = useStyles();\n\n  return (\n    <div className={classes.root}>\n      <TitleBar\n        id=\"enhancer-regions\"\n        title=\"Enhancer Regions\"\n        useShowInfo={useEnhancerRegionsShowInfos}\n        Info={EnhancerRegionsInfo}\n        Help={EnhancerRegionsHelp}\n        Settings={EnhancerRegionsSettings}\n      />\n      <div\n        className={`higlass-container ${classes.higlassContainer}`}\n        onMouseEnter={higlassContainerMouseEnterHandler}\n        onMouseLeave={higlassContainerMouseLeaveHandler}\n        ref={higlassContainerRef}\n        style={{ height: `${viewConfigHeight}px` }}\n      >\n        {higlassFocus &&\n          !higlassMouseOver &&\n          higlassNumFocus.current < 2 &&\n          higlassNumFocusMouseOut.current < 1 && (\n            <Typography\n              // Just a hack to trigger a dom rerendering which in turn\n              // triggers the fadeout animation\n              component=\"div\"\n              className={`panZoomTip ${classes.panZoomTip} ${classes.panZoomTipActive}`}\n              noWrap\n            >\n              Click outside to deactivate pan & zoom!\n            </Typography>\n          )}\n        {higlassFocus &&\n          higlassMouseOver &&\n          higlassNumFocus.current < 2 &&\n          higlassNumFocusMouseOut.current < 1 && (\n            <Typography\n              // Just a hack to trigger a dom rerendering which in turn\n              // triggers the fadeout animation\n              component=\"span\"\n              className={`panZoomTip ${classes.panZoomTip} ${classes.panZoomTipActiveHover}`}\n              noWrap\n            >\n              You can now pan & zoom the plot!\n            </Typography>\n          )}\n        {!higlassFocus && higlassMouseOver && higlassNumMouseOver.current < 2 && (\n          <Typography\n            // Just a hack to trigger a dom rerendering which in turn\n            // triggers the fadeout animation\n            component=\"div\"\n            className={`panZoomTip ${classes.panZoomTip} ${classes.panZoomTipNormalHover}`}\n            noWrap\n          >\n            Click to activate pan & zoom!\n          </Typography>\n        )}\n        {!higlassFocus && !higlassMouseOver && higlassNumMouseOver.current < 2 && (\n          <Typography\n            // Just a hack to trigger a dom rerendering which in turn\n            // triggers the fadeout animation\n            component=\"span\"\n            className={`panZoomTip ${classes.panZoomTip} ${classes.panZoomTipNormal}`}\n            noWrap\n          >\n            This plot is interactive!\n          </Typography>\n        )}\n        <div\n          className={higlassBlockClasses}\n          onMouseDown={higlassMouseDownHandler}\n          onFocus={higlassFocusHandler}\n          onBlur={higlassBlurHandler}\n          tabIndex=\"0\"\n        />\n        <HiGlassComponent\n          ref={higlassInitHandler}\n          viewConfig={viewConfig}\n          options={{\n            sizeMode: 'bounded',\n            globalMousePosition: true,\n          }}\n        />\n      </div>\n    </div>\n  );\n});\n\nexport default EnhancerRegion;\n","import React from 'react';\nimport { useRecoilValue } from 'recoil';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport {\n  enhancerGenesCellEncodingState,\n  enhancerGenesShowInfoState,\n  focusVariantState,\n} from './state';\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    display: 'flex',\n    justifyContent: 'space-between',\n  },\n  text: {\n    fontSize: '0.8rem',\n    verticalAlign: 'center',\n  },\n  placeholder: {\n    fontStyle: 'italic',\n    color: theme.palette.grey['600'],\n  },\n  small: {\n    fontSize: '0.5em',\n    lineHeight: '2em',\n  },\n  medium: {\n    fontSize: '1em',\n    lineHeight: '1em',\n  },\n  large: {\n    fontSize: '1.5em',\n    lineHeight: '0.6667em',\n    marginLeft: '-0.05rem',\n    marginRight: '0.1rem',\n  },\n}));\n\nconst EnhancerRegionsInfo = React.memo(function EnhancerRegionsInfo() {\n  const showInfo = useRecoilValue(enhancerGenesShowInfoState);\n  const focusVariant = useRecoilValue(focusVariantState);\n  const cellEncoding = useRecoilValue(enhancerGenesCellEncodingState);\n\n  const classes = useStyles();\n\n  if (!showInfo) return '';\n\n  return (\n    <div>\n      {!focusVariant && (\n        <Grid\n          container\n          justify=\"center\"\n          alignItems=\"center\"\n          className={classes.placeholder}\n        >\n          <Typography className={classes.text}>\n            Select a variant to see details\n          </Typography>\n        </Grid>\n      )}\n      {focusVariant && cellEncoding === 'number' && (\n        <React.Fragment>\n          <Typography className={classes.text}>\n            <span className={classes.small}></span>\n            <span className={classes.medium}></span>\n            <span className={classes.large}></span>\n            <strong>Absolute number</strong> of enhancer-gene connections\n            overlapping <em>{focusVariant}</em> by sample groups across\n            up/downstream genes.\n          </Typography>\n        </React.Fragment>\n      )}\n      {focusVariant && cellEncoding === 'percent' && (\n        <React.Fragment>\n          <Typography className={classes.text}>\n            <span className={classes.small}></span>\n            <span className={classes.medium}></span>\n            <span className={classes.large}></span>\n            <strong>Percentage</strong> of enhancer-gene connections overlapping{' '}\n            <em>{focusVariant}</em> within a sample group across up/downstream\n            genes.\n          </Typography>\n        </React.Fragment>\n      )}\n      {focusVariant && cellEncoding === 'distribution' && (\n        <React.Fragment>\n          <Typography className={classes.text}>\n            <strong>Distribution</strong> of the prediction scores of\n            enhancer-gene connections overlapping <em>{focusVariant}</em> by\n            sample group across up/downstream genes.\n          </Typography>\n        </React.Fragment>\n      )}\n      {focusVariant && cellEncoding === 'array' && (\n        <React.Fragment>\n          <Typography className={classes.text}>\n            <span></span>\n            <strong>Presence</strong> of enhancer-gene connections overlapping{' '}\n            <em>{focusVariant}</em> by samples across sample groups and\n            up/downstream genes.\n          </Typography>\n        </React.Fragment>\n      )}\n    </div>\n  );\n});\n\nexport default EnhancerRegionsInfo;\n","import React from 'react';\nimport Typography from '@material-ui/core/Typography';\n\nconst EnhancerRegionsHelp = React.memo(function EnhancerRegionsHelp() {\n  return (\n    <React.Fragment>\n      <Typography>...</Typography>\n    </React.Fragment>\n  );\n});\n\nexport default EnhancerRegionsHelp;\n","import React, { useCallback } from 'react';\nimport Box from '@material-ui/core/Box';\nimport IconButton from '@material-ui/core/IconButton';\nimport RadioButtonCheckedIcon from '@material-ui/icons/RadioButtonChecked';\nimport RadioButtonUncheckedIcon from '@material-ui/icons/RadioButtonUnchecked';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport FormLabel from '@material-ui/core/FormLabel';\nimport RadioGroup from '@material-ui/core/RadioGroup';\nimport Switch from '@material-ui/core/Switch';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport { useEnhancerGenesCellEncoding, useEnhancerGenesPadding } from './state';\n\nconst useStyles = makeStyles((theme) => ({\n  iconRadio: {\n    padding: theme.spacing(0.5, 0),\n    marginLeft: -theme.spacing(1) / 2,\n    '& .MuiFormControlLabel-label': {\n      lineHeight: 1.2,\n    },\n  },\n  iconRadioActive: {\n    color: 'black',\n  },\n  iconRadioLegend: {\n    margin: theme.spacing(2, 0, 0.25, 0),\n  },\n}));\n\nconst EnhancerGenesSettings = React.memo(function EnhancerGenesSettings() {\n  const [cellEncoding, setCellEncoding] = useEnhancerGenesCellEncoding();\n  const [padding, setPadding] = useEnhancerGenesPadding();\n\n  const changeCellEncoding = useCallback(\n    (value) => () => {\n      setCellEncoding(value);\n    },\n    [setCellEncoding]\n  );\n\n  const changePadding = useCallback(\n    (value) => () => {\n      setPadding(value);\n    },\n    [setPadding]\n  );\n\n  const classes = useStyles();\n\n  return (\n    <React.Fragment>\n      <Box m={1}>\n        <FormControlLabel\n          control={\n            <Switch checked={padding} onChange={changePadding} name=\"true\" />\n          }\n          label=\"Gene padding\"\n        />\n      </Box>\n      <Box m={1}>\n        <FormControl component=\"fieldset\">\n          <FormLabel component=\"legend\" className={classes.iconRadioLegend}>\n            Gene Cell Encoding\n          </FormLabel>\n          <RadioGroup\n            aria-label=\"cellEncoding\"\n            name=\"cellEncoding\"\n            value={cellEncoding}\n          >\n            <FormControlLabel\n              label=\"Number of predictions\"\n              value=\"number\"\n              className={classes.iconRadio}\n              control={\n                <IconButton size=\"small\" onClick={changeCellEncoding('number')}>\n                  {cellEncoding === 'number' ? (\n                    <RadioButtonCheckedIcon\n                      className={classes.iconRadioActive}\n                      fontSize=\"inherit\"\n                    />\n                  ) : (\n                    <RadioButtonUncheckedIcon fontSize=\"inherit\" />\n                  )}\n                </IconButton>\n              }\n            />\n            <FormControlLabel\n              label=\"Percentage of samples with predictions\"\n              value=\"percent\"\n              className={classes.iconRadio}\n              control={\n                <IconButton\n                  size=\"small\"\n                  onClick={changeCellEncoding('percent')}\n                >\n                  {cellEncoding === 'percent' ? (\n                    <RadioButtonCheckedIcon\n                      className={classes.iconRadioActive}\n                      fontSize=\"inherit\"\n                    />\n                  ) : (\n                    <RadioButtonUncheckedIcon fontSize=\"inherit\" />\n                  )}\n                </IconButton>\n              }\n            />\n            <FormControlLabel\n              label=\"Distribution by prediction score\"\n              value=\"distribution\"\n              className={classes.iconRadio}\n              control={\n                <IconButton\n                  size=\"small\"\n                  onClick={changeCellEncoding('distribution')}\n                >\n                  {cellEncoding === 'distribution' ? (\n                    <RadioButtonCheckedIcon\n                      className={classes.iconRadioActive}\n                      fontSize=\"inherit\"\n                    />\n                  ) : (\n                    <RadioButtonUncheckedIcon fontSize=\"inherit\" />\n                  )}\n                </IconButton>\n              }\n            />\n            <FormControlLabel\n              label=\"Sample array\"\n              value=\"array\"\n              className={classes.iconRadio}\n              control={\n                <IconButton size=\"small\" onClick={changeCellEncoding('array')}>\n                  {cellEncoding === 'array' ? (\n                    <RadioButtonCheckedIcon\n                      className={classes.iconRadioActive}\n                      fontSize=\"inherit\"\n                    />\n                  ) : (\n                    <RadioButtonUncheckedIcon fontSize=\"inherit\" />\n                  )}\n                </IconButton>\n              }\n            />\n          </RadioGroup>\n        </FormControl>\n      </Box>\n    </React.Fragment>\n  );\n});\n\nexport default EnhancerGenesSettings;\n","import React, { createContext, useCallback, useState } from 'react';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport { makeStyles } from '@material-ui/core/styles';\n\nconst TooltipContext = createContext();\n\nconst useStyles = makeStyles({\n  root: {\n    position: 'fixed',\n    zIndex: 10,\n    width: 1,\n    height: 1,\n    background: 'black',\n    fontWeight: 'normal',\n    pointerEvents: 'none',\n    '& strong': {\n      fontWeight: 'bold',\n    },\n  },\n});\n\nexport default function TooltipProvider({ children }) {\n  const [localState, setLocalState] = useState({\n    show: false,\n    title: '',\n    x: 0,\n    y: 0,\n    arrow: true,\n    placement: 'bottom',\n    classes: {},\n  });\n\n  const showTooltip = useCallback(\n    (\n      x,\n      y,\n      title,\n      { arrow = false, placement = 'bottom', classes = {} } = {}\n    ) => {\n      if (Number.isNaN(+x) || Number.isNaN(+y) || !title) {\n        // Close tooltip\n        setLocalState({\n          show: false,\n          title: '',\n          x: 0,\n          y: 0,\n          arrow: true,\n          placement: 'bottom',\n          classes: {},\n        });\n      } else {\n        // Open tooltip\n        setLocalState({\n          show: true,\n          x,\n          y,\n          title,\n          arrow,\n          placement,\n          classes,\n        });\n      }\n    },\n    []\n  );\n\n  const classes = useStyles();\n\n  return (\n    <TooltipContext.Provider value={showTooltip}>\n      {children}\n      <Tooltip\n        open={localState.show}\n        title={localState.title}\n        arrow={localState.arrow}\n        placement={localState.placement}\n        classes={localState.classes}\n      >\n        <div\n          className={classes.root}\n          style={{\n            top: localState.y,\n            left: localState.x,\n          }}\n        />\n      </Tooltip>\n    </TooltipContext.Provider>\n  );\n}\n\nfunction useShowTooltip() {\n  const context = React.useContext(TooltipContext);\n  if (context === undefined) {\n    throw new Error('useShowTooltip must be used within a TooltipContext');\n  }\n  return context;\n}\n\nexport { useShowTooltip };\n","import { identity } from '@flekschas/utils';\nimport { axisRight, scaleLinear, scaleLog, select } from 'd3';\nimport React, {\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useState,\n} from 'react';\nimport { useRecoilValue, useRecoilState } from 'recoil';\nimport TinyQueue from 'tinyqueue';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Grid from '@material-ui/core/Grid';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport { useChromInfo } from './ChromInfoProvider';\nimport { useShowTooltip } from './TooltipProvider';\n\nimport {\n  enhancerGenesCellEncodingState,\n  enhancerGenesPaddingState,\n  enhancerGenesSvgState,\n  focusVariantPositionWithAssembly,\n  focusVariantRelPositionState,\n  focusVariantState,\n  focusVariantStrPositionState,\n  sampleSelectionState,\n  sampleGroupSelectionSizesState,\n} from './state';\n\nimport {\n  DEFAULT_COLOR_MAP,\n  DEFAULT_COLOR_MAP_DARK,\n  DEFAULT_COLOR_MAP_LIGHT,\n  DEFAULT_STRATIFICATION,\n  DEFAULT_VIEW_CONFIG_ENHANCER,\n  SAMPLE_IDX,\n} from './constants';\nimport { scaleBand } from './utils';\nimport usePrevious from './use-previous';\n\nimport './EnhancerGenesPlot.css';\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    color: theme.palette.grey['300'],\n    minHeight: '6rem',\n  },\n  plot: {\n    position: 'relative',\n    flexGrow: 1,\n  },\n  plotSvg: {\n    width: '100%',\n    height: '100%',\n  },\n}));\n\nconst useTooltipStyles = DEFAULT_COLOR_MAP_LIGHT.map((color, i) =>\n  makeStyles((theme) => ({\n    arrow: {\n      color,\n    },\n    tooltip: {\n      color: DEFAULT_COLOR_MAP_DARK[i],\n      backgroundColor: color,\n      boxShadow: '0 0 3px 0 rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(0, 0, 0, 0.05)',\n      '& .value': {\n        color: 'white',\n        background: DEFAULT_COLOR_MAP_DARK[i],\n        padding: '0 0.25em',\n        borderRadius: '0.25rem',\n      },\n    },\n  }))\n);\n\nconst {\n  server,\n  tilesetUid: uuid,\n} = DEFAULT_VIEW_CONFIG_ENHANCER.views[0].tracks.top[3].contents[1];\n\nconst fetchTile = async (tileId) => {\n  const response = await fetch(`${server}/tiles/?d=${tileId}`);\n  return response.json();\n};\n\nconst categories = {};\nconst samples = {};\n\nDEFAULT_STRATIFICATION.groups.forEach((group, i) => {\n  categories[group.label] = {\n    name: group.label,\n    size: group.categories.length,\n    index: i,\n  };\n\n  group.categories.forEach((category, j) => {\n    samples[category] = {\n      category: categories[group.label],\n      index: j,\n    };\n  });\n});\n\nconst getTileWidth = (tilesetInfo) =>\n  tilesetInfo.max_width / 2 ** tilesetInfo.max_zoom;\n\nconst filterByPosition = (tile, position) =>\n  tile.filter((entry) => position >= entry.xStart && position <= entry.xEnd);\n\n// From https://observablehq.com/@d3/beeswarm\nconst dodge = (data, radius, yScale) => {\n  const radius2 = radius ** 2;\n  const circles = data\n    .map((d) => ({ y: yScale(d.value), data: d }))\n    .sort((a, b) => a.y - b.y);\n  const epsilon = 1e-3;\n  let head = null;\n  let tail = null;\n\n  // Returns true if circle x,y intersects with any circle in the queue.\n  function intersects(x, y) {\n    let a = head;\n    while (a) {\n      if (radius2 - epsilon > (a.x - x) ** 2 + (a.y - y) ** 2) {\n        return true;\n      }\n      a = a.next;\n    }\n    return false;\n  }\n\n  // Place each circle sequentially.\n  for (const b of circles) {\n    // Remove circles from the queue that cant intersect the new circle b.\n    while (head && head.y < b.y - radius2) head = head.next;\n\n    // Choose the minimum non-intersecting tangent.\n    if (intersects((b.x = 0), b.y)) {\n      let a = head;\n      b.x = Infinity;\n      do {\n        const x = a.x + Math.sqrt(radius2 - (a.y - b.y) ** 2);\n        if (x < b.x && !intersects(x, b.y)) b.x = x;\n        a = a.next;\n      } while (a);\n    }\n\n    // Add b to the queue.\n    b.next = null;\n    // eslint-disable-next-line no-multi-assign\n    if (head === null) head = tail = b;\n    // eslint-disable-next-line no-multi-assign\n    else tail = tail.next = b;\n  }\n\n  return circles;\n};\n\nconst plotEnhancerGeneConnections = (\n  node,\n  width,\n  data,\n  {\n    geneCellEncoding = 'distribution',\n    prevGeneCellEncoding,\n    genePadding = false,\n    showTooltip = identity,\n    tooltipClasses = [],\n    position = '',\n    variant = null,\n  } = {}\n) => {\n  if (!width || !data) return;\n\n  const svg = select(node);\n\n  const paddingTop = 60;\n  const paddingBottom = 60;\n  const circleRadius = 1;\n  const circlePadding = 0.5;\n  const rowHeight = 36;\n  const geneLabelPadding = 3;\n  const beeswarmPadding = 1;\n  const distanceBarWidth = 6;\n  const distPaddingRange = [0, 20];\n  const height =\n    Object.values(categories).length * rowHeight + paddingTop + paddingBottom;\n\n  svg.attr('viewbox', `0 0 ${width} ${height}`).attr('height', height);\n\n  const maxCatgorySize = Object.values(data.categoryAggregation).reduce(\n    (max, cat) => Math.max(max, cat.numEnhancers),\n    0\n  );\n  const categorySizeScale = scaleLog()\n    .domain([1, maxCatgorySize])\n    .range([2, rowHeight])\n    .clamp(true);\n\n  const percentScale = scaleLinear()\n    .domain([0, 1])\n    .range([0, rowHeight])\n    .clamp(true);\n\n  const circleYScalePre = scaleLinear()\n    .domain([0, 1])\n    .range([1, 10])\n    .clamp(true);\n\n  const circleYScalePost = scaleLog()\n    .domain([1, 10])\n    .range([\n      rowHeight - circleRadius - beeswarmPadding,\n      circleRadius + beeswarmPadding,\n    ]);\n\n  const circleYScale = (v) => circleYScalePost(circleYScalePre(v));\n\n  // ---------------------------------------------------------------------------\n  // Gene setup\n  const geneContainerWidth = width / 2 - rowHeight;\n  const maxGenes = Math.floor(geneContainerWidth / rowHeight);\n\n  const genesUpstream = data.genesUpstreamByDist.slice(0, maxGenes).reverse();\n  const genesDownstream = data.genesDownstreamByDist.slice(0, maxGenes);\n\n  const [minRelDistance, maxRelDistance] = [\n    ...genesUpstream,\n    ...genesDownstream,\n  ].reduce(\n    (minMax, gene) => [\n      Math.min(minMax[0], gene.relDistance),\n      Math.max(minMax[1], gene.relDistance),\n    ],\n    [Infinity, 0]\n  );\n\n  const paddingScale = scaleLinear()\n    .domain([minRelDistance, maxRelDistance])\n    .range(distPaddingRange);\n\n  const genesUpstreamPadding = genePadding\n    ? genesUpstream.map((d) => Math.round(paddingScale(d.relDistance)))\n    : [];\n  const genesUpstreamScale = scaleBand()\n    .domain(genesUpstream.map((d) => d.name))\n    .range([0, width / 2 - rowHeight / 2])\n    .paddingInner(genesUpstreamPadding);\n\n  const genesDownstreamPadding = genePadding\n    ? genesDownstream.map((d) => Math.round(paddingScale(d.relDistance)))\n    : [];\n  const genesDownstreamScale = scaleBand()\n    .domain(genesDownstream.map((d) => d.name))\n    .range([0, width / 2 - rowHeight / 2])\n    .paddingInner(genesDownstreamPadding)\n    .paddingInnerZeroBased(true);\n\n  const bandwidth = Math.min(\n    genesUpstreamScale.bandwidth(),\n    genesDownstreamScale.bandwidth()\n  );\n\n  genesUpstreamScale.fixedBandwidth(bandwidth);\n  genesDownstreamScale.fixedBandwidth(bandwidth);\n\n  const genesUpstreamLeftPad = Math.max(\n    0,\n    genesUpstreamScale.rangeSize() - genesUpstreamScale.totalWidth()\n  );\n\n  const minVisibleAbsDist = Math.min(\n    genesUpstream.reduce(\n      (minDist, gene) => Math.min(minDist, gene.absDistance),\n      Infinity\n    ),\n    genesDownstream.reduce(\n      (minDist, gene) => Math.min(minDist, gene.absDistance),\n      Infinity\n    )\n  );\n\n  const maxVisibleAbsDist = Math.max(\n    genesUpstream.reduce(\n      (maxDist, gene) => Math.max(maxDist, gene.absDistance),\n      0\n    ),\n    genesDownstream.reduce(\n      (maxDist, gene) => Math.max(maxDist, gene.absDistance),\n      0\n    )\n  );\n\n  const distanceHeightScale = scaleLinear()\n    .domain([minVisibleAbsDist, maxVisibleAbsDist])\n    .range([2, paddingBottom]);\n\n  const plotBeeswarm = (selection, { isRightAligned = false } = {}) => {\n    selection\n      .attr(\n        'fill',\n        (d, i) => DEFAULT_COLOR_MAP_DARK[i % DEFAULT_COLOR_MAP_DARK.length]\n      )\n      .selectAll('circle')\n      .data((d) => dodge(d, circleRadius * 2 + circlePadding, circleYScale))\n      .join('circle')\n      .attr('cx', (d) =>\n        isRightAligned\n          ? genesUpstreamScale.bandwidth() - (d.x + 2 * beeswarmPadding)\n          : d.x + circleRadius + beeswarmPadding\n      )\n      .attr('cy', (d) => d.y)\n      .attr('r', circleRadius);\n  };\n\n  const getArrayNumCols = (genes) => {\n    const maxSize = Object.values(genes[0].samplesByCategory).reduce(\n      (max, cat) => Math.max(max, cat.size),\n      0\n    );\n    return Math.ceil(Math.sqrt((maxSize * bandwidth) / rowHeight));\n  };\n\n  const plotArray = (\n    selection,\n    numCols,\n    {\n      instanceCache = {},\n      onMouseEnter = identity,\n      onMouseLeave = identity,\n      tooltipTitleGetter = null,\n    } = {}\n  ) => {\n    const cellSize = bandwidth / numCols;\n\n    const indexToX = (index) => (index % numCols) * cellSize;\n    const indexToY = (index) => Math.floor(index / numCols) * cellSize;\n\n    instanceCache.current = selection\n      .attr(\n        'fill',\n        (d, i) => DEFAULT_COLOR_MAP_DARK[i % DEFAULT_COLOR_MAP_DARK.length]\n      )\n      .selectAll('rect')\n      .data(\n        (d) => d,\n        (d) => `${d.gene}|${d.sample}`\n      )\n      .join('rect')\n      .attr('x', (d) => indexToX(samples[d.sample].index))\n      .attr('y', (d) => indexToY(samples[d.sample].index))\n      .attr('width', cellSize)\n      .attr('height', cellSize)\n      .on('mouseenter', (event, d) => {\n        const bBox = event.target.getBoundingClientRect();\n        const title =\n          (tooltipTitleGetter && tooltipTitleGetter(d)) || d.value.toFixed(3);\n        showTooltip(bBox.x + bBox.width / 2, bBox.y, title, {\n          arrow: true,\n          placement: 'top',\n          classes:\n            tooltipClasses[\n              categories[d.sampleCategory].index % tooltipClasses.length\n            ],\n        });\n        onMouseEnter(d);\n      })\n      .on('mouseleave', (d) => {\n        showTooltip();\n        onMouseLeave(d);\n      });\n  };\n\n  const arrayTooltipTitleGetter = (d) => (\n    <React.Fragment>\n      The enhancer overlapping <strong>{position}</strong>\n      {variant ? ` (${variant})` : ''} is predicted to regulate{' '}\n      <strong>{d.gene}</strong> in sample <strong>{d.sample}</strong> with a\n      score of <strong className=\"value\">{d.value.toFixed(3)}</strong>.\n    </React.Fragment>\n  );\n\n  const geneArrayInstances = {\n    upstream: { current: null },\n    downstream: { current: null },\n  };\n\n  const geneArrayInstanceMouseEnterHandler = (dHovering) => {\n    const opacity = (d) => (d.sample === dHovering.sample ? 1 : 0.2);\n    geneArrayInstances.upstream.current.attr('opacity', opacity);\n    geneArrayInstances.downstream.current.attr('opacity', opacity);\n  };\n\n  const geneArrayInstanceMouseLeaveHandler = () => {\n    geneArrayInstances.upstream.current.attr('opacity', 1);\n    geneArrayInstances.downstream.current.attr('opacity', 1);\n  };\n\n  const plotBox = (\n    selection,\n    valueScale,\n    valueGetter,\n    {\n      cellWidth = rowHeight,\n      fillColor = DEFAULT_COLOR_MAP_LIGHT,\n      textColor = DEFAULT_COLOR_MAP_DARK,\n      showText = true,\n      showZero = true,\n      showTooltip: showTooltipOnMouseEnter = false,\n      tooltipTitleGetter = null,\n    } = {}\n  ) => {\n    const bg = selection\n      .selectAll('.bg')\n      .data((d) => [d])\n      .join('rect')\n      .attr('class', 'bg')\n      .attr('fill', (d) => fillColor[d.row % fillColor.length])\n      .attr('x', (d) => (cellWidth - valueScale(valueGetter(d))) / 2)\n      .attr('y', (d) => (rowHeight - valueScale(valueGetter(d))) / 2)\n      .attr('width', (d) => valueScale(valueGetter(d)))\n      .attr('height', (d) => valueScale(valueGetter(d)))\n      .attr('opacity', (d) => +(valueGetter(d) > 0));\n\n    if (showTooltipOnMouseEnter) {\n      bg.on('mouseenter', (event, d) => {\n        const bBox = event.target.getBoundingClientRect();\n        const title =\n          (tooltipTitleGetter && tooltipTitleGetter(d)) || valueGetter(d);\n        showTooltip(bBox.x + bBox.width / 2, bBox.y, title, {\n          arrow: true,\n          placement: 'top',\n          classes: tooltipClasses[d.row % tooltipClasses.length],\n        });\n      }).on('mouseleave', () => {\n        showTooltip();\n      });\n    } else {\n      bg.on('mouseenter', null).on('mouseleave', null);\n    }\n\n    if (showText) {\n      selection\n        .selectAll('.box-text')\n        .data((d) => [d])\n        .join('text')\n        .attr('class', 'box-text')\n        .attr('fill', (d) => textColor[d.row % textColor.length])\n        .attr('style', 'font-size: 12px; font-weight: bold;')\n        .attr('dominant-baseline', 'middle')\n        .attr('text-anchor', 'middle')\n        .attr('x', cellWidth / 2)\n        .attr('y', rowHeight / 2)\n        .attr('opacity', (d) => +(valueGetter(d) > 0 || showZero))\n        .text((d) => valueGetter(d));\n    }\n  };\n\n  const boxTooltipTitleGetter = (d) => (\n    <React.Fragment>\n      <strong className=\"value\">{d.length}</strong> out of {d.size}{' '}\n      <em>{Object.values(categories)[d.row].name}</em> samples have predicted\n      enhancer activity.\n    </React.Fragment>\n  );\n\n  // ---------------------------------------------------------------------------\n  // Category summary\n  const enhancerG = svg\n    .select('#enhancers')\n    .attr('transform', `translate(${width / 2 - rowHeight / 2}, 0)`);\n\n  // Draw background\n  const enhancerGCellG = enhancerG\n    .selectAll('.enhancer-gene-aggregate')\n    .data(\n      Object.values(data.categoryAggregation).map((d, i) => {\n        // Little hacky but necessary unfortunately\n        d.row = i;\n        return d;\n      }),\n      (d) => d.category.name\n    )\n    .join('g')\n    .attr('class', 'enhancer-gene-aggregate')\n    .attr('transform', (d, i) => `translate(0, ${i * rowHeight + paddingTop})`);\n\n  plotBox(enhancerGCellG, categorySizeScale, (d) => d.numEnhancers);\n\n  // Draw border\n  svg\n    .select('#enhancers')\n    .selectAll('.enhancer-box-border')\n    .data(Object.values(categories), (d) => d.name)\n    .join('rect')\n    .attr('class', 'enhancer-box-border')\n    .attr('fill', 'none')\n    .attr(\n      'stroke',\n      (d, i) => DEFAULT_COLOR_MAP_LIGHT[i % DEFAULT_COLOR_MAP_LIGHT.length]\n    )\n    .attr('stroke-width', '1')\n    .attr('x', 0)\n    .attr('y', (d, i) => i * rowHeight + paddingTop)\n    .attr('width', rowHeight)\n    .attr('height', rowHeight);\n\n  // ---------------------------------------------------------------------------\n  // Draw upstream genes\n\n  const genesUpstreamG = svg\n    .select('#genes-upstream')\n    .selectAll('.gene-upstream')\n    .data(genesUpstream, (d) => d.name)\n    .join('g')\n    .attr('class', 'gene-upstream')\n    .attr(\n      'transform',\n      (d) =>\n        `translate(${genesUpstreamLeftPad + genesUpstreamScale(d.name)}, 0)`\n    );\n\n  // Draw labels\n  const geneLabelX = genesUpstreamScale.bandwidth() / 2;\n  const geneLabelY = paddingTop - geneLabelPadding;\n  genesUpstreamG\n    // the join is needed to avoid appending more and more text elements on\n    // subsequent calls of this function, which would happen if we used\n    // `append()` instead.\n    .selectAll('.gene-upstream-label')\n    .data((d) => [d])\n    .join('text')\n    .attr('class', 'gene-label gene-upstream-label')\n    .attr('style', 'font-size: 9px;')\n    .attr('transform', `translate(${geneLabelX},${geneLabelY}) rotate(-90)`)\n    .attr('fill', 'black')\n    .attr('dominant-baseline', 'middle')\n    .text((d) => d.name);\n\n  // Draw cell\n  const genesUpstreamGCellG = genesUpstreamG\n    .selectAll('.gene-upstream-cell')\n    .data(\n      (d) =>\n        Object.values(d.samplesByCategory).map((item, i) => {\n          // Little hacky but necessary unfortunately\n          item.row = i;\n          return item;\n        }),\n      (d) => d.name\n    )\n    .join('g')\n    .attr('class', 'gene-upstream-cell')\n    .attr('transform', (d, i) => `translate(0, ${i * rowHeight + paddingTop})`);\n\n  if (geneCellEncoding !== prevGeneCellEncoding) {\n    genesUpstreamGCellG.selectAll('*').remove();\n  }\n\n  switch (geneCellEncoding) {\n    case 'distribution':\n      plotBeeswarm(genesUpstreamGCellG, { isRightAligned: true });\n      break;\n\n    case 'array':\n      plotArray(genesUpstreamGCellG, getArrayNumCols(genesUpstream), {\n        tooltipTitleGetter: arrayTooltipTitleGetter,\n        instanceCache: geneArrayInstances.upstream,\n        onMouseEnter: geneArrayInstanceMouseEnterHandler,\n        onMouseLeave: geneArrayInstanceMouseLeaveHandler,\n      });\n      break;\n\n    case 'number':\n    case 'percent':\n    default: {\n      const valueScale =\n        geneCellEncoding === 'percent' ? percentScale : categorySizeScale;\n\n      const valueGetter =\n        geneCellEncoding === 'percent'\n          ? (d) => d.length / d.size\n          : (d) => d.length;\n\n      plotBox(genesUpstreamGCellG, valueScale, valueGetter, {\n        showText: false,\n        cellWidth: genesUpstreamScale.bandwidth(),\n        fillColor: DEFAULT_COLOR_MAP,\n        showTooltip: true,\n        tooltipTitleGetter: boxTooltipTitleGetter,\n      });\n\n      break;\n    }\n  }\n\n  // Draw border\n  genesUpstreamG\n    .selectAll('.gene-upstream-border')\n    .data(Object.values(categories), (d) => d.name)\n    .join('rect')\n    .attr('class', 'gene-upstream-border')\n    .attr('fill', 'none')\n    .attr(\n      'stroke',\n      (d, i) => DEFAULT_COLOR_MAP_LIGHT[i % DEFAULT_COLOR_MAP_LIGHT.length]\n    )\n    .attr('stroke-width', '1')\n    .attr('x', 0)\n    .attr('y', (d, i) => i * rowHeight + paddingTop)\n    .attr('width', genesUpstreamScale.bandwidth())\n    .attr('height', rowHeight);\n\n  // Draw distance bars\n  genesUpstreamG\n    // Same reason we're using a join here as for the text labels above\n    .selectAll('.gene-upstream-distance-bar')\n    .data((d) => [d])\n    .join('rect')\n    .attr('class', 'gene-upstream-distance-bar')\n    .attr('fill', '#bbbbbb')\n    .attr('x', genesUpstreamScale.bandwidth() / 2 - distanceBarWidth / 2)\n    .attr('y', Object.values(categories).length * rowHeight + paddingTop)\n    .attr('width', distanceBarWidth)\n    .attr('height', (d) => distanceHeightScale(d.absDistance));\n\n  // ---------------------------------------------------------------------------\n  // Draw downstream genes\n  svg\n    .select('#genes-downstream')\n    .attr('transform', `translate(${width / 2 + rowHeight / 2}, 0)`);\n\n  const genesDownstreamG = svg\n    .select('#genes-downstream')\n    .selectAll('.gene-downstream')\n    .data(genesDownstream, (d) => d.name)\n    .join('g')\n    .attr('class', 'gene-downstream')\n    .attr('transform', (d) => `translate(${genesDownstreamScale(d.name)}, 0)`);\n\n  // Draw labels\n  genesDownstreamG\n    .selectAll('.gene-downstream-label')\n    .data((d) => [d])\n    .join('text')\n    .attr('class', 'gene-label gene-downstream-label')\n    .attr('style', 'font-size: 9px;')\n    .attr('transform', `translate(${geneLabelX},${geneLabelY}) rotate(-90)`)\n    .attr('fill', 'black')\n    .attr('dominant-baseline', 'middle')\n    .text((d) => d.name);\n\n  // Draw cell\n  const genesDownstreamGCellG = genesDownstreamG\n    .selectAll('.gene-downstream-cell')\n    .data(\n      (d) =>\n        Object.values(d.samplesByCategory).map((item, i) => {\n          // Little hacky but necessary unfortunately\n          item.row = i;\n          return item;\n        }),\n      (d) => d.name\n    )\n    .join('g')\n    .attr('class', 'gene-downstream-cell')\n    .attr('transform', (d, i) => `translate(0, ${i * rowHeight + paddingTop})`);\n\n  if (geneCellEncoding !== prevGeneCellEncoding) {\n    genesDownstreamGCellG.selectAll('*').remove();\n  }\n\n  switch (geneCellEncoding) {\n    case 'distribution':\n      plotBeeswarm(genesDownstreamGCellG);\n      break;\n\n    case 'array':\n      plotArray(genesDownstreamGCellG, getArrayNumCols(genesDownstream), {\n        tooltipTitleGetter: arrayTooltipTitleGetter,\n        instanceCache: geneArrayInstances.downstream,\n        onMouseEnter: geneArrayInstanceMouseEnterHandler,\n        onMouseLeave: geneArrayInstanceMouseLeaveHandler,\n      });\n      break;\n\n    case 'number':\n    case 'percent':\n    default: {\n      const valueScale =\n        geneCellEncoding === 'percent' ? percentScale : categorySizeScale;\n\n      const valueGetter =\n        geneCellEncoding === 'percent'\n          ? (d) => d.length / d.size\n          : (d) => d.length;\n\n      plotBox(genesDownstreamGCellG, valueScale, valueGetter, {\n        showText: false,\n        cellWidth: genesDownstreamScale.bandwidth(),\n        fillColor: DEFAULT_COLOR_MAP,\n        showTooltip: true,\n        tooltipTitleGetter: boxTooltipTitleGetter,\n      });\n\n      break;\n    }\n  }\n\n  // Draw border\n  genesDownstreamG\n    .selectAll('.gene-downstream-border')\n    .data(Object.values(categories), (d) => d.name)\n    .join('rect')\n    .attr('class', 'gene-downstream-border')\n    .attr('fill', 'none')\n    .attr(\n      'stroke',\n      (d, i) => DEFAULT_COLOR_MAP_LIGHT[i % DEFAULT_COLOR_MAP_LIGHT.length]\n    )\n    .attr('stroke-width', '1')\n    .attr('x', 0)\n    .attr('y', (d, i) => i * rowHeight + paddingTop)\n    .attr('width', genesDownstreamScale.bandwidth())\n    .attr('height', rowHeight);\n\n  // Draw distance bars\n  genesDownstreamG\n    // Same reason we're using a join here as for the text labels above\n    .selectAll('.gene-downstream-distance-bar')\n    .data((d) => [d])\n    .join('rect')\n    .attr('class', 'gene-downstream-distance-bar')\n    .attr('fill', '#bbbbbb')\n    .attr('x', genesDownstreamScale.bandwidth() / 2 - distanceBarWidth / 2)\n    .attr('y', Object.values(categories).length * rowHeight + paddingTop)\n    .attr('width', distanceBarWidth)\n    .attr('height', (d) => distanceHeightScale(d.absDistance));\n\n  // ---------------------------------------------------------------------------\n  // Draw gene distance axis\n\n  const distRange = Math.ceil((maxVisibleAbsDist - minVisibleAbsDist) / 1e5);\n  const distStep = Math.ceil(distRange / 4);\n  const tickValues =\n    distRange <= 1\n      ? [minVisibleAbsDist, maxVisibleAbsDist]\n      : Array(4)\n          .fill()\n          .map(\n            (v, i) =>\n              Math.ceil(minVisibleAbsDist / 1e5) * 1e5 + i * (distStep * 1e5)\n          );\n\n  svg\n    .select('#gene-distance-axis')\n    .attr(\n      'transform',\n      `translate(0, ${\n        Object.values(categories).length * rowHeight + paddingTop\n      })`\n    )\n    .call(\n      axisRight(distanceHeightScale)\n        .tickSize(width)\n        .tickFormat(function geneDistanceAxisTickFormat(d) {\n          const s = (d / 1e5).toFixed(0);\n          return this.parentNode.nextSibling\n            ? s\n            : `${s} kbps distance to enhancer`;\n        })\n        .tickValues(tickValues)\n    )\n    .call((g) => g.select('.domain').remove())\n    .call((g) =>\n      g\n        .selectAll('.tick line')\n        .attr('stroke', '#bbbbbb')\n        .attr('stroke-width', 0.5)\n        .attr('stroke-dasharray', '4,4')\n    )\n    .call((g) =>\n      g\n        .selectAll('.tick text')\n        .attr('fill', '#bbbbbb')\n        .attr('x', width / 2)\n        .attr('dy', 1)\n        .attr('text-anchor', 'middle')\n        .attr('dominant-baseline', 'hanging')\n    );\n};\n\nconst EnhancerGenesPlot = React.memo(function EnhancerGenesPlot() {\n  const chromInfo = useChromInfo();\n  const showTooltip = useShowTooltip();\n\n  const sampleSelection = useRecoilValue(sampleSelectionState);\n  const sampleGroupSelectionSizes = useRecoilValue(\n    sampleGroupSelectionSizesState\n  );\n  const geneCellEncoding = useRecoilValue(enhancerGenesCellEncodingState);\n  const position = useRecoilValue(focusVariantPositionWithAssembly(chromInfo));\n  const relPosition = useRecoilValue(focusVariantRelPositionState);\n  const strPosition = useRecoilValue(focusVariantStrPositionState);\n  const genePadding = useRecoilValue(enhancerGenesPaddingState);\n  const variant = useRecoilValue(focusVariantState);\n\n  const [plotEl, setPlotEl] = useRecoilState(enhancerGenesSvgState);\n\n  const [tile, setTile] = useState(null);\n  const [isLoadingTile, setIsLoadingTile] = useState(null);\n  const [tilesetInfo, setTilesetInfo] = useState(null);\n  const [width, setWidth] = useState(null);\n  const prevWidth = usePrevious(width);\n  const prevGeneCellEncoding = usePrevious(geneCellEncoding);\n\n  useEffect(() => {\n    let active = true;\n\n    if (position === null || tilesetInfo === null) return undefined;\n\n    const tileWidth = getTileWidth(tilesetInfo);\n    const tileXPos = Math.floor(position / tileWidth);\n    const tileId = `${uuid}.${tilesetInfo.max_zoom}.${tileXPos}`;\n\n    setIsLoadingTile(true);\n    fetchTile(tileId).then((_tile) => {\n      if (active) {\n        setIsLoadingTile(false);\n        setTile(filterByPosition(_tile[tileId], position));\n      }\n    });\n\n    return () => {\n      active = false;\n    };\n  }, [position, tilesetInfo]);\n\n  const plotElRef = useCallback(\n    (node) => {\n      setPlotEl(node);\n    },\n    [setPlotEl]\n  );\n\n  // Derived State\n  const isInit = useMemo(() => !!tilesetInfo, [tilesetInfo]);\n\n  const data = useMemo(\n    () => {\n      if (!tile) return undefined;\n\n      let maxScore = 0;\n      let minAbsDistance = Infinity;\n      let maxAbsDistance = 0;\n      const genes = {};\n      const categoryAggregation = {};\n\n      Object.entries(categories).forEach(([name, category]) => {\n        categoryAggregation[name] = {\n          category,\n          numEnhancers: 0,\n        };\n      });\n\n      const distComparator = (a, b) => a.absDistance - b.absDistance;\n      const genesUpstreamByDist = new TinyQueue([], distComparator);\n      const genesDownstreamByDist = new TinyQueue([], distComparator);\n\n      tile.forEach((entry) => {\n        const sample = entry.fields[10];\n\n        // Exclude samples that have been deselected\n        if (!sampleSelection[SAMPLE_IDX[sample]]) return;\n\n        const geneName = entry.fields[6];\n\n        if (!genes[geneName]) {\n          const relGenePos = +entry.fields[4];\n          const distance = relGenePos - relPosition;\n          const isDownstream = distance > 0;\n          const absDistance = Math.abs(distance);\n          genes[geneName] = {\n            name: geneName,\n            position: relGenePos,\n            absDistance,\n            isDownstream,\n            samplesByCategory: {},\n          };\n\n          Object.values(categories).forEach(({ name, size }) => {\n            genes[geneName].samplesByCategory[name] = [];\n            genes[geneName].samplesByCategory[name].size =\n              sampleGroupSelectionSizes[name];\n          });\n\n          minAbsDistance = Math.min(minAbsDistance, absDistance);\n          maxAbsDistance = Math.max(maxAbsDistance, absDistance);\n\n          if (isDownstream) genesDownstreamByDist.push(genes[geneName]);\n          else genesUpstreamByDist.push(genes[geneName]);\n        }\n\n        genes[geneName].samplesByCategory[samples[sample].category.name].push({\n          gene: geneName,\n          sample,\n          sampleCategory: samples[sample].category.name,\n          value: entry.importance,\n        });\n        maxScore = Math.max(maxScore, entry.importance);\n        categoryAggregation[samples[sample].category.name].numEnhancers++;\n      });\n\n      const genesDownstreamByDistArr = [];\n      while (genesDownstreamByDist.length)\n        genesDownstreamByDistArr.push(genesDownstreamByDist.pop());\n\n      const genesUpstreamByDistArr = [];\n      while (genesUpstreamByDist.length)\n        genesUpstreamByDistArr.push(genesUpstreamByDist.pop());\n\n      genesDownstreamByDistArr.forEach((gene, i) => {\n        const prevGene = genesDownstreamByDistArr[i - 1];\n        gene.relDistance =\n          gene.position - ((prevGene && prevGene.position) || relPosition);\n      });\n\n      genesUpstreamByDistArr.forEach((gene, i) => {\n        const prevGene = genesDownstreamByDistArr[i - 1];\n        gene.relDistance =\n          ((prevGene && prevGene.position) || relPosition) - gene.position;\n      });\n\n      return {\n        minAbsDistance,\n        maxAbsDistance,\n        maxScore,\n        genes,\n        genesDownstreamByDist: genesDownstreamByDistArr,\n        genesUpstreamByDist: genesUpstreamByDistArr,\n        categoryAggregation,\n      };\n    },\n    // `relPosition` is excluded on purpose because `tile` is already updated\n    // when `relPosition` updates\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [tile, sampleGroupSelectionSizes, sampleSelection]\n  );\n\n  // Initialization\n  useEffect(\n    () => {\n      (async () => {\n        const response = await fetch(`${server}/tileset_info/?d=${uuid}`);\n        const results = await response.json();\n\n        if (results[uuid]) setTilesetInfo(results[uuid]);\n      })();\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    []\n  );\n\n  // Rendering\n  const classes = useStyles();\n\n  useLayoutEffect(\n    () => {\n      if (!plotEl) return undefined;\n\n      const measure = () =>\n        window.requestAnimationFrame(() => {\n          const currWidth = plotEl.getBoundingClientRect().width;\n          if (currWidth !== prevWidth) setWidth(currWidth);\n        });\n\n      measure();\n\n      window.addEventListener('resize', measure);\n      window.addEventListener('orientationchange', measure);\n\n      return () => {\n        window.removeEventListener('resize', measure);\n        window.removeEventListener('orientationchange', measure);\n      };\n    },\n    // `prevWidth` is ommitted on purpose to avoid circular updates.\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [plotEl]\n  );\n\n  const tooltipClasses = [];\n  for (let i = 0; i < useTooltipStyles.length; i++) {\n    tooltipClasses.push(useTooltipStyles[i]());\n  }\n\n  useEffect(\n    () => {\n      plotEnhancerGeneConnections(plotEl, width, data, {\n        geneCellEncoding,\n        prevGeneCellEncoding,\n        genePadding,\n        showTooltip,\n        classes,\n        tooltipClasses,\n        position: strPosition,\n        variant,\n      });\n    },\n    // `prevGeneCellEncoding` is ommitted on purpose to avoid circular updates.\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [plotEl, width, data, geneCellEncoding, genePadding, showTooltip]\n  );\n\n  return (\n    <Grid\n      className={classes.root}\n      container\n      justify=\"center\"\n      alignItems=\"center\"\n    >\n      {isInit && !isLoadingTile ? (\n        <Grid item className={classes.plot}>\n          <svg ref={plotElRef} className={classes.plotSvg}>\n            <g id=\"enhancers\"></g>\n            <g id=\"gene-distance-axis\"></g>\n            <g id=\"genes-upstream\"></g>\n            <g id=\"genes-downstream\"></g>\n          </svg>\n        </Grid>\n      ) : (\n        <CircularProgress color=\"inherit\" />\n      )}\n    </Grid>\n  );\n});\n\nexport default EnhancerGenesPlot;\n","import React from 'react';\nimport { useRecoilValue } from 'recoil';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport EnhancerGenesInfo from './EnhancerGenesInfo';\nimport EnhancerGenesHelp from './EnhancerGenesHelp';\nimport EnhancerGenesSettings from './EnhancerGenesSettings';\nimport EnhancerGenesPlot from './EnhancerGenesPlot';\nimport TitleBar from './TitleBar';\n\nimport { focusVariantState, useEnhancerGenesShowInfos } from './state';\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    // marginLeft: '-8px',\n  },\n  plot: {\n    minHeight: '6rem',\n  },\n}));\n\nconst EnhancerGenes = React.memo(function EnhancerGenes() {\n  const focusVariant = useRecoilValue(focusVariantState);\n\n  const classes = useStyles();\n\n  return (\n    <div className={classes.root}>\n      <TitleBar\n        id=\"enhancer-gene\"\n        title=\"Enhancer-Gene Connections\"\n        popoverDirection=\"top\"\n        useShowInfo={useEnhancerGenesShowInfos}\n        Info={EnhancerGenesInfo}\n        Help={EnhancerGenesHelp}\n        Settings={EnhancerGenesSettings}\n      />\n      <div className={classes.plot}>\n        {focusVariant && <EnhancerGenesPlot />}\n      </div>\n    </div>\n  );\n});\n\nexport default EnhancerGenes;\n","import React, { useMemo } from 'react';\nimport { useRecoilValue } from 'recoil';\nimport Typography from '@material-ui/core/Typography';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport { useChromInfo } from './ChromInfoProvider';\n\nimport {\n  dnaAccessLabelShowInfoState,\n  focusVariantPositionWithAssembly,\n  xDomainEndAbsWithAssembly,\n  xDomainStartAbsWithAssembly,\n} from './state';\nimport { toFixed } from './utils';\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    display: 'flex',\n    justifyContent: 'space-between',\n  },\n  text: {\n    fontSize: '0.8rem',\n  },\n}));\n\nconst DnaAccessibilityInfo = React.memo(function DnaAccessibilityInfo() {\n  const chromInfo = useChromInfo();\n\n  const showInfo = useRecoilValue(dnaAccessLabelShowInfoState);\n  const focusVariantPosition = useRecoilValue(\n    focusVariantPositionWithAssembly(chromInfo)\n  );\n  const xDomainStartAbs = useRecoilValue(\n    xDomainStartAbsWithAssembly(chromInfo)\n  );\n  const xDomainEndAbs = useRecoilValue(xDomainEndAbsWithAssembly(chromInfo));\n\n  const classes = useStyles();\n\n  const dnaAccessibilityRegionSize = useMemo(\n    () =>\n      focusVariantPosition\n        ? 5\n        : Math.round((xDomainEndAbs - xDomainStartAbs) / 1000),\n    [focusVariantPosition, xDomainStartAbs, xDomainEndAbs]\n  );\n\n  if (!showInfo) return '';\n\n  return (\n    <div className={classes.root}>\n      <span></span>\n      <Typography align=\"center\" className={classes.text} noWrap>\n        {toFixed(dnaAccessibilityRegionSize, 1)}{' '}\n        <abbr title=\"kilo base pairs\">kbp</abbr>\n      </Typography>\n      <span></span>\n    </div>\n  );\n});\n\nexport default DnaAccessibilityInfo;\n","import React from 'react';\nimport Typography from '@material-ui/core/Typography';\n\nconst DnaAccessibilityHelp = React.memo(function DnaAccessibilityHelp() {\n  return (\n    <Typography>\n      This panel visualizes the DNA accessibility of all 131 samples. Each track\n      is individually normalized. Mouse over a track to see the underlying\n      value. To focus on a specific locus specify a focus variant.\n    </Typography>\n  );\n});\n\nexport default DnaAccessibilityHelp;\n","import React, { useCallback } from 'react';\nimport Box from '@material-ui/core/Box';\nimport IconButton from '@material-ui/core/IconButton';\nimport RadioButtonCheckedIcon from '@material-ui/icons/RadioButtonChecked';\nimport RadioButtonUncheckedIcon from '@material-ui/icons/RadioButtonUnchecked';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport FormLabel from '@material-ui/core/FormLabel';\nimport RadioGroup from '@material-ui/core/RadioGroup';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport { useDnaAccessLabelStyle } from './state';\n\nconst useStyles = makeStyles((theme) => ({\n  iconRadioLegend: {\n    margin: theme.spacing(2, 0, 0.25, 0),\n  },\n}));\n\nconst DnaAccessibilitySettings = React.memo(\n  function DnaAccessibilitySettings() {\n    const [\n      dnaAccessLabelStyle,\n      setDnaAccessLabelStyle,\n    ] = useDnaAccessLabelStyle();\n\n    const changeDnaAccessLabelStyle = useCallback(\n      (value) => () => {\n        setDnaAccessLabelStyle(value);\n      },\n      [setDnaAccessLabelStyle]\n    );\n\n    // On every render\n    const classes = useStyles();\n\n    return (\n      <React.Fragment>\n        <Box m={1}>\n          <FormControl component=\"fieldset\">\n            <FormLabel component=\"legend\" className={classes.iconRadioLegend}>\n              Labels\n            </FormLabel>\n            <RadioGroup\n              aria-label=\"dnaAccessLabelStyle\"\n              name=\"dnaAccessLabelStyle\"\n              value={dnaAccessLabelStyle}\n            >\n              <FormControlLabel\n                label=\"Indicator\"\n                value=\"indicator\"\n                className={classes.iconRadio}\n                control={\n                  <IconButton\n                    size=\"small\"\n                    onClick={changeDnaAccessLabelStyle('indicator')}\n                  >\n                    {dnaAccessLabelStyle === 'indicator' ? (\n                      <RadioButtonCheckedIcon\n                        className={classes.iconRadioActive}\n                        fontSize=\"inherit\"\n                      />\n                    ) : (\n                      <RadioButtonUncheckedIcon fontSize=\"inherit\" />\n                    )}\n                  </IconButton>\n                }\n              />\n              <FormControlLabel\n                label=\"Text\"\n                value=\"text\"\n                className={classes.iconRadio}\n                control={\n                  <IconButton\n                    size=\"small\"\n                    onClick={changeDnaAccessLabelStyle('text')}\n                  >\n                    {dnaAccessLabelStyle === 'text' ? (\n                      <RadioButtonCheckedIcon\n                        className={classes.iconRadioActive}\n                        fontSize=\"inherit\"\n                      />\n                    ) : (\n                      <RadioButtonUncheckedIcon fontSize=\"inherit\" />\n                    )}\n                  </IconButton>\n                }\n              />\n              <FormControlLabel\n                label=\"Hidden\"\n                value=\"hidden\"\n                className={classes.iconRadio}\n                control={\n                  <IconButton\n                    size=\"small\"\n                    onClick={changeDnaAccessLabelStyle('hidden')}\n                  >\n                    {dnaAccessLabelStyle === 'hidden' ? (\n                      <RadioButtonCheckedIcon\n                        className={classes.iconRadioActive}\n                        fontSize=\"inherit\"\n                      />\n                    ) : (\n                      <RadioButtonUncheckedIcon fontSize=\"inherit\" />\n                    )}\n                  </IconButton>\n                }\n              />\n            </RadioGroup>\n          </FormControl>\n        </Box>\n      </React.Fragment>\n    );\n  }\n);\n\nexport default DnaAccessibilitySettings;\n","import React, { useCallback, useMemo } from 'react';\nimport { useRecoilValue, useSetRecoilState } from 'recoil';\nimport Grid from '@material-ui/core/Grid';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { deepClone, pipe } from '@flekschas/utils';\nimport { HiGlassComponent } from 'higlass';\n\nimport { useChromInfo } from './ChromInfoProvider';\nimport DnaAccessibilityInfo from './DnaAccessibilityInfo';\nimport DnaAccessibilityHelp from './DnaAccessibilityHelp';\nimport DnaAccessibilitySettings from './DnaAccessibilitySettings';\n\nimport TitleBar from './TitleBar';\n\nimport {\n  dnaAccessLabelStyleState,\n  focusGeneEndWithAssembly,\n  focusGeneStartWithAssembly,\n  focusVariantPositionWithAssembly,\n  higlassDnaAccessState,\n  sampleSelectionState,\n  useDnaAccessShowInfos,\n  variantTracksState,\n  variantYScaleState,\n  xDomainEndAbsWithAssembly,\n  xDomainStartAbsWithAssembly,\n} from './state';\nimport {\n  DEFAULT_DNA_ACCESSIBILITY_ROW_SELECTION,\n  DEFAULT_VIEW_CONFIG_DNA_ACCESSIBILITY,\n} from './constants';\nimport useDebounce from './use-debounce';\n\nimport {\n  updateViewConfigFocusVariant,\n  updateViewConfigVariantYScale,\n  updateViewConfigXDomain,\n  updateViewConfigVariantTracks,\n} from './view-config';\n\nimport 'higlass/dist/hglib.css';\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    position: 'absolute',\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0,\n  },\n  grow: {\n    flexGrow: 1,\n  },\n}));\n\nconst updateViewConfigDnaAccessLabels = (labels) => (viewConfig) => {\n  viewConfig.views[0].tracks.top[3].options.showRowLabels =\n    !labels || labels === 'hidden' ? false : labels;\n  return viewConfig;\n};\n\nconst getDnaAccessXDomain = (\n  focusVariantPosition,\n  focusGeneStart,\n  focusGeneEnd,\n  xDomainStartAbs,\n  xDomainEndAbs\n) => {\n  const enhancerViewRange = xDomainEndAbs - xDomainStartAbs;\n  const enhancerViewCenter = xDomainStartAbs + enhancerViewRange / 2;\n\n  if (focusVariantPosition) {\n    if (\n      enhancerViewRange < 5000 &&\n      Math.abs(enhancerViewCenter - focusVariantPosition) < 1000\n    ) {\n      return [xDomainStartAbs, xDomainEndAbs];\n    }\n    return [focusVariantPosition - 2500, focusVariantPosition + 2500];\n  }\n\n  if (focusGeneStart && focusGeneEnd) {\n    const midPos = focusGeneStart + (focusGeneEnd - focusGeneStart) / 2;\n\n    if (\n      enhancerViewRange < 5000 &&\n      enhancerViewCenter > focusGeneStart &&\n      enhancerViewCenter < focusGeneEnd\n    ) {\n      return [xDomainStartAbs, xDomainEndAbs];\n    }\n\n    return [midPos - 2500, midPos + 2500];\n  }\n\n  return [xDomainStartAbs, xDomainEndAbs];\n};\n\nconst updateViewConfigDnaAccessXDomain = (...args) =>\n  updateViewConfigXDomain(...getDnaAccessXDomain(...args), { force: true });\n\nconst updateViewConfigRowSelection = (selection) => (viewConfig) => {\n  viewConfig.views[0].tracks.top[3].options.rowSelections = DEFAULT_DNA_ACCESSIBILITY_ROW_SELECTION.filter(\n    (rowId, i) => selection[i]\n  );\n  return viewConfig;\n};\n\nconst DnaAccessibility = React.memo(function DnaAccessibility() {\n  const chromInfo = useChromInfo();\n\n  const setHiglassDnaAccess = useSetRecoilState(higlassDnaAccessState);\n\n  const sampleSelection = useRecoilValue(sampleSelectionState);\n  const labelStyle = useRecoilValue(dnaAccessLabelStyleState);\n  const variantYScale = useRecoilValue(variantYScaleState);\n  const variantTracks = useRecoilValue(variantTracksState);\n  const focusGeneStart = useRecoilValue(focusGeneStartWithAssembly(chromInfo));\n  const focusGeneEnd = useRecoilValue(focusGeneEndWithAssembly(chromInfo));\n  const focusVariantPosition = useRecoilValue(\n    focusVariantPositionWithAssembly(chromInfo)\n  );\n\n  const xDomainStartAbsDb = useDebounce(\n    useRecoilValue(xDomainStartAbsWithAssembly(chromInfo)),\n    500\n  );\n  const xDomainEndAbsDb = useDebounce(\n    useRecoilValue(xDomainEndAbsWithAssembly(chromInfo)),\n    500\n  );\n\n  const higlassInitHandler = useCallback(\n    (higlassInstance) => {\n      if (higlassInstance !== null) {\n        setHiglassDnaAccess(higlassInstance.api);\n      }\n    },\n    [setHiglassDnaAccess]\n  );\n\n  const viewConfig = useMemo(\n    () =>\n      pipe(\n        updateViewConfigVariantTracks(variantTracks),\n        updateViewConfigFocusVariant(focusVariantPosition, [2]),\n        updateViewConfigVariantYScale(variantYScale),\n        updateViewConfigDnaAccessLabels(labelStyle),\n        updateViewConfigDnaAccessXDomain(\n          focusVariantPosition,\n          focusGeneStart,\n          focusGeneEnd,\n          xDomainStartAbsDb,\n          xDomainEndAbsDb\n        ),\n        updateViewConfigRowSelection(sampleSelection)\n      )(deepClone(DEFAULT_VIEW_CONFIG_DNA_ACCESSIBILITY)),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [\n      // `xDomainStartAbs` and `xDomainEndAbs` are ommitted on purpose to avoid\n      // updating the view-config on every pan or zoom event.\n      variantTracks,\n      focusVariantPosition,\n      focusGeneStart,\n      focusGeneEnd,\n      xDomainStartAbsDb,\n      xDomainEndAbsDb,\n      variantYScale,\n      labelStyle,\n      chromInfo,\n      sampleSelection,\n    ]\n  );\n\n  // On every render\n  const classes = useStyles();\n\n  return (\n    <Grid container direction=\"column\" className={classes.root}>\n      <TitleBar\n        id=\"dna-accessibility\"\n        title=\"DNA Accessibility\"\n        useShowInfo={useDnaAccessShowInfos}\n        Info={DnaAccessibilityInfo}\n        Help={DnaAccessibilityHelp}\n        Settings={DnaAccessibilitySettings}\n      />\n      <Grid item container direction=\"column\" className={classes.grow}>\n        <HiGlassComponent\n          ref={higlassInitHandler}\n          viewConfig={viewConfig}\n          options={{\n            sizeMode: 'scroll',\n            pixelPreciseMarginPadding: true,\n            containerPaddingX: 0,\n            containerPaddingY: 0,\n            viewMarginTop: 0,\n            viewMarginBottom: 0,\n            viewMarginLeft: 0,\n            viewMarginRight: 0,\n            viewPaddingTop: 0,\n            viewPaddingBottom: 0,\n            viewPaddingLeft: 0,\n            viewPaddingRight: 16,\n            globalMousePosition: true,\n          }}\n        />\n      </Grid>\n    </Grid>\n  );\n});\n\nexport default DnaAccessibility;\n","import React, { useEffect } from 'react';\nimport { useRecoilState } from 'recoil';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport Grid from '@material-ui/core/Grid';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport AppSidebar from './AppSidebar';\nimport AppTopbar from './AppTopbar';\nimport EnhancerRegions from './EnhancerRegions';\nimport EnhancerGenes from './EnhancerGenes';\nimport DnaAccessibility from './DnaAccessibility';\nimport ModalProvider from './ModalProvider';\nimport TooltipProvider from './TooltipProvider';\n\nimport {\n  focusGeneOptionState,\n  focusVariantOptionState,\n  useFocusGene,\n  useFocusVariant,\n} from './state';\n\nimport { GENE_SEARCH_URL, VARIANT_SEARCH_URL } from './constants';\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    position: 'absolute',\n    display: 'flex',\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0,\n  },\n  toolbar: theme.mixins.toolbar,\n  content: {\n    flexGrow: 1,\n    padding: theme.spacing(1),\n    backgroundColor: 'white',\n  },\n  grow: {\n    flexGrow: 1,\n  },\n  separator: {\n    zIndex: 1,\n    margin: `-${theme.spacing(1)}px 0`,\n    width: 1,\n    background: theme.palette.grey['300'],\n  },\n  enhancerWrapper: {\n    position: 'relative',\n    flexGrow: 1,\n    margin: '-8px 0 -8px -8px',\n  },\n  enhancer: {\n    position: 'absolute',\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0,\n    overflowY: 'auto',\n    '&> div': {\n      minHeight: '100%',\n    },\n  },\n  enhancerRegions: {\n    position: 'relative',\n    flexGrow: 1,\n  },\n  enhancerGenes: {\n    position: 'relative',\n  },\n  dnaAccessibility: {\n    position: 'relative',\n    width: '20rem',\n    margin: '-8px -8px -8px 0',\n  },\n}));\n\nconst AppMain = React.memo(function AppMain() {\n  const [focusGene, setFocusGene] = useFocusGene();\n  const [focusVariant, setFocusVariant] = useFocusVariant();\n\n  const [focusGeneOption, setFocusGeneOption] = useRecoilState(\n    focusGeneOptionState\n  );\n  const [focusVariantOption, setFocusVariantOption] = useRecoilState(\n    focusVariantOptionState\n  );\n\n  const clearFocusGene = () => {\n    setFocusGene('');\n    setFocusGeneOption(null);\n  };\n\n  const focusGeneChangeHandler = (newValue) => {\n    if (newValue) {\n      setFocusGene(newValue.geneName);\n      setFocusGeneOption(newValue);\n    } else {\n      clearFocusGene();\n    }\n  };\n\n  const clearFocusVariant = () => {\n    setFocusVariant('');\n    setFocusVariantOption(null);\n  };\n\n  const focusVariantChangeHandler = (newValue) => {\n    if (newValue) {\n      setFocusVariant(newValue.geneName);\n      setFocusVariantOption(newValue);\n    } else {\n      clearFocusVariant();\n    }\n  };\n\n  const classes = useStyles();\n\n  // Initialize focus gene/variant options\n  useEffect(\n    () => {\n      (async () => {\n        if (focusGene && !focusGeneOption) {\n          const r = await fetch(`${GENE_SEARCH_URL}&ac=${focusGene}`);\n          const results = await r.json();\n          const result = results[0];\n          result.type = 'gene';\n          focusGeneChangeHandler(results[0]);\n        }\n        if (focusVariant && !focusVariantOption) {\n          const r = await fetch(`${VARIANT_SEARCH_URL}&ac=${focusVariant}`);\n          const results = await r.json();\n          const result = results[0];\n          result.type = 'variant';\n          focusVariantChangeHandler(results[0]);\n        }\n      })();\n    },\n    // Execute only once on initialization\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    []\n  );\n\n  return (\n    <div className={classes.root}>\n      <ModalProvider>\n        <CssBaseline />\n        <AppTopbar />\n        <AppSidebar />\n        <TooltipProvider>\n          <Grid\n            container\n            direction=\"column\"\n            className={classes.content}\n            wrap=\"nowrap\"\n          >\n            <div className={classes.toolbar} />\n            <Grid container className={classes.grow} wrap=\"nowrap\">\n              <div className={classes.enhancerWrapper}>\n                <div className={classes.enhancer}>\n                  <Grid container direction=\"column\">\n                    <Grid item className={classes.enhancerRegions}>\n                      <EnhancerRegions />\n                    </Grid>\n                    <Grid item className={classes.enhancerGenes}>\n                      <EnhancerGenes />\n                    </Grid>\n                  </Grid>\n                </div>\n              </div>\n              <div className={classes.separator} />\n              <div className={classes.dnaAccessibility}>\n                <DnaAccessibility />\n              </div>\n            </Grid>\n          </Grid>\n        </TooltipProvider>\n      </ModalProvider>\n    </div>\n  );\n});\n\nexport default AppMain;\n","import React from 'react';\n\nconst withEither = (ifEitherFn, EitherComponent) => (Component) => (props) =>\n  ifEitherFn(props) ? <EitherComponent {...props} /> : <Component {...props} />;\n\nexport default withEither;\n","import React, { useState, useEffect } from 'react';\nimport { RecoilRoot } from 'recoil';\nimport { ChromosomeInfo } from 'higlass';\nimport { pipe } from '@flekschas/utils';\nimport { createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\n\nimport AppInitializing from './AppInitializing';\nimport AppError from './AppError';\nimport ChromInfoProvider from './ChromInfoProvider';\nimport AppMain from './AppMain';\nimport withEither from './with-either';\n\nimport './App.css';\n\nconst theme = createMuiTheme({\n  palette: {\n    primary: {\n      main: '#000',\n    },\n    secondary: {\n      main: '#000',\n    },\n  },\n});\n\nconst App = () => {\n  const [chromInfo, setChromInfo] = useState(null);\n\n  useEffect(() => {\n    ChromosomeInfo('https://s3.amazonaws.com/pkerp/data/hg19/chromSizes.tsv')\n      .then((_chromInfo) => {\n        if (_chromInfo.totalLength === undefined) {\n          // Monkey patch: chrom sizes were actually unavailable...\n          // Also see https://github.com/higlass/higlass/issues/957\n          setChromInfo(false);\n        } else {\n          setChromInfo(_chromInfo);\n        }\n      })\n      .catch(() => {\n        setChromInfo(false);\n      });\n  }, []);\n\n  const Main = pipe(\n    withEither(() => chromInfo === null, AppInitializing),\n    withEither(() => chromInfo === false, AppError)\n  )(AppMain);\n\n  return (\n    <div className=\"App\">\n      <RecoilRoot>\n        <ThemeProvider theme={theme}>\n          <ChromInfoProvider chromInfo={chromInfo}>\n            <Main />\n          </ChromInfoProvider>\n        </ThemeProvider>\n      </RecoilRoot>\n    </div>\n  );\n};\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","function createAnnotationOverlayMetaTrack(HGC, ...args) {\n  if (!new.target) {\n    throw new Error(\n      'Uncaught TypeError: Class constructor cannot be invoked without \"new\"'\n    );\n  }\n\n  // Services\n  const { pubSub } = HGC.services;\n\n  class AnnotationOverlayMetaTrack {\n    constructor(context, options) {\n      const { definition, getTrackObject, onNewTilesLoaded: animate } = context;\n\n      this.animate = animate;\n      this.options = options;\n\n      this.overlaysTrack = getTrackObject(definition.overlaysTrack);\n\n      if (!this.overlaysTrack) {\n        console.warn(\n          `Overlays track (uid: ${definition.overlaysTrack}) not found`\n        );\n        return;\n      }\n\n      this.annotationTrackIds = new Set();\n      this.annotationTracks = definition.options.annotationTracks\n        .map((uid) => {\n          const track = getTrackObject(uid);\n\n          if (!track) {\n            console.warn(`Child track (uid: ${uid}) not found`);\n          } else {\n            this.annotationTrackIds.add(track.uuid);\n          }\n\n          return track;\n        })\n        .filter((track) => track);\n\n      this.annotationDrawnHandlerBound = this.annotationDrawnHandler.bind(this);\n      this.tilesDrawnEndHandlerBound = this.tilesDrawnEndHandler.bind(this);\n\n      this.drawnAnnotations = new Map();\n      this.tracksDrawingTiles = new Set();\n\n      this.pubSubs = [];\n\n      // Augment annotation tracks\n      this.annotationTracks.forEach((track) => {\n        track.subscribe('annotationDrawn', this.annotationDrawnHandlerBound);\n        track.subscribe('tilesDrawn', this.tilesDrawnEndHandlerBound);\n      });\n    }\n\n    /**\n     * Handles annotation drawn events\n     *\n     * @param  {String}  event.uid  UID of the view that triggered the event.\n     * @param  {Array}  event.viewPos  View position (i.e., [x, y, width, height])\n     *   of the drawn annotation on the screen.\n     * @param  {Array}  event.dataPos  Data position of the drawn annotation. For\n     *   example base pairs (Hi-C), or pixels (gigapixel images), or lng-lat\n     *   (geo json).\n     */\n    annotationDrawnHandler({ xStartAbs, xEndAbs, data }) {\n      this.drawnAnnotations.set(data.uid, [xStartAbs, xEndAbs]);\n    }\n\n    /**\n     * Remove this track.\n     */\n    remove() {\n      this.pubSubs.forEach(pubSub.unsubscribe);\n      this.pubSubs = undefined;\n      this.annotationTracks.forEach((track) => {\n        track.unsubscribe('annotationDrawn', this.annotationDrawnHandlerBound);\n      });\n    }\n\n    tilesDrawnEndHandler({ uuid }) {\n      if (!this.annotationTrackIds.has(uuid)) return;\n\n      this.tracksDrawingTiles.add(uuid);\n\n      if (!(this.tracksDrawingTiles.size % this.annotationTracks.length)) {\n        this.updateOverlays();\n      }\n    }\n\n    updateOverlays() {\n      this.overlaysTrack.options.extent = Array.from(\n        this.drawnAnnotations.values()\n      );\n      this.overlaysTrack.draw();\n      this.tracksDrawingTiles.clear();\n    }\n  }\n\n  return new AnnotationOverlayMetaTrack(...args);\n}\n\ncreateAnnotationOverlayMetaTrack.config = {\n  type: 'annotation-overlay',\n  availableOptions: ['annotationTracks'],\n  defaultOptions: {\n    annotationTracks: [],\n  },\n};\n\nexport default createAnnotationOverlayMetaTrack;\n","import {\n  identity,\n  maxNan,\n  maxVector,\n  meanNan,\n  minNan,\n  sumNan,\n} from '@flekschas/utils';\nimport { line } from 'd3';\n\nimport {\n  DEFAULT_COLOR_MAP,\n  DEFAULT_COLOR_MAP_LIGHT,\n  DEFAULT_COLOR_MAP_DARK,\n} from './constants';\n\nconst FLOAT_BYTES = Float32Array.BYTES_PER_ELEMENT;\n\nconst VS = `precision mediump float;\n\n  attribute vec2 aPrevPosition;\n  attribute vec2 aCurrPosition;\n  attribute vec2 aNextPosition;\n  attribute float aOffsetSign;\n  attribute float aColorIndex;\n\n  uniform sampler2D uAreaColorTex;\n  uniform float uAreaColorTexRes;\n  uniform mat3 projectionMatrix;\n  uniform mat3 translationMatrix;\n\n  uniform vec4 uLineColor;\n  uniform vec4 uNaNColor;\n  uniform float uWidth;\n  uniform int uMiter;\n\n  varying vec4 vColor;\n\n  void main(void)\n  {\n    mat3 model = projectionMatrix * translationMatrix;\n\n    if (aColorIndex <= -0.5) {\n      // Render line\n      vColor = vec4(uLineColor.rgb, 1.0);\n\n      vec4 prevGlPos = vec4((model * vec3(aPrevPosition, 1.0)).xy, 0.0, 1.0);\n      vec4 currGlPos = vec4((model * vec3(aCurrPosition, 1.0)).xy, 0.0, 1.0);\n      vec4 nextGlPos = vec4((model * vec3(aNextPosition, 1.0)).xy, 0.0, 1.0);\n\n      // Calculate the direction\n      vec2 dir = vec2(0.0);\n\n      if (currGlPos == prevGlPos) {\n        // start point uses (next - current)\n        dir = normalize(nextGlPos.xy - currGlPos.xy);\n      }\n      else if (currGlPos == nextGlPos) {\n        // end point uses (current - previous)\n        dir = normalize(currGlPos.xy - prevGlPos.xy);\n      }\n      else {\n        // somewhere in middle, needs a join:\n        // get directions from (C - B) and (B - A)\n        vec2 dirA = normalize((currGlPos.xy - prevGlPos.xy));\n        if (uMiter == 1) {\n          vec2 dirB = normalize((nextGlPos.xy - currGlPos.xy));\n          // now compute the miter join normal and length\n          vec2 tangent = normalize(dirA + dirB);\n          vec2 perp = vec2(-dirA.y, dirA.x);\n          vec2 miter = vec2(-tangent.y, tangent.x);\n          dir = tangent;\n        } else {\n          dir = dirA;\n        }\n      }\n\n      float width = (projectionMatrix * vec3(uWidth, 0.0, 0.0)).x / 2.0;\n\n      vec2 normal = vec2(-dir.y, dir.x) * width;\n      // normal.x /= aspectRatio;\n      vec4 offset = vec4(normal * aOffsetSign, 0.0, 0.0);\n      gl_Position = currGlPos + offset;\n    } else {\n      // Render area\n      float colorRowIndex = aColorIndex / uAreaColorTexRes;\n\n      vec2 colorTexIndex = vec2(\n        (aColorIndex / uAreaColorTexRes) - colorRowIndex,\n        colorRowIndex / uAreaColorTexRes\n      );\n      vColor = texture2D(uAreaColorTex, colorTexIndex);\n\n      gl_Position = vec4((model * vec3(aCurrPosition, 1.0)).xy, 0.0, 1.0);\n    }\n  }\n`;\n\nconst FS = `precision mediump float;\n\n  varying vec4 vColor;\n\n  void main() {\n    gl_FragColor = vColor;\n  }\n`;\n\nconst TILE_SIZE = 256;\n\nconst COLORMAP_GRAYS = Array(127)\n  .fill()\n  .map((x, i) => {\n    const gray = (1 - i / 127) * 0.5 + 0.5;\n    return [gray, gray, gray, 1];\n  });\n\nconst getMax = (fetchedTiles) =>\n  Object.values(fetchedTiles).reduce(\n    (maxValue, tile) => Math.max(maxValue, tile.tileData.maxNonZero),\n    -Infinity\n  );\n\nconst getNumRows = (fetchedTiles) =>\n  Object.values(fetchedTiles)[0].tileData.coarseShape[0];\n\nconst getRowMaxs = (fetchedTiles) =>\n  maxVector(\n    Object.values(fetchedTiles).map((tile) => tile.tileData.maxValueByRow)\n  );\n\nconst scaleGraphics = (graphics, xScale, drawnAtScale) => {\n  const tileK =\n    (drawnAtScale.domain()[1] - drawnAtScale.domain()[0]) /\n    (xScale.domain()[1] - xScale.domain()[0]);\n  const newRange = xScale.domain().map(drawnAtScale);\n\n  const posOffset = newRange[0];\n  graphics.scale.x = tileK;\n  graphics.position.x = -posOffset * tileK;\n};\n\nconst getNumPointsPerRow = (numRows, positions, markArea) =>\n  positions.length / numRows / 4 / (1 + markArea) - 2;\n\nconst createRidgePlotTrack = function createRidgePlotTrack(HGC, ...args) {\n  if (!new.target) {\n    throw new Error(\n      'Uncaught TypeError: Class constructor cannot be invoked without \"new\"'\n    );\n  }\n\n  const { PIXI } = HGC.libraries;\n  const { format } = HGC.libraries.d3Format;\n  const { scaleLinear } = HGC.libraries.d3Scale;\n  const { tileProxy } = HGC.services;\n\n  const createColorTexture = (colors) => {\n    const colorTexRes = Math.max(2, Math.ceil(Math.sqrt(colors.length)));\n    const rgba = new Float32Array(colorTexRes ** 2 * 4);\n    colors.forEach((color, i) => {\n      // eslint-disable-next-line prefer-destructuring\n      rgba[i * 4] = color[0]; // r\n      // eslint-disable-next-line prefer-destructuring\n      rgba[i * 4 + 1] = color[1]; // g\n      // eslint-disable-next-line prefer-destructuring\n      rgba[i * 4 + 2] = color[2]; // b\n      // eslint-disable-next-line prefer-destructuring\n      rgba[i * 4 + 3] = color[3]; // a\n    });\n\n    return [\n      PIXI.Texture.fromBuffer(rgba, colorTexRes, colorTexRes),\n      colorTexRes,\n    ];\n  };\n\n  class RidgePlotTrack extends HGC.tracks.HorizontalLine1DPixiTrack {\n    constructor(context, options) {\n      super(context, options);\n      this.updateOptions();\n\n      this.pLoading = new PIXI.Graphics();\n      this.pLoading.position.x = 0;\n      this.pLoading.position.y = 0;\n      this.pMasked.addChild(this.pLoading);\n\n      this.loadIndicator = new PIXI.Text('Loading data...', {\n        fontSize: this.labelSize || 10,\n        fill: 0x808080,\n      });\n      this.pLoading.addChild(this.loadIndicator);\n    }\n\n    initTile(tile) {\n      this.coarsifyTileValues(tile);\n    }\n\n    destroyTile() {}\n\n    binsPerTile() {\n      return this.tilesetInfo.bins_per_dimension || TILE_SIZE;\n    }\n\n    /**\n     * From HeatmapTiledPixiTrack\n     */\n    getTilePosAndDimensions(zoomLevel, tilePos, binsPerTileIn) {\n      const binsPerTile = binsPerTileIn || this.binsPerTile();\n\n      if (this.tilesetInfo.resolutions) {\n        const sortedResolutions = this.tilesetInfo.resolutions\n          .map((x) => +x)\n          .sort((a, b) => b - a);\n\n        const chosenResolution = sortedResolutions[zoomLevel];\n\n        const tileWidth = chosenResolution * binsPerTile;\n        const tileHeight = tileWidth;\n\n        const tileX = chosenResolution * binsPerTile * tilePos[0];\n        const tileY = chosenResolution * binsPerTile * tilePos[1];\n\n        return {\n          tileX,\n          tileY,\n          tileWidth,\n          tileHeight,\n        };\n      }\n\n      const xTilePos = tilePos[0];\n      const yTilePos = tilePos[1];\n\n      const minX = this.tilesetInfo.min_pos[0];\n      const minY = this.options.reverseYAxis\n        ? -this.tilesetInfo.max_pos[1]\n        : this.tilesetInfo.min_pos[1];\n\n      const tileWidth = this.tilesetInfo.max_width / 2 ** zoomLevel;\n      const tileHeight = this.tilesetInfo.max_width / 2 ** zoomLevel;\n\n      const tileX = minX + xTilePos * tileWidth;\n      const tileY = minY + yTilePos * tileHeight;\n\n      return {\n        tileX,\n        tileY,\n        tileWidth,\n        tileHeight,\n      };\n    }\n\n    updateOptions() {\n      this.selectRowsAggregationMode =\n        this.options.selectRowsAggregationMode || 'mean';\n\n      switch (this.selectRowsAggregationMode) {\n        case 'max':\n          this.selectRowsAggregationFn = maxNan;\n          break;\n\n        case 'min':\n          this.selectRowsAggregationFn = minNan;\n          break;\n\n        case 'sum':\n          this.selectRowsAggregationFn = sumNan;\n          break;\n\n        case 'mean':\n        default:\n          this.selectRowsAggregationFn = meanNan;\n          break;\n      }\n\n      this.markArea = !!this.options.markArea;\n\n      this.markAreaColor = 'grays';\n\n      this.markColor = HGC.utils.colorToHex(this.options.markColor || 'black');\n\n      this.markColorRgbNorm = this.options.markColor\n        ? HGC.utils\n            .colorToRgba(this.options.markColor)\n            .slice(0, 3)\n            .map((x) => Math.min(1, Math.max(0, x / 255)))\n        : [0, 0, 0];\n\n      [this.markColorTex, this.markColorTexRes] = createColorTexture([\n        ...COLORMAP_GRAYS,\n      ]);\n\n      this.markNumColors = COLORMAP_GRAYS.length;\n\n      this.markOpacity = Number.isNaN(+this.options.markOpacity)\n        ? 1\n        : Math.min(1, Math.max(0, +this.options.markOpacity));\n\n      this.markSize = this.options.markSize || 2;\n\n      // Number of line segments\n      const oldMarkResolution = this.markResolution;\n      this.markResolution = Math.max(\n        1,\n        Math.min(TILE_SIZE, this.options.markResolution || TILE_SIZE / 4)\n      );\n      // Given 100 (rows) x 256 (tile size). At a resolution of 1 we need:\n      // 100 x (256 / 4) x 4 = 25,600 vertices\n\n      const oldRowHeight = this.rowHeight;\n      this.rowHeight = Number.isNaN(+this.options.rowHeight)\n        ? 'auto'\n        : +this.options.rowHeight;\n\n      const oldRowPadding = this.rowPadding;\n      this.rowPadding =\n        this.rowHeight === 'auto' ? 0 : this.options.rowPadding || 0;\n\n      const oldRowNormalization = this.rowNormalization;\n      this.rowNormalization = this.options.rowNormalization || false;\n\n      const oldRowSelections = this.rowSelections;\n      this.rowSelections =\n        this.options.rowSelections || this.rowSelections || [];\n\n      const oldShowRowLabels = this.showRowLabels;\n      this.showRowLabels = this.options.showRowLabels;\n\n      if (\n        oldMarkResolution !== this.markResolution ||\n        oldRowSelections !== this.rowSelections\n      ) {\n        this.updateTiles();\n        this.updateRowLabels();\n        this.drawLabel();\n      }\n\n      if (\n        oldRowHeight !== this.rowHeight ||\n        oldRowPadding !== this.rowPadding ||\n        oldRowNormalization !== this.rowNormalization\n      ) {\n        this.updateScales();\n      }\n\n      if (oldShowRowLabels !== this.showRowLabels) {\n        this.updateRowLabels();\n        this.drawLabel();\n      }\n\n      this.rowLabelAlign = this.options.rowLabelAlign || 'left';\n      this.rowLabelSize = this.options.rowLabelSize || 12;\n\n      this.rowCategories = this.options.rowCategories || {};\n      this.rowIdToCategory = (id) => id.substring(0, id.length - 14);\n      this.rowIdToCategory = this.options.rowIdToCategory\n        ? (id) =>\n            id[this.options.rowIdToCategory.fn](\n              ...this.options.rowIdToCategory.args\n            )\n        : identity;\n    }\n\n    removeRowLabels() {\n      while (this.pAxis.children.length) {\n        this.pAxis.removeChildAt(0);\n      }\n      if (this.rowLabels) {\n        this.rowLabels.forEach((rowLabel) => {\n          rowLabel.destroy();\n        });\n        this.rowLabels = undefined;\n      }\n    }\n\n    updateRowLabels() {\n      if (!this.tilesetInfo || !this.tilesetInfo.row_infos) return;\n\n      const labels = this.rowSelections.length\n        ? this.rowSelections.map((rowIndex) =>\n            this.tilesetInfo.row_infos[rowIndex] === undefined\n              ? '?'\n              : this.rowIdToCategory(this.tilesetInfo.row_infos[rowIndex].id)\n          )\n        : this.tilesetInfo.row_infos.map(({ id }) => this.rowIdToCategory(id));\n\n      this.removeRowLabels();\n\n      if (this.showRowLabels === 'indicator') {\n        this.rowLabels = labels.map((label) => {\n          const indicator = new PIXI.Sprite(PIXI.Texture.WHITE);\n          indicator.width = this.rowLabelSize / 2;\n          indicator.height = this.rowLabelSize;\n          indicator.tint = this.rowCategories[label]\n            ? HGC.utils.colorToHex(\n                this.rowCategories[label].axisLabelColor ||\n                  DEFAULT_COLOR_MAP[\n                    this.rowCategories[label].index % DEFAULT_COLOR_MAP.length\n                  ]\n              )\n            : 0x808080;\n          return indicator;\n        });\n      } else if (this.showRowLabels) {\n        this.rowLabels = labels.map(\n          (label) =>\n            new PIXI.Text(label, {\n              fontSize: this.rowLabelSize,\n              align: this.rowLabelAlign === 'right' ? 'right' : 'left',\n              fill: this.rowCategories[label]\n                ? HGC.utils.colorToHex(\n                    this.rowCategories[label].axisLabelColor ||\n                      DEFAULT_COLOR_MAP_DARK[\n                        this.rowCategories[label].index %\n                          DEFAULT_COLOR_MAP_DARK.length\n                      ]\n                  )\n                : 0x808080,\n            })\n        );\n      }\n    }\n\n    drawLabel() {\n      if (!this.showRowLabels) {\n        if (this.rowLabels) {\n          while (this.pAxis.children.length) {\n            this.pAxis.removeChildAt(0);\n          }\n        }\n        return;\n      }\n      if (this.showRowLabels && !this.rowLabels) this.updateRowLabels();\n      if (!this.rowLabels) return;\n\n      const [width] = this.dimensions;\n      const [left, top] = this.position;\n\n      this.pAxis.position.x = this.axisAlign === 'right' ? left + width : left;\n      this.pAxis.position.y = top;\n\n      this.pAxis.clear();\n      let yStart = 0;\n\n      const xLabelOffset = this.axisAlign === 'right' ? -3 : 3;\n      const [, rowStepHeight] = this.getRowHeight();\n      const rowStepYCenter = rowStepHeight / 2;\n\n      this.rowLabels.forEach((label, i) => {\n        label.x = xLabelOffset;\n        label.y = yStart - this.rowPadding + rowStepYCenter;\n        label.anchor.x = this.axisAlign === 'right' ? 1 : 0;\n        label.anchor.y = 0.5;\n\n        yStart += rowStepHeight;\n\n        this.pAxis.addChild(label);\n      });\n    }\n\n    rerender(newOptions) {\n      this.options = newOptions;\n      this.updateOptions();\n      this.updateExistingGraphics();\n    }\n\n    hasFetchedTiles() {\n      return Object.values(this.fetchedTiles).length;\n    }\n\n    coarsifyTileValues(tile) {\n      const { tileX, tileWidth } = this.getTilePosAndDimensions(\n        tile.tileData.zoomLevel,\n        tile.tileData.tilePos\n      );\n      const [numRows] = tile.tileData.shape;\n      const binSizePx = Math.floor(TILE_SIZE / this.markResolution);\n      const binSizeBp = tileWidth / this.markResolution;\n      const binSizeBpHalf = binSizeBp / 2;\n\n      // Determine bin boundaries\n      tile.tileData.binXPos = Array(this.markResolution).fill();\n      for (let i = 0; i <= this.markResolution; i++) {\n        tile.tileData.binXPos[i] = tileX + binSizeBp * i + binSizeBpHalf;\n      }\n\n      // 1. Coarsify the dense matrix according to `this.markResolution`\n      tile.tileData.valuesByRow = Array(numRows)\n        .fill()\n        .map(() => []);\n      tile.tileData.maxValueByRow = Array(numRows).fill(-Infinity);\n\n      for (let i = 0; i < numRows; i++) {\n        for (let j = 0; j < TILE_SIZE; j += binSizePx) {\n          const meanValue = meanNan(\n            tile.tileData.dense.subarray(\n              i * TILE_SIZE + j,\n              i * TILE_SIZE + j + binSizePx\n            )\n          );\n          tile.tileData.valuesByRow[i].push(meanValue);\n          tile.tileData.maxValueByRow[i] =\n            meanValue > tile.tileData.maxValueByRow[i]\n              ? meanValue\n              : tile.tileData.maxValueByRow[i];\n        }\n      }\n\n      // 2. Sort rows\n      if (this.rowSelections.length) {\n        tile.tileData.valuesByRow = this.rowSelections\n          .map((rowIdx) => tile.tileData.valuesByRow[rowIdx])\n          .filter(identity);\n        tile.tileData.maxValueByRow = this.rowSelections\n          .map((rowIdx) => tile.tileData.maxValueByRow[rowIdx])\n          .filter(identity);\n      }\n\n      // 3. Set out shape\n      tile.tileData.coarseShape = [\n        tile.tileData.valuesByRow.length,\n        this.markResolution,\n      ];\n    }\n\n    updateTiles() {\n      Object.values(this.fetchedTiles).forEach(\n        this.coarsifyTileValues.bind(this)\n      );\n    }\n\n    updateScales() {\n      const fetchedTiles = Object.values(this.fetchedTiles);\n\n      if (!fetchedTiles.length) return;\n\n      const numRows = getNumRows(fetchedTiles);\n\n      const [rowHeight] = this.getRowHeight();\n\n      const actualTrackHeight = this.getTrackHeight(numRows, rowHeight);\n\n      const globalMax = getMax(this.fetchedTiles);\n\n      this.valueScale = scaleLinear()\n        .domain([0, globalMax])\n        .range([rowHeight, 0]);\n      this.colorIndexScale = scaleLinear()\n        .domain([0, globalMax])\n        .range([0, this.markNumColors])\n        .clamp(true);\n\n      if (this.rowNormalization) {\n        const rowMaxs = getRowMaxs(this.fetchedTiles);\n        this.rowValueScales = {};\n        this.rowColorIndexScales = {};\n        for (let i = 0; i < numRows; i++) {\n          this.rowValueScales[i] = scaleLinear()\n            .domain([0, rowMaxs[i]])\n            .range([rowHeight, 0]);\n          this.rowColorIndexScales[i] = scaleLinear()\n            .domain([0, rowMaxs[i]])\n            .range([0, this.markNumColors])\n            .clamp(true);\n        }\n        this.valueScaleByRow = (value, row) =>\n          Number.isNaN(value) ? rowHeight : this.rowValueScales[row](value);\n        this.colorIndexScaleByRow = (value, row) =>\n          Number.isNaN(value) ? -2 : this.rowColorIndexScales[row](value);\n      } else {\n        this.valueScaleByRow = (value, row) =>\n          Number.isNaN(value) ? rowHeight : this.valueScale(value);\n        this.colorIndexScaleByRow = (value, row) =>\n          Number.isNaN(value) ? -2 : this.colorIndexScale(value);\n      }\n\n      this.rowScale = scaleLinear()\n        .domain([0, numRows])\n        .range([0, actualTrackHeight + this.rowPadding]);\n    }\n\n    tilesToData(tiles, { markArea, maxRows = Infinity, rowHeight } = {}) {\n      if (!tiles.length) return [];\n\n      const numRows = Math.min(maxRows, getNumRows(tiles));\n\n      const positionsByRow = Array(numRows)\n        .fill()\n        .map(() => []);\n      const colorIndicesByRow = Array(numRows)\n        .fill()\n        .map(() => []);\n      const offsetSignsByRow = Array(numRows)\n        .fill()\n        .map(() => []);\n\n      tiles.forEach((tile) => {\n        tile.tileData.valuesByRow.forEach((values, i) => {\n          if (i >= maxRows) return;\n          values.forEach((value, j) => {\n            const x = this._xScale(tile.tileData.binXPos[j]);\n            const yStart = this.rowScale(i);\n            const y = yStart + this.valueScaleByRow(value, i);\n            // We're duplicating the point as for every point on the line we\n            // need two x,y vertices to render triangles.\n            positionsByRow[i].push(x, y, x, y);\n            colorIndicesByRow[i].push(-1, -1); // -1 refers to the line color\n            offsetSignsByRow[i].push(1, -1);\n\n            if (markArea) {\n              positionsByRow[i].push(x, y, x, yStart + rowHeight);\n              colorIndicesByRow[i].push(this.colorIndexScaleByRow(value, i), 0);\n              offsetSignsByRow[i].push(0, 0);\n            }\n          });\n        });\n      });\n\n      const size2d = markArea ? 8 : 4;\n      const size1d = markArea ? 4 : 2;\n\n      // For each row, duplicate the first and last point\n      for (let i = 0; i < numRows; i++) {\n        // Add first point pair to the beginning of the array\n        positionsByRow[i].unshift(...positionsByRow[i].slice(0, size2d));\n\n        // The very first duplicated point positions do not matter as\n        // we offset the buffer reading. Subsequent dupliations need to be\n        // taken into account though.\n        if (i > 0) {\n          colorIndicesByRow[i].unshift(\n            ...colorIndicesByRow[i].slice(0, size1d)\n          );\n          offsetSignsByRow[i].unshift(...offsetSignsByRow[i].slice(0, size1d));\n        }\n\n        // Add last point pair to the end of the array\n        positionsByRow[i].push(...positionsByRow[i].slice(-size2d));\n        colorIndicesByRow[i].push(...colorIndicesByRow[i].slice(-size1d));\n        offsetSignsByRow[i].push(...offsetSignsByRow[i].slice(-size1d));\n      }\n\n      return [\n        new Float32Array(positionsByRow.flatMap(identity)),\n        new Float32Array(colorIndicesByRow.flatMap(identity)),\n        new Float32Array(offsetSignsByRow.flatMap(identity)),\n      ];\n    }\n\n    toLineIndices(numRows, numPointsPerRow, markArea) {\n      const verticesPerLine = markArea ? 12 : 6;\n      const verticesPerPoint = markArea ? 4 : 2;\n      const indices = new Uint32Array(\n        (numPointsPerRow - 1) * numRows * verticesPerLine\n      );\n      let k = 0;\n\n      if (markArea) {\n        // Draw a line and area\n        for (let i = 0; i < numRows; i++) {\n          for (let j = 0; j < numPointsPerRow - 1; j++) {\n            // The `+2` comes from the fact that for each row of points we\n            // duplicate the first and last point.\n            const pointOffset = i * (numPointsPerRow + 2) * verticesPerPoint;\n            const p1a = pointOffset + j * verticesPerPoint;\n            const p1b = p1a + 1;\n            const p1c = p1a + 2;\n            const p1d = p1a + 3;\n            const p2a = p1a + 4;\n            const p2b = p1a + 5;\n            const p2c = p1a + 6;\n            const p2d = p1a + 7;\n\n            const indexOffset = k * verticesPerLine;\n            // Area\n            indices[indexOffset] = p1c;\n            indices[indexOffset + 1] = p1d;\n            indices[indexOffset + 2] = p2c;\n            indices[indexOffset + 3] = p2c;\n            indices[indexOffset + 4] = p1d;\n            indices[indexOffset + 5] = p2d;\n            // Line\n            indices[indexOffset + 6] = p1a;\n            indices[indexOffset + 7] = p1b;\n            indices[indexOffset + 8] = p2a;\n            indices[indexOffset + 9] = p2a;\n            indices[indexOffset + 10] = p1b;\n            indices[indexOffset + 11] = p2b;\n\n            k++;\n          }\n        }\n      } else {\n        // Just draw a line\n        for (let i = 0; i < numRows; i++) {\n          for (let j = 0; j < numPointsPerRow - 1; j++) {\n            // The `+2` comes from the fact that for each row of points we\n            // duplicate the first and last point.\n            const pointOffset = i * (numPointsPerRow + 2) * verticesPerPoint;\n            const p1a = pointOffset + j * verticesPerPoint;\n            const p1b = p1a + 1;\n            const p2a = p1a + 2;\n            const p2b = p1a + 3;\n\n            const indexOffset = k * verticesPerLine;\n            indices[indexOffset] = p1a;\n            indices[indexOffset + 1] = p1b;\n            indices[indexOffset + 2] = p2a;\n            indices[indexOffset + 3] = p2a;\n            indices[indexOffset + 4] = p1b;\n            indices[indexOffset + 5] = p2b;\n\n            k++;\n          }\n        }\n      }\n\n      return indices;\n    }\n\n    getRowHeight(numRows) {\n      const [, visibleTrackHeight] = this.dimensions;\n\n      return this.rowHeight === 'auto'\n        ? [\n            Math.floor(visibleTrackHeight / numRows),\n            Math.floor(visibleTrackHeight / numRows),\n          ]\n        : [this.rowHeight, this.rowHeight + this.rowPadding];\n    }\n\n    getTrackHeight(numRows, rowHeight) {\n      const [, visibleTrackHeight] = this.dimensions;\n\n      return this.rowHeight === 'auto'\n        ? visibleTrackHeight\n        : rowHeight * numRows + this.rowPadding * (numRows - 1);\n    }\n\n    renderLines() {\n      this.drawnAtScale = scaleLinear()\n        .domain([...this.xScale().domain()])\n        .range([...this.xScale().range()]);\n\n      const tiles = Object.values(this.fetchedTiles);\n\n      const numRows = getNumRows(tiles);\n      const [rowHeight] = this.getRowHeight(numRows);\n\n      const [positions, colorIndices, offsetSigns] = this.tilesToData(tiles, {\n        maxRows: numRows,\n        markArea: this.markArea,\n        rowHeight,\n      });\n\n      const numPointsPerRow = getNumPointsPerRow(\n        numRows,\n        positions,\n        this.markArea\n      );\n\n      const indices = this.toLineIndices(\n        numRows,\n        numPointsPerRow,\n        this.markArea\n      );\n\n      const uniforms = new PIXI.UniformGroup({\n        uLineColor: [...this.markColorRgbNorm, 1.0],\n        uNaNColor: [1.0, 1.0, 1.0, 1.0],\n        uAreaColorTex: this.markColorTex,\n        uAreaColorTexRes: this.markColorTexRes,\n        uWidth: 0.25,\n        uMiter: 1,\n      });\n\n      const shader = PIXI.Shader.from(VS, FS, uniforms);\n\n      const geometry = new PIXI.Geometry();\n      const numCoords = 2;\n      const numVerticesPoint = this.markArea ? 4 : 2;\n      geometry.addAttribute(\n        'aPrevPosition',\n        positions,\n        2, // size\n        false, // normalize\n        PIXI.TYPES.FLOAT, // type\n        FLOAT_BYTES * numCoords, // stride\n        0 // offset/start\n      );\n      geometry.addAttribute(\n        'aCurrPosition',\n        positions,\n        2, // size\n        false, // normalize\n        PIXI.TYPES.FLOAT, // type\n        FLOAT_BYTES * numCoords, // stride\n        // note that each point is duplicated, hence we need to skip over the first two\n        FLOAT_BYTES * numCoords * numVerticesPoint // offset/start\n      );\n      geometry.addAttribute(\n        'aNextPosition',\n        positions,\n        2, // size\n        false, // normalize\n        PIXI.TYPES.FLOAT, // type\n        FLOAT_BYTES * 2, // stride\n        // note that each point is duplicated, hence we need to skip over the first four\n        FLOAT_BYTES * numCoords * numVerticesPoint * 2 // offset/start\n      );\n      geometry.addAttribute('aOffsetSign', offsetSigns, 1);\n      geometry.addAttribute('aColorIndex', colorIndices, 1);\n      geometry.addIndex(indices);\n\n      const mesh = new PIXI.Mesh(geometry, shader);\n\n      const newGraphics = new PIXI.Graphics();\n      newGraphics.addChild(mesh);\n\n      // eslint-disable-next-line\n      this.pMain.x = this.position[0];\n\n      if (this.lineGraphics) {\n        this.pMain.removeChild(this.lineGraphics);\n        this.lineGraphics.destroy();\n      }\n\n      this.pMain.addChild(newGraphics);\n      this.lineGraphics = newGraphics;\n\n      scaleGraphics(this.lineGraphics, this._xScale, this.drawnAtScale);\n\n      this.draw();\n      this.animate();\n    }\n\n    // Called whenever a new tile comes in\n    updateExistingGraphics() {\n      this.updateLoadIndicator();\n      if (!this.hasFetchedTiles()) return;\n      this.updateScales();\n      this.renderLines();\n    }\n\n    updateLoadIndicator() {\n      const [left, top] = this.position;\n      this.pLoading.position.x = left + 6;\n      this.pLoading.position.y = top + 6;\n\n      if (this.fetching.size) {\n        this.pLoading.addChild(this.loadIndicator);\n      } else {\n        this.pLoading.removeChild(this.loadIndicator);\n      }\n    }\n\n    refreshTiles() {\n      super.refreshTiles();\n      this.updateLoadIndicator();\n    }\n\n    setPosition(newPosition) {\n      super.setPosition(newPosition);\n\n      [this.pMain.position.x, this.pMain.position.y] = this.position;\n    }\n\n    zoomed(newXScale, newYScale) {\n      this.xScale(newXScale);\n      this.yScale(newYScale);\n\n      if (this.lineGraphics) {\n        scaleGraphics(this.lineGraphics, newXScale, this.drawnAtScale);\n      }\n\n      this.refreshTiles();\n      this.draw();\n    }\n\n    /**\n     * Return the data currently visible at position X and Y\n     *\n     * @param {Number} trackX: The x position relative to the track's start and end\n     * @param {Number} trakcY: The y position relative to the track's start and end\n     */\n    getVisibleData(trackX, trackY) {\n      if (!this.hasFetchedTiles()) return '';\n\n      const zoomLevel = this.calculateZoomLevel();\n\n      const numRows = getNumRows(this.fetchedTiles);\n      const [, rowStepHeight] = this.getRowHeight(numRows);\n\n      // the width of the tile in base pairs\n      const tileWidth = tileProxy.calculateTileWidth(\n        this.tilesetInfo,\n        zoomLevel,\n        this.tilesetInfo.tile_size\n      );\n\n      // the position of the tile containing the query position\n      const tilePos = this._xScale.invert(trackX) / tileWidth;\n\n      // the position of query within the tile\n      let posInTileX =\n        this.tilesetInfo.tile_size * (tilePos - Math.floor(tilePos));\n      // const posInTileYNormalized = trackY / this.dimensions[1];\n      // The first track doesn't apply padding so we have to shift padding\n      // to the mouse position once\n      const rowIndex = Math.floor(\n        Math.max(0, (trackY + this.rowPadding) / rowStepHeight)\n      );\n      const rowSelection = this.rowSelections[rowIndex];\n      const tileId = this.tileToLocalId([zoomLevel, Math.floor(tilePos)]);\n      const fetchedTile = this.fetchedTiles[tileId];\n\n      let text = '';\n      let value = '<em>unknown</em>';\n\n      if (rowSelection === undefined) return text;\n\n      if (fetchedTile) {\n        if (!this.tilesetInfo.shape) {\n          posInTileX =\n            fetchedTile.tileData.dense.length * (tilePos - Math.floor(tilePos));\n        }\n\n        let index = null;\n        if (this.tilesetInfo.shape) {\n          // Accomodate data from vector sources\n          if (\n            Array.isArray(rowSelection) &&\n            this.options.selectRowsAggregationMethod === 'client'\n          ) {\n            // Need to aggregate, so `index` will actually be an array.\n            index = rowSelection.map(\n              (rowI) =>\n                this.tilesetInfo.shape[0] * rowI + Math.floor(posInTileX)\n            );\n          } else if (\n            rowSelection &&\n            this.options.selectRowsAggregationMethod === 'client'\n          ) {\n            index =\n              this.tilesetInfo.shape[0] * rowSelection + Math.floor(posInTileX);\n          } else {\n            // No need to aggregate, `index` will contain a single item.\n            index =\n              this.tilesetInfo.shape[0] * rowIndex + Math.floor(posInTileX);\n          }\n        } else {\n          index =\n            fetchedTile.tileData.dense.length * rowIndex +\n            Math.floor(posInTileX);\n        }\n\n        if (Array.isArray(index)) {\n          const values = index.map((i) => fetchedTile.tileData.dense[i]);\n          value = format('.3f')(this.selectRowsAggregationFn(values));\n          text = value;\n\n          text += '<br/>';\n          text += `${index.length}-item ${this.options.selectRowsAggregationMode}`;\n        } else {\n          value = format('.3f')(fetchedTile.tileData.dense[index]);\n          text = value;\n\n          if (Array.isArray(rowSelection)) {\n            value += '<br/>';\n            value += `${rowSelection.length}-item ${this.options.selectRowsAggregationMode}`;\n          }\n        }\n      }\n\n      // add information about the row\n      if (this.tilesetInfo.row_infos) {\n        let rowInfo = '';\n\n        if (rowSelection !== undefined) {\n          rowInfo = this.tilesetInfo.row_infos[rowSelection];\n        }\n\n        const label =\n          typeof rowInfo === 'object'\n            ? this.rowIdToCategory(rowInfo.id)\n            : rowInfo;\n\n        const color = this.rowCategories[label]\n          ? this.rowCategories[label].axisLabelColor ||\n            DEFAULT_COLOR_MAP_DARK[\n              this.rowCategories[label].index % DEFAULT_COLOR_MAP_DARK.length\n            ]\n          : '#666666';\n\n        const background = this.rowCategories[label]\n          ? this.rowCategories[label].axisLabelColor ||\n            DEFAULT_COLOR_MAP_LIGHT[\n              this.rowCategories[label].index % DEFAULT_COLOR_MAP_LIGHT.length\n            ]\n          : '#ffffff';\n\n        return `<div style=\"margin: -0.25rem; padding: 0 0.25rem; background: ${background}\"><strong style=\"color: ${color};\">${label}:</strong> ${value}</div>`;\n      }\n\n      return text;\n    }\n\n    /**\n     * Get some information to display when the mouse is over this\n     * track\n     *\n     * @param {Number} trackX: the x position of the mouse over the track\n     * @param {Number} trackY: the y position of the mouse over the track\n     *\n     * @return {string}: A HTML string containing the information to display\n     *\n     */\n    getMouseOverHtml(trackX, trackY) {\n      if (!this.tilesetInfo) return '';\n\n      return this.getVisibleData(trackX, trackY);\n    }\n\n    exportSVG() {\n      const svgns = 'http://www.w3.org/2000/svg';\n\n      let track = null;\n      let base = null;\n\n      [base, track] = super.exportSVG();\n\n      base.setAttribute('class', 'ridge-plot-track');\n      const output = document.createElement('g');\n\n      track.appendChild(output);\n      output.setAttribute(\n        'transform',\n        `translate(${this.position[0]}, ${this.position[1]})`\n      );\n\n      const tiles = Object.values(this.fetchedTiles);\n\n      const numRows = getNumRows(tiles);\n      const [rowHeight] = this.getRowHeight(numRows);\n      const stride = this.markArea ? 8 : 4;\n\n      const [positions] = this.tilesToData(tiles, {\n        maxRows: numRows,\n        markArea: this.markArea,\n        rowHeight,\n      });\n\n      const createLine = line()\n        .x((d) => d[0])\n        .y((d) => d[1]);\n\n      const posPerRow = positions.length / numRows;\n\n      const posToPoints = (pos) => {\n        const arr = [];\n        const start = stride;\n        const end = pos.length - stride;\n\n        for (let i = start; i < end; i += stride) {\n          arr.push([pos[i], pos[i + 1]]);\n        }\n\n        return arr;\n      };\n\n      let fill = this.markArea\n        ? (this.options.colorRange && this.options.colorRange[0]) || '#ffffff'\n        : 'none';\n      if (this.markArea && this.options.colorRange) {\n        const numColors = this.options.colorRange.length;\n        const defs = document.createElementNS(svgns, 'defs');\n        const linearGradient = document.createElementNS(\n          svgns,\n          'linearGradient'\n        );\n        linearGradient.setAttribute('id', 'RidgePlotGradient');\n        linearGradient.setAttribute('x1', '0');\n        linearGradient.setAttribute('y1', '1');\n        linearGradient.setAttribute('x2', '0');\n        linearGradient.setAttribute('y2', '0');\n        this.options.colorRange.forEach((color, i) => {\n          const stop = document.createElementNS(svgns, 'stop');\n          stop.setAttribute(\n            'offset',\n            `${Math.round((i / (numColors - 1)) * 100)}%`\n          );\n          stop.setAttribute('stop-color', color);\n          linearGradient.appendChild(stop);\n        });\n        defs.appendChild(linearGradient);\n        base.insertBefore(defs, base.firstChild);\n        fill = 'url(#RidgePlotGradient)';\n      }\n\n      for (let i = 0; i < numRows; i++) {\n        const arr = posToPoints(\n          positions.subarray(i * posPerRow, (i + 1) * posPerRow)\n        );\n\n        const l = document.createElement('path');\n        let d = createLine(arr);\n\n        const y0 = this.rowScale(i) + this.valueScaleByRow(0, i);\n\n        // We extend the line a little to the left and right and anchor them at\n        // y = 0 to avoid weird glitches with the fill.\n        const firstComma = d.indexOf(',');\n        const firstX = +d.substring(1, firstComma);\n        const firstY = +d.substring(firstComma + 1, d.indexOf('L'));\n        d = `M${firstX - 1},${y0}L${firstX - 1},${firstY}L${d.substring(1)}`;\n        const lastComma = d.lastIndexOf(',');\n        const lastX = +d.substring(d.lastIndexOf('L') + 1, lastComma);\n        const lastY = +d.substring(lastComma + 1);\n        d += `L${lastX + 1},${lastY}L${lastX + 1},${y0}`;\n\n        l.setAttribute('d', d);\n        l.setAttribute('fill', fill);\n        l.setAttribute('stroke', this.options.markColor || 'black');\n        l.setAttribute('stroke-width', (this.options.markSize || 2) / 8);\n\n        output.appendChild(l);\n      }\n\n      return [base, track];\n    }\n  }\n\n  return new RidgePlotTrack(...args);\n};\n\ncreateRidgePlotTrack.config = {\n  type: 'ridge-plot',\n  datatype: ['multivec'],\n  orientation: '1d',\n  name: 'RidgePlot',\n};\n\nexport default createRidgePlotTrack;\n","import createIntervalTree from 'interval-tree-1d';\n\nimport {\n  DEFAULT_COLOR_MAP,\n  DEFAULT_COLOR_MAP_DARK,\n  DEFAULT_COLOR_MAP_LIGHT,\n  EPS,\n} from './constants';\nimport { contains, dashedXLineTo, toFixed } from './utils';\n\nconst VS = `\n  precision mediump float;\n  attribute vec2 aPosition;\n  attribute float aOpacity;\n  attribute float aHighlight;\n\n  uniform mat3 projectionMatrix;\n  uniform mat3 translationMatrix;\n  uniform float uPointSize;\n\n  varying float vHighlight;\n  varying float vOpacity;\n\n  void main(void)\n  {\n    vHighlight = aHighlight;\n    vOpacity = aOpacity;\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aPosition, 1.0)).xy, 0.0, 1.0);\n    gl_PointSize = uPointSize;\n  }\n`;\n\nconst FS = `\n  precision mediump float;\n\n  uniform vec4 uColor;\n  uniform vec4 uColorHighlight;\n\n  varying float vHighlight;\n  varying float vOpacity;\n\n  void main() {\n    float isNotFocused = 1.0 - vHighlight;\n\n    float r = uColor.r * isNotFocused + uColorHighlight.r * vHighlight;\n    float g = uColor.g * isNotFocused + uColorHighlight.g * vHighlight;\n    float b = uColor.b * isNotFocused + uColorHighlight.b * vHighlight;\n\n    gl_FragColor = vec4(r, g, b, 1.0) * vOpacity;\n  }\n`;\n\n// prettier-ignore\nconst pointToPosition = (pt) => [\n  // top-left\n  pt.cX - pt.widthHalf, pt.y,\n  // top-right\n  pt.cX + pt.widthHalf, pt.y,\n  // bottom-right\n  pt.cX + pt.widthHalf, pt.y + pt.height,\n  // pt.cX + pt.widthHalf, pt.y + pt.height,\n  // bottom-left\n  pt.cX - pt.widthHalf, pt.y + pt.height,\n  // pt.cX - pt.widthHalf, pt.y,\n];\n\nconst pointToIndex = (pt, i) => {\n  const base = i * 4;\n  return [base, base + 1, base + 2, base + 2, base + 3, base];\n};\n\nconst pointToOpacity = (pt) => [pt.opacity, pt.opacity, pt.opacity, pt.opacity];\n\nconst pointToHighlight = (pt) => [\n  pt.highlight,\n  pt.highlight,\n  pt.highlight,\n  pt.highlight,\n];\n\nconst getItemDistance = (item) =>\n  Math.abs(\n    +item.fields[1] +\n      (+item.fields[2] - +item.fields[1]) / 2 -\n      (+item.fields[4] + (+item.fields[4] - +item.fields[5]) / 2)\n  );\n\nconst getMaxDistance = (fetchedTiles) =>\n  Object.values(fetchedTiles).reduce(\n    (maxDist, tile) =>\n      Math.max(\n        maxDist,\n        tile.tileData.reduce(\n          (maxDistItem, item) => Math.max(maxDistItem, item.distance),\n          0\n        )\n      ),\n    0\n  );\n\nconst scaleScalableGraphics = (graphics, xScale, drawnAtScale) => {\n  const tileK =\n    (drawnAtScale.domain()[1] - drawnAtScale.domain()[0]) /\n    (xScale.domain()[1] - xScale.domain()[0]);\n  const newRange = xScale.domain().map(drawnAtScale);\n\n  const posOffset = newRange[0];\n  graphics.scale.x = tileK;\n  graphics.position.x = -posOffset * tileK;\n};\n\nconst getRegionId = (item) =>\n  `${item.fields[0]}:${item.fields[1]}-${item.fields[2]}`;\n\nconst createStratifiedBedTrack = function createStratifiedBedTrack(\n  HGC,\n  ...args\n) {\n  if (!new.target) {\n    throw new Error(\n      'Uncaught TypeError: Class constructor cannot be invoked without \"new\"'\n    );\n  }\n\n  const { PIXI } = HGC.libraries;\n  const { scaleLinear, scaleLog } = HGC.libraries.d3Scale;\n  const { tileProxy } = HGC.services;\n  const { MAX_CLICK_DELAY } = HGC.configs;\n\n  const opacityLogScale = scaleLog()\n    .domain([1, 10])\n    .range([0.1, 1])\n    .clamp(true);\n\n  class StratifiedBedTrack extends HGC.tracks.HorizontalLine1DPixiTrack {\n    constructor(context, options) {\n      super(context, options);\n\n      this.pLegend = new PIXI.Graphics();\n      this.pMasked.addChild(this.pLegend);\n\n      this.legendMin = Infinity;\n      this.legendMax = -Infinity;\n\n      // Needed for interaction tracking because interaction tracking on the\n      // mesh causes errors...\n      this.bg = new PIXI.Sprite(PIXI.Texture.WHITE);\n      [this.bg.width, this.bg.height] = this.dimensions;\n      this.bg.interactive = true;\n      this.bg.interactiveChildren = false;\n      this.bg.alpha = 0;\n\n      let mousedownTime = performance.now();\n      this.bg.mousedown = () => {\n        mousedownTime = performance.now();\n      };\n      this.bg.mouseup = (e) => {\n        if (performance.now() - mousedownTime < MAX_CLICK_DELAY)\n          this.clickHandler(e);\n      };\n\n      this.updateOptions();\n\n      this.pLoading = new PIXI.Graphics();\n      this.pLoading.position.x = 0;\n      this.pLoading.position.y = 0;\n      this.pMasked.addChild(this.pLoading);\n\n      this.loadIndicator = new PIXI.Text('Loading data...', {\n        fontSize: this.labelSize || 10,\n        fill: 0x808080,\n      });\n      this.pLoading.addChild(this.loadIndicator);\n    }\n\n    initTile(tile) {\n      const intervals = [];\n\n      tile.tileData.forEach((item, i) => {\n        item.distance = getItemDistance(item) || -1;\n        item.cX = item.xStart + (item.xEnd - item.xStart) / 2;\n        item.regionId = getRegionId(item);\n        item.isLeftToRight = item.xStart < item.xEnd;\n        intervals.push([item.xStart, item.xEnd, i]);\n      });\n\n      tile.intervalTree = createIntervalTree(intervals);\n    }\n\n    updateStratificationOption() {\n      if (!this.options.stratification) {\n        this.categoryField = undefined;\n        this.categoryToGroup = undefined;\n        this.groupToColor = undefined;\n        this.numGroups = 0;\n        this.numCategories = 0;\n        this.groupLabels = [];\n        return;\n      }\n\n      this.categoryField = this.options.stratification.categoryField;\n      this.getCategory = (item) =>\n        item.fields[this.categoryField].toLowerCase();\n      this.categoryToGroup = new Map();\n      this.categoryToY = new Map();\n      this.yToCategory = new Map();\n      this.groupToColor = new Map();\n\n      this.groupSizes = this.options.stratification.groups.map(\n        (group) =>\n          group.categories.filter((category) => this.valueFilter(category))\n            .length\n      );\n      this.filteredGroups = this.options.stratification.groups.filter(\n        (group, i) => this.groupSizes[i] > 0\n      );\n      this.numGroups = this.filteredGroups.length;\n      this.numCategories = this.groupSizes.reduce(\n        (numCategories, groupSize) => numCategories + groupSize,\n        0\n      );\n      this.groupLabels = this.options.stratification.groups.map(\n        (group, i) => group.label || `Group ${i}`\n      );\n\n      let k = 0;\n      this.options.stratification.groups.forEach((group, i) => {\n        this.groupToColor.set(i, [\n          HGC.utils.colorToHex(\n            group.color || DEFAULT_COLOR_MAP[i % DEFAULT_COLOR_MAP.length]\n          ),\n          HGC.utils.colorToHex(\n            group.backgroundColor ||\n              DEFAULT_COLOR_MAP_LIGHT[i % DEFAULT_COLOR_MAP.length]\n          ),\n        ]);\n        group.categories\n          .filter((category) => this.valueFilter(category))\n          .forEach((category, j) => {\n            const cat = category.toLowerCase();\n            this.categoryToGroup.set(cat, i);\n            this.categoryToY.set(cat, k + j);\n            this.yToCategory.set(k + j, cat);\n          });\n        k += this.groupSizes[i];\n      });\n\n      this.groupLabelsPixiText = this.groupLabels.map(\n        (label, i) =>\n          new PIXI.Text(label, {\n            fontSize: this.labelSize,\n            align: this.axisAlign === 'right' ? 'right' : 'left',\n            fill: HGC.utils.colorToHex(\n              this.options.stratification.groups[i].axisLabelColor ||\n                DEFAULT_COLOR_MAP_DARK[i % DEFAULT_COLOR_MAP_DARK.length]\n            ),\n          })\n      );\n    }\n\n    updateOptions() {\n      this.axisAlign = this.options.axisAlign || 'left';\n\n      this.labelColor = HGC.utils.colorToHex(\n        this.options.labelColor || 'black'\n      );\n\n      this.labelSize = this.options.labelSize || 12;\n\n      this.markColor = HGC.utils.colorToHex(this.options.markColor || 'black');\n\n      this.markColorRgbNorm = this.options.markColor\n        ? HGC.utils\n            .colorToRgba(this.options.markColor)\n            .slice(0, 3)\n            .map((x) => Math.min(1, Math.max(0, x / 255)))\n        : [0, 0, 0];\n\n      this.markOpacity = Number.isNaN(+this.options.markOpacity)\n        ? 1\n        : Math.min(1, Math.max(0, +this.options.markOpacity));\n\n      this.markSize = this.options.markSize || 2;\n      this.markMinWidth = this.options.markMinWidth || this.markSize;\n      this.markHeight = this.options.markHeight || this.markSize;\n\n      this.rowHeight = this.options.rowHeight || this.markHeight;\n\n      this.markColorHighlight = HGC.utils.colorToHex(\n        this.options.markColorHighlight || 'red'\n      );\n\n      this.markColorHighlightRgbNorm = this.options.markColorHighlight\n        ? HGC.utils\n            .colorToRgba(this.options.markColorHighlight)\n            .slice(0, 3)\n            .map((x) => Math.min(1, Math.max(0, x / 255)))\n        : [1, 0, 0];\n\n      this.markColorDehighlight = HGC.utils.colorToHex(\n        this.options.markColorDehighlight || '#999999'\n      );\n\n      this.markColorDehighlightRgbNorm = this.options.markColorDehighlight\n        ? HGC.utils\n            .colorToRgba(this.options.markColorDehighlight)\n            .slice(0, 3)\n            .map((x) => Math.min(1, Math.max(0, x / 255)))\n        : [0.6, 0.6, 0.6];\n\n      this.markOpacityFocus = Number.isNaN(+this.options.markOpacityFocus)\n        ? this.markOpacity\n        : Math.min(1, Math.max(0, +this.options.markOpacityFocus));\n\n      this.filterSet =\n        this.options.filter && this.options.filter.set\n          ? this.options.filter.set.reduce((s, include) => {\n              s.add(include);\n              return s;\n            }, new Set())\n          : null;\n\n      this.filterField = this.options.filter && this.options.filter.field;\n\n      this.valueFilter = this.filterSet\n        ? (value) => this.filterSet.has(value)\n        : () => true;\n\n      this.itemFilter =\n        this.valueFilter && this.filterField\n          ? (item) => this.valueFilter(item.fields[this.filterField])\n          : () => true;\n\n      this.getImportance = this.options.importanceField\n        ? (item) => +item.fields[this.options.importanceField]\n        : (item) => item.distance;\n\n      this.opacityEncoding = this.options.opacityEncoding || 'solid';\n\n      switch (this.opacityEncoding) {\n        case 'frequency':\n          this.opacityScale = () => 0.1;\n          break;\n\n        case 'highestImportance':\n        case 'closestImportance': {\n          const importanceDomain = this.options.importanceDomain || [1, 1000];\n          const opacityLinearScale = scaleLinear()\n            .domain(importanceDomain)\n            .range([1, 10]);\n          this.opacityScale = (x) => opacityLogScale(opacityLinearScale(x));\n          break;\n        }\n\n        case 'solid':\n        default:\n          this.opacityScale = () => 1;\n          break;\n      }\n\n      this.focusRegion = this.options.focusRegion\n        ? this.options.focusRegion\n        : [Infinity, Infinity];\n\n      this.getRegion = this.options.focusRegion\n        ? (item) => [item.xStart, item.xEnd]\n        : undefined;\n\n      this.focusGene = this.options.focusGene\n        ? this.options.focusGene.toLowerCase()\n        : undefined;\n\n      this.getGene = this.options.geneField\n        ? (item) => item.fields[this.options.geneField].toLowerCase()\n        : undefined;\n\n      this.focusStyle = this.options.focusStyle\n        ? this.options.focusStyle.toLowerCase()\n        : undefined;\n\n      this.minImportance = this.options.minImportance || 0;\n\n      this.updateStratificationOption();\n    }\n\n    rerender(newOptions) {\n      this.options = newOptions;\n      this.updateOptions();\n      this.updateExistingGraphics();\n    }\n\n    hasFetchedTiles() {\n      return Object.values(this.fetchedTiles).length;\n    }\n\n    updateScales() {\n      const fetchedTiles = Object.values(this.fetchedTiles);\n\n      if (!fetchedTiles.length) return;\n\n      const [, height] = this.dimensions;\n\n      this.maxDist = getMaxDistance(this.fetchedTiles);\n\n      this.heightScale = scaleLinear()\n        .domain([0, this.maxDist])\n        .range([Math.min(12, height / 10), height]);\n\n      this.categoryHeightScale = scaleLinear()\n        .domain([0, this.numCategories])\n        .range([0, this.numCategories * this.rowHeight]);\n\n      this.valueScale = scaleLinear()\n        .domain([0, this.maxDist])\n        .range([height, 0]);\n\n      this.valueScaleInverted = scaleLinear()\n        .domain([0, this.maxDist])\n        .range([0, height]);\n    }\n\n    itemToIndicatorCategory(item, isHighlighting) {\n      return {\n        cX: this._xScale(item.cX),\n        y: this.categoryHeightScale(\n          this.categoryToY.get(this.getCategory(item))\n        ),\n        opacity: this.opacityScale(this.getImportance(item)),\n        highlight: isHighlighting && item.__focus,\n        widthHalf: Math.max(\n          this.markMinWidth / 2,\n          Math.abs(this._xScale(item.xStart) - this._xScale(item.xEnd)) / 2\n        ),\n        height: this.markHeight,\n        __item: item,\n      };\n    }\n\n    isItemInFocus() {\n      if (\n        this.getGene &&\n        this.focusGene &&\n        this.getRegion &&\n        this.focusRegion\n      ) {\n        return (item) => {\n          item.__focus =\n            this.getGene(item) === this.focusGene &&\n            contains(this.getRegion(item), this.focusRegion);\n          return item.__focus;\n        };\n      }\n\n      if (this.getGene && this.focusGene) {\n        return (item) => {\n          item.__focus = this.getGene(item) === this.focusGene;\n          return item.__focus;\n        };\n      }\n\n      if (this.getRegion && this.focusRegion) {\n        return (item) => {\n          item.__focus = contains(this.getRegion(item), this.focusRegion);\n          return item.__focus;\n        };\n      }\n\n      return (item) => {\n        item.__focus = false;\n        // If no focus was defined, we include all intervals\n        return true;\n      };\n    }\n\n    itemToIndicatorReducer(focusFilterFn, addFn) {\n      if (this.focusStyle === 'highlighting') {\n        return (filteredItems, item, i) => {\n          focusFilterFn(item);\n          if (this.itemFilter(item)) addFn(filteredItems, item);\n          return filteredItems;\n        };\n      }\n\n      return (filteredItems, item) => {\n        if (focusFilterFn(item) && this.itemFilter(item))\n          addFn(filteredItems, item);\n        return filteredItems;\n      };\n    }\n\n    getPoints(isHighlighting) {\n      let reducerVar = [];\n      let addFn = (accumulator, item) =>\n        accumulator.push(this.itemToIndicatorCategory(item, isHighlighting));\n\n      if (this.opacityEncoding === 'highestImportance') {\n        reducerVar = {};\n        addFn = (accumulator, item) => {\n          if (accumulator[item.regionId]) {\n            const i1 = this.getImportance(accumulator[item.regionId].__item);\n            const i2 = this.getImportance(item);\n            if (i2 > i1) {\n              accumulator[item.regionId] = this.itemToIndicatorCategory(\n                item,\n                isHighlighting\n              );\n            }\n          } else {\n            accumulator[item.regionId] = this.itemToIndicatorCategory(\n              item,\n              isHighlighting\n            );\n          }\n        };\n      } else if (this.opacityEncoding === 'closestImportance') {\n        reducerVar = {};\n        addFn = (accumulator, item) => {\n          if (\n            !accumulator[item.regionId] ||\n            item.distance < accumulator[item.regionId].__item.distance\n          ) {\n            accumulator[item.regionId] = this.itemToIndicatorCategory(\n              item,\n              isHighlighting\n            );\n          }\n        };\n      }\n\n      const focusFilterFn = this.isItemInFocus();\n      const dataToPoint = this.itemToIndicatorReducer(focusFilterFn, addFn);\n\n      return Object.values(this.fetchedTiles).flatMap((tile) =>\n        Object.values(tile.tileData.reduce(dataToPoint, reducerVar))\n      );\n    }\n\n    renderIndicatorPoints() {\n      this.drawnAtScale = scaleLinear()\n        .domain([...this.xScale().domain()])\n        .range([...this.xScale().range()]);\n\n      const isHighlighting = !!(\n        this.focusStyle === 'highlighting' &&\n        ((this.focusGene && this.getGene) ||\n          (this.focusRegion && this.getRegion))\n      );\n\n      const points = this.getPoints(isHighlighting);\n\n      const positions = new Float32Array(points.flatMap(pointToPosition));\n      const indices = new Uint16Array(points.flatMap(pointToIndex));\n      const opacities = new Float32Array(points.flatMap(pointToOpacity));\n      const highlights = new Float32Array(points.flatMap(pointToHighlight));\n\n      const uniforms = new PIXI.UniformGroup({\n        uColor: isHighlighting\n          ? [...this.markColorDehighlightRgbNorm, this.markOpacity]\n          : [...this.markColorRgbNorm, this.markOpacity],\n        uColorHighlight: [...this.markColorHighlightRgbNorm, this.markOpacity],\n        uHighlighting: isHighlighting,\n      });\n\n      const shader = PIXI.Shader.from(VS, FS, uniforms);\n\n      const geometry = new PIXI.Geometry();\n      geometry.addAttribute('aPosition', positions, 2);\n      geometry.addAttribute('aOpacity', opacities, 1);\n      geometry.addAttribute('aHighlight', highlights, 1);\n      geometry.addIndex(indices);\n\n      const mesh = new PIXI.Mesh(geometry, shader);\n\n      const newGraphics = new PIXI.Graphics();\n      newGraphics.addChild(this.bg);\n      newGraphics.addChild(mesh);\n\n      [this.bg.width, this.bg.height] = this.dimensions;\n\n      // eslint-disable-next-line\n      this.pMain.x = this.position[0];\n\n      if (this.indicatorPointGraphics) {\n        this.indicatorPointGraphics.removeChild(this.bg);\n        this.pMain.removeChild(this.indicatorPointGraphics);\n      }\n\n      this.pMain.addChild(newGraphics);\n      this.indicatorPointGraphics = newGraphics;\n\n      scaleScalableGraphics(\n        this.indicatorPointGraphics,\n        this._xScale,\n        this.drawnAtScale\n      );\n\n      this.draw();\n      this.animate();\n    }\n\n    renderIndicatorCategoryAxis() {\n      const [width] = this.dimensions;\n      const [left, top] = this.position;\n\n      this.pAxis.position.x = this.axisAlign === 'right' ? left + width : left;\n      this.pAxis.position.y = top;\n\n      this.pAxis.clear();\n      let yStart = 0;\n      let yEnd = 0;\n\n      const xTickOffset = this.axisAlign === 'right' ? -5 : 5;\n      const xTickEnd = this.axisAlign === 'right' ? -width : width;\n      const xLabelOffset = this.axisAlign === 'right' ? -3 : 3;\n      const numAxisLabels = this.pAxis.children.length;\n\n      this.pAxis.lineStyle(1, 0x000000, 1.0, 0.0);\n\n      this.groupLabelsPixiText.forEach((labelPixiText, i) => {\n        if (numAxisLabels < i + 1) {\n          this.pAxis.addChild(labelPixiText);\n        }\n\n        // Don't ask me why but somehow after `labelPixiText` was added to\n        // `this.pAxis` the object is not the same as `this.pAxis.children[i]`\n        // anymore and subsequent changes were ineffective\n        const text = this.pAxis.children[i];\n\n        if (this.groupSizes[i] === 0) {\n          text.alpha = 0;\n          return;\n        }\n\n        const height = this.categoryHeightScale(this.groupSizes[i]);\n        yEnd += height;\n        text.x = xLabelOffset;\n        text.y = yStart + height / 2;\n        text.anchor.x = this.axisAlign === 'right' ? 1 : 0;\n        text.anchor.y = 0.5;\n        text.alpha = 1;\n\n        if (this.options.focusStyle === 'highlighting') {\n          this.pAxis.beginFill(0xffffff, 0.66);\n        } else {\n          this.pAxis.beginFill(this.groupToColor.get(i)[1], 0.66);\n        }\n\n        this.pAxis.lineStyle(0);\n        if (this.axisAlign === 'right') {\n          this.pAxis.drawRect(\n            text.x - text.width,\n            text.y - text.height / 2,\n            text.width,\n            text.height\n          );\n        } else {\n          this.pAxis.drawRect(\n            text.x,\n            text.y - text.height / 2,\n            text.width,\n            text.height\n          );\n        }\n        this.pAxis.endFill();\n\n        this.pAxis.lineStyle(1, 0x000000, 1.0, 0.0);\n        this.pAxis.moveTo(0, yStart);\n        this.pAxis.lineTo(xTickOffset, yStart);\n\n        if (this.options.stratification.axisShowGroupSeparator) {\n          dashedXLineTo(this.pAxis, 0, xTickEnd, yStart, 5);\n        }\n\n        yStart = yEnd;\n      });\n\n      this.pAxis.moveTo(0, 0);\n      this.pAxis.lineTo(0, yEnd);\n      this.pAxis.lineTo(xTickOffset, yEnd);\n\n      if (this.options.stratification.axisShowGroupSeparator) {\n        dashedXLineTo(this.pAxis, 0, xTickEnd, yEnd, 5);\n      }\n    }\n\n    renderIndicatorLegend() {\n      this.pLegend.clear();\n\n      if (this.opacityEncoding.indexOf('Importance') === -1) {\n        if (this.legendMinText) {\n          this.pLegend.removeChild(this.legendMinText);\n          this.legendMinText.destroy();\n          this.legendMinText = undefined;\n        }\n        if (this.legendMaxText) {\n          this.pLegend.removeChild(this.legendMaxText);\n          this.legendMaxText.destroy();\n          this.legendMaxText = undefined;\n        }\n        return;\n      }\n\n      const padding = 6;\n      const [width] = this.dimensions;\n      const [left, top] = this.position;\n      const [, y] = this.categoryHeightScale.range();\n      const isRightAligned = this.options.legendAlign === 'right';\n      const isHighlighting = !!(\n        this.focusStyle === 'highlighting' &&\n        ((this.focusGene && this.getGene) ||\n          (this.focusRegion && this.getRegion))\n      );\n\n      this.pLegend.position.x = isRightAligned ? left + width : left;\n\n      const [minValue, maxValue] = this.options.importanceDomain || [1, 1000];\n\n      if (Math.abs(minValue - this.legendMin) > EPS) {\n        if (this.legendMinText) {\n          this.pLegend.removeChild(this.legendMinText);\n          this.legendMinText.destroy();\n        }\n        this.legendMinText = new PIXI.Text(toFixed(minValue, 3), {\n          fontSize: this.labelSize,\n          align: isRightAligned ? 'right' : 'left',\n          fill: 0x808080,\n        });\n        this.legendMinText.x = 0;\n        this.legendMinText.y = padding / 2;\n        this.legendMinText.anchor.x = isRightAligned ? 1 : 0;\n        this.pLegend.addChild(this.legendMinText);\n      }\n\n      if (Math.abs(maxValue - this.legendMax) > EPS) {\n        if (this.legendMaxText) {\n          this.pLegend.removeChild(this.legendMaxText);\n          this.legendMaxText.destroy();\n        }\n        this.legendMaxText = new PIXI.Text(toFixed(maxValue, 3), {\n          fontSize: this.labelSize,\n          align: isRightAligned ? 'right' : 'left',\n          fill: 0x808080,\n        });\n        this.legendMaxText.x = 0;\n        this.legendMaxText.y = padding / 2;\n        this.legendMaxText.anchor.x = isRightAligned ? 1 : 0;\n        this.pLegend.addChild(this.legendMaxText);\n      }\n\n      const legendRectWidth = 42;\n      const minTextWidth = this.legendMinText.getBounds().width;\n      const maxTextWidth = this.legendMaxText.getBounds().width;\n      const offset = isRightAligned\n        ? -(maxTextWidth + legendRectWidth + padding)\n        : minTextWidth + 2 * padding;\n\n      const rectHeight = 18 + (isHighlighting * padding) / 2;\n\n      this.pLegend.beginFill(0xffffff);\n      this.pLegend.lineStyle(1, 0xcccccc);\n      if (isRightAligned) {\n        this.legendMinText.x = offset - padding;\n        this.pLegend.drawRoundedRect(\n          -(legendRectWidth + minTextWidth + maxTextWidth + 3 * padding + 0.5),\n          0,\n          legendRectWidth + minTextWidth + maxTextWidth + 3 * padding,\n          rectHeight,\n          3\n        );\n      } else {\n        this.legendMaxText.x = offset + legendRectWidth + 2 * padding;\n        this.pLegend.drawRoundedRect(\n          0.5,\n          0,\n          legendRectWidth + minTextWidth + maxTextWidth + 3 * padding,\n          18 + (isHighlighting * padding) / 2,\n          3\n        );\n      }\n      this.pLegend.endFill();\n      this.pLegend.lineStyle(0);\n\n      for (let i = 0; i < 5; i++) {\n        const opacity = this.opacityScale(minValue + (i / 4) * maxValue);\n\n        this.pLegend.beginFill(this.markColor, opacity);\n        this.pLegend.drawRect(\n          i * 9 + offset,\n          padding / 2 + !isHighlighting * 3,\n          6,\n          6\n        );\n        this.pLegend.endFill();\n\n        if (isHighlighting) {\n          this.pLegend.beginFill(this.markColorHighlight, opacity);\n          this.pLegend.drawRect(i * 9 + offset, padding / 2 + 9, 6, 6);\n          this.pLegend.endFill();\n        }\n      }\n\n      if (isRightAligned) {\n        this.legendMinText.x = offset - padding;\n        this.legendMaxText.x = -padding / 2;\n      } else {\n        this.legendMinText.x = padding / 2;\n        this.legendMaxText.x = offset + legendRectWidth + padding;\n      }\n\n      this.pLegend.position.y = top + y - padding - rectHeight;\n    }\n\n    updateIndicators() {\n      this.renderIndicatorCategoryAxis();\n      this.renderIndicatorLegend();\n      this.renderIndicatorPoints();\n    }\n\n    updateLoadIndicator() {\n      const [left, top] = this.position;\n      this.pLoading.position.x = left + 6;\n      this.pLoading.position.y = top + 6;\n\n      if (this.fetching.size) {\n        this.pLoading.addChild(this.loadIndicator);\n      } else {\n        this.pLoading.removeChild(this.loadIndicator);\n      }\n    }\n\n    // Called whenever a new tile comes in\n    updateExistingGraphics() {\n      this.updateLoadIndicator();\n      if (!this.hasFetchedTiles()) return;\n      this.updateScales();\n      this.updateIndicators();\n    }\n\n    // Gets called on every draw call\n    drawTile(tile) {\n      tile.graphics.clear();\n\n      this.updateLoadIndicator();\n\n      if (!this.options.stratification.axisNoGroupColor) {\n        let yStart = 0;\n        let yEnd = 0;\n        this.groupSizes.forEach((size, i) => {\n          yEnd += this.categoryHeightScale(size);\n\n          tile.graphics.beginFill(this.groupToColor.get(i)[1]);\n          tile.graphics.drawRect(\n            0,\n            yStart,\n            this.dimensions[0],\n            Math.abs(yEnd - yStart)\n          );\n\n          yStart = yEnd;\n        });\n        tile.graphics.endFill();\n      }\n    }\n\n    getElementAtPosition(relX, relY) {\n      if (!this.tilesetInfo) return undefined;\n\n      const zoomLevel = this.calculateZoomLevel();\n      const tileWidth = tileProxy.calculateTileWidth(\n        this.tilesetInfo,\n        zoomLevel,\n        this.tilesetInfo.tile_size\n      );\n\n      // the position of the tile containing the query position\n      const tileId = this.tileToLocalId([\n        zoomLevel,\n        Math.floor(this._xScale.invert(relX) / tileWidth),\n      ]);\n      const fetchedTile = this.fetchedTiles[tileId];\n\n      if (!fetchedTile) return undefined;\n\n      const category = this.yToCategory.get(\n        Math.floor(this.categoryHeightScale.invert(relY))\n      );\n\n      const xAbsLo = this._xScale.invert(relX - 1);\n      const xAbsHi = this._xScale.invert(relX + 1);\n\n      let foundItem;\n      fetchedTile.intervalTree.queryInterval(xAbsLo, xAbsHi, (interval) => {\n        const item = fetchedTile.tileData[interval[2]];\n        if (this.getCategory(item) === category) {\n          foundItem = item;\n          return true;\n        }\n        return false;\n      });\n\n      return {\n        item: foundItem,\n        category,\n        tileId,\n      };\n    }\n\n    getMouseOverHtml(relX, relY) {\n      const element = this.getElementAtPosition(relX, relY);\n\n      if (!element) return '';\n\n      const { item, category } = element;\n\n      if (item) {\n        const [color, bg] = this.groupToColor.get(\n          this.categoryToGroup.get(category)\n        );\n        const colorHex = `#${color.toString(16)}`;\n        const bgHex = `#${bg.toString(16)}`;\n        const value = this.getImportance(item).toFixed(2);\n        return `<div style=\"margin: -0.25rem; padding: 0 0.25rem; background: ${bgHex}\"><strong style=\"color: ${colorHex};\">${category}:</strong> ${value}</div>`;\n      }\n\n      return '';\n    }\n\n    clickHandler(event) {\n      const [offsetX, offsetY] = this.position;\n      const relX = event.data.global.x - offsetX;\n      const relY = event.data.global.y - offsetY;\n\n      const element = this.getElementAtPosition(relX, relY);\n\n      if (element) {\n        this.pubSub.publish('app.click', {\n          type: 'annotation',\n          event,\n          payload: element,\n        });\n      }\n    }\n\n    setPosition(newPosition) {\n      super.setPosition(newPosition);\n\n      [this.pMain.position.x, this.pMain.position.y] = this.position;\n    }\n\n    zoomed(newXScale, newYScale) {\n      this.xScale(newXScale);\n      this.yScale(newYScale);\n\n      if (this.indicatorPointGraphics) {\n        scaleScalableGraphics(\n          this.indicatorPointGraphics,\n          newXScale,\n          this.drawnAtScale\n        );\n      }\n\n      this.refreshTiles();\n      this.draw();\n    }\n\n    refreshTiles() {\n      super.refreshTiles();\n      this.updateLoadIndicator();\n    }\n\n    renderIndicatorCategoryAxisAsSvg() {\n      const gAxis = document.createElement('g');\n      gAxis.setAttribute('id', 'axis');\n\n      const [width] = this.dimensions;\n      const [left, top] = this.position;\n\n      this.pAxis.position.x = this.axisAlign === 'right' ? left + width : left;\n      this.pAxis.position.y = top;\n\n      gAxis.setAttribute(\n        'transform',\n        `translate(${this.pAxis.position.x}, ${this.pAxis.position.y})`\n      );\n\n      let yStart = 0;\n      let yEnd = 0;\n\n      const xTickOffset = this.axisAlign === 'right' ? -5 : 5;\n      const xTickEnd = this.axisAlign === 'right' ? -width : width;\n      const xLabelOffset = this.axisAlign === 'right' ? -3 : 3;\n\n      const createRect = (x, y, w, h, f, o) => {\n        const r = document.createElement('rect');\n\n        r.setAttribute('x', x);\n        r.setAttribute('y', y);\n        r.setAttribute('width', w);\n        r.setAttribute('height', h);\n        r.setAttribute('fill', f);\n        r.setAttribute('fill-opacity', o);\n        r.setAttribute('stroke-width', 0);\n\n        return r;\n      };\n\n      const createText = (pixiText) => {\n        const t = document.createElement('text');\n\n        t.setAttribute('x', pixiText.x);\n        t.setAttribute('y', pixiText.y + pixiText.height / (4 / 1));\n        t.setAttribute('fill', pixiText._style._fill);\n        t.setAttribute(\n          'text-anchor',\n          pixiText._style._align === 'right' ? 'end' : 'start'\n        );\n        t.setAttribute('style', `font: ${pixiText._font};`);\n\n        t.textContent = pixiText.text;\n\n        return t;\n      };\n\n      const createLine = ({\n        stroke = '#000000',\n        strokeWidth = 1,\n        strokeDasharray = null,\n      } = {}) => (x1, y1, x2, y2) => {\n        const l = document.createElement('line');\n\n        l.setAttribute('x1', x1);\n        l.setAttribute('y1', y1);\n        l.setAttribute('x2', x2);\n        l.setAttribute('y2', y2);\n        l.setAttribute('stroke', stroke);\n        l.setAttribute('stroke-width', strokeWidth);\n\n        if (strokeDasharray)\n          l.setAttribute('stroke-dasharray', strokeDasharray);\n\n        return l;\n      };\n\n      const createDashedLine = createLine({ strokeDasharray: '5' });\n\n      const isHighlighting = this.options.focusStyle === 'highlighting';\n      const backgroundOpacity = 0.66;\n\n      this.groupLabelsPixiText.forEach((labelPixiText, i) => {\n        const height = this.categoryHeightScale(this.groupSizes[i]);\n        yEnd += height;\n        labelPixiText.x = xLabelOffset;\n        labelPixiText.y = yStart + height / 2;\n\n        // Background color\n        const backgroundColor = isHighlighting\n          ? '#ffffff'\n          : `#${this.groupToColor.get(i)[1].toString(16)}`;\n\n        if (this.axisAlign === 'right') {\n          gAxis.appendChild(\n            createRect(\n              labelPixiText.x - labelPixiText.width,\n              labelPixiText.y - labelPixiText.height / (4 / 1),\n              labelPixiText.width,\n              labelPixiText.height,\n              backgroundColor,\n              backgroundOpacity\n            )\n          );\n        } else {\n          gAxis.appendChild(\n            createRect(\n              labelPixiText.x,\n              labelPixiText.y - labelPixiText.height / (4 / 1),\n              labelPixiText.width,\n              labelPixiText.height,\n              backgroundColor,\n              backgroundOpacity\n            )\n          );\n        }\n\n        gAxis.appendChild(createText(labelPixiText));\n\n        gAxis.appendChild(createLine()(0, yStart, xTickOffset, yStart));\n\n        if (this.options.stratification.axisShowGroupSeparator) {\n          gAxis.appendChild(createDashedLine(0, yStart, xTickEnd, yStart));\n        }\n\n        yStart = yEnd;\n      });\n\n      gAxis.appendChild(createLine()(0, 0, 0, yEnd));\n\n      if (this.options.stratification.axisShowGroupSeparator) {\n        gAxis.appendChild(createDashedLine(0, yEnd, xTickEnd, yEnd));\n      }\n\n      return gAxis;\n    }\n\n    /**\n     * Export an SVG representation of this track\n     *\n     * @returns {Array} The two returned DOM nodes are both SVG\n     * elements [base,track]. Base is a parent which contains track as a\n     * child. Track is clipped with a clipping rectangle contained in base.\n     *\n     */\n    exportSVG() {\n      let track = null;\n      let base = null;\n\n      [base, track] = super.superSVG();\n\n      base.setAttribute('class', 'exported-stratified-bed-track');\n      const output = document.createElement('g');\n\n      track.appendChild(output);\n      output.setAttribute(\n        'transform',\n        `translate(${this.position[0]},${this.position[1]})`\n      );\n\n      const isHighlighting = !!(\n        this.focusStyle === 'highlighting' &&\n        ((this.focusGene && this.getGene) ||\n          (this.focusRegion && this.getRegion))\n      );\n\n      const points = this.getPoints(isHighlighting);\n      const color = isHighlighting\n        ? this.options.markColorDehighlight || '#999999'\n        : this.options.markColor || 'black';\n      const colorHighlight = this.options.markColorHighlight || 'red';\n\n      points.forEach(({ cX, y, widthHalf, opacity, highlight, height }, i) => {\n        const r = document.createElement('rect');\n\n        r.setAttribute('x', cX - widthHalf);\n        r.setAttribute('y', y);\n        r.setAttribute('width', widthHalf * 2);\n        r.setAttribute('height', height);\n        r.setAttribute('fill', highlight ? colorHighlight : color);\n        r.setAttribute('fill-opacity', opacity);\n        r.setAttribute('stroke-width', 0);\n\n        output.appendChild(r);\n      });\n\n      base.appendChild(this.renderIndicatorCategoryAxisAsSvg());\n\n      return [base, track];\n    }\n  }\n\n  return new StratifiedBedTrack(...args);\n};\n\nconst icon =\n  '<svg viewBox=\"0 0 16 16\" xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" clip-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-miterlimit=\"1.5\"><path d=\"M4 2.1L.5 3.5v12l5-2 5 2 5-2v-12l-5 2-3.17-1.268\" fill=\"none\" stroke=\"currentColor\"/><path d=\"M10.5 3.5v12\" fill=\"none\" stroke=\"currentColor\" stroke-opacity=\".33\" stroke-dasharray=\"1,2,0,0\"/><path d=\"M5.5 13.5V6\" fill=\"none\" stroke=\"currentColor\" stroke-opacity=\".33\" stroke-width=\".9969299999999999\" stroke-dasharray=\"1.71,3.43,0,0\"/><path d=\"M9.03 5l.053.003.054.006.054.008.054.012.052.015.052.017.05.02.05.024 4 2 .048.026.048.03.046.03.044.034.042.037.04.04.037.04.036.042.032.045.03.047.028.048.025.05.022.05.02.053.016.053.014.055.01.055.007.055.005.055v.056l-.002.056-.005.055-.008.055-.01.055-.015.054-.017.054-.02.052-.023.05-.026.05-.028.048-.03.046-.035.044-.035.043-.038.04-4 4-.04.037-.04.036-.044.032-.045.03-.046.03-.048.024-.05.023-.05.02-.052.016-.052.015-.053.012-.054.01-.054.005-.055.003H8.97l-.053-.003-.054-.006-.054-.008-.054-.012-.052-.015-.052-.017-.05-.02-.05-.024-4-2-.048-.026-.048-.03-.046-.03-.044-.034-.042-.037-.04-.04-.037-.04-.036-.042-.032-.045-.03-.047-.028-.048-.025-.05-.022-.05-.02-.053-.016-.053-.014-.055-.01-.055-.007-.055L4 10.05v-.056l.002-.056.005-.055.008-.055.01-.055.015-.054.017-.054.02-.052.023-.05.026-.05.028-.048.03-.046.035-.044.035-.043.038-.04 4-4 .04-.037.04-.036.044-.032.045-.03.046-.03.048-.024.05-.023.05-.02.052-.016.052-.015.053-.012.054-.01.054-.005L8.976 5h.054zM5 10l4 2 4-4-4-2-4 4z\" fill=\"currentColor\"/><path d=\"M7.124 0C7.884 0 8.5.616 8.5 1.376v3.748c0 .76-.616 1.376-1.376 1.376H3.876c-.76 0-1.376-.616-1.376-1.376V1.376C2.5.616 3.116 0 3.876 0h3.248zm.56 5.295L5.965 1H5.05L3.375 5.295h.92l.354-.976h1.716l.375.975h.945zm-1.596-1.7l-.592-1.593-.58 1.594h1.172z\" fill=\"currentColor\"/></svg>';\n\ncreateStratifiedBedTrack.config = {\n  type: 'stratified-bed',\n  datatype: ['arcs', 'bedlike'],\n  orientation: '1d',\n  name: 'Arcs1D',\n  thumbnail: new DOMParser().parseFromString(icon, 'text/xml').documentElement,\n  availableOptions: [\n    'arcStyle',\n    'flip1D',\n    'labelPosition',\n    'labelColor',\n    'labelTextOpacity',\n    'labelBackgroundOpacity',\n    'trackBorderWidth',\n    'trackBorderColor',\n  ],\n  defaultOptions: {\n    arcStyle: 'ellipse',\n    flip1D: 'no',\n    labelColor: 'black',\n    labelPosition: 'hidden',\n    trackBorderWidth: 0,\n    trackBorderColor: 'black',\n  },\n  optionsInfo: {\n    arcStyle: {\n      name: 'Arc Style',\n      inlineOptions: {\n        circle: {\n          name: 'Circle',\n          value: 'circle',\n        },\n        ellipse: {\n          name: 'Ellipse',\n          value: 'ellipse',\n        },\n      },\n    },\n  },\n};\n\nexport default createStratifiedBedTrack;\n","const MAX_RADIUS = 2;\nconst MAX_RADIUS_EXTENSION = 2;\n\n// const VS = `\n//   attribute vec2 aPosition;\n\n//   uniform mat3 projectionMatrix;\n//   uniform mat3 translationMatrix;\n//   uniform float uPointSize;\n//   uniform vec4 uColor;\n\n//   varying vec4 vColor;\n\n//   void main(void)\n//   {\n//     vColor = uColor;\n//     gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aPosition, 1.0)).xy, 0.0, 1.0);\n//     gl_PointSize = uPointSize;\n//   }\n// `;\n\n// const FS_ROUND = `\n//   #ifdef GL_OES_standard_derivatives\n//   #extension GL_OES_standard_derivatives : enable\n//   #endif\n\n//   precision mediump float;\n\n//   varying vec4 vColor;\n\n//   void main() {\n//     float r = 0.0, delta = 0.0, alpha = 1.0;\n//     vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n//     r = dot(cxy, cxy);\n\n//     #ifdef GL_OES_standard_derivatives\n//       delta = fwidth(r);\n//       alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\n//     #endif\n\n//     gl_FragColor = vec4(vColor.rgb, alpha * vColor.a);\n//   }\n// `;\n\n// const FS_SQUARE = `\n//   precision mediump float;\n//   varying vec4 vColor;\n\n//   void main() {\n//     gl_FragColor = vec4(vColor.rgb, vColor.a);\n//   }\n// `;\n\n// const DEFAULT_GROUP_COLORS = [\n//   '#c17da5',\n//   '#c76526',\n//   '#dca237',\n//   '#eee462',\n//   '#469b76',\n//   '#3170ad',\n//   '#6fb2e4',\n//   '#000000',\n//   '#999999',\n// ];\n\n// const DEFAULT_GROUP_COLORS_DARK = [\n//   '#a1688a',\n//   '#a65420',\n//   '#b7872e',\n//   '#9f9841',\n//   '#3a8162',\n//   '#295d90',\n//   '#4a7798',\n//   '#000000',\n//   '#666666',\n// ];\n\n// const DEFAULT_GROUP_COLORS_LIGHT = [\n//   '#f5e9f0',\n//   '#f6e5db',\n//   '#f9f0de',\n//   '#fcfbe5',\n//   '#e0eee8',\n//   '#dde7f1',\n//   '#e7f2fb',\n//   '#d5d5d5',\n//   '#ffffff',\n// ];\n\n// const scaleScalableGraphics = (graphics, xScale, drawnAtScale) => {\n//   const tileK =\n//     (drawnAtScale.domain()[1] - drawnAtScale.domain()[0]) /\n//     (xScale.domain()[1] - xScale.domain()[0]);\n//   const newRange = xScale.domain().map(drawnAtScale);\n\n//   const posOffset = newRange[0];\n//   graphics.scale.x = tileK;\n//   graphics.position.x = -posOffset * tileK;\n// };\n\nconst createSnpTrack = function createSnpTrack(HGC, ...args) {\n  if (!new.target) {\n    throw new Error(\n      'Uncaught TypeError: Class constructor cannot be invoked without \"new\"'\n    );\n  }\n\n  const { range } = HGC.libraries.d3Array;\n  const { scaleBand } = HGC.libraries.d3Scale;\n  const { tileProxy } = HGC.services;\n  const { colorToHex } = HGC.utils;\n\n  class SnpTrack extends HGC.tracks.BedLikeTrack {\n    setValueScale() {\n      this.valueScale = null;\n      if (this.options && this.options.valueColumn) {\n        const min = this.options.colorEncodingRange\n          ? +this.options.colorEncodingRange[0]\n          : this.minVisibleValueInTiles(+this.options.valueColumn);\n        const max = this.options.colorEncodingRange\n          ? +this.options.colorEncodingRange[1]\n          : this.maxVisibleValueInTiles(+this.options.valueColumn);\n\n        if (this.options.valueColumn) {\n          [this.valueScale] = this.makeValueScale(\n            min,\n            this.calculateMedianVisibleValue(+this.options.valueColumn),\n            max,\n            2\n          );\n        }\n      }\n    }\n\n    finalDotYPos(y, r) {\n      return Math.max(r, Math.min(this.dimensions[1] - r, y));\n    }\n\n    drawPoly(tile, xStartPos, xEndPos, rectY, doubleRadius = false) {\n      // prettier-ignore\n      const drawnPoly = [\n        // left top\n        xStartPos, rectY,\n        // right top\n        xEndPos, rectY,\n        // right bottom\n        xEndPos, this.dimensions[1],\n         // left bottom\n        xStartPos, this.dimensions[1]\n      ];\n\n      const anchorRadius = Math.max(MAX_RADIUS, xEndPos - xStartPos);\n      const radius = anchorRadius * (1 + MAX_RADIUS_EXTENSION * doubleRadius);\n\n      tile.rectGraphics.drawCircle(\n        xStartPos,\n        this.finalDotYPos(rectY, anchorRadius),\n        radius\n      );\n\n      return drawnPoly;\n    }\n\n    renderRows(tile, rows, maxRows, startY, endY, fill) {\n      const zoomLevel = +tile.tileId.split('.')[0];\n\n      this.initialize();\n\n      const rowScale = scaleBand()\n        .domain(range(maxRows))\n        .range([startY, endY])\n        .paddingInner(0);\n\n      const focusRegion = this.options.focusRegion || [Infinity, Infinity];\n\n      const circleDraws = [];\n      const circleFocusDraws = [];\n\n      for (let j = 0; j < rows.length; j++) {\n        for (let i = 0; i < rows[j].length; i++) {\n          const td = rows[j][i].value;\n          const geneInfo = td.fields;\n\n          // the returned positions are chromosome-based and they need to\n          // be converted to genome-based\n          const chrOffset = +td.chrOffset;\n          const txStart = +geneInfo[1] + chrOffset;\n          const txEnd = +geneInfo[2] + chrOffset;\n          let yMiddle = rowScale(j) + rowScale.step() / 2;\n\n          if (this.valueScale) {\n            yMiddle = this.valueScale(+geneInfo[+this.options.valueColumn - 1]);\n          }\n\n          const rectY = yMiddle;\n          const xStartPos = this._xScale(txStart);\n          const xEndPos = this._xScale(txEnd);\n\n          // don't draw anything that has already been drawn\n          if (\n            !(\n              zoomLevel in this.drawnRects &&\n              td.uid in this.drawnRects[zoomLevel]\n            )\n          ) {\n            if (!this.drawnRects[zoomLevel]) this.drawnRects[zoomLevel] = {};\n\n            const circleDraw = [xStartPos, xEndPos, rectY, td, txStart, txEnd];\n\n            if (txStart <= focusRegion[1] && txEnd >= focusRegion[0]) {\n              circleFocusDraws.push(circleDraw);\n            } else {\n              circleDraws.push(circleDraw);\n            }\n          }\n        }\n\n        // 1. draw white background to make clicking easier\n        tile.rectGraphics.lineStyle(0);\n        tile.rectGraphics.beginFill(0xffffff);\n        circleDraws.forEach((circleDraw) => {\n          this.drawPoly(\n            tile,\n            circleDraw[0],\n            circleDraw[1],\n            circleDraw[2],\n            true\n          );\n        });\n\n        // 2. Now draw the normal circles\n        let color = this.options.markColor || 'black';\n        let opacity = this.options.fillOpacity || 0.3;\n        tile.rectGraphics.lineStyle(1, colorToHex(color), opacity);\n        tile.rectGraphics.beginFill(colorToHex(color), opacity);\n        circleDraws.forEach((circleDraw) => {\n          const drawnPoly = this.drawPoly(\n            tile,\n            circleDraw[0],\n            circleDraw[1],\n            circleDraw[2]\n          );\n          this.drawnRects[zoomLevel][circleDraw[4].uid] = [\n            drawnPoly,\n            {\n              start: circleDraw[4],\n              end: circleDraw[5],\n              value: circleDraw[3],\n              tile,\n              fill,\n            },\n            tile.tileId,\n          ];\n        });\n\n        // 2. Now draw the focused circles\n        color = this.options.markColorFocus || 'red';\n        opacity = this.options.markOpacityFocus || 0.6;\n        tile.rectGraphics.lineStyle(1, colorToHex(color), opacity);\n        tile.rectGraphics.beginFill(colorToHex(color), opacity);\n        circleFocusDraws.forEach((circleDraw) => {\n          const drawnPoly = this.drawPoly(\n            tile,\n            circleDraw[0],\n            circleDraw[1],\n            circleDraw[2]\n          );\n          this.drawnRects[zoomLevel][circleDraw[4].uid] = [\n            drawnPoly,\n            {\n              start: circleDraw[4],\n              end: circleDraw[5],\n              value: circleDraw[3],\n              tile,\n              fill,\n            },\n            tile.tileId,\n          ];\n        });\n        tile.rectGraphics.endFill();\n      }\n\n      tile.rectGraphics.interactive = true;\n      tile.rectGraphics.buttonMode = true;\n      tile.rectGraphics.mouseup = (event) => {\n        if (this.hoveringSnp) {\n          this.pubSub.publish('app.click', {\n            type: 'snp',\n            event,\n            payload: this.hoveringSnp,\n          });\n        }\n      };\n\n      return [circleDraws, circleFocusDraws];\n    }\n\n    /**\n     * Shows value and type for each bar\n     *\n     * @param trackX relative x-coordinate of mouse\n     * @param trackY relative y-coordinate of mouse\n     * @returns string with embedded values and svg square for color\n     */\n    getMouseOverHtml(trackX, trackY) {\n      this.hoveringSnp = undefined;\n\n      if (!this.tilesetInfo || !this.options.toolTip || !this.valueScale)\n        return '';\n\n      const zoomLevel = this.calculateZoomLevel();\n      const tileWidth = tileProxy.calculateTileWidth(\n        this.tilesetInfo,\n        zoomLevel,\n        this.tilesetInfo.tile_size\n      );\n\n      // the position of the tile containing the query position\n      const genomePos = this._xScale.invert(trackX);\n      const relTilePos = genomePos / tileWidth;\n      const tilePos = Math.floor(relTilePos);\n      const tileId = this.tileToLocalId([zoomLevel, tilePos]);\n      const fetchedTile = this.fetchedTiles[tileId];\n\n      if (!fetchedTile) return '';\n\n      let minDist = 3;\n      fetchedTile.tileData.forEach((item) => {\n        const dist = Math.abs(this._xScale(item.xStart) - trackX);\n        if (dist < minDist) {\n          this.hoveringSnp = item;\n          minDist = dist;\n        }\n      });\n\n      if (!this.hoveringSnp) return '';\n\n      const itemY = this.finalDotYPos(\n        this.valueScale(this.hoveringSnp.importance),\n        2\n      );\n\n      if (\n        Math.abs(itemY - (trackY - 1)) >\n        MAX_RADIUS * (MAX_RADIUS_EXTENSION + 1)\n      )\n        return '';\n\n      const name = this.hoveringSnp.fields[this.options.toolTip.name.field];\n      const value = (+this.hoveringSnp.fields[\n        this.options.toolTip.value.field\n      ]).toFixed(this.options.toolTip.value.numDecimals || 2);\n      let otherStr = '';\n\n      if (this.options.toolTip.other) {\n        this.options.toolTip.other.forEach((other) => {\n          const label = other.label || '';\n          const v = (+this.hoveringSnp.fields[other.field]).toFixed(\n            other.numDecimals || 2\n          );\n          otherStr += `${label}: ${v};`;\n        });\n        otherStr = ` (${otherStr.substr(0, otherStr.length - 1)})`;\n      }\n\n      return `<div><strong>${name}:</strong> ${value}${otherStr}</div>`;\n    }\n\n    /**\n     * Export an SVG representation of this track\n     *\n     * @returns {Array} The two returned DOM nodes are both SVG\n     * elements [base,track]. Base is a parent which contains track as a\n     * child. Track is clipped with a clipping rectangle contained in base.\n     *\n     */\n    exportSVG() {\n      let track = null;\n      let base = null;\n\n      [base, track] = super.exportSVG();\n\n      base.setAttribute('class', 'exported-snp-track');\n      const output = document.createElement('g');\n\n      track.appendChild(output);\n      output.setAttribute(\n        'transform',\n        `translate(${this.position[0]},${this.position[1]})`\n      );\n\n      this.visibleAndFetchedTiles()\n        .filter((tile) => tile.plusStrandRows)\n        .forEach((tile) => {\n          // call drawTile with storePolyStr = true so that\n          // we record path strings to use in the SVG\n          const [circles, focusedCircles] = this.renderRows(\n            tile,\n            tile.plusStrandRows,\n            tile.plusStrandRows.length,\n            0,\n            this.dimensions[1],\n            'blue'\n          );\n\n          circles.forEach((circle) => {\n            const c = document.createElement('circle');\n            c.setAttribute('fill', this.options.markColor || 'black');\n            c.setAttribute('stroke-width', 0);\n            c.setAttribute('opacity', this.options.markOpacity || 0.33);\n            c.setAttribute('r', this.options.markSize);\n            c.setAttribute('cx', circle[0]);\n            c.setAttribute('cy', circle[2]);\n            output.appendChild(c);\n          });\n\n          focusedCircles.forEach((circle) => {\n            const c = document.createElement('circle');\n            c.setAttribute('fill', this.options.markColorFocus || 'red');\n            c.setAttribute('stroke-width', 0);\n            c.setAttribute('opacity', this.options.markOpacityFocus || 0.66);\n            c.setAttribute('r', this.options.markSize + 1);\n            c.setAttribute('cx', circle[0]);\n            c.setAttribute('cy', circle[2]);\n            output.appendChild(c);\n          });\n        });\n\n      const gAxis = document.createElement('g');\n      gAxis.setAttribute('id', 'axis');\n\n      // append the axis to base so that it's not clipped\n      base.appendChild(gAxis);\n      gAxis.setAttribute(\n        'transform',\n        `translate(${this.axis.pAxis.position.x}, ${this.axis.pAxis.position.y})`\n      );\n\n      if (\n        this.options.axisPositionHorizontal === 'left' ||\n        this.options.axisPositionVertical === 'top'\n      ) {\n        const gDrawnAxis = this.axis.exportAxisLeftSVG(\n          this.valueScale,\n          this.dimensions[1]\n        );\n        gAxis.appendChild(gDrawnAxis);\n      } else if (\n        this.options.axisPositionHorizontal === 'right' ||\n        this.options.axisPositionVertical === 'bottom'\n      ) {\n        const gDrawnAxis = this.axis.exportAxisRightSVG(\n          this.valueScale,\n          this.dimensions[1]\n        );\n        gAxis.appendChild(gDrawnAxis);\n      }\n\n      return [base, track];\n    }\n  }\n\n  return new SnpTrack(...args);\n};\n\nconst icon =\n  '<svg viewBox=\"0 0 16 16\" xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" clip-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-miterlimit=\"1.5\"><path d=\"M4 2.1L.5 3.5v12l5-2 5 2 5-2v-12l-5 2-3.17-1.268\" fill=\"none\" stroke=\"currentColor\"/><path d=\"M10.5 3.5v12\" fill=\"none\" stroke=\"currentColor\" stroke-opacity=\".33\" stroke-dasharray=\"1,2,0,0\"/><path d=\"M5.5 13.5V6\" fill=\"none\" stroke=\"currentColor\" stroke-opacity=\".33\" stroke-width=\".9969299999999999\" stroke-dasharray=\"1.71,3.43,0,0\"/><path d=\"M9.03 5l.053.003.054.006.054.008.054.012.052.015.052.017.05.02.05.024 4 2 .048.026.048.03.046.03.044.034.042.037.04.04.037.04.036.042.032.045.03.047.028.048.025.05.022.05.02.053.016.053.014.055.01.055.007.055.005.055v.056l-.002.056-.005.055-.008.055-.01.055-.015.054-.017.054-.02.052-.023.05-.026.05-.028.048-.03.046-.035.044-.035.043-.038.04-4 4-.04.037-.04.036-.044.032-.045.03-.046.03-.048.024-.05.023-.05.02-.052.016-.052.015-.053.012-.054.01-.054.005-.055.003H8.97l-.053-.003-.054-.006-.054-.008-.054-.012-.052-.015-.052-.017-.05-.02-.05-.024-4-2-.048-.026-.048-.03-.046-.03-.044-.034-.042-.037-.04-.04-.037-.04-.036-.042-.032-.045-.03-.047-.028-.048-.025-.05-.022-.05-.02-.053-.016-.053-.014-.055-.01-.055-.007-.055L4 10.05v-.056l.002-.056.005-.055.008-.055.01-.055.015-.054.017-.054.02-.052.023-.05.026-.05.028-.048.03-.046.035-.044.035-.043.038-.04 4-4 .04-.037.04-.036.044-.032.045-.03.046-.03.048-.024.05-.023.05-.02.052-.016.052-.015.053-.012.054-.01.054-.005L8.976 5h.054zM5 10l4 2 4-4-4-2-4 4z\" fill=\"currentColor\"/><path d=\"M7.124 0C7.884 0 8.5.616 8.5 1.376v3.748c0 .76-.616 1.376-1.376 1.376H3.876c-.76 0-1.376-.616-1.376-1.376V1.376C2.5.616 3.116 0 3.876 0h3.248zm.56 5.295L5.965 1H5.05L3.375 5.295h.92l.354-.976h1.716l.375.975h.945zm-1.596-1.7l-.592-1.593-.58 1.594h1.172z\" fill=\"currentColor\"/></svg>';\n\ncreateSnpTrack.config = {\n  type: 'point-annotation',\n  datatype: ['arcs', 'bedlike'],\n  orientation: '1d',\n  name: 'Arcs1D',\n  thumbnail: new DOMParser().parseFromString(icon, 'text/xml').documentElement,\n  availableOptions: [\n    'arcStyle',\n    'flip1D',\n    'labelPosition',\n    'labelColor',\n    'labelTextOpacity',\n    'labelBackgroundOpacity',\n    'strokeColor',\n    'strokeWidth',\n    'trackBorderWidth',\n    'trackBorderColor',\n  ],\n  defaultOptions: {\n    arcStyle: 'ellipse',\n    flip1D: 'no',\n    labelColor: 'black',\n    labelPosition: 'hidden',\n    strokeColor: 'black',\n    strokeWidth: 1,\n    trackBorderWidth: 0,\n    trackBorderColor: 'black',\n  },\n  optionsInfo: {\n    arcStyle: {\n      name: 'Arc Style',\n      inlineOptions: {\n        circle: {\n          name: 'Circle',\n          value: 'circle',\n        },\n        ellipse: {\n          name: 'Ellipse',\n          value: 'ellipse',\n        },\n      },\n    },\n  },\n};\n\nexport default createSnpTrack;\n","import {\n  DEFAULT_COLOR_MAP,\n  DEFAULT_COLOR_MAP_DARK,\n  DEFAULT_COLOR_MAP_LIGHT,\n} from './constants';\nimport { createColorTexture } from './utils';\n\nconst DEFAULT_TILE_SIZE = 1024;\n\nconst DEFAULT_BIN_SIZE = 8; // 8 \"tile-pixels\" make up one bin by default\n\nconst VS = `\nprecision mediump float;\nattribute vec2 aPosition;\nattribute float aColorIdx;\nattribute float aFocused;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform sampler2D uColorMapTex;\nuniform float uColorMapTexRes;\nuniform sampler2D uColorMapFocusTex;\nuniform float uColorMapFocusTexRes;\n\nvarying vec4 vColor;\nvarying vec4 vColorFocused;\nvarying float vFocused;\n\nvoid main(void)\n{\n  // Half a texel (i.e., pixel in texture coordinates)\n  float eps = 0.5 / uColorMapTexRes;\n  float colorRowIndex = floor((aColorIdx + eps) / uColorMapTexRes);\n  vec2 colorTexIndex = vec2(\n    (aColorIdx / uColorMapTexRes) - colorRowIndex + eps,\n    (colorRowIndex / uColorMapTexRes) + eps\n  );\n  vColor = texture2D(uColorMapTex, colorTexIndex);\n\n  float eps2 = 0.5 / uColorMapFocusTexRes;\n  float colorRowIndex2 = floor((aColorIdx + eps2) / uColorMapFocusTexRes);\n  vec2 colorTexIndex2 = vec2(\n    (aColorIdx / uColorMapFocusTexRes) - colorRowIndex2 + eps2,\n    (colorRowIndex2 / uColorMapFocusTexRes) + eps2\n  );\n  vColorFocused = texture2D(uColorMapFocusTex, colorTexIndex2);\n\n  vFocused = aFocused;\n\n  gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aPosition, 1.0)).xy, 0.0, 1.0);\n}\n`;\n\nconst FS = `\n  precision mediump float;\n\n  varying vec4 vColor;\n  varying vec4 vColorFocused;\n  varying float vFocused;\n\n  void main() {\n    float isNotFocused = 1.0 - vFocused;\n\n    float r = vColor.r * isNotFocused + vColorFocused.r * vFocused;\n    float g = vColor.g * isNotFocused + vColorFocused.g * vFocused;\n    float b = vColor.b * isNotFocused + vColorFocused.b * vFocused;\n\n    gl_FragColor = vec4(r, g, b, 1.0);\n  }\n`;\n\nconst getIs2d = (tile) =>\n  tile.tileData.length && tile.tileData[0].yStart !== undefined;\n\nconst get1dStart = (item) => item.xStart;\n\nconst get2dStart = (item) => item.xStart + (item.xEnd - item.xStart) / 2;\n\nconst get1dEnd = (item) => item.xEnd;\n\nconst get2dEnd = (item) => item.yStart + (item.yEnd - item.yStart) / 2;\n\nconst getHistMax = (fetchedTiles) =>\n  fetchedTiles.reduce(\n    (histMax, tile) => Math.max(histMax, tile.histogramMax),\n    0\n  );\n\nconst scaleScalableGraphics = (graphics, xScale, drawnAtScale) => {\n  const tileK =\n    (drawnAtScale.domain()[1] - drawnAtScale.domain()[0]) /\n    (xScale.domain()[1] - xScale.domain()[0]);\n  const newRange = xScale.domain().map(drawnAtScale);\n\n  const posOffset = newRange[0];\n  graphics.scale.x = tileK;\n  graphics.position.x = -posOffset * tileK;\n};\n\n// prettier-ignore\nconst segmentToPosition = (segment) => [\n  segment.xStart, segment.yStart,\n  segment.xEnd, segment.yStart,\n  segment.xEnd, segment.yEnd,\n  segment.xStart, segment.yStart,\n  segment.xStart, segment.yEnd,\n  segment.xEnd, segment.yEnd,\n];\n\nconst segmentToColorIdx = (segment) => [\n  segment.colorIdx,\n  segment.colorIdx,\n  segment.colorIdx,\n  segment.colorIdx,\n  segment.colorIdx,\n  segment.colorIdx,\n];\n\nconst segmentToFocused = (segment) => [\n  segment.focused,\n  segment.focused,\n  segment.focused,\n  segment.focused,\n  segment.focused,\n  segment.focused,\n];\n\nconst createStackedBarTrack = function createStackedBarTrack(HGC, ...args) {\n  if (!new.target) {\n    throw new Error(\n      'Uncaught TypeError: Class constructor cannot be invoked without \"new\"'\n    );\n  }\n\n  const { PIXI } = HGC.libraries;\n  const { scaleLinear, scaleLog } = HGC.libraries.d3Scale;\n  const { tileProxy } = HGC.services;\n  const { colorToHex } = HGC.utils;\n\n  const opacityLogScale = scaleLog()\n    .domain([1, 10])\n    .range([0.1, 1])\n    .clamp(true);\n\n  const toRgbNorm = (color) =>\n    HGC.utils\n      .colorToRgba(color)\n      .slice(0, 3)\n      .map((x) => Math.min(1, Math.max(0, x / 255)));\n\n  class StackedBarTrack extends HGC.tracks.HorizontalLine1DPixiTrack {\n    constructor(context, options) {\n      super(context, options);\n\n      this.updateOptions();\n\n      this.pLoading = new PIXI.Graphics();\n      this.pLoading.position.x = 0;\n      this.pLoading.position.y = 0;\n      this.pMasked.addChild(this.pLoading);\n\n      this.loadIndicator = new PIXI.Text('Loading data...', {\n        fontSize: this.labelSize || 10,\n        fill: 0x808080,\n      });\n      this.pLoading.addChild(this.loadIndicator);\n    }\n\n    initTile(tile) {\n      const is2d = getIs2d(tile);\n      const getStart = is2d ? get2dStart : get1dStart;\n      const getEnd = is2d ? get2dEnd : get1dEnd;\n\n      tile.tileData.forEach((item) => {\n        item.start = getStart(item);\n        item.end = getEnd(item);\n        item.isLeftToRight = item.start < item.end;\n      });\n\n      tile.histogramMax = 0;\n\n      this.updateTileFocusMap(tile);\n    }\n\n    updateTileHistogram(tile) {\n      const { tileX, tileWidth } = this.getTilePosAndDimensions(\n        tile.tileData.zoomLevel,\n        tile.tileData.tilePos\n      );\n      const binSize = tileWidth / this.numBins;\n\n      tile.binXPos = new Float32Array(this.numBins + 1);\n      tile.histogram1d = new Float32Array(this.numBins);\n      tile.histogram2d = new Float32Array(this.numBins * this.numGroups);\n      tile.histogram2dNumPred = new Uint8Array(this.numBins * this.numGroups);\n\n      let max = 0;\n\n      // Determine bin boundaries\n      for (let i = 0; i <= this.numBins; i++) {\n        tile.binXPos[i] = tileX + binSize * i;\n      }\n\n      const categoryBinHash = new Map();\n      const maxBinId = this.numBins - 1;\n\n      tile.tileData.filter(this.itemFilter).forEach((item) => {\n        const group = this.categoryToGroup.get(\n          item.fields[this.categoryField].toLowerCase()\n        );\n        const binStart = Math.max(\n          0,\n          Math.min(\n            maxBinId,\n            Math.round((this.getStart(item) - tileX) / binSize)\n          )\n        );\n        const binEnd = Math.max(\n          0,\n          Math.min(maxBinId, Math.round((this.getEnd(item) - tileX) / binSize))\n        );\n        const numBins = Math.abs(binEnd - binStart);\n        const score = this.getImportance(item);\n        const category = this.getCategory(item);\n        const base = group * this.numBins;\n\n        for (let i = 0; i <= numBins; i++) {\n          const bin = binStart + i;\n          const histIdx = base + bin;\n\n          const binHash = categoryBinHash.get(category) || {};\n\n          // Make sure we count multiple enhancer predictions of the same\n          // biosample and bin only once (i.e., summing up)\n          if (!binHash[bin]) {\n            binHash[bin] = binHash[bin] || score > 0;\n            tile.histogram2dNumPred[histIdx] += binHash[bin];\n            categoryBinHash.set(category, binHash);\n          }\n\n          tile.histogram2d[histIdx] += score;\n          tile.histogram1d[bin] += score;\n\n          max = Math.max(max, tile.histogram1d[bin]);\n        }\n      });\n\n      tile.histogramMax = max;\n    }\n\n    updateHistograms() {\n      Object.values(this.fetchedTiles).forEach(\n        this.updateTileHistogram.bind(this)\n      );\n    }\n\n    updateTileFocusMap(tile) {\n      tile.focusMap = new Float32Array(this.numBins);\n\n      const { tileX, tileWidth } = this.getTilePosAndDimensions(\n        tile.tileData.zoomLevel,\n        tile.tileData.tilePos\n      );\n\n      if (\n        tileX <= this.focusRegion[1] &&\n        tileX + tileWidth >= this.focusRegion[0]\n      ) {\n        const binSize = tileWidth / this.numBins;\n\n        const binStart = Math.max(\n          0,\n          Math.round((this.focusRegion[0] - tileX) / binSize)\n        );\n        const binEnd = Math.min(\n          this.numBins - 1,\n          Math.round((this.focusRegion[1] - tileX) / binSize)\n        );\n        const numBins = Math.abs(binEnd - binStart);\n\n        for (let i = 0; i <= numBins; i++) {\n          tile.focusMap[i] = 1;\n        }\n      }\n    }\n\n    updateFocusMap() {\n      Object.values(this.fetchedTiles).forEach(\n        this.updateTileFocusMap.bind(this)\n      );\n    }\n\n    updateStratificationOption() {\n      if (!this.options.stratification) {\n        this.categoryField = undefined;\n        this.categoryToGroup = undefined;\n        this.groupToColor = undefined;\n        this.numGroups = 0;\n        this.numFilteredGroups = 0;\n        this.numCategories = 0;\n        this.groupLabels = [];\n        return;\n      }\n\n      this.categoryField = this.options.stratification.categoryField;\n      this.getCategory = (item) =>\n        item.fields[this.categoryField].toLowerCase();\n      this.categoryToGroup = new Map();\n      this.categoryToY = new Map();\n      this.groupToColor = new Map();\n\n      this.groupSizes = this.options.stratification.groups.map(\n        (group) =>\n          group.categories.filter((category) => this.valueFilter(category))\n            .length\n      );\n      this.filteredGroups = this.options.stratification.groups.filter(\n        (group, i) => this.groupSizes[i] > 0\n      );\n      this.numGroups = this.options.stratification.groups.length;\n      this.numFilteredGroups = this.filteredGroups.length;\n      this.numCategories = this.groupSizes.reduce(\n        (numCategories, groupSize) => numCategories + groupSize,\n        0\n      );\n      this.groupLabels = this.options.stratification.groups.map(\n        (group, i) => group.label || `Group ${i}`\n      );\n\n      let k = 0;\n      this.options.stratification.groups.forEach((group, i) => {\n        this.groupToColor.set(i, [\n          colorToHex(\n            group.color || DEFAULT_COLOR_MAP[i % DEFAULT_COLOR_MAP.length]\n          ),\n          colorToHex(\n            group.backgroundColor ||\n              DEFAULT_COLOR_MAP_LIGHT[i % DEFAULT_COLOR_MAP_LIGHT.length]\n          ),\n        ]);\n        group.categories\n          .filter((category) => this.valueFilter(category))\n          .forEach((category, j) => {\n            this.categoryToGroup.set(category.toLowerCase(), i);\n            this.categoryToY.set(category.toLowerCase(), k + j);\n          });\n        k += this.groupSizes[i];\n      });\n\n      this.groupLabelsPixiText = this.groupLabels.map(\n        (label, i) =>\n          new PIXI.Text(label, {\n            fontSize: this.labelSize,\n            // fill: this.labelColor,\n            align: this.axisAlign === 'right' ? 'right' : 'left',\n            fill: colorToHex(\n              this.options.stratification.groups[i].axisLabelColor ||\n                DEFAULT_COLOR_MAP_DARK[i % DEFAULT_COLOR_MAP_DARK.length]\n            ),\n          })\n      );\n    }\n\n    updateOptions() {\n      this.axisAlign = this.options.axisAlign || 'left';\n\n      this.labelColor = colorToHex(this.options.labelColor || 'black');\n\n      this.labelSize = this.options.labelSize || 12;\n\n      this.colorMap = this.options.colorMap || [...DEFAULT_COLOR_MAP];\n\n      this.colorMapRgbNorm = this.colorMap.map(toRgbNorm);\n\n      [this.colorMapTex, this.colorMapTexRes] = createColorTexture(\n        PIXI,\n        this.colorMapRgbNorm\n      );\n\n      this.colorMapFocus = this.options.colorMapFocus || [\n        ...DEFAULT_COLOR_MAP_DARK,\n      ];\n\n      this.colorMapFocusRgbNorm = this.colorMapFocus.map(toRgbNorm);\n\n      [this.colorMapFocusTex, this.colorMapFocusTexRes] = createColorTexture(\n        PIXI,\n        this.colorMapFocusRgbNorm\n      );\n\n      this.markColor = colorToHex(this.options.markColor || 'black');\n\n      this.markColorRgbNorm = this.options.markColor\n        ? toRgbNorm(this.options.markColor)\n        : [0, 0, 0];\n\n      this.markOpacity = Number.isNaN(+this.options.markOpacity)\n        ? 1\n        : Math.min(1, Math.max(0, +this.options.markOpacity));\n\n      this.markSize = this.options.markSize || 2;\n\n      this.markColorFocus = colorToHex(this.options.markColorFocus || 'red');\n\n      this.markColorFocusRgbNorm = this.options.markColorFocus\n        ? toRgbNorm(this.options.markColorFocus)\n        : [1, 0, 0];\n\n      this.markOpacityFocus = Number.isNaN(+this.options.markOpacityFocus)\n        ? this.markOpacity\n        : Math.min(1, Math.max(0, +this.options.markOpacityFocus));\n\n      this.markSizeFocus = this.options.markSizeFocus || this.markSize;\n\n      this.binSize = this.options.binSize || DEFAULT_BIN_SIZE;\n\n      this.numBins = this.tilesetInfo\n        ? Math.round(this.tilesetInfo.tile_size / this.binSize)\n        : DEFAULT_TILE_SIZE / this.binSize;\n\n      this.getOffset = this.options.offsetField\n        ? (item) => this.chromOffsets[item.fields[this.options.offsetField]]\n        : () => 0;\n\n      this.getStart = this.options.startField\n        ? (item) => this.getOffset(item) + +item.fields[this.options.startField]\n        : (item) => item.xStart;\n\n      this.getEnd = this.options.endField\n        ? (item) => this.getOffset(item) + +item.fields[this.options.endField]\n        : (item) => item.xEnd;\n\n      this.getImportance = this.options.importanceField\n        ? (item) => +item.fields[this.options.importanceField]\n        : () => 1;\n\n      const importanceDomain = this.options.importanceDomain || [1000, 1];\n\n      this.filterSet =\n        this.options.filter && this.options.filter.set\n          ? this.options.filter.set.reduce((s, include) => {\n              s.add(include);\n              return s;\n            }, new Set())\n          : null;\n\n      this.filterField = this.options.filter && this.options.filter.field;\n\n      this.valueFilter = this.filterSet\n        ? (value) => this.filterSet.has(value)\n        : () => true;\n\n      this.itemFilter =\n        this.valueFilter && this.filterField\n          ? (item) => this.valueFilter(item.fields[this.filterField])\n          : () => true;\n\n      const opacityLinearScale = scaleLinear()\n        .domain(importanceDomain)\n        .range([1, 10]);\n\n      this.opacityScale = (x) => opacityLogScale(opacityLinearScale(x));\n\n      this.focusRegion = this.options.focusRegion\n        ? this.options.focusRegion\n        : [Infinity, Infinity];\n\n      this.focusGene = this.options.focusGene\n        ? this.options.focusGene.toLowerCase()\n        : undefined;\n\n      this.minImportance = this.options.minImportance || 0;\n\n      this.updateStratificationOption();\n\n      this.updateFocusMap();\n      this.updateHistograms();\n      this.updateScales();\n    }\n\n    updateLoadIndicator() {\n      const [left, top] = this.position;\n      this.pLoading.position.x = left + 6;\n      this.pLoading.position.y = top + 6;\n\n      if (this.fetching.size) {\n        this.pLoading.addChild(this.loadIndicator);\n      } else {\n        this.pLoading.removeChild(this.loadIndicator);\n      }\n    }\n\n    computeChromOffets() {\n      if (!this.tilesetInfo) return;\n      const chroms = this.tilesetInfo.chrom_names.split('\\t');\n      const chromSizes = this.tilesetInfo.chrom_sizes\n        .split('\\t')\n        .map((size) => +size);\n      // eslint-disable-next-line prefer-destructuring\n      this.chromOffsets = chroms.reduce(\n        ([offsets, cumSum], chrom, i) => {\n          offsets[chrom] = cumSum;\n          return [offsets, cumSum + chromSizes[i]];\n        },\n        [{}, 0]\n      )[0];\n    }\n\n    refreshTiles(...brgs) {\n      super.refreshTiles(...brgs);\n      this.computeChromOffets();\n      this.updateLoadIndicator();\n      if (this.tilesetInfo) {\n        const oldNumBins = this.numBins;\n        this.numBins = Math.round(this.tilesetInfo.tile_size / this.binSize);\n        if (oldNumBins !== this.numBins) {\n          this.updateHistograms();\n          this.updateScales();\n        }\n      }\n    }\n\n    rerender(newOptions) {\n      this.options = newOptions;\n      this.updateOptions();\n      this.updateExistingGraphics();\n    }\n\n    updateScales() {\n      const fetchedTiles = Object.values(this.fetchedTiles);\n\n      if (!fetchedTiles.length) return;\n\n      const [, height] = this.dimensions;\n\n      this.histMax = getHistMax(fetchedTiles);\n\n      this.heightScale = scaleLinear()\n        .domain([0, this.histMax])\n        .range([height, 0]);\n\n      this.valueScale = this.heightScale;\n\n      this.valueScaleInverted = scaleLinear()\n        .domain([0, this.histMax])\n        .range([0, height]);\n    }\n\n    itemToPoint(item) {\n      return {\n        xStart: this._xScale(item.start),\n        xEnd: this._xScale(item.start),\n        yStart: this.heightScale(\n          this.categoryToY.get(item.fields[this.categoryField].toLowerCase())\n        ),\n        yEnd: () => {},\n        opacity: this.opacityScale(this.getImportance(item)),\n        focused:\n          item.xStart <= this.focusRegion[1] &&\n          item.xEnd >= this.focusRegion[0],\n      };\n    }\n\n    histToSegments(tile) {\n      const segments = [];\n\n      for (let i = 0; i < this.numBins; i++) {\n        let cumHeight = 0;\n        if (tile.histogram1d[i] > 0) {\n          for (let j = 0; j < this.numGroups; j++) {\n            const height = tile.histogram2d[j * this.numBins + i];\n\n            if (height) {\n              segments.push({\n                xStart: this._xScale(tile.binXPos[i]),\n                xEnd: this._xScale(tile.binXPos[i + 1]),\n                yStart: this.heightScale(cumHeight),\n                yEnd: this.heightScale(cumHeight + height),\n                colorIdx: j % this.colorMap.length,\n                focused: tile.focusMap[i],\n              });\n\n              cumHeight += height;\n            }\n          }\n        }\n      }\n\n      return segments;\n    }\n\n    renderStackedBars() {\n      this.drawnAtScale = scaleLinear()\n        .domain([...this.xScale().domain()])\n        .range([...this.xScale().range()]);\n\n      const segments = Object.values(this.fetchedTiles).flatMap(\n        this.histToSegments.bind(this)\n      );\n\n      const positions = new Float32Array(segments.flatMap(segmentToPosition));\n      const colorIdxs = new Float32Array(segments.flatMap(segmentToColorIdx));\n      const focused = new Float32Array(segments.flatMap(segmentToFocused));\n\n      const uniforms = new PIXI.UniformGroup({\n        uColorMapTex: this.colorMapTex,\n        uColorMapTexRes: this.colorMapTexRes,\n        uColorMapFocus: this.colorMapFocusTex,\n        uColorMapFocusTexRes: this.colorMapFocusTexRes,\n      });\n\n      const shader = PIXI.Shader.from(VS, FS, uniforms);\n\n      const geometry = new PIXI.Geometry();\n      geometry.addAttribute('aPosition', positions, 2);\n      geometry.addAttribute('aColorIdx', colorIdxs, 1);\n      geometry.addAttribute('aFocused', focused, 1);\n\n      const mesh = new PIXI.Mesh(\n        geometry,\n        shader,\n        new PIXI.State(),\n        PIXI.DRAW_MODES.TRIANGLES\n      );\n\n      const newGraphics = new PIXI.Graphics();\n      newGraphics.addChild(mesh);\n\n      // eslint-disable-next-line\n      this.pMain.x = this.position[0];\n\n      if (this.indicatorPointGraphics) {\n        this.pMain.removeChild(this.indicatorPointGraphics);\n      }\n\n      this.pMain.addChild(newGraphics);\n      this.indicatorPointGraphics = newGraphics;\n\n      scaleScalableGraphics(\n        this.indicatorPointGraphics,\n        this._xScale,\n        this.drawnAtScale\n      );\n\n      this.draw();\n      this.animate();\n    }\n\n    renderTrack() {\n      this.drawAxis(this.valueScaleInverted);\n      this.renderStackedBars();\n    }\n\n    hasFetchedTiles() {\n      return Object.values(this.fetchedTiles).length;\n    }\n\n    // Called whenever a new tile comes in\n    updateExistingGraphics() {\n      this.updateLoadIndicator();\n      if (!this.hasFetchedTiles()) return;\n      this.updateHistograms();\n      this.updateScales();\n      this.renderTrack();\n    }\n\n    /**\n     * Shows value and type for each bar\n     *\n     * @param trackX relative x-coordinate of mouse\n     * @param trackY relative y-coordinate of mouse\n     * @returns string with embedded values and svg square for color\n     */\n    getMouseOverHtml(trackX, trackY) {\n      if (!this.tilesetInfo) return '';\n\n      const zoomLevel = this.calculateZoomLevel();\n      const tileWidth = tileProxy.calculateTileWidth(\n        this.tilesetInfo,\n        zoomLevel,\n        this.tilesetInfo.tile_size\n      );\n\n      // the position of the tile containing the query position\n      const relTilePos = this._xScale.invert(trackX) / tileWidth;\n      const tilePos = Math.floor(relTilePos);\n      const tileId = this.tileToLocalId([zoomLevel, tilePos]);\n      const fetchedTile = this.fetchedTiles[tileId];\n\n      if (!fetchedTile) return '';\n\n      const relPos = relTilePos - tilePos;\n      const binXPos = Math.floor(this.numBins * relPos);\n\n      const rowCumSum = [];\n      const rowNumPred = [];\n      let totalPred = 0;\n      let sum = 0;\n      for (let i = 0; i < this.numGroups; i++) {\n        sum += fetchedTile.histogram2d[i * this.numBins + binXPos];\n        const numPred =\n          fetchedTile.histogram2dNumPred[i * this.numBins + binXPos];\n        rowNumPred.push(numPred);\n        totalPred += numPred;\n        rowCumSum.push(sum);\n      }\n\n      const relYPos = this.heightScale.invert(trackY);\n      const group = rowCumSum.findIndex((cumHeight) => cumHeight > relYPos);\n\n      if (group >= 0) {\n        const [color, bg] = this.groupToColor.get(group);\n        const colorHex = `#${color.toString(16)}`;\n        const bgHex = `#${bg.toString(16)}`;\n        const value =\n          fetchedTile.histogram2dNumPred[group * this.numBins + binXPos];\n        return `<div style=\"margin: -0.25rem; padding: 0 0.25rem; background: ${bgHex}\"><strong style=\"color: ${colorHex};\">${this.groupLabels[group]}:</strong> ${value} of ${totalPred} samples</div>`;\n      }\n\n      return '';\n    }\n\n    setPosition(newPosition) {\n      super.setPosition(newPosition);\n\n      [this.pMain.position.x, this.pMain.position.y] = this.position;\n    }\n\n    zoomed(newXScale, newYScale) {\n      this.xScale(newXScale);\n      this.yScale(newYScale);\n\n      if (this.indicatorPointGraphics) {\n        scaleScalableGraphics(\n          this.indicatorPointGraphics,\n          newXScale,\n          this.drawnAtScale\n        );\n      }\n\n      this.refreshTiles();\n      this.draw();\n    }\n\n    /**\n     * Export an SVG representation of this track\n     *\n     * @returns {Array} The two returned DOM nodes are both SVG\n     * elements [base,track]. Base is a parent which contains track as a\n     * child. Track is clipped with a clipping rectangle contained in base.\n     *\n     */\n    exportSVG() {\n      let track = null;\n      let base = null;\n\n      [base, track] = super.superSVG();\n\n      base.setAttribute('class', 'exported-stacked-bar-track');\n      const output = document.createElement('g');\n\n      track.appendChild(output);\n      output.setAttribute(\n        'transform',\n        `translate(${this.position[0]},${this.position[1]})`\n      );\n\n      const segments = Object.values(this.fetchedTiles).flatMap(\n        this.histToSegments.bind(this)\n      );\n\n      segments.forEach(({ xStart, xEnd, yStart, yEnd, colorIdx }) => {\n        const r = document.createElement('rect');\n\n        r.setAttribute('x', xEnd);\n        r.setAttribute('y', yEnd);\n        r.setAttribute('width', Math.abs(xEnd - xStart));\n        r.setAttribute('height', Math.abs(yEnd - yStart));\n        r.setAttribute('fill', this.colorMap[colorIdx]);\n        r.setAttribute('stroke-width', 0);\n\n        output.appendChild(r);\n      });\n\n      const gAxis = document.createElement('g');\n      gAxis.setAttribute('id', 'axis');\n\n      // append the axis to base so that it's not clipped\n      base.appendChild(gAxis);\n      gAxis.setAttribute(\n        'transform',\n        `translate(${this.axis.pAxis.position.x}, ${this.axis.pAxis.position.y})`\n      );\n\n      if (\n        this.options.axisPositionHorizontal === 'left' ||\n        this.options.axisPositionVertical === 'top'\n      ) {\n        const gDrawnAxis = this.axis.exportAxisLeftSVG(\n          this.valueScale,\n          this.dimensions[1]\n        );\n        gAxis.appendChild(gDrawnAxis);\n      } else if (\n        this.options.axisPositionHorizontal === 'right' ||\n        this.options.axisPositionVertical === 'bottom'\n      ) {\n        const gDrawnAxis = this.axis.exportAxisRightSVG(\n          this.valueScale,\n          this.dimensions[1]\n        );\n        gAxis.appendChild(gDrawnAxis);\n      }\n\n      return [base, track];\n    }\n  }\n\n  return new StackedBarTrack(...args);\n};\n\nconst icon =\n  '<svg viewBox=\"0 0 16 16\" xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" clip-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-miterlimit=\"1.5\"><path d=\"M4 2.1L.5 3.5v12l5-2 5 2 5-2v-12l-5 2-3.17-1.268\" fill=\"none\" stroke=\"currentColor\"/><path d=\"M10.5 3.5v12\" fill=\"none\" stroke=\"currentColor\" stroke-opacity=\".33\" stroke-dasharray=\"1,2,0,0\"/><path d=\"M5.5 13.5V6\" fill=\"none\" stroke=\"currentColor\" stroke-opacity=\".33\" stroke-width=\".9969299999999999\" stroke-dasharray=\"1.71,3.43,0,0\"/><path d=\"M9.03 5l.053.003.054.006.054.008.054.012.052.015.052.017.05.02.05.024 4 2 .048.026.048.03.046.03.044.034.042.037.04.04.037.04.036.042.032.045.03.047.028.048.025.05.022.05.02.053.016.053.014.055.01.055.007.055.005.055v.056l-.002.056-.005.055-.008.055-.01.055-.015.054-.017.054-.02.052-.023.05-.026.05-.028.048-.03.046-.035.044-.035.043-.038.04-4 4-.04.037-.04.036-.044.032-.045.03-.046.03-.048.024-.05.023-.05.02-.052.016-.052.015-.053.012-.054.01-.054.005-.055.003H8.97l-.053-.003-.054-.006-.054-.008-.054-.012-.052-.015-.052-.017-.05-.02-.05-.024-4-2-.048-.026-.048-.03-.046-.03-.044-.034-.042-.037-.04-.04-.037-.04-.036-.042-.032-.045-.03-.047-.028-.048-.025-.05-.022-.05-.02-.053-.016-.053-.014-.055-.01-.055-.007-.055L4 10.05v-.056l.002-.056.005-.055.008-.055.01-.055.015-.054.017-.054.02-.052.023-.05.026-.05.028-.048.03-.046.035-.044.035-.043.038-.04 4-4 .04-.037.04-.036.044-.032.045-.03.046-.03.048-.024.05-.023.05-.02.052-.016.052-.015.053-.012.054-.01.054-.005L8.976 5h.054zM5 10l4 2 4-4-4-2-4 4z\" fill=\"currentColor\"/><path d=\"M7.124 0C7.884 0 8.5.616 8.5 1.376v3.748c0 .76-.616 1.376-1.376 1.376H3.876c-.76 0-1.376-.616-1.376-1.376V1.376C2.5.616 3.116 0 3.876 0h3.248zm.56 5.295L5.965 1H5.05L3.375 5.295h.92l.354-.976h1.716l.375.975h.945zm-1.596-1.7l-.592-1.593-.58 1.594h1.172z\" fill=\"currentColor\"/></svg>';\n\ncreateStackedBarTrack.config = {\n  type: 'stacked-bar',\n  datatype: ['bedlike'],\n  orientation: '1d',\n  name: 'Advanced Stacked Bars Track',\n  thumbnail: new DOMParser().parseFromString(icon, 'text/xml').documentElement,\n  availableOptions: [\n    'flip1D',\n    'labelPosition',\n    'labelColor',\n    'labelTextOpacity',\n    'labelBackgroundOpacity',\n    'strokeColor',\n    'strokeWidth',\n    'trackBorderWidth',\n    'trackBorderColor',\n  ],\n  defaultOptions: {\n    flip1D: 'no',\n    labelColor: 'black',\n    labelPosition: 'hidden',\n    strokeColor: 'black',\n    strokeWidth: 1,\n    trackBorderWidth: 0,\n    trackBorderColor: 'black',\n  },\n};\n\nexport default createStackedBarTrack;\n","import createPubSub from 'pub-sub-es';\n\nfunction createTssTrack(HGC, ...args) {\n  if (!new.target) {\n    throw new Error(\n      'Uncaught TypeError: Class constructor cannot be invoked without \"new\"'\n    );\n  }\n\n  class TssTrack extends HGC.tracks.BedLikeTrack {\n    constructor(context, options) {\n      super(context, options);\n\n      const { publish, subscribe, unsubscribe } = createPubSub();\n      this.publish = publish;\n      this.subscribe = subscribe;\n      this.unsubscribe = unsubscribe;\n    }\n\n    drawPoly(tile, xStartPos, xEndPos, rectY, doubleRadius = false) {\n      // prettier-ignore\n      const drawnPoly = [\n        // left top\n        xStartPos, rectY,\n        // right top\n        xEndPos, rectY,\n        // right bottom\n        xEndPos, this.dimensions[1],\n         // left bottom\n        xStartPos, this.dimensions[1]\n      ];\n\n      const anchorRadius = 1;\n      const radius = 2;\n\n      tile.rectGraphics.drawCircle(\n        xStartPos,\n        this.finalDotYPos(rectY, anchorRadius),\n        radius\n      );\n\n      return drawnPoly;\n    }\n\n    renderRows(tile, rows, maxRows, startY, endY, fill) {\n      const zoomLevel = +tile.tileId.split('.')[0];\n\n      this.initialize();\n\n      const focusRegion = this.options.focusRegion || [Infinity, Infinity];\n\n      const circleDraws = [];\n      const circleFocusDraws = [];\n\n      for (let j = 0; j < rows.length; j++) {\n        for (let i = 0; i < rows[j].length; i++) {\n          const td = rows[j][i].value;\n          const geneInfo = td.fields;\n\n          // the returned positions are chromosome-based and they need to\n          // be converted to genome-based\n          const chrOffset = +td.chrOffset;\n          const txStart = +geneInfo[1] + chrOffset;\n          const txEnd = +geneInfo[2] + chrOffset;\n\n          const xStartPos = this._xScale(txStart);\n          const xEndPos = this._xScale(txEnd);\n\n          // don't draw anything that has already been drawn\n          if (\n            !(\n              zoomLevel in this.drawnRects &&\n              td.uid in this.drawnRects[zoomLevel]\n            )\n          ) {\n            if (!this.drawnRects[zoomLevel]) this.drawnRects[zoomLevel] = {};\n\n            const circleDraw = {\n              xStartScreen: xStartPos,\n              xEndScreen: xEndPos,\n              xStartAbs: txStart,\n              xEndAbs: txEnd,\n              data: td,\n            };\n\n            if (txStart <= focusRegion[1] && txEnd >= focusRegion[0]) {\n              circleFocusDraws.push(circleDraw);\n            } else {\n              circleDraws.push(circleDraw);\n            }\n          }\n        }\n\n        circleDraws.forEach((circleDraw) => {\n          this.publish('annotationDrawn', circleDraw);\n        });\n      }\n    }\n\n    rerender() {\n      // Monkey patch because TiledPixiTrack doesn't always fire correctly\n      this.draw();\n      this.publish('tilesDrawn', { uuid: this.uuid });\n    }\n\n    updateExistingGraphics() {\n      super.updateExistingGraphics();\n      this.publish('tilesDrawn', { uuid: this.uuid });\n    }\n\n    getMouseOverHtml() {\n      return '';\n    }\n  }\n\n  return new TssTrack(...args);\n}\n\ncreateTssTrack.config = {\n  type: 'tss',\n  datatype: ['bedlike'],\n};\n\nexport default createTssTrack;\n","import { globalPubSub } from 'pub-sub-es';\n\n// Timeout requests after 10 seconds\nconst T_TIMEOUT = 10000;\n\nconst LocalCsvDataFetcher = function LocalCsvDataFetcher(HGC, ...args) {\n  if (!new.target) {\n    throw new Error(\n      'Uncaught TypeError: Class constructor cannot be invoked without \"new\"'\n    );\n  }\n\n  const createRandomId = () => Math.random().toString(36).substring(2);\n\n  class LocalBedDataFetcherClass {\n    constructor(dataConfig) {\n      this.dataConfig = dataConfig;\n    }\n\n    tilesetInfo(callback) {\n      this.tilesetInfoLoading = true;\n\n      if (!this.tilesetInfoData) {\n        this.tilesetInfoData = new Promise((resolve, reject) => {\n          const requestId = createRandomId();\n          const timeoutId = setTimeout(\n            () =>\n              reject(\n                new Error(\n                  `Could not load tileset info for ${this.dataConfig.id}`\n                )\n              ),\n            T_TIMEOUT\n          );\n          globalPubSub.subscribe(\n            `localBed:tilesetInfo:${requestId}`,\n            (tilesetInfo) => {\n              clearTimeout(timeoutId);\n              this.tilesetInfoLoading = false;\n              resolve(tilesetInfo);\n            },\n            1\n          );\n          globalPubSub.publish('localBed:requestTilesetInfo', {\n            fileId: this.dataConfig.id,\n            requestId,\n          });\n        });\n      }\n\n      this.tilesetInfoData.then((tilesetInfoData) => {\n        callback(tilesetInfoData);\n      });\n    }\n\n    /** We expect there to be a tilesetUid in the provided tilesetInfo\n     * and tiles data since tileResponseToData needs it\n     *\n     * It is also easier for users to paste in request responses for debugging.\n     */\n    fetchTilesDebounced(loadHandler, tileIds) {\n      Promise.all(tileIds.map((tileId) => this.tile(tileId.split('.')))).then(\n        (tiles) => {\n          loadHandler(\n            tiles.reduce((response, tile, i) => {\n              response[tileIds[i]] = tile;\n              return response;\n            }, {})\n          );\n        }\n      );\n    }\n\n    tile([z, x]) {\n      return new Promise((resolve, reject) => {\n        const requestId = createRandomId();\n        const timeoutId = setTimeout(\n          () =>\n            reject(\n              new Error(\n                `Could not load tile ${z}.${x} for ${this.dataConfig.id} (request: ${requestId})`\n              )\n            ),\n          T_TIMEOUT\n        );\n        globalPubSub.subscribe(\n          `localBed:tile:${requestId}`,\n          (tile) => {\n            clearTimeout(timeoutId);\n            resolve(tile);\n          },\n          1\n        );\n        globalPubSub.publish('localBed:requestTile', {\n          fileId: this.dataConfig.id,\n          z: +z,\n          x: +x,\n          requestId,\n        });\n      });\n    }\n  }\n\n  return new LocalBedDataFetcherClass(...args);\n};\n\nLocalCsvDataFetcher.config = {\n  type: 'localBed',\n};\n\nexport default LocalCsvDataFetcher;\n","import register from 'higlass-register';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport 'higlass-arcs';\n\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nimport createAnnotationOverlayMetaTrack from './annotation-overlay-meta-track';\nimport createRidgePlotTrack from './ridge-plot-track';\nimport createStratifiedBedTrack from './stratified-bed-track';\nimport createSnpTrack from './snp-track';\nimport createStackedBarTrack from './stacked-bar-track';\nimport createTssTrack from './tss-track';\n\nimport createLocalBedDataFetcher from './local-bed-data-fetcher';\n\nimport './index.css';\n\nregister(\n  {\n    dataFetcher: createLocalBedDataFetcher,\n    config: createLocalBedDataFetcher.config,\n  },\n  { pluginType: 'dataFetcher' }\n);\n\nregister({\n  track: createRidgePlotTrack,\n  config: createRidgePlotTrack.config,\n});\n\nregister({\n  track: createStratifiedBedTrack,\n  config: createStratifiedBedTrack.config,\n});\n\nregister({\n  track: createSnpTrack,\n  config: createSnpTrack.config,\n});\n\nregister({\n  track: createStackedBarTrack,\n  config: createStackedBarTrack.config,\n});\n\nregister({\n  track: createTssTrack,\n  config: createTssTrack.config,\n});\n\nregister({\n  track: createAnnotationOverlayMetaTrack,\n  config: createAnnotationOverlayMetaTrack.config,\n  isMetaTrack: true,\n});\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["higlass-scalable-arcs"]=e():t["higlass-scalable-arcs"]=e()}(window,(function(){return function(t){var e={};function o(i){if(e[i])return e[i].exports;var r=e[i]={i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=t,o.c=e,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(i,r,function(e){return t[e]}.bind(null,r));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){"use strict";o.r(e),window.higlassTracks=window.higlassTracks||{},window.higlassTracksByType=window.higlassTracksByType||{};var i=t=>{window.higlassTracks[t.name]=t,window.higlassTracksByType[t.config.type]=t},r=function(t,e){var o=Math.max(2,Math.ceil(Math.sqrt(e.length))),i=new Float32Array(4*Math.pow(o,2));return e.forEach((function(t,e){i[4*e]=t[0],i[4*e+1]=t[1],i[4*e+2]=t[2],i[4*e+3]=t[3]})),[t.Texture.fromBuffer(i,o,o),o]},n=function(t,e,o,i,r){for(var n=o-e,a=Math.sign(n),s=Math.abs(n),l=2*r,c=Math.ceil(s/l),u=0;u<c;u++)t.moveTo(e+u*l*a,i),t.lineTo(e+(u*l+r)*a,i)};function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e,o){return(s=x()?Reflect.construct:function(t,e,o){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return o&&g(r,o.prototype),r}).apply(null,arguments)}function l(t,e){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=h(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,s=!1;return{s:function(){o=t[Symbol.iterator]()},n:function(){var t=o.next();return a=t.done,t},e:function(t){s=!0,n=t},f:function(){try{a||null==o.return||o.return()}finally{if(s)throw n}}}}function c(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||h(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var o=[],i=!0,r=!1,n=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(o.push(a.value),!e||o.length!==e);i=!0);}catch(t){r=!0,n=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw n}}return o}(t,e)||h(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){if(t){if("string"==typeof t)return p(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?p(t,e):void 0}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,i=new Array(e);o<e;o++)i[o]=t[o];return i}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function y(t,e,o){return e&&d(t.prototype,e),o&&d(t,o),t}function m(t,e,o){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,o){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=k(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(o):r.value}})(t,e,o||t)}function v(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e)}function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function b(t){var e=x();return function(){var o,i=k(t);if(e){var r=k(this).constructor;o=Reflect.construct(i,arguments,r)}else o=i.apply(this,arguments);return S(this,o)}}function S(t,e){return!e||"object"!==a(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function x(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var w="\n  precision mediump float;\n  attribute vec2 aPosition;\n  attribute float aOpacity;\n  attribute float aFocused;\n\n  uniform mat3 projectionMatrix;\n  uniform mat3 translationMatrix;\n  uniform float uPointSize;\n  uniform vec4 uColor;\n  uniform vec4 uColorFocused;\n\n  varying vec4 vColor;\n  varying vec4 vColorFocused;\n  varying float vOpacity;\n  varying float vFocused;\n\n  void main(void)\n  {\n    vColor = uColor;\n    vColorFocused = uColorFocused;\n    vOpacity = aOpacity;\n    vFocused = aFocused;\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aPosition, 1.0)).xy, 0.0, 1.0);\n    gl_PointSize = uPointSize;\n  }\n",C="\n  #ifdef GL_OES_standard_derivatives\n  #extension GL_OES_standard_derivatives : enable\n  #endif\n\n  precision mediump float;\n\n  varying vec4 vColor;\n  varying vec4 vColorFocused;\n  varying float vOpacity;\n  varying float vFocused;\n\n  void main() {\n    float r = 0.0, delta = 0.0, alpha = 1.0;\n    vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n    r = dot(cxy, cxy);\n\n    #ifdef GL_OES_standard_derivatives\n      delta = fwidth(r);\n      alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\n    #endif\n\n    gl_FragColor = vec4(vColor.rgb, alpha * vColor.a);\n  }\n",M="\n  precision mediump float;\n  varying vec4 vColor;\n  varying vec4 vColorFocused;\n  varying float vOpacity;\n  varying float vFocused;\n\n  void main() {\n    float isNotFocused = 1.0 - vFocused;\n\n    float r = vColor.r * isNotFocused + vColorFocused.r * vFocused;\n    float g = vColor.g * isNotFocused + vColorFocused.g * vFocused;\n    float b = vColor.b * isNotFocused + vColorFocused.b * vFocused;\n\n    gl_FragColor = vec4(r, g, b, 1.0) * vOpacity;\n  }\n",T=["#c76526","#dca237","#eee462","#469b76","#3170ad","#6fb2e4","#000000","#999999"],F=["#a65420","#b7872e","#9f9841","#3a8162","#295d90","#4a7798","#000000","#666666"],O=["#f6e5db","#f9f0de","#fcfbe5","#e0eee8","#dde7f1","#e7f2fb","#d5d5d5","#ffffff"],A=function(t){return t.tileData.length&&void 0!==t.tileData[0].yStart},I=function(t){return t.xEnd-t.xStart},R=function(t){return Math.abs(t.xStart+(t.xEnd-t.xStart)/2-(t.yStart+(t.yEnd-t.yStart)/2))},P=function(t){return t.xStart},E=function(t){return t.xStart+(t.xEnd-t.xStart)/2},z=function(t){return t.xEnd},_=function(t){return t.yStart+(t.yEnd-t.yStart)/2},G=function(t){return Object.values(t).reduce((function(t,e){return Math.max(t,e.tileData.reduce((function(t,e){return Math.max(t,e.width)}),0))}),0)},j=function(t,e,o){var i=(o.domain()[1]-o.domain()[0])/(e.domain()[1]-e.domain()[0]),r=e.domain().map(o)[0];t.scale.x=i,t.position.x=-r*i},D=function(t){for(var e=t.libraries.PIXI,o=t.libraries.d3Scale,i=o.scaleLinear,r=o.scaleLog,a=r().domain([1,10]).range([.1,1]).clamp(!0),h=function(o){v(s,o);var r=b(s);function s(t,e){var o;return f(this,s),(o=r.call(this,t,e)).updateOptions(),o}return y(s,[{key:"initTile",value:function(t){var e=A(t),o=e?R:I,i=e?E:P,r=e?_:z;t.tileData.forEach((function(t){t.width=o(t),t.start=i(t),t.end=r(t),t.isLeftToRight=t.start<t.end}))}},{key:"updateTileWidthHistogram",value:function(t){var e=Math.max(this.dimensions[1]/this.pointSize),o=this.maxWidth/e,i=0;t.widthHistogramLeft=new Uint32Array(e),t.widthHistogramRight=new Uint32Array(e),t.tileData.forEach((function(e){var r=Math.round(e.width/o);e.histPos=e.isLeftToRight?t.widthHistogramRight[r]++:t.widthHistogramLeft[r]++,i=i>e.histPos?i:e.histPos})),t.widthHistogramMax=i}},{key:"updateWidthHistograms",value:function(){Object.values(this.fetchedTiles).forEach(this.updateTileWidthHistogram.bind(this))}},{key:"updateStratificationOption",value:function(){var o=this;if(!this.options.stratification)return this.categoryField=void 0,this.categoryToGroup=void 0,this.groupToColor=void 0,this.numGroups=0,this.numCategories=0,void(this.groupLabels=[]);this.categoryField=this.options.stratification.categoryField,this.categoryToGroup=new Map,this.categoryToY=new Map,this.groupToColor=new Map,this.numGroups=this.options.stratification.groups.length,this.groupSizes=this.options.stratification.groups.map((function(t){return t.categories.length})),this.numCategories=this.groupSizes.reduce((function(t,e){return t+e}),0),this.groupLabels=this.options.stratification.groups.map((function(t,e){return t.label||"Group ".concat(e)}));var i=0;this.options.stratification.groups.forEach((function(e,r){o.groupToColor.set(r,[t.utils.colorToHex(e.color||T[r%T.length]),t.utils.colorToHex(e.backgroundColor||O[r%T.length])]),e.categories.forEach((function(t,e){o.categoryToGroup.set(t.toLowerCase(),r),o.categoryToY.set(t.toLowerCase(),i+e)})),i+=e.categories.length})),this.groupLabelsPixiText=this.groupLabels.map((function(i,r){return new e.Text(i,{fontSize:o.labelSize,align:"right"===o.axisAlign?"right":"left",fill:t.utils.colorToHex(o.options.stratification.groups[r].axisLabelColor||F[r%F.length])})}))}},{key:"updateOptions",value:function(){var e=this;this.axisAlign=this.options.axisAlign||"left",this.labelColor=t.utils.colorToHex(this.options.labelColor||"black"),this.labelSize=this.options.labelSize||12,this.markColor=t.utils.colorToHex(this.options.markColor||"black"),this.markColorRgbNorm=this.options.markColor?t.utils.colorToRgba(this.options.markColor).slice(0,3).map((function(t){return Math.min(1,Math.max(0,t/255))})):[0,0,0],this.markOpacity=Number.isNaN(+this.options.markOpacity)?1:Math.min(1,Math.max(0,+this.options.markOpacity)),this.markSize=this.options.markSize||2,this.markColorFocus=t.utils.colorToHex(this.options.markColorFocus||"red"),this.markColorFocusRgbNorm=this.options.markColorFocus?t.utils.colorToRgba(this.options.markColorFocus).slice(0,3).map((function(t){return Math.min(1,Math.max(0,t/255))})):[1,0,0],this.markOpacityFocus=Number.isNaN(+this.options.markOpacityFocus)?this.markOpacity:Math.min(1,Math.max(0,+this.options.markOpacityFocus)),this.markSizeFocus=this.options.markSizeFocus||this.markSize,this.strokeColor=this.markColor||t.utils.colorToHex(this.options.strokeColor||"black"),this.strokeWidth=this.options.strokeWidth||this.markSize,this.getImportance=this.options.importanceField?function(t){return+t.fields[e.options.importanceField]}:function(t){return t.width};var o=this.options.importanceDomain||[1e3,1],r=i().domain(o).range([1,10]);this.opacityScale=function(t){return a(r(t))},this.focusRegion=this.options.focusRegion?this.options.focusRegion:[1/0,1/0],this.focusGene=this.options.focusGene?this.options.focusGene.toLowerCase():void 0,this.getGene=this.options.geneField?function(t){return t.fields[e.options.geneField].toLowerCase()}:void 0,this.minImportance=this.options.minImportance||0,this.updateStratificationOption(),this.updateWidthHistograms()}},{key:"rerender",value:function(t){this.options=t,this.updateOptions(),this.updateExistingGraphics()}},{key:"updateScales",value:function(){if(Object.values(this.fetchedTiles).length){var t=u(this.dimensions,2)[1],e=this.markSize/2;this.maxWidth=G(this.fetchedTiles),this.heightScale=i().domain([0,this.maxWidth]).range([Math.min(12,t/10),t]),this.fullHeightScale=i().domain([this.maxWidth,0]).range([Math.min(e,t/10),Math.max(t-e,9*t/10)]),this.fullHeightScaleInverted=i().domain([0,this.maxWidth]).range([Math.min(e,t/10),Math.max(t-e,9*t/10)]),this.incomingHeightScale=i().domain([0,this.maxWidth]).range([t/2,t]),this.outgoingHeightScale=i().domain([0,this.maxWidth]).range([t/2,0]),this.categoryHeightScale=i().domain([0,this.numCategories]).range([0,this.numCategories*this.markSize]),this.valueScale=i().domain([0,this.maxWidth]).range([t,0]),this.valueScaleInverted=i().domain([0,this.maxWidth]).range([0,t])}}},{key:"itemToIndicatorDiverging",value:function(t){return{startX:this._xScale(t.start),endX:this._xScale(t.end),startY:this.outgoingHeightScale(t.width),endY:this.incomingHeightScale(t.width),opacity:this.opacityScale(this.getImportance(t)),size:this.markSize}}},{key:"itemToIndicatorStart",value:function(t){return{x:this._xScale(t.start),y:this.fullHeightScale(t.width),opacity:this.opacityScale(this.getImportance(t)),size:this.markSize}}},{key:"itemToIndicatorEnd",value:function(t){return{x:this._xScale(t.end),y:this.fullHeightScaleInverted(t.width),opacity:this.opacityScale(this.getImportance(t)),size:this.markSize}}},{key:"itemToIndicatorCategory",value:function(t){return{cX:this._xScale(t.start),cY:this.categoryHeightScale(this.categoryToY.get(t.fields[this.categoryField].toLowerCase())),wHalf:Math.max(this.markSize/2,Math.abs(this._xScale(t.xStart)-this._xScale(t.xEnd))/2),opacity:this.opacityScale(this.getImportance(t)),focused:t.xStart<=this.focusRegion[1]&&t.xEnd>=this.focusRegion[0],size:this.markSize,sizeHalf:this.markSize/2}}},{key:"itemToIndicatorReducer",value:function(t){var e=this;return this.getGene&&this.focusGene?function(o,i){return e.getGene(i)===e.focusGene&&o.push(t(i)),o}:function(e,o){return e.push(t(o)),e}}},{key:"renderIndicatorPoints",value:function(t,o,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=a.vertexShader,l=void 0===s?w:s,u=a.fragmentShader,h=void 0===u?C:u,p=a.drawTriangles,f=void 0!==p&&p;this.drawnAtScale=i().domain(c(this.xScale().domain())).range(c(this.xScale().range()));var d=Object.values(this.fetchedTiles).flatMap((function(e){return e.tileData.reduce(t,[])})),y=new Float32Array(d.flatMap(o)),m=new Float32Array(d.flatMap(r)),v=new Float32Array(d.flatMap(n)),g=new e.UniformGroup({uPointSize:this.markSize,uColor:[].concat(c(this.markColorRgbNorm),[this.markOpacity]),uColorFocused:[].concat(c(this.markColorFocusRgbNorm),[this.markOpacity])}),b=e.Shader.from(l,h,g),S=new e.Geometry;S.addAttribute("aPosition",y,2),S.addAttribute("aOpacity",m,1),S.addAttribute("aFocused",v,1);var x=new e.Mesh(S,b,new e.State,f?e.DRAW_MODES.TRIANGLES:e.DRAW_MODES.POINTS),k=new e.Graphics;k.addChild(x),this.pMain.x=this.position[0],this.indicatorPointGraphics&&this.pMain.removeChild(this.indicatorPointGraphics),this.pMain.addChild(k),this.indicatorPointGraphics=k,j(this.indicatorPointGraphics,this._xScale,this.drawnAtScale),this.draw(),this.animate()}},{key:"renderIndicatorDistanceAxis",value:function(t){this.drawAxis(t)}},{key:"renderIndicatorCategoryAxis",value:function(){var t=this,e=u(this.dimensions,1)[0],o=u(this.position,2),i=o[0],r=o[1];this.pAxis.position.x="right"===this.axisAlign?i+e:i,this.pAxis.position.y=r,this.pAxis.clear();var a=0,s=0,l="right"===this.axisAlign?-5:5,c="right"===this.axisAlign?-e:e,h="right"===this.axisAlign?-3:3,p=this.pAxis.children.length;this.pAxis.lineStyle(1,0,1,0),this.groupLabelsPixiText.forEach((function(e,o){var i=t.categoryHeightScale(t.groupSizes[o]);s+=i,e.x=h,e.y=a+i/2,e.anchor.x="right"===t.axisAlign?1:0,e.anchor.y=.5,p<o+1&&t.pAxis.addChild(e),t.pAxis.moveTo(0,a),t.pAxis.lineTo(l,a),t.options.stratification.axisShowGroupSeparator&&n(t.pAxis,0,c,a,5),a=s})),this.pAxis.moveTo(0,0),this.pAxis.lineTo(0,s),this.pAxis.lineTo(l,s),this.options.stratification.axisShowGroupSeparator&&n(this.pAxis,0,c,s,5)}},{key:"updateIndicators",value:function(){var t=this.itemToIndicatorDiverging.bind(this),e=function(t){return[t.startX,t.startY,t.endX,t.endY]},o=function(t){return t.opacity},i=function(t){return t.focused},r=C,n=!1;"category"===this.options.indicatorStyle?(t=this.itemToIndicatorCategory.bind(this),e=function(t){return[t.cX,t.cY]},r=M,this.renderIndicatorCategoryAxis(this.valueScaleInverted)):"category-rect"===this.options.indicatorStyle?(t=this.itemToIndicatorCategory.bind(this),e=function(t){return[t.cX-t.wHalf,t.cY,t.cX+t.wHalf,t.cY,t.cX+t.wHalf,t.cY+t.size,t.cX+t.wHalf,t.cY+t.size,t.cX-t.wHalf,t.cY+t.size,t.cX-t.wHalf,t.cY]},o=function(t){return[t.opacity,t.opacity,t.opacity,t.opacity,t.opacity,t.opacity]},i=function(t){return[t.focused,t.focused,t.focused,t.focused,t.focused,t.focused]},r=M,n=!0,this.renderIndicatorCategoryAxis(this.valueScaleInverted)):"start-only"===this.options.indicatorStyle?(t=this.itemToIndicatorStart.bind(this),e=function(t){return[t.x,t.y]},this.renderIndicatorDistanceAxis(this.valueScale)):"end-only"===this.options.indicatorStyle&&(t=this.itemToIndicatorEnd.bind(this),e=function(t){return[t.x,t.y]},this.renderIndicatorDistanceAxis(this.valueScaleInverted)),t=this.itemToIndicatorReducer(t),this.renderIndicatorPoints(t,e,o,i,{fragmentShader:r,drawTriangles:n})}},{key:"updateExistingGraphics",value:function(){this.updateScales(),this.updateWidthHistograms(),"indicator"===this.options.arcStyle&&this.updateIndicators()}},{key:"drawTile",value:function(t,e){var o=this;if(t.graphics.clear(),t.tileData.length){if("indicator"===this.options.arcStyle){var i=u(this.dimensions,2),r=i[0],n=i[1];if(this.options.indicatorStyle.startsWith("category")){if(!this.options.stratification.axisNoGroupColor){var a=0,s=0;this.groupSizes.forEach((function(e,i){s+=o.categoryHeightScale(e),t.graphics.beginFill(o.groupToColor.get(i)[1]),t.graphics.drawRect(0,a,r,Math.abs(s-a)),a=s})),t.graphics.endFill()}}else{var l=Math.round(n/2)-.5;"start-only"===this.options.indicatorStyle?l=n-.5:"end-only"===this.options.indicatorStyle&&(l=.5),t.graphics.lineStyle(1,0,.2),t.graphics.moveTo(0,l),t.graphics.lineTo(r,l)}}for(var c=0;c<t.tileData.length;c++){var h=t.tileData[c];"circle"===this.options.arcStyle?this.drawCircle(t.graphics,h,e):"indicator"===this.options.arcStyle||this.drawEllipse(t.graphics,h,e)}}}},{key:"drawIndicator",value:function(t,e){var o=this._xScale(e.start),i=this._xScale(e.end),r=this.outgoingHeightScale(e.width),n=this.incomingHeightScale(e.width),a=this.opacityScale(this.getImportance(e));t.lineStyle(0,0,0),t.beginFill(4033753,a),t.drawCircle(o,r,this.pointSize),t.endFill(),t.beginFill(12680613,a),t.drawCircle(i,n,this.pointSize),t.endFill(),e.start<=this.focusRegion[1]&&e.end>=this.focusRegion[0]&&(e.start>=this.focusRegion[0]||e.end<=this.focusRegion[1])&&(t.lineStyle(this.pointSize,12680613,a),t.moveTo(o,n),t.lineTo(i,n),t.endFill())}},{key:"drawCircle",value:function(t,e,o,r){var n=this._xScale(e.start),a=this._xScale(e.end),s=u(this.dimensions,2),l=s[0],c=s[1],h=u(this.position,2)[1],p=(a-n)/2,f=(a-n)/2,d=(f*f+p*p)/(2*p),y=(n+a)/2,m=c-p+d,v="";r&&(v+="M".concat(n,",").concat(h+c)),t.moveTo(n,h+c);var g=Math.max(0,n),b=Math.min(l,a),S=this.markColor,x=this.markSize,k=this.markOpacity;e.start<=this.focusRegion[1]&&e.end>=this.focusRegion[0]&&(e.start>=this.focusRegion[0]||e.end<=this.focusRegion[1])&&(S=this.markColorFocus,x=this.markSizeFocus,k=this.markOpacityFocus),t.lineStyle(x,S,k);var w=Math.acos(Math.min(Math.max(-(g-y)/d,-1),1)),C=Math.acos(Math.min(Math.max(-(b-y)/d,-1),1));this.options.flip&&(m=0,C=-Math.PI,t.moveTo(n,0),r&&(v+="M".concat(n,",0")));for(var M=i().domain([0,9]).range([w,C]),T=0;T<10;T++){var F=y-d*Math.cos(M(T)),O=m-d*Math.sin(M(T));t.lineTo(F,O),r&&(v+="L".concat(F,",").concat(O))}r&&this.polys.push({polyStr:v,opacity:k})}},{key:"drawEllipse",value:function(t,e,o,r,n){var a=this._xScale(e.start),s=this._xScale(e.end),l=u(this.dimensions,2)[1],c=this.heightScale(e.width),h=s-a,p=h/2,f=(a+s)/2,d=l,y=Math.PI,m="";n&&(m+="M".concat(a,",").concat(l)),t.moveTo(a,l),this.options.flip&&(d=0,y=-Math.PI,t.moveTo(a,0),n&&(m+="M".concat(a,",0")));var v=this.markColor,g=this.markSize,b=this.markOpacity;e.start<=this.focusRegion[1]&&e.end>=this.focusRegion[0]&&(e.start>=this.focusRegion[0]||e.end<=this.focusRegion[1])&&(v=this.markColorFocus,g=this.markSizeFocus,b=this.markOpacityFocus),t.lineStyle(g,v,b);for(var S=10*Math.round(Math.abs(h)/200),x=i().domain([0,S-1]).range([0,y]),k=0;k<S;k++){var w=f-p*Math.cos(x(k)),C=d-c*Math.sin(x(k));t.lineTo(w,C),n&&(m+="L".concat(w,",").concat(C))}n&&this.polys.push({polyStr:m,opacity:b})}},{key:"getMouseOverHtml",value:function(){}},{key:"setPosition",value:function(t){m(k(s.prototype),"setPosition",this).call(this,t);var e=u(this.position,2);this.pMain.position.x=e[0],this.pMain.position.y=e[1]}},{key:"zoomed",value:function(t,e){this.xScale(t),this.yScale(e),this.indicatorPointGraphics&&j(this.indicatorPointGraphics,t,this.drawnAtScale),this.refreshTiles(),this.draw()}},{key:"exportSVG",value:function(){var t=this,e=null,o=null,i=u(m(k(s.prototype),"superSVG",this).call(this),2);o=i[0],e=i[1],o.setAttribute("class","exported-arcs-track");var r=document.createElement("g");e.appendChild(r),r.setAttribute("transform","translate(".concat(this.position[0],",").concat(this.position[1],")"));var n=this.options.strokeColor?this.options.strokeColor:"blue",a=this.options.strokeWidth?this.options.strokeWidth:2;return this.visibleAndFetchedTiles().forEach((function(e){t.polys=[],t.drawTile(e,!0);var o,i=l(t.polys);try{for(i.s();!(o=i.n()).done;){var s=o.value,c=s.polyStr,u=s.opacity,h=document.createElement("path");h.setAttribute("fill","transparent"),h.setAttribute("stroke",n),h.setAttribute("stroke-width",a),h.setAttribute("opacity",u),h.setAttribute("d",c),r.appendChild(h)}}catch(t){i.e(t)}finally{i.f()}})),[o,e]}}]),s}(t.tracks.HorizontalLine1DPixiTrack),p=arguments.length,d=new Array(p>1?p-1:0),g=1;g<p;g++)d[g-1]=arguments[g];return s(h,d)};D.config={type:"1d-arcs",datatype:["arcs","bedlike"],orientation:"1d",name:"Arcs1D",thumbnail:(new DOMParser).parseFromString('<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="1.5"><path d="M4 2.1L.5 3.5v12l5-2 5 2 5-2v-12l-5 2-3.17-1.268" fill="none" stroke="currentColor"/><path d="M10.5 3.5v12" fill="none" stroke="currentColor" stroke-opacity=".33" stroke-dasharray="1,2,0,0"/><path d="M5.5 13.5V6" fill="none" stroke="currentColor" stroke-opacity=".33" stroke-width=".9969299999999999" stroke-dasharray="1.71,3.43,0,0"/><path d="M9.03 5l.053.003.054.006.054.008.054.012.052.015.052.017.05.02.05.024 4 2 .048.026.048.03.046.03.044.034.042.037.04.04.037.04.036.042.032.045.03.047.028.048.025.05.022.05.02.053.016.053.014.055.01.055.007.055.005.055v.056l-.002.056-.005.055-.008.055-.01.055-.015.054-.017.054-.02.052-.023.05-.026.05-.028.048-.03.046-.035.044-.035.043-.038.04-4 4-.04.037-.04.036-.044.032-.045.03-.046.03-.048.024-.05.023-.05.02-.052.016-.052.015-.053.012-.054.01-.054.005-.055.003H8.97l-.053-.003-.054-.006-.054-.008-.054-.012-.052-.015-.052-.017-.05-.02-.05-.024-4-2-.048-.026-.048-.03-.046-.03-.044-.034-.042-.037-.04-.04-.037-.04-.036-.042-.032-.045-.03-.047-.028-.048-.025-.05-.022-.05-.02-.053-.016-.053-.014-.055-.01-.055-.007-.055L4 10.05v-.056l.002-.056.005-.055.008-.055.01-.055.015-.054.017-.054.02-.052.023-.05.026-.05.028-.048.03-.046.035-.044.035-.043.038-.04 4-4 .04-.037.04-.036.044-.032.045-.03.046-.03.048-.024.05-.023.05-.02.052-.016.052-.015.053-.012.054-.01.054-.005L8.976 5h.054zM5 10l4 2 4-4-4-2-4 4z" fill="currentColor"/><path d="M7.124 0C7.884 0 8.5.616 8.5 1.376v3.748c0 .76-.616 1.376-1.376 1.376H3.876c-.76 0-1.376-.616-1.376-1.376V1.376C2.5.616 3.116 0 3.876 0h3.248zm.56 5.295L5.965 1H5.05L3.375 5.295h.92l.354-.976h1.716l.375.975h.945zm-1.596-1.7l-.592-1.593-.58 1.594h1.172z" fill="currentColor"/></svg>',"text/xml").documentElement,availableOptions:["arcStyle","flip1D","labelPosition","labelColor","labelTextOpacity","labelBackgroundOpacity","strokeColor","strokeWidth","trackBorderWidth","trackBorderColor"],defaultOptions:{arcStyle:"ellipse",flip1D:"no",labelColor:"black",labelPosition:"hidden",strokeColor:"black",strokeWidth:1,trackBorderWidth:0,trackBorderColor:"black"},optionsInfo:{arcStyle:{name:"Arc Style",inlineOptions:{circle:{name:"Circle",value:"circle"},ellipse:{name:"Ellipse",value:"ellipse"}}}}};var L=D;function H(t){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function B(t,e,o){return(B=tt()?Reflect.construct:function(t,e,o){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return o&&J(r,o.prototype),r}).apply(null,arguments)}function W(t,e){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=Y(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,s=!1;return{s:function(){o=t[Symbol.iterator]()},n:function(){var t=o.next();return a=t.done,t},e:function(t){s=!0,n=t},f:function(){try{a||null==o.return||o.return()}finally{if(s)throw n}}}}function N(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var o=[],i=!0,r=!1,n=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(o.push(a.value),!e||o.length!==e);i=!0);}catch(t){r=!0,n=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw n}}return o}(t,e)||Y(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(t,e){if(t){if("string"==typeof t)return V(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?V(t,e):void 0}}function V(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,i=new Array(e);o<e;o++)i[o]=t[o];return i}function X(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function U(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function $(t,e,o){return e&&U(t.prototype,e),o&&U(t,o),t}function Z(t,e,o){return(Z="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,o){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=et(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(o):r.value}})(t,e,o||t)}function q(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&J(t,e)}function J(t,e){return(J=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function K(t){var e=tt();return function(){var o,i=et(t);if(e){var r=et(this).constructor;o=Reflect.construct(i,arguments,r)}else o=i.apply(this,arguments);return Q(this,o)}}function Q(t,e){return!e||"object"!==H(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function tt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function et(t){return(et=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ot=function(t){for(var e=t.libraries.d3Array.range,o=t.libraries.d3Scale.scaleBand,i=t.services.tileProxy,r=t.utils.colorToHex,n=function(t){q(a,t);var n=K(a);function a(){return X(this,a),n.apply(this,arguments)}return $(a,[{key:"setValueScale",value:function(){if(this.valueScale=null,this.options&&this.options.valueColumn){var t=this.options.colorEncodingRange?+this.options.colorEncodingRange[0]:this.minVisibleValueInTiles(+this.options.valueColumn),e=this.options.colorEncodingRange?+this.options.colorEncodingRange[1]:this.maxVisibleValueInTiles(+this.options.valueColumn);if(this.options.valueColumn){var o=N(this.makeValueScale(t,this.calculateMedianVisibleValue(+this.options.valueColumn),e,2),1);this.valueScale=o[0]}}}},{key:"finalDotYPos",value:function(t,e){return Math.max(e,Math.min(this.dimensions[1]-e,t))}},{key:"drawPoly",value:function(t,e,o,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=[e,i,o,i,o,this.dimensions[1],e,this.dimensions[1]],a=Math.max(2,o-e),s=a*(1+2*r);return t.rectGraphics.drawCircle(e,this.finalDotYPos(i,a),s),n}},{key:"renderRows",value:function(t,i,n,a,s,l){var c=this,u=+t.tileId.split(".")[0];this.initialize();for(var h=o().domain(e(n)).range([a,s]).paddingInner(0),p=this.options.focusRegion||[1/0,1/0],f=[],d=[],y=0;y<i.length;y++){for(var m=0;m<i[y].length;m++){var v=i[y][m].value,g=v.fields,b=+v.chrOffset,S=+g[1]+b,x=+g[2]+b,k=h(y)+h.step()/2;this.valueScale&&(k=this.valueScale(+g[+this.options.valueColumn-1]));var w=k,C=this._xScale(S),M=this._xScale(x);if(!(u in this.drawnRects)||!(v.uid in this.drawnRects[u])){this.drawnRects[u]||(this.drawnRects[u]={});var T=[C,M,w,v,S,x];S<=p[1]&&x>=p[0]?d.push(T):f.push(T)}}t.rectGraphics.lineStyle(0),t.rectGraphics.beginFill(16777215),f.forEach((function(e){c.drawPoly(t,e[0],e[1],e[2],!0)}));var F=this.options.markColor||"black",O=this.options.fillOpacity||.3;t.rectGraphics.lineStyle(1,r(F),O),t.rectGraphics.beginFill(r(F),O),f.forEach((function(e){var o=c.drawPoly(t,e[0],e[1],e[2]);c.drawnRects[u][e[4].uid]=[o,{start:e[4],end:e[5],value:e[3],tile:t,fill:l},t.tileId]})),F=this.options.markColorFocus||"red",O=this.options.markOpacityFocus||.6,t.rectGraphics.lineStyle(1,r(F),O),t.rectGraphics.beginFill(r(F),O),d.forEach((function(e){var o=c.drawPoly(t,e[0],e[1],e[2]);c.drawnRects[u][e[4].uid]=[o,{start:e[4],end:e[5],value:e[3],tile:t,fill:l},t.tileId]})),t.rectGraphics.endFill()}t.rectGraphics.interactive=!0,t.rectGraphics.buttonMode=!0,t.rectGraphics.mouseup=function(t){c.hoveringSnp&&c.pubSub.publish("app.click",{type:"snp",event:t,payload:c.hoveringSnp})}}},{key:"getMouseOverHtml",value:function(t,e){var o=this;if(this.hoveringSnp=void 0,!this.tilesetInfo&&!this.options.toolTip)return"";var r=this.calculateZoomLevel(),n=i.calculateTileWidth(this.tilesetInfo,r,this.tilesetInfo.tile_size),a=this._xScale.invert(t)/n,s=Math.floor(a),l=this.tileToLocalId([r,s]),c=this.fetchedTiles[l];if(!c)return"";var u=3;if(c.tileData.forEach((function(e){var i=Math.abs(o._xScale(e.xStart)-t);i<u&&(o.hoveringSnp=e,u=i)})),!this.hoveringSnp)return"";var h=this.finalDotYPos(this.valueScale(this.hoveringSnp.importance),2);if(Math.abs(h-(e-1))>6)return"";var p=this.hoveringSnp.fields[this.options.toolTip.name.field],f=(+this.hoveringSnp.fields[this.options.toolTip.value.field]).toFixed(this.options.toolTip.value.numDecimals||2),d="";return this.options.toolTip.other&&(this.options.toolTip.other.forEach((function(t){var e=t.label||"",i=(+o.hoveringSnp.fields[t.field]).toFixed(t.numDecimals||2);d+="".concat(e,": ").concat(i,";")})),d=" (".concat(d.substr(0,d.length-1),")")),"<div><strong>".concat(p,":</strong> ").concat(f).concat(d,"</div>")}},{key:"exportSVG",value:function(){var t=this,e=null,o=null,i=N(Z(et(a.prototype),"superSVG",this).call(this),2);o=i[0],e=i[1],o.setAttribute("class","exported-arcs-track");var r=document.createElement("g");e.appendChild(r),r.setAttribute("transform","translate(".concat(this.position[0],",").concat(this.position[1],")"));var n=this.options.strokeColor?this.options.strokeColor:"blue",s=this.options.strokeWidth?this.options.strokeWidth:2;return this.visibleAndFetchedTiles().forEach((function(e){t.polys=[],t.drawTile(e,!0);var o,i=W(t.polys);try{for(i.s();!(o=i.n()).done;){var a=o.value,l=a.polyStr,c=a.opacity,u=document.createElement("path");u.setAttribute("fill","transparent"),u.setAttribute("stroke",n),u.setAttribute("stroke-width",s),u.setAttribute("opacity",c),u.setAttribute("d",l),r.appendChild(u)}}catch(t){i.e(t)}finally{i.f()}})),[o,e]}}]),a}(t.tracks.BedLikeTrack),a=arguments.length,s=new Array(a>1?a-1:0),l=1;l<a;l++)s[l-1]=arguments[l];return B(n,s)};ot.config={type:"point-annotation",datatype:["arcs","bedlike"],orientation:"1d",name:"Arcs1D",thumbnail:(new DOMParser).parseFromString('<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="1.5"><path d="M4 2.1L.5 3.5v12l5-2 5 2 5-2v-12l-5 2-3.17-1.268" fill="none" stroke="currentColor"/><path d="M10.5 3.5v12" fill="none" stroke="currentColor" stroke-opacity=".33" stroke-dasharray="1,2,0,0"/><path d="M5.5 13.5V6" fill="none" stroke="currentColor" stroke-opacity=".33" stroke-width=".9969299999999999" stroke-dasharray="1.71,3.43,0,0"/><path d="M9.03 5l.053.003.054.006.054.008.054.012.052.015.052.017.05.02.05.024 4 2 .048.026.048.03.046.03.044.034.042.037.04.04.037.04.036.042.032.045.03.047.028.048.025.05.022.05.02.053.016.053.014.055.01.055.007.055.005.055v.056l-.002.056-.005.055-.008.055-.01.055-.015.054-.017.054-.02.052-.023.05-.026.05-.028.048-.03.046-.035.044-.035.043-.038.04-4 4-.04.037-.04.036-.044.032-.045.03-.046.03-.048.024-.05.023-.05.02-.052.016-.052.015-.053.012-.054.01-.054.005-.055.003H8.97l-.053-.003-.054-.006-.054-.008-.054-.012-.052-.015-.052-.017-.05-.02-.05-.024-4-2-.048-.026-.048-.03-.046-.03-.044-.034-.042-.037-.04-.04-.037-.04-.036-.042-.032-.045-.03-.047-.028-.048-.025-.05-.022-.05-.02-.053-.016-.053-.014-.055-.01-.055-.007-.055L4 10.05v-.056l.002-.056.005-.055.008-.055.01-.055.015-.054.017-.054.02-.052.023-.05.026-.05.028-.048.03-.046.035-.044.035-.043.038-.04 4-4 .04-.037.04-.036.044-.032.045-.03.046-.03.048-.024.05-.023.05-.02.052-.016.052-.015.053-.012.054-.01.054-.005L8.976 5h.054zM5 10l4 2 4-4-4-2-4 4z" fill="currentColor"/><path d="M7.124 0C7.884 0 8.5.616 8.5 1.376v3.748c0 .76-.616 1.376-1.376 1.376H3.876c-.76 0-1.376-.616-1.376-1.376V1.376C2.5.616 3.116 0 3.876 0h3.248zm.56 5.295L5.965 1H5.05L3.375 5.295h.92l.354-.976h1.716l.375.975h.945zm-1.596-1.7l-.592-1.593-.58 1.594h1.172z" fill="currentColor"/></svg>',"text/xml").documentElement,availableOptions:["arcStyle","flip1D","labelPosition","labelColor","labelTextOpacity","labelBackgroundOpacity","strokeColor","strokeWidth","trackBorderWidth","trackBorderColor"],defaultOptions:{arcStyle:"ellipse",flip1D:"no",labelColor:"black",labelPosition:"hidden",strokeColor:"black",strokeWidth:1,trackBorderWidth:0,trackBorderColor:"black"},optionsInfo:{arcStyle:{name:"Arc Style",inlineOptions:{circle:{name:"Circle",value:"circle"},ellipse:{name:"Ellipse",value:"ellipse"}}}}};var it=ot;function rt(t){return(rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nt(t,e,o){return(nt=bt()?Reflect.construct:function(t,e,o){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return o&&mt(r,o.prototype),r}).apply(null,arguments)}function at(t,e){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=ct(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,s=!1;return{s:function(){o=t[Symbol.iterator]()},n:function(){var t=o.next();return a=t.done,t},e:function(t){s=!0,n=t},f:function(){try{a||null==o.return||o.return()}finally{if(s)throw n}}}}function st(t){return function(t){if(Array.isArray(t))return ut(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||ct(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var o=[],i=!0,r=!1,n=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(o.push(a.value),!e||o.length!==e);i=!0);}catch(t){r=!0,n=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw n}}return o}(t,e)||ct(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ct(t,e){if(t){if("string"==typeof t)return ut(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?ut(t,e):void 0}}function ut(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,i=new Array(e);o<e;o++)i[o]=t[o];return i}function ht(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pt(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ft(t,e,o){return e&&pt(t.prototype,e),o&&pt(t,o),t}function dt(t,e,o){return(dt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,o){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=St(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(o):r.value}})(t,e,o||t)}function yt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&mt(t,e)}function mt(t,e){return(mt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function vt(t){var e=bt();return function(){var o,i=St(t);if(e){var r=St(this).constructor;o=Reflect.construct(i,arguments,r)}else o=i.apply(this,arguments);return gt(this,o)}}function gt(t,e){return!e||"object"!==rt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function bt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function St(t){return(St=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var xt="\nprecision mediump float;\nattribute vec2 aPosition;\nattribute float aColorIdx;\nattribute float aFocused;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform sampler2D uColorMapTex;\nuniform float uColorMapTexRes;\nuniform sampler2D uColorMapFocusTex;\nuniform float uColorMapFocusTexRes;\n\nvarying vec4 vColor;\nvarying vec4 vColorFocused;\nvarying float vFocused;\n\nvoid main(void)\n{\n  // Half a texel (i.e., pixel in texture coordinates)\n  float eps = 0.5 / uColorMapTexRes;\n  float colorRowIndex = floor((aColorIdx + eps) / uColorMapTexRes);\n  vec2 colorTexIndex = vec2(\n    (aColorIdx / uColorMapTexRes) - colorRowIndex + eps,\n    (colorRowIndex / uColorMapTexRes) + eps\n  );\n  vColor = texture2D(uColorMapTex, colorTexIndex);\n\n  float eps2 = 0.5 / uColorMapFocusTexRes;\n  float colorRowIndex2 = floor((aColorIdx + eps2) / uColorMapFocusTexRes);\n  vec2 colorTexIndex2 = vec2(\n    (aColorIdx / uColorMapFocusTexRes) - colorRowIndex2 + eps2,\n    (colorRowIndex2 / uColorMapFocusTexRes) + eps2\n  );\n  vColorFocused = texture2D(uColorMapFocusTex, colorTexIndex2);\n\n  vFocused = aFocused;\n\n  gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aPosition, 1.0)).xy, 0.0, 1.0);\n}\n",kt="\n  precision mediump float;\n\n  varying vec4 vColor;\n  varying vec4 vColorFocused;\n  varying float vFocused;\n\n  void main() {\n    float isNotFocused = 1.0 - vFocused;\n\n    float r = vColor.r * isNotFocused + vColorFocused.r * vFocused;\n    float g = vColor.g * isNotFocused + vColorFocused.g * vFocused;\n    float b = vColor.b * isNotFocused + vColorFocused.b * vFocused;\n\n    gl_FragColor = vec4(r, g, b, 1.0);\n  }\n",wt=["#c76526","#dca237","#eee462","#469b76","#3170ad","#6fb2e4","#000000","#999999"],Ct=["#a65420","#b7872e","#9f9841","#3a8162","#295d90","#4a7798","#000000","#666666"],Mt=["#f6e5db","#f9f0de","#fcfbe5","#e0eee8","#dde7f1","#e7f2fb","#d5d5d5","#ffffff"],Tt=function(t){return t.tileData.length&&void 0!==t.tileData[0].yStart},Ft=function(t){return t.xStart},Ot=function(t){return t.xStart+(t.xEnd-t.xStart)/2},At=function(t){return t.xEnd},It=function(t){return t.yStart+(t.yEnd-t.yStart)/2},Rt=function(t){return t.reduce((function(t,e){return Math.max(t,e.histogramMax)}),0)},Pt=function(t,e,o){var i=(o.domain()[1]-o.domain()[0])/(e.domain()[1]-e.domain()[0]),r=e.domain().map(o)[0];t.scale.x=i,t.position.x=-r*i},Et=function(t){return[t.xStart,t.yStart,t.xEnd,t.yStart,t.xEnd,t.yEnd,t.xStart,t.yStart,t.xStart,t.yEnd,t.xEnd,t.yEnd]},zt=function(t){return[t.colorIdx,t.colorIdx,t.colorIdx,t.colorIdx,t.colorIdx,t.colorIdx]},_t=function(t){return[t.focused,t.focused,t.focused,t.focused,t.focused,t.focused]},Gt=function(t){for(var e=t.libraries.PIXI,o=t.libraries.d3Scale,i=o.scaleLinear,n=o.scaleLog,a=t.services.tileProxy,s=t.utils.colorToHex,l=n().domain([1,10]).range([.1,1]).clamp(!0),c=function(e){return t.utils.colorToRgba(e).slice(0,3).map((function(t){return Math.min(1,Math.max(0,t/255))}))},u=function(t){yt(n,t);var o=vt(n);function n(t,e){var i;return ht(this,n),(i=o.call(this,t,e)).updateOptions(),i}return ft(n,[{key:"initTile",value:function(t){var e=Tt(t),o=e?Ot:Ft,i=e?It:At;t.tileData.forEach((function(t){t.start=o(t),t.end=i(t),t.isLeftToRight=t.start<t.end})),t.histogramMax=0,this.updateTileFocusMap(t)}},{key:"updateTileHistogram",value:function(t){var e=this,o=this.getTilePosAndDimensions(t.tileData.zoomLevel,t.tileData.tilePos),i=o.tileX,r=o.tileWidth/this.numBins;t.binXPos=new Float32Array(this.numBins+1),t.histogram1d=new Float32Array(this.numBins),t.histogram2d=new Float32Array(this.numBins*this.numGroups);for(var n=0,a=0;a<=this.numBins;a++)t.binXPos[a]=i+r*a;t.tileData.forEach((function(o){for(var a=e.categoryToGroup.get(o.fields[e.categoryField].toLowerCase()),s=e.numBins-1,l=Math.max(0,Math.min(s,Math.round((o.xStart-i)/r))),c=Math.max(0,Math.min(s,Math.round((o.xEnd-i)/r))),u=Math.abs(c-l),h=e.getImportance(o),p=a*e.numBins,f=0;f<=u;f++){var d=l+f,y=p+d;t.histogram2d[y]+=h,t.histogram1d[d]+=h,n=Math.max(n,t.histogram1d[d])}})),t.histogramMax=n}},{key:"updateHistograms",value:function(){Object.values(this.fetchedTiles).forEach(this.updateTileHistogram.bind(this))}},{key:"updateTileFocusMap",value:function(t){t.focusMap=new Float32Array(this.numBins);var e=this.getTilePosAndDimensions(t.tileData.zoomLevel,t.tileData.tilePos),o=e.tileX,i=e.tileWidth;if(o<=this.focusRegion[1]&&o+i>=this.focusRegion[0])for(var r=i/this.numBins,n=Math.max(0,Math.round((this.focusRegion[0]-o)/r)),a=Math.min(this.numBins-1,Math.round((this.focusRegion[1]-o)/r)),s=Math.abs(a-n),l=0;l<=s;l++)t.focusMap[l]=1}},{key:"updateFocusMap",value:function(){Object.values(this.fetchedTiles).forEach(this.updateTileFocusMap.bind(this))}},{key:"updateStratificationOption",value:function(){var t=this;if(!this.options.stratification)return this.categoryField=void 0,this.categoryToGroup=void 0,this.groupToColor=void 0,this.numGroups=0,this.numCategories=0,void(this.groupLabels=[]);this.categoryField=this.options.stratification.categoryField,this.categoryToGroup=new Map,this.categoryToY=new Map,this.groupToColor=new Map,this.numGroups=this.options.stratification.groups.length,this.groupSizes=this.options.stratification.groups.map((function(t){return t.categories.length})),this.numCategories=this.groupSizes.reduce((function(t,e){return t+e}),0),this.groupLabels=this.options.stratification.groups.map((function(t,e){return t.label||"Group ".concat(e)}));var o=0;this.options.stratification.groups.forEach((function(e,i){t.groupToColor.set(i,[s(e.color||wt[i%wt.length]),s(e.backgroundColor||Mt[i%Mt.length])]),e.categories.forEach((function(e,r){t.categoryToGroup.set(e.toLowerCase(),i),t.categoryToY.set(e.toLowerCase(),o+r)})),o+=e.categories.length})),this.groupLabelsPixiText=this.groupLabels.map((function(o,i){return new e.Text(o,{fontSize:t.labelSize,align:"right"===t.axisAlign?"right":"left",fill:s(t.options.stratification.groups[i].axisLabelColor||Ct[i%Ct.length])})}))}},{key:"updateOptions",value:function(){var t=this;this.axisAlign=this.options.axisAlign||"left",this.labelColor=s(this.options.labelColor||"black"),this.labelSize=this.options.labelSize||12,this.colorMap=this.options.colorMap||[].concat(wt),this.colorMapRgbNorm=this.colorMap.map(c);var o=lt(r(e,this.colorMapRgbNorm),2);this.colorMapTex=o[0],this.colorMapTexRes=o[1],this.colorMapFocus=this.options.colorMapFocus||[].concat(Ct),this.colorMapFocusRgbNorm=this.colorMapFocus.map(c);var n=lt(r(e,this.colorMapFocusRgbNorm),2);this.colorMapFocusTex=n[0],this.colorMapFocusTexRes=n[1],this.markColor=s(this.options.markColor||"black"),this.markColorRgbNorm=this.options.markColor?c(this.options.markColor):[0,0,0],this.markOpacity=Number.isNaN(+this.options.markOpacity)?1:Math.min(1,Math.max(0,+this.options.markOpacity)),this.markSize=this.options.markSize||2,this.markColorFocus=s(this.options.markColorFocus||"red"),this.markColorFocusRgbNorm=this.options.markColorFocus?c(this.options.markColorFocus):[1,0,0],this.markOpacityFocus=Number.isNaN(+this.options.markOpacityFocus)?this.markOpacity:Math.min(1,Math.max(0,+this.options.markOpacityFocus)),this.markSizeFocus=this.options.markSizeFocus||this.markSize,this.binSize=this.options.binSize||8,this.numBins=this.tilesetInfo?Math.round(this.tilesetInfo.tile_size/this.binSize):1024/this.binSize,this.getImportance=this.options.importanceField?function(e){return+e.fields[t.options.importanceField]}:function(){return 1};var a=this.options.importanceDomain||[1e3,1],u=i().domain(a).range([1,10]);this.opacityScale=function(t){return l(u(t))},this.focusRegion=this.options.focusRegion?this.options.focusRegion:[1/0,1/0],this.focusGene=this.options.focusGene?this.options.focusGene.toLowerCase():void 0,this.getGene=this.options.geneField?function(e){return e.fields[t.options.geneField].toLowerCase()}:void 0,this.minImportance=this.options.minImportance||0,this.updateStratificationOption(),this.updateFocusMap(),this.updateHistograms(),this.updateScales()}},{key:"refreshTiles",value:function(){for(var t,e=arguments.length,o=new Array(e),i=0;i<e;i++)o[i]=arguments[i];if((t=dt(St(n.prototype),"refreshTiles",this)).call.apply(t,[this].concat(o)),this.tilesetInfo){var r=this.numBins;this.numBins=Math.round(this.tilesetInfo.tile_size/this.binSize),r!==this.numBins&&(this.updateHistograms(),this.updateScales())}}},{key:"rerender",value:function(t){this.options=t,this.updateOptions(),this.updateExistingGraphics()}},{key:"updateScales",value:function(){var t=Object.values(this.fetchedTiles);if(t.length){var e=lt(this.dimensions,2)[1];this.histMax=Rt(t),this.heightScale=i().domain([0,this.histMax]).range([e,0]),this.valueScale=this.heightScale,this.valueScaleInverted=i().domain([0,this.histMax]).range([0,e])}}},{key:"itemToPoint",value:function(t){return{xStart:this._xScale(t.start),xEnd:this._xScale(t.start),yStart:this.heightScale(this.categoryToY.get(t.fields[this.categoryField].toLowerCase())),yEnd:function(){},opacity:this.opacityScale(this.getImportance(t)),focused:t.xStart<=this.focusRegion[1]&&t.xEnd>=this.focusRegion[0]}}},{key:"histToSegments",value:function(t){for(var e=[],o=0;o<this.numBins;o++){var i=0;if(t.histogram1d[o]>0)for(var r=0;r<this.numGroups;r++){var n=t.histogram2d[r*this.numBins+o];n&&(e.push({xStart:this._xScale(t.binXPos[o]),xEnd:this._xScale(t.binXPos[o+1]),yStart:this.heightScale(i),yEnd:this.heightScale(i+n),colorIdx:r%this.colorMap.length,focused:t.focusMap[o]}),i+=n)}}return e}},{key:"renderStackedBars",value:function(){this.drawnAtScale=i().domain(st(this.xScale().domain())).range(st(this.xScale().range()));var t=Object.values(this.fetchedTiles).flatMap(this.histToSegments.bind(this)),o=new Float32Array(t.flatMap(Et)),r=new Float32Array(t.flatMap(zt)),n=new Float32Array(t.flatMap(_t)),a=new e.UniformGroup({uColorMapTex:this.colorMapTex,uColorMapTexRes:this.colorMapTexRes,uColorMapFocus:this.colorMapFocusTex,uColorMapFocusTexRes:this.colorMapFocusTexRes}),s=e.Shader.from(xt,kt,a),l=new e.Geometry;l.addAttribute("aPosition",o,2),l.addAttribute("aColorIdx",r,1),l.addAttribute("aFocused",n,1);var c=new e.Mesh(l,s,new e.State,e.DRAW_MODES.TRIANGLES),u=new e.Graphics;u.addChild(c),this.pMain.x=this.position[0],this.indicatorPointGraphics&&this.pMain.removeChild(this.indicatorPointGraphics),this.pMain.addChild(u),this.indicatorPointGraphics=u,Pt(this.indicatorPointGraphics,this._xScale,this.drawnAtScale),this.draw(),this.animate()}},{key:"renderTrack",value:function(){this.drawAxis(this.valueScaleInverted),this.renderStackedBars()}},{key:"updateExistingGraphics",value:function(){this.updateHistograms(),this.updateScales(),this.renderTrack()}},{key:"getMouseOverHtml",value:function(t,e){if(!this.tilesetInfo)return"";var o=this.calculateZoomLevel(),i=a.calculateTileWidth(this.tilesetInfo,o,this.tilesetInfo.tile_size),r=this._xScale.invert(t)/i,n=Math.floor(r),s=this.tileToLocalId([o,n]),l=this.fetchedTiles[s];if(!l)return"";for(var c=r-n,u=Math.floor(this.numBins*c),h=[],p=0,f=0;f<this.numGroups;f++)p+=l.histogram2d[f*this.numBins+u],h.push(p);var d=this.heightScale.invert(e),y=h.findIndex((function(t){return t>d}));if(y>=0){var m=lt(this.groupToColor.get(y),2),v=m[0],g=m[1],b="#".concat(v.toString(16)),S="#".concat(g.toString(16)),x=h[y].toFixed(2);return'<div style="margin: 0 -0.25rem; padding: 0 0.25rem; background: '.concat(S,'"><strong style="color: ').concat(b,';">').concat(this.groupLabels[y],":</strong> ").concat(x,"</div>")}return""}},{key:"setPosition",value:function(t){dt(St(n.prototype),"setPosition",this).call(this,t);var e=lt(this.position,2);this.pMain.position.x=e[0],this.pMain.position.y=e[1]}},{key:"zoomed",value:function(t,e){this.xScale(t),this.yScale(e),this.indicatorPointGraphics&&Pt(this.indicatorPointGraphics,t,this.drawnAtScale),this.refreshTiles(),this.draw()}},{key:"exportSVG",value:function(){var t=this,e=null,o=null,i=lt(dt(St(n.prototype),"superSVG",this).call(this),2);o=i[0],e=i[1],o.setAttribute("class","exported-arcs-track");var r=document.createElement("g");e.appendChild(r),r.setAttribute("transform","translate(".concat(this.position[0],",").concat(this.position[1],")"));var a=this.options.strokeColor?this.options.strokeColor:"blue",s=this.options.strokeWidth?this.options.strokeWidth:2;return this.visibleAndFetchedTiles().forEach((function(e){t.polys=[],t.drawTile(e,!0);var o,i=at(t.polys);try{for(i.s();!(o=i.n()).done;){var n=o.value,l=n.polyStr,c=n.opacity,u=document.createElement("path");u.setAttribute("fill","transparent"),u.setAttribute("stroke",a),u.setAttribute("stroke-width",s),u.setAttribute("opacity",c),u.setAttribute("d",l),r.appendChild(u)}}catch(t){i.e(t)}finally{i.f()}})),[o,e]}}]),n}(t.tracks.HorizontalLine1DPixiTrack),h=arguments.length,p=new Array(h>1?h-1:0),f=1;f<h;f++)p[f-1]=arguments[f];return nt(u,p)};Gt.config={type:"stacked-bar",datatype:["bedlike"],orientation:"1d",name:"Arcs1D",thumbnail:(new DOMParser).parseFromString('<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="1.5"><path d="M4 2.1L.5 3.5v12l5-2 5 2 5-2v-12l-5 2-3.17-1.268" fill="none" stroke="currentColor"/><path d="M10.5 3.5v12" fill="none" stroke="currentColor" stroke-opacity=".33" stroke-dasharray="1,2,0,0"/><path d="M5.5 13.5V6" fill="none" stroke="currentColor" stroke-opacity=".33" stroke-width=".9969299999999999" stroke-dasharray="1.71,3.43,0,0"/><path d="M9.03 5l.053.003.054.006.054.008.054.012.052.015.052.017.05.02.05.024 4 2 .048.026.048.03.046.03.044.034.042.037.04.04.037.04.036.042.032.045.03.047.028.048.025.05.022.05.02.053.016.053.014.055.01.055.007.055.005.055v.056l-.002.056-.005.055-.008.055-.01.055-.015.054-.017.054-.02.052-.023.05-.026.05-.028.048-.03.046-.035.044-.035.043-.038.04-4 4-.04.037-.04.036-.044.032-.045.03-.046.03-.048.024-.05.023-.05.02-.052.016-.052.015-.053.012-.054.01-.054.005-.055.003H8.97l-.053-.003-.054-.006-.054-.008-.054-.012-.052-.015-.052-.017-.05-.02-.05-.024-4-2-.048-.026-.048-.03-.046-.03-.044-.034-.042-.037-.04-.04-.037-.04-.036-.042-.032-.045-.03-.047-.028-.048-.025-.05-.022-.05-.02-.053-.016-.053-.014-.055-.01-.055-.007-.055L4 10.05v-.056l.002-.056.005-.055.008-.055.01-.055.015-.054.017-.054.02-.052.023-.05.026-.05.028-.048.03-.046.035-.044.035-.043.038-.04 4-4 .04-.037.04-.036.044-.032.045-.03.046-.03.048-.024.05-.023.05-.02.052-.016.052-.015.053-.012.054-.01.054-.005L8.976 5h.054zM5 10l4 2 4-4-4-2-4 4z" fill="currentColor"/><path d="M7.124 0C7.884 0 8.5.616 8.5 1.376v3.748c0 .76-.616 1.376-1.376 1.376H3.876c-.76 0-1.376-.616-1.376-1.376V1.376C2.5.616 3.116 0 3.876 0h3.248zm.56 5.295L5.965 1H5.05L3.375 5.295h.92l.354-.976h1.716l.375.975h.945zm-1.596-1.7l-.592-1.593-.58 1.594h1.172z" fill="currentColor"/></svg>',"text/xml").documentElement,availableOptions:["arcStyle","flip1D","labelPosition","labelColor","labelTextOpacity","labelBackgroundOpacity","strokeColor","strokeWidth","trackBorderWidth","trackBorderColor"],defaultOptions:{arcStyle:"ellipse",flip1D:"no",labelColor:"black",labelPosition:"hidden",strokeColor:"black",strokeWidth:1,trackBorderWidth:0,trackBorderColor:"black"},optionsInfo:{arcStyle:{name:"Arc Style",inlineOptions:{circle:{name:"Circle",value:"circle"},ellipse:{name:"Ellipse",value:"ellipse"}}}}};var jt=Gt;i({name:"ScalableArcs1dTrack",track:L,config:L.config}),i({name:"SnpTrack",track:it,config:it.config}),i({name:"StackedBarTrack",track:jt,config:jt.config})}])}));